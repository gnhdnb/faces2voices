/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{188:function(t,e,n){"use strict";(function(t,r,o,c){n.d(e,"a",(function(){return xt})),n.d(e,"b",(function(){return St})),n.d(e,"c",(function(){return tu})),n.d(e,"d",(function(){return ac})),n.d(e,"e",(function(){return qs})),n.d(e,"f",(function(){return Gh})),n.d(e,"g",(function(){return us})),n.d(e,"h",(function(){return Cn})),n.d(e,"i",(function(){return Uu})),n.d(e,"j",(function(){return Gu})),n.d(e,"k",(function(){return ou})),n.d(e,"l",(function(){return ps})),n.d(e,"m",(function(){return Gn})),n.d(e,"n",(function(){return bn})),n.d(e,"o",(function(){return Sl})),n.d(e,"p",(function(){return jh})),n.d(e,"q",(function(){return Zu})),n.d(e,"r",(function(){return xc})),n.d(e,"s",(function(){return ic})),n.d(e,"t",(function(){return du})),n.d(e,"u",(function(){return ys})),n.d(e,"v",(function(){return Yn})),n.d(e,"w",(function(){return Ic})),n.d(e,"x",(function(){return ir})),n.d(e,"y",(function(){return pn})),n.d(e,"z",(function(){return Ku})),n.d(e,"A",(function(){return _s})),n.d(e,"B",(function(){return cc})),n.d(e,"C",(function(){return pc})),n.d(e,"D",(function(){return Dr})),n.d(e,"E",(function(){return ur})),n.d(e,"F",(function(){return bu})),n.d(e,"G",(function(){return ln})),n.d(e,"H",(function(){return fn})),n.d(e,"I",(function(){return dn})),n.d(e,"J",(function(){return vn})),n.d(e,"K",(function(){return mn})),n.d(e,"L",(function(){return je})),n.d(e,"M",(function(){return cr})),n.d(e,"N",(function(){return Dc})),n.d(e,"O",(function(){return pr})),n.d(e,"P",(function(){return yn}));var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function f(t,e,n,r){return new(n||(n=Promise))((function(o,a){function i(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(i,s)}u((r=r.apply(t,e||[])).next())}))}function d(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var v=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n,r=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return a(n,e[0],e[1]),e.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(e){var n=e.split(":"),r=n[0],o=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,o)}))}},t}();function a(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function i(){return s}var s=null,u=new Map,m=new Map;function y(t,e){var n=g(t,e);return u.get(n)}function x(t){for(var e=u.entries(),n=[];;){var r=e.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===t&&n.push(s)}return n}function w(t){var e=t.kernelName,n=t.backendName,r=g(e,n);if(u.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");u.set(r,t)}function p(t){var e=t.kernelName;m.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),m.set(e,t)}function g(t,e){return e+"_"+t}function _(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function C(t,e,n){return Math.max(t,Math.min(e,n))}function b(t){return t%2==0?t:t+1}function E(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function T(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function S(t,e,n){void 0===n&&(n=""),T(R(t,e),(function(){return n+" Shapes "+t+" and "+e+" must match"}))}function k(t){T(null!=t,(function(){return"The input to the tensor constructor must be a non-null value."}))}function A(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||G(t)&&!n)for(var r=0;r<t.length;++r)A(t[r],e,n);else e.push(t);return e}function I(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function R(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function O(t){return t%1==0}function D(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function M(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function N(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function F(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise((function(r,o){var a=0,i=function(){if(t())r();else{a++;var s=e(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()}))}function P(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var a=t.slice();return a[r]=e/n,a}function B(t,e){var n=e.length;return T((t=null==t?e.map((function(t,e){return e})):[].concat(t)).every((function(t){return t>=-n&&t<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t})),T(t.every((function(t){return O(t)})),(function(){return"All values in axis param must be integers but got axis "+t})),t.map((function(t){return t<0?n+t:t}))}function L(t,e){for(var n=[],r=[],o=null!=e&&Array.isArray(e)&&0===e.length,a=null==e||o?null:B(e,t).sort(),i=0,s=0;s<t.length;++s){if(null!=a){if(a[i]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===t[s]&&(n.push(t[s]),r.push(s)),a[i]<=s&&i++}1!==t[s]&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function W(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function V(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function U(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function j(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function z(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function G(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function H(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function X(t){if(null==t)return 0;var e=0;return t.forEach((function(t){return e+=t.length})),e}function K(t){return"string"==typeof t||t instanceof String}function q(t){return"boolean"==typeof t}function Y(t){return"number"==typeof t}function $(t){return Array.isArray(t)?$(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Y(t)?"float32":K(t)?"string":q(t)?"bool":"float32"}function Z(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Q(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function J(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function tt(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=A(t)),n&&U(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function et(t,e){if(0===t.length)return e[0];var n=t.reduce((function(t,e){return t*e}));if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[e+i];else{a=n[0];var s=n.slice(1),u=s.reduce((function(t,e){return t*e}));for(i=0;i<a;i++)o[i]=t(e+i*u,s,r)}return o}(0,t,e)}function nt(t,e){for(var n=ot(t,e),r=0;r<n.length;r++)n[r]=1;return n}function ot(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function it(){return i().platform.now()}function at(t){t.forEach((function(e){T(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."}))}))}function rt(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",i().platform.encode(t,e)}function st(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",i().platform.decode(t,e)}function ut(t,e,n){if(0===e)return 0;if(1===e)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=n[o]*t[o];return r}function ct(t,e,n){if(0===e)return[];if(1===e)return[t];for(var r=new Array(e),o=0;o<r.length-1;++o)r[o]=Math.floor(t/n[o]),t-=r[o]*n[o];return r[r.length-1]=t,r}Object.freeze({shuffle:_,clamp:C,nearestLargerEven:b,sum:E,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:T,assertShapesMatch:S,assertNonNull:k,flatten:A,sizeFromShape:I,isScalarShape:function(t){return 0===t.length},arraysEqual:R,isInt:O,tanh:D,sizeToSquarishShape:M,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return _(e),e},rightPad:N,repeatedTry:F,inferFromImplicitShape:P,parseAxisParam:B,squeezeShape:L,getTypedArrayFromDType:W,getArrayFromDType:V,checkConversionForErrors:U,isValidDtype:j,hasEncodingLoss:z,isTypedArray:G,bytesPerElement:H,bytesFromStringArray:X,isString:K,isBoolean:q,isNumber:Y,inferDtype:$,isFunction:Z,nearestDivisor:Q,computeStrides:J,toTypedArray:tt,toNestedArray:et,makeOnesTypedArray:nt,makeZerosTypedArray:ot,now:it,assertNonNegativeIntegerDimensions:at,fetch:function(t,e){return i().platform.fetch(t,e)},encodeString:rt,decodeString:st,locToIndex:ut,indexToLoc:ct});var lt=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new ht)}return t.prototype.profileKernel=function(t,e,n){var r,o=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,t),a.then((function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(t,n,r,a.kernelMs,e,i)}))}))})),r},t}(),ht=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o,a){var i="number"==typeof r?N(r+"ms",9):r.error,s=N(t,25),u=e.rank,c=e.size,l=N(e.shape.toString(),14),h="";for(var f in o){var d=o[f].shape||e.shape,p=d.length;h+=f+": "+p+"D "+(p>0?d:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+h+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function pt(t,e,n){return N(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":K(t)?"'"+t+"'":"bool"===n?ft(t):parseFloat(t.toFixed(7)).toString(),e)}function ft(t){return 0===t?"false":"true"}function vt(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var mt=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=I(t),null!=n){var o=n.length;T(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||V(e,this.size),this.strides=J(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),T(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return gt().makeTensor(this.values,this.shape,this.dtype)},t}(),gt=null,yt=null,bt=null,xt=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=I(t),this.strides=J(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),T(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),yt.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,yt.buffer(this.shape,this.dtype,t)]}}))}))},t.prototype.bufferSync=function(){return yt.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,et(this.shape,t)]}}))}))},t.prototype.arraySync=function(){return et(this.shape,this.dataSync())},t.prototype.data=function(){return f(this,void 0,void 0,(function(){var t,e;return d(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=gt().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(t){return st(t)}))]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},t.prototype.dataSync=function(){this.throwIfDisposed();var t=gt().readSync(this.dataId);if("string"===this.dtype)try{return t.map((function(t){return st(t)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,gt().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},t.prototype.dispose=function(){this.isDisposed||(gt().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),yt.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),yt.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),yt.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),yt.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),yt.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),yt.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),yt.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=J(e),a=function(t,e,n,r){var o=I(e),a=r[r.length-1],i=new Array(a).fill(0),s=e.length,u="complex64"===n?vt(t):t;if(s>1)for(var c=0;c<o/a;c++)for(var l=c*a,h=0;h<a;h++)i[h]=Math.max(i[h],pt(u[l+h],0,n).length);return i}(t,e,n,o),i=e.length,s=function t(e,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[pt(vt(e)[0],0,r)]:"bool"===r?[ft(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=3*s,h=Array.from(e.slice(0,l)),f=Array.from(e.slice((u-3)*s,u*s));return"complex64"===r&&(h=vt(h),f=vt(f)),["["+h.map((function(t,e){return pt(t,a[e],r)})).join(", ")+", ..., "+f.map((function(t,e){return pt(t,a[u-3+e],r)})).join(", ")+"]"]}return["["+("complex64"===r?vt(e):Array.from(e)).map((function(t,e){return pt(t,a[e],r)})).join(", ")+"]"]}var d=n.slice(1),p=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(x=g*v)+v;m.push.apply(m,t(e.slice(x,y),d,r,p,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(x=g*v)+v,m.push.apply(m,t(e.slice(x,y),d,r,p,a,g===u-1))}else for(g=0;g<u;g++){var x;y=(x=g*v)+v,m.push.apply(m,t(e.slice(x,y),d,r,p,a,g===u-1))}var b=2===c?",":"";for(m[0]="["+m[0]+b,g=1;g<m.length-1;g++)m[g]=" "+m[g]+b;var w=",\n";for(g=2;g<c;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(t,e,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(t){return"    "+t})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),yt.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),yt.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),yt.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),yt.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),yt.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),yt.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),yt.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),yt.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),yt.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),yt.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),yt.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),yt.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),bt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),yt.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),yt.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),yt.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),yt.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),yt.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),yt.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),yt.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),yt.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),yt.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),yt.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),yt.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),yt.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),yt.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),yt.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),yt.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),yt.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),yt.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),yt.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),yt.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),yt.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),yt.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),yt.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),yt.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),yt.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),yt.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),yt.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),yt.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),yt.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),yt.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),yt.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),yt.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),yt.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),yt.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),yt.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),yt.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),yt.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),yt.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),yt.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),yt.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),yt.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),yt.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),yt.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),yt.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),yt.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),yt.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),yt.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),yt.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),yt.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),yt.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),yt.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),yt.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),yt.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),yt.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),yt.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),yt.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),yt.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),yt.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),yt.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),yt.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),yt.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),yt.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),yt.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),yt.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),yt.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),yt.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),yt.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),yt.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),yt.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),yt.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),yt.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),yt.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),yt.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),yt.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),yt.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),yt.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),yt.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),yt.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),yt.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),yt.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),yt.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),yt.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),yt.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),yt.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),yt.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),yt.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),yt.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),yt.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),yt.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),yt.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),yt.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),yt.conv1d(this,t,e,n,r,o,a)},t.prototype.conv2d=function(t,e,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),yt.conv2d(this,t,e,n,r,o,a)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),yt.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),yt.depthwiseConv2d(this,t,e,n,r,o,a)},t.prototype.separableConv2d=function(t,e,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),yt.separableConv2d(this,t,e,n,r,o,a)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),yt.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),yt.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),yt.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),yt.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),gt().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),yt.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),yt.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),yt.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),yt.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),yt.stridedSlice(this,t,e,n,r,o,a,i,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),yt.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),yt.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),yt.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),yt.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),yt.spectral.irfft(this)},t}();Object.defineProperty(xt,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var wt,_t,Ct,Et,Tt,St=function(t){function e(e,n,r,o){var a=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return a.trainable=n,a.name=r,a}return h(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!R(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");gt().disposeTensor(this),this.dataId=t.dataId,gt().incRef(this,null)},e.prototype.dispose=function(){gt().disposeVariable(this),this.isDisposedInternal=!0},e}(xt);Object.defineProperty(St,Symbol.hasInstance,{value:function(t){return t instanceof xt&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(wt||(wt={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(_t||(_t={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ct||(Ct={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Et||(Et={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Tt||(Tt={}));var kt={float32:Et,int32:_t,bool:Ct,complex64:Tt};function At(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return kt[t][e]}function It(t){return At(t,"int32")}function Rt(t,e){if(t.dtype===e.dtype)return[t,e];var n=At(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Ot(t,e){T(t.dtype===e.dtype,(function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"}))}function Dt(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof xt)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,a=e;for(var i in a){var s=a[i];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}Object.freeze({makeTypesMatch:Rt,assertTypesMatch:Ot,isTensorInList:function(t,e){return e.some((function(e){return e.id===t.id}))},getTensorsInContainer:Dt});var Mt,Nt=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Ft=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Nt}return t.prototype.ready=function(){return f(this,void 0,void 0,(function(){var t,e,n;return d(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return f(this,void 0,void 0,(function(){var e,n,r;return d(this,(function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new lt(this.backendInstance),[2,!0]}}))}))},t.prototype.setupRegisteredKernels=function(){var t=this;x(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)}))},t.prototype.disposeRegisteredKernels=function(t){var e=this;x(t).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])}))},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then((function(n){return!(o<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))})).catch((function(n){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,o=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun((function(){return r.startScope(o)}),(function(){return r.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(function(t){return{x:function(){return t.toFloat()}}}),[]),e},t.prototype.runKernel=function(t,e,n,r,o){return this.runKernelFunc(null,e,null,t,n,r,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),o=0;n.forEach((function(t){o+="complex64"===t.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,o,a,i){var s,u=this;void 0===a&&(a=[]),void 0===i&&(i=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=function(t){l&&(c=t.map((function(t){return u.keep(u.clone(t))})))},p=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,g=y(r,this.backendName);return h=null!=g?function(){var t=u.backend.numDataIds();v=g.kernelFunc({inputs:e,attrs:o,backend:u.backend});var n=Array.isArray(v)?v:[v];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var s=n.map((function(t){var e=t.dataId,n=t.shape,r=t.dtype;return u.makeTensorFromDataId(e,n,r)})),c=s.filter((function(t,e){return i[e]}));return f((a||[]).slice().concat(c)),s}:function(){var e=u.backend.numDataIds();v=u.tidy((function(){return t(u.backend,f)}));var n=Array.isArray(v)?v:[v];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,(function(){return h()})):h()})),l&&this.addTapeNode(r,e,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map((function(t){return e[t].shape})),outputShapes:s.map((function(t){return t.shape}))}),Array.isArray(v)?s:s[0]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=t;"string"===n&&K(t[0])&&(o=t.map((function(t){return rt(t)})));var a=r.write(o,e,n),i=new xt(e,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=X(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},t.prototype.makeTensorFromDataId=function(t,e,n,r){var o=new xt(e,n=n||"float32",t,this.nextTensorId());return this.incRef(o,r),o},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var o=new St(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*H(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof St||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return f(this,void 0,void 0,(function(){var e,n;return d(this,(function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(t){return t.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,o){var a=this,i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:o},s=function(t){return m.get(t)}(t);null!=s&&(r=s.gradFunc),null!=r&&(i.gradient=function(t){return t=t.map((function(t,e){if(null==t){var r=n[e],o=ot(r.size,r.dtype);return a.makeTensor(o,r.shape,r.dtype)}return t})),r(t.length>1?t:t[0],o)}),this.state.activeTape.push(i)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=Dt(t),r=new Set(n.map((function(t){return t.id}))),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(t){t.kept||t.scopeId!==i.id||e.track(t)}))},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),T(e.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",t)}));T(a instanceof xt,(function(){return"The result y returned by f() must be a tensor."}));var i=function(t,e,n){for(var r={},o={},a=0;a<e.length;a++)r[e[a].id]=!0;for(a=0;a<t.length;a++){var i=(p=t[a]).inputs;for(var s in i){for(var u=i[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){p.outputs.forEach((function(t){return r[t.id]=!0})),c=!0,o[p.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var f={};for(a=t.length-1;a>=0;a--)for(i=(p=t[a]).inputs,l=0;l<p.outputs.length;l++)if(h[p.outputs[l].id]){for(var s in i)h[i[s].id]=!0,f[p.id]=!0;break}var d=[];for(a=0;a<t.length;a++){var p;if(o[(p=t[a]).id]&&f[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.state.activeTape,e,a);if(!r&&0===i.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var t,r,s={};s[a.id]=null==n?(r=nt(I(t=a.shape),"float32"),Pt.makeTensor(r,t,"float32")):n,function(t,e,n){for(var r=function(r){var o=e[r],a=[];if(o.outputs.forEach((function(e){var n=t[e.id];null!=n?a.push(n):a.push(null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(e){if(!(e in i))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(i)+".");var r=n((function(){return i[e]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[e];if(!R(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==t[a.id])t[a.id]=r;else{var s=t[a.id];t[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,i,(function(t){return o.tidy(t)}));var u=e.map((function(t){return s[t.id]}));return 0===o.state.gradientDepth&&(o.state.activeTape.forEach((function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()})),o.state.activeTape=null),{value:a,grads:u}}))},t.prototype.customGrad=function(t){var e=this;return T(Z(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];T(r.every((function(t){return t instanceof xt})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(t,e){a[e]=t})),e.runKernelFunc((function(e,o){return T((n=t.apply(void 0,r.concat([o]))).value instanceof xt,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),T(Z(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(t,e){var o=n.gradFunc(t,e),a=Array.isArray(o)?o:[o];T(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),T(a.every((function(t){return t instanceof xt})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var i={};return a.forEach((function(t,e){i[e]=function(){return t}})),i}))}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return f(this,void 0,void 0,(function(){var e,n;return d(this,(function(r){switch(r.label){case 0:return e=it(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=it()-e,[2,n]}}))}))},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Nt,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),Pt=function(){var e=function(){if(null==Mt){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==t)e=t;else if(void 0!==r)e=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Mt=e}return Mt}();if(null==e._tfengine){var n=new v(e);e._tfengine=new Ft(n)}return function(t){s=t}(e._tfengine.ENV),gt=function(){return e._tfengine},e._tfengine}();function Bt(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Lt=i();Lt.registerFlag("DEBUG",(function(){return!1}),(function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Lt.registerFlag("IS_BROWSER",(function(){return Bt()})),Lt.registerFlag("IS_NODE",(function(){return void 0!==r&&void 0!==r.versions&&void 0!==r.versions.node})),Lt.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Lt.registerFlag("PROD",(function(){return!1})),Lt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Lt.getBool("DEBUG")})),Lt.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Lt.registerFlag("IS_TEST",(function(){return!1}));var Wt,Vt,Ut,jt={},zt={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qt(t,e){jt[t]=e}function Gt(t){t in jt||(jt[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",(function(e){e.preventDefault(),delete jt[t]}),!1),1===t?e.getContext("webgl",zt)||e.getContext("experimental-webgl",zt):e.getContext("webgl2",zt)}(t));var e=jt[t];return e.isContextLost()?(delete jt[t],Gt(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),jt[t])}function Ht(t,e){return[e,t]}function Xt(t){var e=I(t);return M(Math.ceil(e/4))}function Kt(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Yt(t,e){var n,r,o,a,s,u,c,l,h,f=t;return 2===i().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,o=f.RGBA16F,a=f.RGBA32F,s=f.RED,u=4,c=1,l=f.HALF_FLOAT,h=f.FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,a=f.RGBA,s=t.RGBA,u=4,c=4,l=null!=e?e.HALF_FLOAT_OES:null,h=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:s,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:h}}function $t(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Qt(t,e))}(t),r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Wt||(Wt={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Vt||(Vt={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Ut||(Ut={}));function Zt(t){return!!(i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function Qt(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Jt(t,e,n){return _e(t,e,(function(){return t.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function te(t,e,n){var r=_e(t,e,(function(){return t.createShader(t.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if($t(t,e,(function(){return t.shaderSource(r,n)})),$t(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ee(t,e,n){var r=_e(t,e,(function(){return t.createShader(t.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if($t(t,e,(function(){return t.shaderSource(r,n)})),$t(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=oe.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),a=o.length.toString().length+2,i=o.map((function(t,e){return N((e+1).toString(),a)+t})),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var c=i.slice(0,r-1),l=i.slice(r-1,r),h=i.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+N(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var ne,re,oe=/ERROR: [0-9]+:([0-9]+):/g;function ie(t,e){return _e(t,e,(function(){return t.createProgram()}),"Unable to create WebGLProgram.")}function ae(t,e,n){if($t(t,e,(function(){return t.linkProgram(n)})),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function se(t,e,n){if($t(t,e,(function(){return t.validateProgram(n)})),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function ue(t,e,n){var r=_e(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return $t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),$t(t,e,(function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function ce(t,e,n){var r=_e(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return $t(t,e,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)})),$t(t,e,(function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function le(t,e){return _e(t,e,(function(){return t.createTexture()}),"Unable to create WebGLTexture.")}function he(t,e){var n=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function pe(t,e){return _e(t,e,(function(){return t.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function fe(t,e,n,r,o,a,i,s){var u=t.getAttribLocation(n,r);return-1!==u&&($t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,o)})),$t(t,e,(function(){return t.vertexAttribPointer(u,a,t.FLOAT,!1,i,s)})),$t(t,e,(function(){return t.enableVertexAttribArray(u)})),!0)}function de(t,e,n,r){Ce(t,r),$t(t,e,(function(){return t.activeTexture(t.TEXTURE0+r)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)}))}function ve(t,e,n,r){return _e(t,e,(function(){return t.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function me(t,e,n){return t.getUniformLocation(e,n)}function ge(t,e,n,r,o,a){$t(t,e,(function(){return de(t,e,r,a)})),$t(t,e,(function(){return t.uniform1i(o,a)}))}function ye(t,e,n,r){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)})),$t(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}))}function be(t,e,n){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)})),$t(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}))}function xe(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+we(t,e))}function we(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function _e(t,e,n,r){var o=$t(t,e,(function(){return n()}));if(null==o)throw new Error(r);return o}function Ce(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Ee(t,e){return void 0===e&&(e=2),I(t.slice(0,t.length-e))}function Te(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Se(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[Ee(t)].concat(Te(t))),e}function ke(t,e){var n;void 0===e&&(e=!1);var r=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map((function(e,n){return n>=t.length-2?b(t[n]):t[n]}))).length&&(t=[2,t[0]])),2!==t.length){var o=L(t);t=o.newShape}var a=I(t);if(t.length<=1&&a<=r)return[1,a];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var s=Ee(t),u=2,c=2;return t.length&&(u=(n=Te(t))[0],c=n[1]),M(a=s*(u/2)*(c/2)).map((function(t){return 2*t}))}return M(a)}function Ae(t){return t%2==0}function Ie(t,e){if(R(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(Ae(n)&&Ae(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&Ae(t[0])&&Ae(e[0])}function Re(t){if(null==ne){var e=Gt(t);ne=e.getParameter(e.MAX_TEXTURE_SIZE)}return ne}function Oe(t){if(null==re){var e=Gt(t);re=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,re)}function De(t){if(0===t)return 0;var e=Gt(t);return Me(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Me(e,"EXT_disjoint_timer_query")?1:0}function Me(t,e){return null!=t.getExtension(e)}function Ne(t){try{if(null!=Gt(t))return!0}catch(t){return!1}return!1}function Fe(t){if(0===t)return!1;var e=Gt(t);if(1===t){if(!Me(e,"OES_texture_float"))return!1}else if(!Me(e,"EXT_color_buffer_float"))return!1;return Be(e)}function Pe(t){if(0===t)return!1;var e=Gt(t);if(1!==t){if(Me(e,"EXT_color_buffer_float"))return Be(e);if(Me(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=Yt(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}(e,n)}return!1}return!!Me(e,"OES_texture_float")&&!!Me(e,"WEBGL_color_buffer_float")&&Be(e)}function Be(t){var e=Yt(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function Le(t){return 2===t&&null!=Gt(t).fenceSync}var We=Object.freeze({callAndCheck:$t,canBeRepresented:Zt,getWebGLErrorMessage:Qt,getExtensionOrThrow:Jt,createVertexShader:te,createFragmentShader:ee,createProgram:ie,linkProgram:ae,validateProgram:se,createStaticVertexBuffer:ue,createStaticIndexBuffer:ce,getNumChannels:function(){return 2===i().getNumber("WEBGL_VERSION")?1:4},createTexture:le,validateTextureSize:he,createFramebuffer:pe,bindVertexBufferToProgramAttribute:fe,bindTextureUnit:de,unbindTextureUnit:function(t,e,n){Ce(t,n),$t(t,e,(function(){return t.activeTexture(t.TEXTURE0+n)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:ve,getProgramUniformLocation:me,bindTextureToProgramUniformSampler:ge,bindCanvasToFramebuffer:function(t,e){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),$t(t,e,(function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)})),$t(t,e,(function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)}))},bindColorTextureToFramebuffer:ye,unbindColorTextureFromFramebuffer:be,validateFramebuffer:xe,getFramebufferErrorMessage:we,getBatchDim:Ee,getRowsCols:Te,getShapeAs3D:Se,getTextureShapeFromLogicalShape:ke,isReshapeFree:Ie,getWebGLMaxTextureSize:Re,resetMaxTextureSize:function(){ne=null},resetMaxTexturesInShader:function(){re=null},getMaxTexturesInShader:Oe,getWebGLDisjointQueryTimerVersion:De,hasExtension:Me,isWebGLVersionEnabled:Ne,isCapableOfRenderingToFloatTexture:Fe,isDownloadFloatTextureEnabled:Pe,isWebGLFenceEnabled:Le}),Ve=i();function Ue(t){i().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function je(t,e){return Pt.tidy(t,e)}function ze(t){Dt(t).forEach((function(t){return t.dispose()}))}function qe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i().getBool("IS_TEST")||console.warn.apply(console,t)}function Ge(t,e){var n=t;if(G(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||G(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&i().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||G(e)){T(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"})),T(e.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"}));for(var o=n.slice(1),a=0;a<e.length;++a)t(e[a],o,r.concat(a))}else T(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(t,r,[]),r}function He(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function Xe(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof xt)return He(r,t.dtype,e,n),t;var o=$(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),He(r,o,e,n),null==t||!G(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var a=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var s=Ge(t,o);G(t)||Array.isArray(t)||(t=[t]);var u="string"!==o?tt(t,o,i().getBool("DEBUG")):A(t,[],!0);return Pt.makeTensor(u,s,o)}function Ke(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map((function(t,r){return Xe(t,e+"["+r+"]",n)}),r)}function Ye(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function $e(t,e,n){for(var r=t.length+e.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[a++]):o.push(e[i++]);return o}function Ze(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map((function(e){return t[e]}))]}function Qe(t,e){return $e(t,e.map((function(t){return 1})),e)}function Je(t,e,n){T(Ye(e,n),(function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."}))}function tn(t,e){if(Ye(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n}function en(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}function nn(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function rn(t,e){var n=t[0].length;t.forEach((function(t,e){T(t.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"}))})),T(e>=0&&e<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=t[0];t.forEach((function(t,o){for(var a=0;a<n;a++)T(a===e||t[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function on(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function an(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Pt.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Pt.endScope(o),o}catch(t){throw Pt.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Ve.registerFlag("HAS_WEBGL",(function(){return Ve.getNumber("WEBGL_VERSION")>0})),Ve.registerFlag("WEBGL_VERSION",(function(){return Ne(2)?2:Ne(1)?1:0})),Ve.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Ve.get("WEBGL_VERSION")})),Ve.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Ve.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Ve.registerFlag("WEBGL_PACK",(function(){return Ve.getBool("HAS_WEBGL")})),Ve.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_CLIP",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Ve.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_PACK_REDUCE",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_CONV_IM2COL",(function(){return Ve.getBool("WEBGL_PACK")})),Ve.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Re(Ve.getNumber("WEBGL_VERSION"))})),Ve.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Oe(Ve.getNumber("WEBGL_VERSION"))})),Ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var t=Ve.getNumber("WEBGL_VERSION");return 0===t?0:De(t)})),Ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Ve.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t})),Ve.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Fe(Ve.getNumber("WEBGL_VERSION"))})),Ve.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Ve.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ve.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Ve.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Pe(Ve.getNumber("WEBGL_VERSION"))})),Ve.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Le(Ve.getNumber("WEBGL_VERSION"))})),Ve.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Ve.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),bt=Ue;var sn=an({complex_:function(t,e){var n=Xe(t,"real","complex"),r=Xe(e,"imag","complex");return S(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Pt.runKernelFunc((function(t){return t.complex(n,r)}),{$real:n,$imag:r})}}),un=an({real_:function(t){var e=Xe(t,"input","real");return Pt.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),cn=an({imag_:function(t){var e=Xe(t,"input","imag");return Pt.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function ln(t,e,n){return hn(t,e,Ge(t,n),n)}function hn(t,e,n,r){if(null==r&&(r=$(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!G(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){at(e);var o=I(e),a=I(n);T(o===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+a}));for(var s=0;s<n.length;++s){var u=n[s],c=s!==n.length-1||u!==I(e.slice(s));T(n[s]===e[s]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "}))}}return G(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?tt(t,r,i().getBool("DEBUG")):A(t,[],!0),Pt.makeTensor(t,e,r)}function pn(t,e){if((G(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&G(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return hn(t,[],[],e)}function fn(t,e){k(t);var n=Ge(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return hn(t,null,n,e)}function dn(t,e,n){if(k(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ge(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return hn(t,e,r,n)}function vn(t,e,n){if(k(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ge(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return hn(t,e,r,n)}function mn(t,e,n){if(k(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ge(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return hn(t,e,r,n)}function gn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=gn(t,"float32"),r=yn(t,"float32");return sn(n,r)}var o=nt(I(t),e);return Pt.makeTensor(o,t,e)}function yn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=yn(t,"float32"),r=yn(t,"float32");return sn(n,r)}var o=ot(I(t),e);return Pt.makeTensor(o,t,e)}function bn(t,e,n){return Pt.runKernelFunc((function(r){return r.fill(t,e,n)}),{})}function xn(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return yn([0],r);var o=ot(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return fn(o,r)}var wn=an({onesLike_:function(t){var e=Xe(t,"x","onesLike");if("complex64"===e.dtype){var n=wn(un(e)),r=_n(cn(e));return sn(n,r)}return Pt.runKernelFunc((function(t){return t.onesLike(e)}),{$x:e},(function(t,e){return{$x:function(){return _n(t)}}}))}}),_n=an({zerosLike_:function(t){var e=Xe(t,"x","zerosLike");return Pt.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,e){return{$x:function(){return _n(t)}}}))}}),Cn=an({concat_:function(t,e){void 0===e&&(e=0),T(t.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Ke(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")})),e=B(e,n[0].shape)[0];var r=on(n.map((function(t){return t.shape})),e);if(0===I(r))return ln([],r);if(1===(n=n.filter((function(t){return t.size>0}))).length)return n[0];var o=n.map((function(t){return t.shape}));rn(o,e);var a=n,i={axis:e};return Pt.runKernelFunc((function(t){return t.concat(n,e)}),a,(function(t){var n=o.map((function(t){return t[e]}));return tr(t,n,e).map((function(t){return function(){return t}}))}),"Concat",i)}}),En=an({concat1d_:function(t){return Cn(t,0)}}),Tn=an({concat2d_:function(t,e){return Cn(t,e)}}),Sn=an({concat3d_:function(t,e){return Cn(t,e)}}),kn=an({concat4d_:function(t,e){return Cn(t,e)}}),tr=an({split_:function(t,e,n){void 0===n&&(n=0);var r,o=Xe(t,"x","split");return n=B(n,o.shape)[0],"number"==typeof e?(T(o.shape[n]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(o.shape[n]/e)):(T(o.shape[n]===e.reduce((function(t,e){return t+e})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),Pt.runKernelFunc((function(t){return t.split(o,r,n)}),{$x:o},(function(t){return{$x:function(){return Cn(t,n)}}}))}});function An(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var In=An((function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var n=new r(t),a=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.alea=a}(0,t)})),Rn=An((function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xor128=a}(0,t)})),On=An((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)})),Dn=An((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&(a.x&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)})),Mn=An((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,a=e.i;return e.w=r=r+1640531527|0,n=o[a+34&127],t=o[a=a+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=o[a]=n^t,e.i=a,n+(r^r>>>16)|0},function(t,e){var n,r,o,a,i,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,a=-32;a<u;++a)e&&(r^=e.charCodeAt((a+32)%e.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;t.w=i,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&(a.X&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)})),Nn=An((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.tychei=a}(0,t)})),Fn=An((function(t){!function(e,r){var o,c=this,a=256,s="random",u=r.pow(a,6),l=r.pow(2,52),h=2*l,f=255;function d(t,n,f){var g=[],d=m(function t(e,n){var r,o=[],a=typeof e;if(n&&"object"==a)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==a?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,y(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(c.crypto||c.msCrypto).getRandomValues(t)),y(t)}catch(t){var n=c.navigator,i=n&&n.plugins;return[+new Date,c,i,c.screen,y(e)]}}():t,3),g),x=new v(g),b=function(){for(var t=x.g(6),e=u,n=0;t<l;)t=(t+n)*a,e*=a,n=x.g(1);for(;t>=h;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|x.g(4)},b.quick=function(){return x.g(4)/4294967296},b.double=b,m(y(x.S),e),(n.pass||f||function(t,e,n,o){return o&&(o.S&&p(o,x),t.state=function(){return p(x,{})}),n?(r[s]=t,e):t})(b,d,"global"in n?n.global:this==r,n.state)}function v(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=f&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=f&o+1],n=n*a+s[f&(s[o]=s[i=f&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}function p(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",o=0;o<r.length;)e[f&o]=f&(n^=19*e[f&o])+r.charCodeAt(o++);return y(e)}function y(t){return String.fromCharCode.apply(0,t)}if(r.seedrandom=d,m(r.random(),e),t.exports){t.exports=d;try{o=n(222)}catch(t){}}}([],Math)}));Fn.alea=In,Fn.xor128=Rn,Fn.xorwow=On,Fn.xorshift7=Dn,Fn.xor4096=Mn,Fn.tychei=Nn;var Pn=Fn.alea,Bn=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Pn(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),hr=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var o=r||Math.random();this.randu=Pn(o.toString()),this.randn=new Bn(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-a+Math.log(a)),(o=this.randu())<e||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),Ln=function(){function t(t,e,n,r){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Pn(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Wn(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",at(t),new mt(t,e,n)}var Vn=an({batchToSpaceND_:function(t,e,n){var r=Xe(t,"x","batchToSpaceND"),o=e.reduce((function(t,e){return t*e}));return T(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),T(n.length===e.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length})),T(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o})),Pt.runKernelFunc((function(t){return t.batchToSpaceND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}}))}}),Un=an({broadcastTo_:function(t,e){var n=Xe(t,"broadcastTo","x"),r=n.shape;if(e.some((function(t){return!(t>0)||t%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var o=n.shape.slice();o.length<e.length;)o.unshift(1);n=n.reshape(o)}for(var a=Array.from(e),i=e.length-1;i>=0;i--)if(n.shape[i]===e[i])a[i]=1;else if(1!==n.shape[i])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=a.map((function(t,e){return t>1?e:-1})).filter((function(t){return t>=0}));return 0===s.length?n.clone():Pt.runKernelFunc((function(t){return t.tile(n,a)}),{input:n},(function(t){return{input:function(){return t.sum(s,!0)}}}))}}),jn=an({cast_:function(t,e){var n=Xe(t,"x","cast");if(!j(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:e};return Pt.runKernelFunc((function(t){return t.cast(n,e)}),{x:n},(function(t){return{x:function(){return t.clone()}}}),"Cast",r)}}),zn=an({clone_:function(t){var e=Xe(t,"x","clone",null);return Pt.runKernelFunc((function(){return Pt.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),qn=an({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Xe(t,"x","cumsum"),a=tn([e|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=nn(1,o.rank)[0],u=Pt.runKernelFunc((function(t){return t.cumsum(i,s,n,r)}),{permutedX:i},(function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),br=an({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=Xe(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return T(o*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape})),T(a*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+e+" for depthToSpace with input shape\n          "+r.shape})),T(i%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+i+" for depthToSpace with input shape "+r.shape})),Pt.runKernelFunc((function(t){return t.depthToSpace(r,e,n)}),{$x:r})}}),Gn=an({expandDims_:function(t,e){void 0===e&&(e=0);var n=Xe(t,"x","expandDims",null);T(e<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return e<0&&(T(-(n.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),e=n.rank+e+1),r.splice(e,0,1),ir(n,r)}}),Hn=an({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=Wn([t,e],r),a=t<=e?t:e,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return cr(Gn(s,0),[n[0],1,1]);if(2===n.length)return cr(Gn(Gn(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return cr(Gn(Gn(Gn(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Xn=an({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=Xe(t,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=Pt.runKernelFunc((function(t){return t.multinomial(s,r,e,n)}),{logits2D:s});return 1===i?u.as1D():u}}),Kn=an({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=Xe(t,"indices","oneHot","int32"),a=o.shape.concat([e]);return o=o.flatten(),Pt.runKernelFunc((function(t){return t.oneHot(o,e,n,r)}),{$indices:o},(function(t){return{$indices:function(){return yn(o.shape,"float32")}}})).reshape(a)}}),Yn=an({pad_:function(t,e,n){void 0===n&&(n=0);var r=Xe(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:e,constantValue:n};return Pt.runKernelFunc((function(t){return t.pad(r,e,n)}),{x:r},(function(t){var n=e.map((function(t){return t[0]}));return{x:function(){return t.slice(n,r.shape)}}}),"PadV2",o)}}),$n=an({pad1d_:function(t,e,n){return void 0===n&&(n=0),T(2===e.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Yn(t,[e],n)}}),Zn=an({pad2d_:function(t,e,n){return void 0===n&&(n=0),T(2===e.length&&2===e[0].length&&2===e[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(t,e,n)}}),Qn=an({pad3d_:function(t,e,n){return void 0===n&&(n=0),T(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(t,e,n)}}),Jn=an({pad4d_:function(t,e,n){return void 0===n&&(n=0),T(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Yn(t,e,n)}}),er=an({rand_:function(t,e,n){var r=I(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=e();return Pt.makeTensor(o,t,n)}}),nr=an({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Bn(e,n,r,!1,o),i=Wn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),rr=an({randomGamma_:function(t,e,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new hr(e,n,r,o),i=Wn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),or=an({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Wn(t,r),i=new Ln(e,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ir=an({reshape_:function(t,e){var n=Xe(t,"x","reshape",null);e=P(e,n.size),T(n.size===I(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return Pt.runKernelFunc((function(t){return t.reshape(n,e)}),{x:n},(function(t){return{x:function(){return t.reshape(n.shape)}}}),"Reshape",r)}}),ar=an({spaceToBatchND_:function(t,e,n){var r=Xe(t,"x","spaceToBatchND");return T(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),T(n.length===e.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length})),T(r.shape.reduce((function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()})),Pt.runKernelFunc((function(t){return t.spaceToBatchND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}}))}}),sr=an({squeeze_:function(t,e){var n=Xe(t,"x","squeeze");return ir(n,L(n.shape,e).newShape)}}),ur=an({stack_:function(t,e){void 0===e&&(e=0);var n=Ke(t,"tensors","stack");if(T(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(e);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;T(e<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(t){S(o,t.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(t){T(a===t.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(t){return t.expandDims(e)}));return Cn(i,e)}}),cr=an({tile_:function(t,e){var n=Xe(t,"x","tile",null);T(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}));var r=[n],o={reps:e};return Pt.runKernelFunc((function(t,r){var o=t.tile(n,e);return r([n]),o}),{x:n},(function(t,n){var r=n[0];return{x:function(){var n=_n(r);if(1===r.rank)for(var o=0;o<e[0];++o)n=n.add(t.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<e[0];++o)for(var a=0;a<e[1];++a)n=n.add(t.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<e[0];++o)for(a=0;a<e[1];++a)for(var i=0;i<e[2];++i)n=n.add(t.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<e[0];++o)for(a=0;a<e[1];++a)for(i=0;i<e[2];++i)for(var s=0;s<e[3];++s)n=n.add(t.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",o,r)}}),lr=an({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Bn(e,n,r,!0,o),i=Wn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),pr=an({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=Xe(t,"x","unstack");T(e>=-n.shape.length&&e<n.shape.length,(function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),e<0&&(e+=n.shape.length);var r={axis:e};return Pt.runKernelFunc((function(t){return t.unstack(n,e)}),{x:n},(function(t){return{x:function(){return ur(t,e)}}}),"Unpack",r)}});function fr(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var a=e.length,i=0;i<a;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(a+1))}return o}function dr(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function vr(t,e,n,r){void 0===r&&(r=!0);var o=[];r?o.push(t[0]/n):o.push(t[0]*n);for(var a=1;a<t.length;++a)a<=e.length?r?o.push(e[a-1]*t[a]):o.push(t[a]/e[a-1]):o.push(t[a]);return o}function mr(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function gr(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function yr(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=t.shape,s=n.slice();s.pop();var u=1;for(a=r;a<t.rank;++a)u*=i[a],s.push(i[a]);var c=J(t.shape).map((function(t){return t/u})).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:yr});function xr(t){return t<=30?t:Q(t,Math.floor(Math.sqrt(t)))}function wr(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(a+" update.rank != "+(o+t.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==e.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+e.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==t[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+t[i+o]+")")}function _r(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}wr(n,e,t)}function Cr(t,e,n){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:I(e.shape)/u,sliceSize:i,strides:J(n.slice(0,o)).concat([1]),outputSize:I(n)}}Object.freeze({validateUpdateShape:wr,validateInput:_r,calculateShapes:Cr});function Er(t,e,n){T(t.rank===e.length,(function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."})),T(t.rank===n.length,(function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."}));for(var r=function(r){T(e[r]+n[r]<=t.shape[r],(function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"}))},o=0;o<t.rank;++o)r(o)}function Tr(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function Sr(t,e,n){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((e[o]-t[o])/n[o]);return r}function kr(t,e,n,r,o){var a=e[o],i=n[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),C(0,a,s-1)}function Ar(t,e,n,r,o){var a=e[o],i=n[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?C(0,a,s):C(-1,a,s-1)}function Ir(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function Rr(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}Object.freeze({assertParamsValid:Er,maskToAxes:Tr,computeOutShape:Sr,startForAxis:kr,stopForAxis:Ar,isSliceContinous:Ir,computeFlatOffset:Rr});function Or(t){return Pt.customGrad(t)}var Dr=an({softmax_:function(t,e){void 0===e&&(e=-1);var n=Xe(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return Pt.runKernelFunc((function(t,r){var o=t.softmax(n,e);return r([o]),o}),{logits:n},(function(t,n){var r=n[0],o=t.mul(r);return{logits:function(){return o.sub(o.sum([e],!0).mul(r))}}}),"Softmax",{dim:e},[],[!0])}}),Mr=an({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=Xe(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Or((function(t,n){var r=t.max(e,!0),o=t.sub(r),a=o.toFloat().sub(o.exp().sum(e,!0).log());return n([a]),{value:a,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}}))(n)}}),Nr=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),Fr=function(){function t(){}return t.prototype.time=function(t){return Pr("time")},t.prototype.read=function(t){return Pr("read")},t.prototype.readSync=function(t){return Pr("readSync")},t.prototype.numDataIds=function(){return Pr("numDataIds")},t.prototype.disposeData=function(t){return Pr("disposeData")},t.prototype.write=function(t,e,n){return Pr("write")},t.prototype.move=function(t,e,n,r){return Pr("move")},t.prototype.memory=function(){return Pr("memory")},t.prototype.floatPrecision=function(){return Pr("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return Pr("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,Pr("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return Pr("slice")},t.prototype.stridedSlice=function(t,e,n,r){return Pr("stridedSlice")},t.prototype.unstack=function(t,e){return Pr("unstack")},t.prototype.reverse=function(t,e){return Pr("reverse")},t.prototype.concat=function(t,e){return Pr("concat")},t.prototype.neg=function(t){return Pr("neg")},t.prototype.add=function(t,e){return Pr("add")},t.prototype.addN=function(t){return Pr("addN")},t.prototype.subtract=function(t,e){return Pr("subtract")},t.prototype.multiply=function(t,e){return Pr("multiply")},t.prototype.realDivide=function(t,e){return Pr("realDivide")},t.prototype.floorDiv=function(t,e){return Pr("floorDiv")},t.prototype.sum=function(t,e){return Pr("sum")},t.prototype.prod=function(t,e){return Pr("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return Pr("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return Pr("argMin")},t.prototype.argMax=function(t,e){return Pr("argMax")},t.prototype.equal=function(t,e){return Pr("equal")},t.prototype.notEqual=function(t,e){return Pr("notEqual")},t.prototype.less=function(t,e){return Pr("less")},t.prototype.lessEqual=function(t,e){return Pr("lessEqual")},t.prototype.greater=function(t,e){return Pr("greater")},t.prototype.greaterEqual=function(t,e){return Pr("greaterEqual")},t.prototype.logicalNot=function(t){return Pr("logicalNot")},t.prototype.logicalAnd=function(t,e){return Pr("logicalAnd")},t.prototype.logicalOr=function(t,e){return Pr("logicalOr")},t.prototype.where=function(t){return Pr("where")},t.prototype.select=function(t,e,n){return Pr("select")},t.prototype.topk=function(t,e,n){return Pr("topk")},t.prototype.min=function(t,e){return Pr("min")},t.prototype.minimum=function(t,e){return Pr("minimum")},t.prototype.mod=function(t,e){return Pr("mod")},t.prototype.max=function(t,e){return Pr("max")},t.prototype.maximum=function(t,e){return Pr("maximum")},t.prototype.all=function(t,e){return Pr("all")},t.prototype.any=function(t,e){return Pr("any")},t.prototype.squaredDifference=function(t,e){return Pr("squaredDifference")},t.prototype.ceil=function(t){return Pr("ceil")},t.prototype.floor=function(t){return Pr("floor")},t.prototype.round=function(t){return Pr("round")},t.prototype.sign=function(t){return Pr("sign")},t.prototype.isNaN=function(t){return Pr("isNaN")},t.prototype.isInf=function(t){return Pr("isInf")},t.prototype.isFinite=function(t){return Pr("isFinite")},t.prototype.pow=function(t,e){return Pr("pow")},t.prototype.exp=function(t){return Pr("exp")},t.prototype.expm1=function(t){return Pr("expm1")},t.prototype.softmax=function(t,e){return Pr("softmax")},t.prototype.log=function(t){return Pr("log")},t.prototype.log1p=function(t){return Pr("log1p")},t.prototype.sqrt=function(t){return Pr("sqrt")},t.prototype.rsqrt=function(t){return Pr("rsqrt")},t.prototype.square=function(t){return Pr("square")},t.prototype.reciprocal=function(t){return Pr("reciprocal")},t.prototype.relu=function(t){return Pr("relu")},t.prototype.relu6=function(t){return Pr("relu6")},t.prototype.prelu=function(t,e){return Pr("prelu")},t.prototype.elu=function(t){return Pr("elu")},t.prototype.eluDer=function(t,e){return Pr("eluDer")},t.prototype.selu=function(t){return Pr("selu")},t.prototype.int=function(t){return Pr("int")},t.prototype.clip=function(t,e,n){return Pr("clip")},t.prototype.abs=function(t){return Pr("abs")},t.prototype.complexAbs=function(t){return Pr("complexAbs")},t.prototype.sigmoid=function(t){return Pr("sigmoid")},t.prototype.softplus=function(t){return Pr("softplus")},t.prototype.sin=function(t){return Pr("sin")},t.prototype.cos=function(t){return Pr("cos")},t.prototype.tan=function(t){return Pr("tan")},t.prototype.asin=function(t){return Pr("asin")},t.prototype.acos=function(t){return Pr("acos")},t.prototype.atan=function(t){return Pr("atan")},t.prototype.atan2=function(t,e){return Pr("atan2")},t.prototype.sinh=function(t){return Pr("sinh")},t.prototype.cosh=function(t){return Pr("cosh")},t.prototype.tanh=function(t){return Pr("tanh")},t.prototype.asinh=function(t){return Pr("asinh")},t.prototype.acosh=function(t){return Pr("acosh")},t.prototype.atanh=function(t){return Pr("atanh")},t.prototype.erf=function(t){return Pr("erf")},t.prototype.step=function(t,e){return Pr("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Pr("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return Pr("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return Pr("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return Pr("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Pr("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return Pr("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return Pr("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return Pr("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return Pr("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return Pr("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return Pr("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return Pr("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return Pr("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return Pr("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return Pr("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return Pr("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return Pr("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return Pr("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return Pr("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return Pr("reshape")},t.prototype.cast=function(t,e){return Pr("cast")},t.prototype.tile=function(t,e){return Pr("tile")},t.prototype.pad=function(t,e,n){return Pr("pad")},t.prototype.transpose=function(t,e){return Pr("transpose")},t.prototype.gather=function(t,e,n){return Pr("gather")},t.prototype.gatherND=function(t,e){return Pr("gatherND")},t.prototype.scatterND=function(t,e,n){return Pr("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return Pr("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return Pr("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return Pr("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return Pr("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return Pr("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return Pr("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,o,a){return Pr("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){return Pr("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,o,a,i){return Pr("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return Pr("multinomial")},t.prototype.oneHot=function(t,e,n,r){return Pr("oneHot")},t.prototype.cumsum=function(t,e,n,r){return Pr("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return Pr("nonMaxSuppression")},t.prototype.fft=function(t){return Pr("fft")},t.prototype.ifft=function(t){return Pr("ifft")},t.prototype.complex=function(t,e){return Pr("complex")},t.prototype.real=function(t){return Pr("real")},t.prototype.imag=function(t){return Pr("imag")},t.prototype.cropAndResize=function(t,e,n,r,o,a){return Pr("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return Pr("depthToSpace")},t.prototype.split=function(t,e,n){return Pr("split")},t.prototype.sparseToDense=function(t,e,n,r){return Pr("sparseToDense")},t.prototype.diag=function(t){return Pr("diag")},t.prototype.fill=function(t,e,n){return Pr("fill")},t.prototype.onesLike=function(t){return Pr("onesLike")},t.prototype.zerosLike=function(t){return Pr("zerosLike")},t.prototype.linspace=function(t,e,n){return Pr("linspace")},t.prototype.dispose=function(){return Pr("dispose")},t}();function Pr(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Br(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var a=n-1-o,i=t[a]||1;(e[e.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function Lr(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],a=e.length-r-1,i=e[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function Wr(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var a=t[t.length-o-1];null==a&&(a=1);var i=e[e.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(a)}}return n}function Vr(t,e,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=Gr(e),c=u[0],l=u[1];if("channelsLast"===i)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[c,l,t[1],t[1]]}return jr(t,s,n,r,o,a,!1,i)}function Ur(t,e,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,c=Hr(e),l=c[0],h=c[1],f=c[2];if("NDHWC"===i)u="channelsLast",s=[l,h,f,t[4],t[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[l,h,f,t[1],t[1]]}return zr(t,s,n,r,o,!1,u,a)}function jr(t,e,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],f=u[3];if("channelsLast"===s)c=t[0],l=t[1],h=t[2],f=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],f=t[1],l=t[2],h=t[3]}var d,p=e[0],v=e[1],m=e[3],g=Gr(n),y=g[0],x=g[1],b=Gr(r),w=b[0],_=b[1],C=Xr(p,w),E=Xr(v,_),S=function(t,e,n,r,o,a,i,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var h=function(t,e,n,r,o){null==r&&(r=qr(t,e,n));var i=t[1],s=Kr((t[0]-e+2*r)/n+1,o);T(O(s),(function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"}));var u=Kr((i-e+2*r)/n+1,o);return T(O(u),(function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"})),[s,u]}([e,n],a,r,t,s);c=h[0],l=h[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/o);var f=Math.max(0,(c-1)*r+a-e),d=Math.max(0,(l-1)*o+i-n),p=Math.floor(f/2),v=f-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-a+1)/r),l=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,h,y,x,C,E,a),k=S.padInfo,A=S.outHeight,I=S.outWidth,R=i?m*f:m;return"channelsFirst"===s?d=[c,R,A,I]:"channelsLast"===s&&(d=[c,A,I,R]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:f,outHeight:A,outWidth:I,outChannels:R,padInfo:k,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:w,dilationWidth:_,inShape:t,outShape:d,filterShape:e}}function zr(t,e,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],f=u[3],d=u[4];if("channelsLast"===i)c=t[0],l=t[1],h=t[2],f=t[3],d=t[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);c=t[0],d=t[1],l=t[2],h=t[3],f=t[4]}var p,v=e[0],m=e[1],g=e[2],y=e[4],x=Hr(n),b=x[0],w=x[1],_=x[2],C=Hr(r),E=C[0],S=C[1],k=C[2],A=Xr(v,E),I=Xr(m,S),R=Xr(g,k),D=function(t,e,n,r,o,a,i,s,u,c,l){var h,f,d,p;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var v=function(t,e,n,r,o,a){null==o&&(o=qr(t,e,r));var s=t[1],u=t[2],c=Kr((t[0]-e+2*o)/r+1,a);T(O(c),(function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=Kr((s-e+2*o)/r+1,a);T(O(l),(function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"}));var h=Kr((u-e+2*o)/r+1,a);return T(O(h),(function(){return"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"})),[c,l,h,1]}([e,n,r,1],s,0,o,t,l);f=v[0],d=v[1],p=v[2]}else if("same"===t){var m=((f=Math.ceil(e/o))-1)*o+s-e,g=((d=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/i))-1)*i+c-r,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),_=g-w,C=Math.floor(y/2);h={top:w,bottom:_,left:C,right:y-C,front:x,back:b,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((e-s+1)/o),d=Math.ceil((n-u+1)/a),p=Math.ceil((r-c+1)/i)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}(o,l,h,f,b,w,_,A,I,R,s),M=D.padInfo,N=D.outDepth,F=D.outHeight,P=D.outWidth,B=a?y*d:y;return"channelsFirst"===i?p=[c,B,N,F,P]:"channelsLast"===i&&(p=[c,N,F,P,B]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:h,inWidth:f,inChannels:d,outDepth:N,outHeight:F,outWidth:P,outChannels:B,padInfo:M,strideDepth:b,strideHeight:w,strideWidth:_,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:A,effectiveFilterHeight:I,effectiveFilterWidth:R,dilationDepth:E,dilationHeight:S,dilationWidth:k,inShape:t,outShape:p,filterShape:e}}function qr(t,e,n,r){void 0===r&&(r=1);var o=Xr(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function Gr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Hr(t){return"number"==typeof t?[t,t,t]:t}function Xr(t,e){return e<=1?t:t+(t-1)*(e-1)}function Kr(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Yr(t){var e=Gr(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function $r(t,e){return Yr(t)||Yr(e)}function Zr(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Qr(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=yn(t.shape),o=t.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!z(t.dtype,e))return Pt.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var i=n.real(t);return a=i.cast(e),i.dispose(),a}if("int32"===e)return n.int(t);if("bool"===e){var s=pn(0,t.dtype);return a=n.notEqual(t,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function Jr(t,e){return Pt.makeTensorFromDataId(t.dataId,e,t.dtype)}function to(t,e,n){var r=(e-t)/(n-1),o=ot(n,"float32");o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return fn(o,"float32")}Object.freeze({castTensor:Qr,reshapeTensor:Jr,linspaceImpl:to,upcastType:At,axesAreInnerMostDims:Ye,combineLocations:$e,computeOutAndReduceShapes:Ze,expandShapeToKeepDim:Qe,assertAxesAreInnerMostDims:Je,getAxesPermutation:tn,getUndoAxesPermutation:en,getInnerMostAxes:nn,getBroadcastDims:Br,getReductionAxes:Lr,assertAndGetBroadcastShape:Wr,assertParamsConsistent:rn,computeOutShape:on,computePool2DInfo:Vr,computePool3DInfo:Ur,computeConv2DInfo:jr,computeConv3DInfo:zr,computeDefaultPad:qr,tupleValuesAreOne:Yr,eitherStridesOrDilationsAreOne:$r,convertConv2DDataFormat:Zr,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:xr});function eo(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function no(t,e){return{real:t[2*e],imag:t[2*e+1]}}function ro(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function oo(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function io(t,e,n){var r=function(t,e,n){return function(t,e,n){for(var r=0,o=t.length,a=0,i=!1;r<o;){var s=n(e,t[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(t,e,n||ao)}(t,e,n),o=r<0?-(r+1):r;t.splice(o,0,e)}function ao(t,e){return t>e?1:t<e?-1:0}function so(t,e,n,r,o){return co(t,e,n,r,o,0).selectedIndices}function uo(t,e,n,r,o,a){var i=co(t,e,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function co(t,e,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(e).map((function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}})).filter((function(t){return t.score>o})).sort(po),c=a>0?-.5/a:0,l=[],h=[];l.length<n&&u.length>0;){var f=u.pop(),d=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(d<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var y=lo(t,p,l[g]);if(y>=r){m=!0;break}if(f.score=f.score*ho(r,c,y),f.score<=o)break}f.suppressBeginIndex=l.length,m||(f.score===d?(l.push(p),h.push(f.score)):f.score>o&&io(u,f,po))}var x=l.length;return s&&(l.fill(0,x),h.fill(0,x)),{selectedIndices:fn(l,"int32"),selectedScores:fn(h,"float32"),numValidOutputs:pn(x,"int32")}}function lo(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(s-a)*(u-i),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(a,c),m=Math.max(i,l),g=Math.min(s,h),y=Math.min(u,f),x=Math.max(g-v,0)*Math.max(y-m,0);return x/(d+p-x)}function ho(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function po(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function fo(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map((function(e){o[n]=e;var a=t.slice(r,o);return r[n]+=e,a}))}function vo(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=Wn(n,t.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(t.rank),s=0;s<i.length;s++)i[s]=a[s]%t.shape[s];var u=t.locToIndex(i);o.values[r]=t.values[u]}return o.toTensor()}function mo(t,e,n,r,o){for(var a=e[e.length-1],i=[t.length/a,a],s=i[0],u=i[1],c=W(n,s*r),l=W("int32",s*r),h=0;h<s;h++){for(var f=h*u,d=t.subarray(f,f+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort((function(t,e){return e.value-t.value}));var m=h*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var x=e.slice();return x[x.length-1]=r,[ln(c,x,n),ln(l,x,"int32")]}function go(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=Wn(t,"int32"),a=Wn([n.length,t.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*t.length;a.values.set(i,s)}return a.toTensor()}var yo=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},bo=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},xo=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,a=t.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function wo(t,e){return["x","y","z","w","u","v"].slice(0,e).map((function(e){return t+"."+e}))}function _o(t,e){return 1===e?[t]:wo(t,e)}function Co(){var t,e,n,r,o,a,s,u,c,l;return 2===i().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",a="outputColor",s="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",s="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:l}}function Eo(t,e,n){void 0===n&&(n="index");var r=J(e);return r.map((function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"})).join("")}function To(t){var e=J(t).map((function(t){return t.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var So="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ko(t,e,n,r){var o=[];t.forEach((function(t){var e=I(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))}));var a,i,s=o.join("\n"),u=t.map((function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";r+=n?function t(e){var n,r,o;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Co(),"\n    vec4 "+r+"() {\n      return "+o.texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=Co();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,a=o[0],i=o[1],s=Co();if(null!=o&&R(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=e.shapeInfo.texShape,a=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(1===n[0]){var s=Fo(e,n.slice(1));return"\n        "+t(s)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+Po(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],l=a[1],h=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+l+", "+h*Math.ceil(n[1]/2)+", "+h+", b, row, col);\n      return "+Co().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),h="int b, int row, int col",f="b * "+l+" + (row / 2) * "+c+" + (col / 2)",d=2;d<n-1;d++)h="int b"+d+", "+h,f="b"+d+" * "+(l*=e[n-d-1])+" + "+f;return"\n    vec4 "+o+"("+h+") {\n      int index = "+f+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Co().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+Do(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Mo(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=Do(e);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=e.shapeInfo.texShape;if(null!=c&&R(n,c)){var a=c[0];return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+c[1]+".0, "+a+".0);\n      return sampleTexture("+r+", uv);\n    }\n  "}var s=L(n),u=s.newShape,l=s.keptDims,h=u;if(h.length<n.length){var f=Fo(e,h);return"\n      "+t(f)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Po(["row","col"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+Mo(e)+"\n      }\n    ";var d=c[0],v=c[1],p=Do(r);return 1===v?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===d?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+v+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+d+", "+v+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[1]*n[2],a=n[2],i=L(n),s=i.newShape,u=i.keptDims,l=s;if(l.length<n.length){var h=Fo(e,l);return"\n        "+t(h)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Po(["row","col","depth"],u)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+c+", "+a+", 1)));\n        "+Mo(e)+"\n      }\n    ";var f=e.shapeInfo.texShape,d=f[0],v=f[1],p=e.shapeInfo.flatOffset;return v===c&&null==p?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+v+".0, "+d+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":v===a&&null==p?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+v+".0, "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+c+" + col * "+a+" + depth + "+Do(r)+";\n        vec2 uv = uvFromFlat("+d+", "+v+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[3],a=n[2]*c,i=n[1]*a,s=L(n),u=s.newShape,l=s.keptDims;if(u.length<n.length){var h=Fo(e,u);return"\n      "+t(h)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Po(["row","col","depth","depth2"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+c+", 1)));\n        "+Mo(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,v=d[0],p=d[1];return p===i&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+c+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":p===c&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+c+" + depth2;\n      vec2 uv = uvFromFlat("+v+", "+p+", index + "+Do(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[4],a=n[3]*c,i=n[2]*a,s=n[1]*i,u=L(n),l=u.newShape,h=u.keptDims;if(l.length<n.length){var f=Fo(e,l);return"\n      "+t(f)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Po(["row","col","depth","depth2","depth3"],h)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+c+")) +\n          depth3;\n        "+Mo(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,p=v[0],m=v[1];return m===s&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+c+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===c&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+c+" + depth3 + "+Do(r)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=L(n),a=c.newShape,i=c.keptDims;if(a.length<n.length){var s=Fo(e,a);return"\n      "+t(s)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Po(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    "}var u=n[5],l=n[4]*u,h=n[3]*l,f=n[2]*h,d=n[1]*f;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+f+", "+h+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+u+", 1)));\n        "+Mo(e)+"\n      }\n    ";var v=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],y=p[1];return y===d&&null==v?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+f+", "+h+", "+l+", "+u+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":y===u&&null==v?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+f+" + depth * "+h+" +\n          depth2 * "+l+" + depth3 * "+u+" + depth4 + "+Do(r)+";\n      vec2 uv = uvFromFlat("+m+", "+y+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t);var o=t.shapeInfo.logicalShape,a=e.logicalShape;return o.length<=a.length&&(r+=n?function(t,e){var n,r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=Br(t.shapeInfo.logicalShape,e.logicalShape),c=No(s),l=s-i,h=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map((function(t){return"coords."+h[t+l]+" = 0;"})).join("\n");var f;f=s<2&&i>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+h[e+l]})).join(", ");var d="return outputValue;",p=1===I(t.shapeInfo.logicalShape),v=1===I(e.logicalShape);if(1!==i||p||v){if(p&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=i-2,g=i-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+f+");\n      "+d+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=e.texShape,i=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===u&&null==t.shapeInfo.flatOffset&&R(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=No(u),l=Br(t.shapeInfo.logicalShape,e.logicalShape),h=u-s,f=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map((function(t){return"coords."+f[t+h]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+f[e+h]})).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)})).join("\n"),c=e.texShape,l=Co(),h=function(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),f=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Ao+"\n    "+Io+"\n    "+Ro+"\n  "}(l);return e.isPacked?(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(R(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),a=o,i="",s="b, r, c",u=2;u<t.length-1;u++)i="\n      int b"+u+" = index / "+(a*=t[t.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,a,i}(e.logicalShape,c),i=function(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}(l)):(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return R(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=Eo(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=Eo(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=Eo(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=Eo(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,c),i=function(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=Oo),[f,h,i,s,a,u,n].join("\n")}var Ao="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Io="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ro="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Oo="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Do(t){return"offset"+t}function Mo(t){var e=t.name,n=I(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function No(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Fo(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Po(t,e){return e.map((function(e){return t[e]})).join(", ")}var Bo=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(t.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var o=t[t.length-1],a=Math.ceil(o/e);this.outputShape=t.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,c=u.length,l=No(c),h=_o("coords",c);if(1===a){var f=No(s=c+1);i="\n        "+f+" sourceLocR = "+f+"("+h.join()+", 0);\n        ++"+h[c-1]+";\n        "+f+" sourceLocG = "+f+"("+h.join()+", 0);\n        ++"+h[c-2]+";\n        "+f+" sourceLocA = "+f+"("+h.join()+", 0);\n        --"+h[c-1]+";\n        "+f+" sourceLocB = "+f+"("+h.join()+", 0);\n        --"+h[c-2]+";"}else s=c,i="\n        "+l+" sourceLocR = coords;\n        ++"+h[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+h[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+h[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+h[c-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),p="."+d[s-1],v=d.map((function(t){return"int "+t})),m=_o("sourceLocR",s-1).concat("inIdx.r"),g=_o("sourceLocG",s-1).concat("inIdx.g"),y=_o("sourceLocB",s-1).concat("inIdx.b"),x=_o("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",_="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+h[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+h[c-2]+" < "+(u[c-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Lo=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.top,l=u-1-t.padInfo.left,h=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wo=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=l-1-t.padInfo.front,p=h-1-t.padInfo.top,v=f-1-t.padInfo.left,m=1/(e*n*r);this.userCode="\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Vo=function(t,e,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Wr(t,e),Wr(t,n);var i="0.0";null!=r&&(Wr(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Wr(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Uo=function(t,e,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Wr(t,e),Wr(t,n);var i="vec4(0.0)";null!=r&&(Wr(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Wr(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},jo=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Wr(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},zo="return a + b;",qo="return a - b;",Go="return a * b;",Ho="return (a < 0.) ? b * a : a;",Xo=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Wr(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ko="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Yo=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Wr(e,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===I(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+No(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=_o("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},$o=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Zo=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Qo=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Jo=function(t){this.outputShape=[],this.outputShape=on(t,1),this.variableNames=t.map((function(t,e){return"T"+e}));var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var o=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=e.length,i=e[e.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},ti=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=on(t,e);var n=this.outputShape,r=n.length,o=No(r),a=_o("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((function(t,e){return"T"+e}));var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var c=i[e],l=i.slice(-2),h=i.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var d=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+ei(i,c,d)+"),\n            vec2("+ei(l,c,d)+"));\n        }"}var p=s.length,v=s[s.length-1];f+="\n        return getChannel(\n          getT"+p+"("+ei(i,c,v)+"),\n          vec2("+ei(l,c,v)+"));",this.userCode="\n      float getValue("+i.map((function(t){return"int "+t}))+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function ei(t,e,n){var r=t.indexOf(e);return t.map((function(t,e){return e===r?t+" - "+n:t})).join()}var ni=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,a="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ri=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a="channelsLast"===t.dataFormat,i=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},oi=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,a=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+o+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ii=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ai=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},si=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.top,i=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ui=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,a=t.padInfo.left,i=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4,p="channelsLast"===t.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",x="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===d)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===d)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===d)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+x+"\n        setOutput(result);\n      }\n    "},ci=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},hi=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=t.outChannels/t.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},pi=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var g=0;g<d;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<f;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(g=2*y)*h+";\n        ",1===c){if(g<d&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<d)){var x=s%2==0?b(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<d&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<d&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<d&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<d&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<d&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<f;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var w="",_="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",_="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+_+"\n        setOutput(result);\n      }\n    "},fi=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=t[0],i=t[1],s=t[2],u=t[3],c=e[0],l=n[0],h=n[1];this.outputShape=[c,l,h,u];var f="bilinear"===r?1:0,d=[i-1+".0",s-1+".0"],p=d[0],v=d[1],m=l>1?[""+(i-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],x=m[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=b[0],_=b[1],C=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+_+";\n\n        float in_y = "+x+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+f+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},di=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+No(r)+" coords = getOutputCoords();\n        int end = "+vi(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+vi(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function vi(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var mi=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Wt.DENSE;var e=Xt(t),n=Co();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eo(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},gi=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Wt.DENSE;var e=Xt(t),n=Co();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eo(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},yi=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),bi=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},xi=function(t){this.variableNames=["A"],this.outTexUsage=Vt.DOWNLOAD;var e=Co();this.outputShape=t,this.userCode="\n      "+So+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},wi=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Vt.DOWNLOAD;var e=Co();this.outputShape=t,this.userCode="\n      "+So+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},li=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Co(),o=e[0],a=e[1];this.outputShape=t;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+To(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},_i=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Co(),o=e[0],a=e[1];this.outputShape=t;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+To(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Ci=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ei=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),Ti=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=No(this.rank),a=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<t.length;a++)a===e?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Si=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=No(e.length),o=No(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function ki(t,e){var n=Co();return te(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ai(t,e){return ue(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ii(t,e){return ce(t,e,new Uint16Array([0,1,2,2,1,3]))}function Ri(t,e,n,r,o,a,i){he(n,r);var s=le(t,e),u=t.TEXTURE_2D;return $t(t,e,(function(){return t.bindTexture(u,s)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)})),$t(t,e,(function(){return t.texImage2D(u,0,o,n,r,0,a,i,null)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)})),s}function Oi(t,e,n,r,o){var a=Ht(n,r);return Ri(t,e,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function Di(t,e,n,r,o){var a=Ht(n,r);return Ri(t,e,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Mi(t,e,n,r,o){var a=Ht(n,r);return Ri(t,e,a[0],a[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Ni(t,e,n,r,o){var a=Kt(n,r);return Ri(t,e,a[0],a[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Fi(t,e,n,r,o){var a=Kt(n,r);return Ri(t,e,a[0],a[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function Pi(t,e,n,r){return $t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),fe(t,e,n,"clipSpacePos",r,3,20,0)&&fe(t,e,n,"uv",r,2,20,12)}function Bi(t,e,n,r,o,a,i){var s,u,c;$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=i.internalFormatPackedFloat),s.set(a),$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function Li(t,e,n,r){$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),r.data instanceof Uint8Array?$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)})):$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function Wi(t,e,n,r,o){var a=t.createBuffer();$t(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,a)}));var i=16*n*r;return $t(t,e,(function(){return t.bufferData(t.PIXEL_PACK_BUFFER,i,t.STREAM_READ)})),$t(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)})),$t(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)})),a}function Vi(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Ui(t,e,n,r,o){var a=Ht(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return $t(t,e,(function(){return t.readPixels(0,0,i,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function ji(t,e,n,r,o,a,i,s){var u=t,c=new Float32Array(function(t,e){var n=Kt(t,e);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function zi(t,e,n,r){var o=new Float32Array(n*r*4);return $t(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)})),o}var qi=Object.freeze({createVertexShader:ki,createVertexBuffer:Ai,createIndexBuffer:Ii,createFloat32MatrixTexture:Oi,createFloat16MatrixTexture:Di,createUnsignedBytesMatrixTexture:Mi,createPackedMatrixTexture:Ni,createFloat16PackedMatrixTexture:Fi,bindVertexProgramAttributeStreams:Pi,uploadDenseMatrixToTexture:Bi,uploadPixelDataToTexture:Li,createBufferFromOutputTexture:Wi,downloadFloat32MatrixFromBuffer:Vi,downloadByteEncodedFloatMatrixFromOutputTexture:Ui,downloadPackedMatrixFromBuffer:ji,downloadMatrixFromPackedOutputTexture:zi}),Gi=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=i().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,qt(e,t)):this.gl=Gt(e);var n="WEBGL_color_buffer_float";if(1===i().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Jt(this.gl,this.debug,"OES_texture_float"),Me(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Jt(this.gl,this.debug,"OES_texture_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Me(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Jt(this.gl,this.debug,"EXT_color_buffer_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Me(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Me(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ai(this.gl,this.debug),this.indexBuffer=Ii(this.gl,this.debug),this.framebuffer=pe(this.gl,this.debug),this.textureConfig=Yt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return i().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;$t(e,this.debug,(function(){return e.finish()})),$t(e,this.debug,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),$t(e,this.debug,(function(){return e.deleteFramebuffer(t.framebuffer)})),$t(e,this.debug,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),$t(e,this.debug,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),$t(e,this.debug,(function(){return e.deleteBuffer(t.indexBuffer)})),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Oi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),Di(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),Mi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Li(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),Bi(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Fi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Ni(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(be(this.gl,this.debug,this.framebuffer),this.outputTexture=null),$t(this.gl,this.debug,(function(){return e.gl.deleteTexture(t)}))},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return Ui(r.gl,r.debug,e,n,r.textureConfig)}))},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,a){return ji(this.gl,t,0,0,0,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return Vi(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Wi(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(i().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(a,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=a}else i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return zi(r.gl,r.debug,e,n)}))},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=ee(e,this.debug,t),r=ki(e,this.debug),o=ie(e,this.debug);return $t(e,this.debug,(function(){return e.attachShader(o,r)})),$t(e,this.debug,(function(){return e.attachShader(o,n)})),ae(e,this.debug,o),this.debug&&se(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Pi(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&$t(this.gl,this.debug,(function(){return e.gl.deleteProgram(t)}))},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&se(this.gl,this.debug,this.program),$t(this.gl,this.debug,(function(){return e.gl.useProgram(t)}))},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ve(this.gl,this.debug,t,e):me(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return n.gl.getAttribLocation(t,e)}))},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),ge(this.gl,this.debug,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Kt(e,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(t,o,a)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&se(this.gl,this.debug,this.program),xe(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),$t(t,this.debug,(function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}))},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return t.gl.finish()}))},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Jt(this.gl,this.debug,2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return f(this,void 0,void 0,(function(){var e=this;return d(this,(function(n){switch(n.label){case 0:return[4,F((function(){return e.disposed||e.isQueryAvailable(t,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(t,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise((function(n){e.addItemToPoll((function(){return t.isFencePassed()}),(function(){return n()}))}))},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map((function(t){return t.isDoneFn}))),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||F((function(){return n.pollItems(),0===n.itemsToPoll.length}))},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),ye(this.gl,this.debug,t,this.framebuffer),this.debug&&xe(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(ye(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&xe(this.gl)):be(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;ye(r,this.debug,t,this.framebuffer),this.debug&&xe(r),this.outputTexture=t,$t(r,this.debug,(function(){return r.viewport(0,0,e,n)})),$t(r,this.debug,(function(){return r.scissor(0,0,e,n)}))},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return o.gl.scissor(t,e,n,r)}))},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function Hi(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach((function(t,n){var r=t.logicalShape,o=e[n],a=o.shape;if(!R(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var i=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!R(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}}))}var Xi=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,h=n.dataFormat,f=s.left,d=s.top,p=o*r,v=Co(),m="channelsLast"===h,g=m?0:1,y=m?1:2,x="",b=0;b<=1;b++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+d+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+e[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+v.output+" = result;\n      }\n    "},Ki=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Yi=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},$i=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Zi=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,a=t.effectiveFilterWidth,i=o-1-t.padInfo.top,s=a-1-t.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qi=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=s-1-t.padInfo.front,h=u-1-t.padInfo.top,f=c-1-t.padInfo.left,d=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+h+", "+f+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+d+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ji=function(t,e,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=n?t[1]:t[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";a&&(d=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+f[0]+");\n          result += ("+h[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},ta=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),ea=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},na=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=_o("rc",e),r=No(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),a=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),i=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<t;i++)a=e[e.length-1-i]+","+a;n.push(a)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},ra=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));var r=t.length,o=No(r),a=e.map((function(t){return t[0]})).join(","),i=e.map((function(e,n){return e[0]+t[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},oa=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));for(var r=t.length,o=No(r),a=e.map((function(t){return t[0]})).join(","),i=e.map((function(e,n){return e[0]+t[n]})).join(","),s=_o("rc",r),u=_o("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+h[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";d+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "},ia=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var f="avg"===e,d="0.0";if(f||(d="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},aa=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===e,g="0.0";if(m||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+a+", "+i+");\n        const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var x=4*Math.floor(r/4),b=r%4,w="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+x+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+x+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},sa=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===e?i="1.0":"min"===e?(i="1.0 / 1e-20",s="min"):"max"===e&&(i="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===e?(i="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===e&&(i="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var d="";o%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},ua=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Eo(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+To(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},ca=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],a=r[2],i=t.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],f=c[1]/l[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},la=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ha=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},pa=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],a=r[2],i=t.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],f=c[1]/l[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},fa=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},da=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map((function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=No(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},va=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=_o("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=No(n);function s(n){var r=t.map((function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(t){return s(t)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},ma=function(t,e,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=No(o.length),u=No(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var f="getUpdates("+h+")",d=e>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+f+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ga=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,a=t.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},ya=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<e.length;u++)s.push(""+a[u]),u<t&&i.push(""+a[u]);r=i.join(),o=s.join()}var c=No(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ba=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=No(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return xa.slice(0,t).map((function(t){return"sourceLoc."+t})).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map((function(t,e){return"sourceLoc."+xa[e]+" = start["+e+"] + coords."+xa[e]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),xa=["x","y","z","w","u","v"],wa=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=No(this.rank),n=_o("coords",this.rank),r=_o("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map((function(t,e){return"start["+e+"]"})).join()+");":t.map((function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),_a=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=No(n.length),a=No(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map((function(t,e){return s++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"})).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},Ca=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=Ea(e,n),a=Ta(t,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Ut.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Ut.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Ut.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Ut.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Ut.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=Ta(e,Ea(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(t);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));for(var e in this.usedTextures)this.usedTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Ea(t,e){if(t===Vt.UPLOAD)return Ut.PACKED_2X2_FLOAT32;if(t===Vt.RENDER||null==t)return function(t){return i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Ut.PACKED_2X2_FLOAT32:Ut.UNPACKED_FLOAT32:t?Ut.PACKED_2X2_FLOAT16:Ut.UNPACKED_FLOAT16}(e);if(t===Vt.DOWNLOAD||t===Vt.PIXELS)return Ut.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Ta(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Sa=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=No(this.rank),a=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},ka=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=No(this.rank),a=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Aa=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=No(this.rank),a=wo("rc",this.rank),i=new Array(this.rank);for(r=0;r<e.length;r++)i[e[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ia=1.7580993408473768,Ra=1.0507009873554805,Oa=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Da="if (isnan(x)) return x;",Ma="return abs(x);",Na=Da+"\n  return (x < 0.0) ? 0.0 : x;\n",Fa=Da+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Pa="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ba="return -x;",La="return ceil(x);",Wa="return floor(x);",Va="return exp(x);",Ua="return exp(x) - 1.0;",ja="return x;",za="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",qa="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ga="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Ha=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Xa=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=_o("rc",e),r=No(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),a=n.slice(-2),i=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},Ka={};function Ya(t,e){if(void 0===e&&(e=!1),"linear"===t)return"return x;";if("relu"===t)return e?za:Na;if("elu"===t)return e?Ga:Pa;if("relu6"===t)return e?qa:Fa;if("prelu"===t)return e?Ko:Ho;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var $a=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!i().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=Gt(i().getNumber("WEBGL_VERSION"));r.binaryCache=((n=i().getNumber("WEBGL_VERSION"))in Ka||(Ka[n]={}),Ka[n]),r.gpgpu=new Gi(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new Ca(r.gpgpu),r.numMBBeforeWarning=null==i().global.screen?1024:i().global.screen.height*i().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Nr(r,Pt),r}return h(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(i().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:Vt.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(i().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:Vt.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,a=e.slice,i=e.shape,s=e.isPacked;if(null!=a){var u;u=s?new Ha(i,ja):new Oa(i,ja);var c=this.runWebGLProgram(u,[{dataId:t,shape:i,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var h,f,d=null!=this.activeTimers;return d&&(h=it()),f="complex64"===r?eo(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),d&&(this.downloadWaitMs+=it()-h),this.convertAndCacheOnCPU(t,f)},e.prototype.read=function(t){return f(this,void 0,void 0,(function(){var e,n,r,a,s,u,o,c,l,h,f,p,v,m,g,y,x,b,w,_,C,E;return d(this,(function(d){switch(d.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise((function(t){return e.push(t)}))];if(n=this.texData.get(t),r=n.values,a=n.shape,s=n.slice,u=n.dtype,o=n.complexTensors,c=n.isPacked,null!=s)return void 0,l=c?new Ha(a,ja):new Oa(a,ja),h=this.runWebGLProgram(l,[{dataId:t,shape:a,dtype:u}],u),f=this.read(h.dataId),this.disposeData(h.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===i().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&i().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[m.texture].concat(Xt(a)))),this.pendingRead.set(t,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:d.sent(),d.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([o.real.data(),o.imag.data()])];case 3:return y=d.sent(),x=y[0],b=y[1],g=eo(x,b),[3,5];case 4:null==p?g=this.getValuesFromTexture(t):(w=I(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),d.label=5;case 5:return null!=v&&this.disposeData(v.dataId),_=this.convertAndCacheOnCPU(t,g),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach((function(t){return t(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}}))}))},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!Zt(n)){if(i().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,a=n.isPacked,s=I(r);if(i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),c=this.texData.get(u.dataId),l=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[c.texture].concat(Xt(r))).subarray(0,s);return this.disposeData(u.dataId),l}var h=i().getBool("WEBGL_PACK")&&!0===a,f=h?Se(r):r,d=h?new wi(f):new xi(f),p=this.runWebGLProgram(d,[{shape:f,dtype:o,dataId:t}],"float32"),v=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,s);return this.disposeData(p.dataId),m},e.prototype.time=function(t){return f(this,void 0,void 0,(function(){var e,n,r,a,s,u,o;return d(this,(function(c){switch(c.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),a=A(this.activeTimers.map((function(t){return t.query}))).filter((function(t){return null!=t})),s=A(this.activeTimers.map((function(t){return t.name}))).filter((function(t){return null!=t})),this.activeTimers=e,r&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return o=c.sent(),u.kernelMs=E(o),u.getExtraProfileInfo=function(){return o.map((function(t,e){return{name:s[e],ms:t}})).map((function(t){return t.name+": "+t.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:it(),endMs:null}},e.prototype.endTimer=function(t){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=it(),t)},e.prototype.getQueryTime=function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,a=e.usage,i=e.isPacked,s=e.slice,u=s&&s.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return i().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Pt.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every((function(t){return null==n.texData.get(t.dataId).texture&&t.size<e}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Pt.keep(t.clone()),imag:Pt.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===I(n))return ln([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=Ir(t.shape,e,n);if(r||!o){var a=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wa(n):new ba(n),s=a.getCustomSetupFunc(e);return this.compileAndRun(a,[t],null,s)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=this.makeOutput(n,t.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=t.dtype;var i=Rr(e,t.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var o=Sr(e,n,r);if(o.some((function(t){return 0===t})))return ln([],o);var a=new _a(e,r,o);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,e){var n=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new va(t.shape,e):new da(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map((function(t){return un(t)})),r=t.map((function(t){return cn(t)}));return sn(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>i().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),a=this.concat(t.slice(0,o),e),s=this.concat(t.slice(o),e);return this.concat([a,s],e)}if(i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new ti(t.map((function(t){return t.shape})),e);return this.compileAndRun(u,t)}var c=on(t.map((function(t){return t.shape})),e),l=t.map((function(t){return t.as2D(-1,I(t.shape.slice(e)))})),h=new Jo(l.map((function(t){return t.shape})));return this.compileAndRun(h,l).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ba,t.dtype);var e=new Oa(t.shape,Ba);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],i=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===a)&&i>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===a?t:t.as3D(s,i,1),c=1===a?2:1,l=1===a?e.as3D(s,1,i):e;return this.multiply(u,l).sum(c,!0)}var h=At(t.dtype,e.dtype),f=new Ji(t.shape,[s,o,a],n,r);return this.compileAndRun(f,[t,e],h)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],c=o?n.shape[1]:n.shape[2],l=e.shape[0],h=At(e.dtype,n.dtype),f=null!=a,d=null!=s,p=i?Ya(i,!0):null,v=new Ji(e.shape,[l,u,c],r,o,f,p,d),m=[e,n];return a&&m.push(a),s&&m.push(s),this.compileAndRun(v,m,h)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new jo("return areal * breal - aimag * bimag;",t.shape,e.shape),a=new jo("return areal * bimag + aimag * breal;",t.shape,e.shape),s=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],u=this.compileAndRun(o,s),c=this.compileAndRun(a,s),l=this.complex(u,c);return u.dispose(),c.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Go,t.dtype);var h=new Xo(Go,t.shape,e.shape);return this.compileAndRun(h,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,a){var s=[t,e,n],u=null;null!=a&&(u=a.shape,s.push(a));var c=null;if(null!=o&&(c=o.shape,s.push(o)),i().getBool("WEBGL_PACK_NORMALIZATION")){var l=new Uo(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(l,s)}var h=new Vo(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(h,s)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){var a=i().getBool("WEBGL_PACK_NORMALIZATION")?new $i(t.shape,e,n,r,o):new Ki(t.shape,e,n,r,o);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,e,n,r,o,a,i){var s=new Yi(e.shape,r,o,a,i);return this.compileAndRun(s,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map((function(t){return st(t)}));return vo(Wn(t.shape,t.dtype,n),e)}var r=new Sa(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oa(t.shape,e,n):new ra(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Aa(t.shape,e):new ka(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new Ti(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){T(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=fr(t.shape,e,r),a=dr(o.length,e.length),i=vr(t.shape,e,r),s=mr(n,e.length),u=gr(i,n,e.length);return t.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){T(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=fr(i.shape,e,r,!1),u=dr(s.length,e.length,!1),c=vr(i.shape,e,r,!1);return i.reshape(s).transpose(u).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],a=xr(o),i=new sa({windowSize:a,inSize:o,batchSize:r},e),s=this.compileAndRun(i,[t],n);return 1===s.shape[1]?s:this.reduce(s,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=xr(o),i=new xo({windowSize:a,inSize:o,batchSize:r},e,null==n),s=[t];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=xr(r[r.length-1]),a=new Bo(r,o,e,null==n),i=null==n?[t]:[t,n],s=this.compileAndRun(a,i,"int32");return s.rank===t.rank?this.argReducePacked(t,e,s):s},e.prototype.sum=function(t,e){Je("sum",e,t.rank);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o),i=It(t.dtype);return this.reduce(a,"sum",i).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o),i=It(t.dtype);return this.reduce(a,"prod",i).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=tn([r],t.rank),a=t;null!=o&&(a=t.transpose(o),r=nn(1,t.rank)[0]);var i=function(t,e,n){for(var r=[],o=t.length,a=0;a<o;a++)a!==e?r.push(t[a]):r.push(n);return r}(a.shape,r,n),s=I([a.shape[r]]),u=a.as2D(-1,s),c=It(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(i);return null!=o&&(l=l.transpose(en(o))),l},e.prototype.segOpCompute=function(t,e,n,r,o){var a=t.shape[0],i=t.shape[1],s=function(t,e){var n,r=!1;for(t<=30?(n=t,r=!0):n=Q(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Q(t,n+1);return n}(i,o),u=new ga({windowSize:s,inSize:i,batchSize:a,numSegments:o},e),c=this.compileAndRun(u,[t,n],r);return c.shape[1]===o?c:(n=xn(0,o).tile([i/s]),this.segOpCompute(c,e,n,r,o))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(Je("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!i().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Ze(t.shape,r),a=o[0],s=I(o[1]),u=t.as2D(-1,s);return this.argReduce(u,n).reshape(a)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new di(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Xo("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Xo("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Xo("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Xo("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Xo("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Xo("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new Oa(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Xo("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Xo("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new ya(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],At(e.dtype,n.dtype))},e.prototype.where=function(t){qe("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return go(t.shape,e)},e.prototype.topk=function(t,e,n){return mo(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){Je("min",e,t.rank);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xo("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Je("max",e,t.rank);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){Je("all",e,t.rank);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(t,e){Je("any",e,t.rank);var n=Ze(t.shape,e),r=n[0],o=I(n[1]),a=t.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.realDivide=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Xo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(n,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Xo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,zo);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=At(t.dtype,e.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,zo,n);var r=new Xo(zo,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new Ha(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var a=new Yo(n,t.shape,e.shape,o);return this.compileAndRun(a,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),a=this.texData.get(e.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map((function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(t,a),u=r.makeComplexComponentTensorInfo(e,i),c=new Xo(n,t.shape,e.shape);return r.compileAndRun(c,[s,u],At(a.dtype,i.dtype))})),s=i[0],u=i[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>i().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map((function(t){return t.dtype})).reduce((function(t,e){return At(t,e)})),a=t.map((function(t){return t.shape})),s=i().getBool("WEBGL_PACK")?new bo(t[0].shape,a):new yo(t[0].shape,a);return this.compileAndRun(s,t,o)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,qo);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=At(t.dtype,e.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,qo,t.dtype);var r=new Xo(qo,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=At(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,La,t.dtype);var e=new Oa(t.shape,La);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Wa,t.dtype);var e=new Oa(t.shape,Wa);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new Oa(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new Oa(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new Oa(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new Oa(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new Oa(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Va,t.dtype);var e=new Oa(t.shape,Va);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ua,t.dtype);var e=new Oa(t.shape,Ua);return this.compileAndRun(e,[t])},e.prototype.softmax=function(t,e){var n=B([e],t.shape),r=this.max(t,n),o=Qe(r.shape,n),a=this.subtract(t,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new Oa(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new Oa(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new Oa(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Oa(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new Oa(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=i().getBool("WEBGL_PACK")?new Ha(t.shape,za):new Oa(t.shape,Na),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=i().getBool("WEBGL_PACK")?new Ha(t.shape,qa):new Oa(t.shape,Fa),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo(Ko,t.shape,e.shape):new Xo(Ho,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ga,t.dtype);var e=new Oa(t.shape,Pa);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Xo("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new Oa(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new Oa(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,o=(r=i().getBool("WEBGL_PACK_CLIP")?new Zo(t.shape):new $o(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ma,t.dtype);var e=new Oa(t.shape,Ma);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Qo(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new Oa(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new Oa(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new Oa(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new Oa(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new Oa(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new Oa(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new Oa(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new Oa(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n=new Oa(t.shape,function(t){return void 0===t&&(t=0),Da+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,o,a){var s=t.shape,u=this.texData.get(t.dataId),c=n.inChannels,l=s[0]*s[1]*s[2],h=n.outChannels,f="channelsLast"===n.dataFormat,d=(1===l||1===h)&&c>1e3,p=s[2]%2!=0&&!!u.isPacked;if(d||!i().getBool("WEBGL_LAZILY_UNPACK")||!i().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var v=f?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],m=this.reshape(t,[1,v,n.inChannels]),g=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var y=f?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),x={dataId:t.dataId,shape:[1,y,n.inChannels],dtype:t.dtype},b=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,T(Ie(u.shape,x.shape),(function(){return"packed reshape "+u.shape+" to "+x.shape+" isn't free"}));var w=this.reshape(e,[1,n.inChannels,n.outChannels]),_=this.fusedBatchMatMul({a:x,b:w,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),C=this.texData.get(_.dataId);return T(C.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=b,C.shape=n.outShape,Pt.makeTensorFromDataId(_.dataId,n.outShape,_.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,f=i*s*u,d=l*c,p=[f,d],v=t.squeeze([0]),m=e.reshape([1,f,-1]),g=new Xi(p,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,p[0],p[1]]),x=null!=r,b=null!=a,w=o?Ya(o,!0):null,_=new Ji(y.shape,[1,d,n.outChannels],!0,!1,x,w,b),C=[y,m];r&&C.push(r),b&&C.push(a);var E=this.compileAndRun(_,C);return h?E.reshape([1,l,c,n.outChannels]):E.reshape([1,n.outChannels,l,c])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,s=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,o,a,s);if(i().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,o,a,s);var u=null!=o,c=null!=s,l=a?Ya(a,!1):null,h=new ui(r,u,l,c),f=[e,n];return o&&f.push(o),s&&f.push(s),this.compileAndRun(h,f)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(i().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new ui(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new ri(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new ni(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=i().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=s?Ya(s,c):null,h=[n,r],f=null!=a,d=null!=u;return f&&h.push(a),d&&h.push(u),c?(e=new pi(o,f,l,d),this.compileAndRun(e,h)):(e=new hi(o,f,l,d),this.compileAndRun(e,h))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return i().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new pi(n),this.compileAndRun(r,[t,e])):(r=new hi(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new si(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new ai(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new ci(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new ii(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new oi(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new ia(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new ia(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var o=new ia(r,"max",!0),a=this.compileAndRun(o,[e]),i=new Zi(r),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,n){var r=new Lo(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return Qr(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(r[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(r);return u},e.prototype.avgPool3d=function(t,e){var n=new aa(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new Wo(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new aa(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var o=new aa(r,"max",!0),a=this.compileAndRun(o,[e]),i=new Qi(r),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!Ie(t.shape,e)&&(null===n.texture||!Ie(n.shape,e))){var r=this.packedReshape(t,e);return Pt.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Jr(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var o=i().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ha(t.shape,e,n,r):new la(t.shape,e,n,r);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new ca(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new fa(t.shape,e,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new pa(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var o=e?t:Dr(t),a=o.shape[0],i=o.shape[1],s=new ta(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},e.prototype.oneHot=function(t,e,n,r){var o=new ea(t.size,e,n,r);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var e=new bi(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return qe("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),so(t.dataSync(),e.dataSync(),n,r,o)},e.prototype.cropAndResize=function(t,e,n,r,o,a){var i=new fi(t.shape,e.shape,r,o,a);return this.compileAndRun(i,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){T(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));var r=t.shape[0],o="NHWC"===n?t.shape[1]:t.shape[2],a="NHWC"===n?t.shape[2]:t.shape[3],i="NHWC"===n?t.shape[3]:t.shape[1],s=o*e,u=a*e,c=i/(e*e),l=new yi("NHWC"===n?[r,s,u,c]:[r,c,s,u],e,n);return this.compileAndRun(l,[t])},e.prototype.split=function(t,e,n){return fo(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=Cr(0,t,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/i,i],l=t.reshape([a,o]),h=e.reshape([a,i]);if(0===u)return Jr(ln([]),n);var f=pn(0),d=new ma(a,o,l.rank,h.rank,s,c);return this.compileAndRun(d,[h,l,f]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var o=Cr(0,t,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,c=new ma(i,a,t.rank,e.rank,s,[u,1],!1);return this.compileAndRun(c,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new Ci("return real * expR - imag * expI;",t.shape,e),o=new Ci("return real * expI + imag * expR;",t.shape,e),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(t.shape[0],t.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=yr(t,e),a=o[0],i=o[1],s=o[2],u=o[3],c=e.reshape([i,r]),l=t.reshape([t.size/s,s]),h=new Si(r,u,[i,s]);return this.compileAndRun(h,[l,c]).reshape(a)},e.prototype.fill=function(t,e,n){if("string"===(n=n||$(e))){var r=V(n,I(t));return r.fill(e),Pt.makeTensor(r,t,n,this)}var o=new Ei(t,e),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[],n,a)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return to(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return Pt.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new Xa(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new na(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[Ee(t.shape)].concat(Te(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},o=[Ee(e)].concat(Te(e)),a=new ua(o,n),i=this.runWebGLProgram(a,[r],t.dtype,null,!0);return{dataId:i.dataId,shape:e,dtype:i.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,a=n.dtype,i=Se(o);return e=r?new gi(i):new mi(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(e,[{shape:i,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,o){var a=this;void 0===o&&(o=!1);var s=this.makeTensorInfo(t.outputShape,n),u=this.texData.get(s.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Wt.DENSE){var c=Xt(t.outputShape);u.texShape=c.map((function(t){return 2*t}))}if(null!=t.outTexUsage&&(u.usage=t.outTexUsage),0===I(s.shape))return u.values=W(s.dtype,0),s;var l=[],h=e.map((function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&I(e.shape)<=i().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?a.unpackTensor(e):a.packTensor(e),l.push(e),n=a.texData.get(e.dataId);else if(n.isPacked&&!Ie(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=a.packedReshape(e,o),l.push(e),n=a.texData.get(e.dataId),r.shape=o}return a.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,d={shape:s.shape,texData:u,isUniform:!1},p=function(t,e,n){var r="";e.concat(n).forEach((function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;r+=t.shape+"_"+n+"_"+e}));var o=t.userCode;return t.constructor.name+"_"+r+"_"+o}(t,h,d),v=this.getAndSaveBinary(p,(function(){return function(t,e,n,r){var o=e.userCode,a=n.map((function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=a.map((function(t){return t.shapeInfo})),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=ko(a,u,o,e.packedInputs),l=t.createProgram(c),h=null,f=t.getUniformLocation(l,"NAN",!1);1===i().getNumber("WEBGL_VERSION")&&(h=t.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<e.variableNames.length;p++){var v=e.variableNames[p];d[v]=t.getUniformLocation(l,v,!1),d["offset"+v]=t.getUniformLocation(l,"offset"+v,!1)}return{program:e,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:s,outShapeInfo:u,infLoc:h,nanLoc:f}}(a.gpgpu,t,h,d)})),m=null!=this.activeTimers;if(m&&(f=this.startTimer()),function(t,e,n,r,o){Hi(e.inShapeInfos,n),Hi([e.outShapeInfo],[r]);var a=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(a,s[0],s[1]):t.setOutputMatrixTexture(a,s[0],s[1]),t.setProgram(e.webGLProgram),1===i().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((function(n,r){var o=e.program.variableNames[r],a=e.uniformLocations[o],i=e.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(I(n.shape)<2)t.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&t.gl.uniform1i(i,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,a,r)})),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,v,h,d,r),l.forEach((function(t){return a.disposeData(t.dataId)})),m&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!i().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var g=this.unpackTensor(s);return this.disposeData(s.dataId),g}return s},e.prototype.compileAndRun=function(t,e,n,r,o){void 0===o&&(o=!1),n=n||e[0].dtype;var a=this.runWebGLProgram(t,e,n,r,o);return Pt.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(i().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=je((function(){if(!i().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=i().getBool("DEBUG");i().set("DEBUG",!1);var n=t.abs(pn(1e-8)).dataSync()[0];if(i().set("DEBUG",e),n>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var c,l=null!=this.activeTimers;l&&(c=it());var h=n.texShape;if(null==h&&(h=ke(r,u),n.texShape=h),null!=a){var f=Se(r),d=void 0,p=h[1],v=h[0],m=a instanceof Uint8Array;u?(p=(e=Kt(h[0],h[1]))[0],v=e[1],d=new _i(f,[v,p],m)):d=new li(f,[v,p],m);var g=this.makeTensorInfo([v,p],o);this.texData.get(g.dataId).usage=m?Vt.PIXELS:Vt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,v,a);var y=this.runWebGLProgram(d,[g],o,null,!0),x=this.texData.get(y.dataId);n.texture=x.texture,n.texShape=x.texShape,n.isPacked=x.isPacked,n.usage=x.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=it()-c)}else{var b=this.acquireTexture(h,s,o,u);n.texture=b}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*H(e)},e}(Fr);Bt()&&Pt.registerBackend("webgl",(function(){return new $a}),2);var Za=an({square_:function(t){var e=Xe(t,"x","square"),n=[e];return Pt.runKernelFunc((function(t,n){return n([e]),t.square(e)}),{x:e},null,"Square",{},n,[])}}),Qa="SquaredDifference",Ja=an({squaredDifference_:function(t,e){var n,r=Xe(t,"a","squaredDifference"),o=Xe(e,"b","squaredDifference");n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return Pt.runKernelFunc((function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n}),a,(function(t,e){var n=e[0],r=e[1],o=pn(2);return{a:function(){return t.mul(n.sub(r).mul(o))},b:function(){return t.mul(r.sub(n).mul(o))}}}),Qa,{},i,[])}}),ts=an({abs_:function(t){var e=Xe(t,"x","abs");return"complex64"===e.dtype?Pt.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):Pt.runKernelFunc((function(t,n){var r=t.abs(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}}),"Abs")}}),es=an({acos_:function(t){var e=Xe(t,"x","acos");return Pt.runKernelFunc((function(t,n){var r=t.acos(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(pn(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),ns=an({acosh_:function(t){var e=Xe(t,"x","acosh");return Pt.runKernelFunc((function(t,n){var r=t.acosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),rs=an({asin_:function(t){var e=Xe(t,"x","asin");return Pt.runKernelFunc((function(t,n){var r=t.asin(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(pn(1).sub(n.toFloat().square()).sqrt())}}}))}}),os=an({asinh_:function(t){var e=Xe(t,"x","asinh");return Pt.runKernelFunc((function(t,n){var r=t.asinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(pn(1).add(n.toFloat().square()).sqrt())}}}))}}),is=an({atan_:function(t){var e=Xe(t,"x","atan");return Pt.runKernelFunc((function(t,n){var r=t.atan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}}))}}),as=an({atanh_:function(t){var e=Xe(t,"x","atanh");return Pt.runKernelFunc((function(t,n){var r=t.atanh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(pn(1).sub(n.toFloat().square()))}}}))}}),ss=an({ceil_:function(t){var e=Xe(t,"x","ceil");return Pt.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),us=an({clipByValue_:function(t,e,n){var r=Xe(t,"x","clipByValue");T(e<=n,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."}));var o=[r],a={min:e,max:n};return Pt.runKernelFunc((function(t,o){var a=t.clip(r,e,n);return o([r]),a}),{x:r},(function(t,r){var o=r[0];return{x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),_n(t))}}}),"ClipByValue",a,o)}}),cs=an({cos_:function(t){var e=Xe(t,"x","cos"),n=[e];return Pt.runKernelFunc((function(t,n){var r=t.cos(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}}),"Cos",{},n)}}),ls=an({cosh_:function(t){var e=Xe(t,"x","cosh");return Pt.runKernelFunc((function(t,n){var r=t.cosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}}))}}),hs=an({erf_:function(t){var e=Xe(t,"x","erf");return T("int32"===e.dtype||"float32"===e.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===e.dtype&&(e=e.toFloat()),Pt.runKernelFunc((function(t,n){var r=t.erf(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),ps=an({exp_:function(t){var e=Xe(t,"x","exp");return Pt.runKernelFunc((function(t,n){var r=t.exp(e);return n([r]),r}),{x:e},(function(t,e){return{x:function(){return t.mulStrict(e[0])}}}),"Exp",{},[],[!0])}}),fs=an({expm1_:function(t){var e=Xe(t,"x","expm1");return Pt.runKernelFunc((function(t,n){var r=t.expm1(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}}))}}),ds=an({floor_:function(t){var e=Xe(t,"x","floor");return Pt.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),vs=an({log_:function(t){var e=Xe(t,"x","log"),n=[e];return Pt.runKernelFunc((function(t,n){var r=t.log(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}}),"Log",{},n)}}),ms=an({log1p_:function(t){var e=Xe(t,"x","log1p");return Pt.runKernelFunc((function(t,n){var r=t.log1p(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}}))}}),gs=an({logSigmoid_:function(t){var e=Xe(t,"x","logSigmoid");return Pt.runKernelFunc((function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}}))}}),ys=an({neg_:function(t){var e=Xe(t,"x","neg"),n=[e];return Pt.runKernelFunc((function(t){return t.neg(e)}),{x:e},(function(t){return{x:function(){return t.neg()}}}),"Neg",{},n)}}),bs=an({reciprocal_:function(t){var e=Xe(t,"x","reciprocal");return Pt.runKernelFunc((function(t,n){var r=t.reciprocal(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}}))}}),xs=an({round_:function(t){var e=Xe(t,"x","round");return Pt.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),ws=an({rsqrt_:function(t){var e=Xe(t,"x","rsqrt"),n=[e];return Pt.runKernelFunc((function(t,n){var r=t.rsqrt(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),_s=an({sigmoid_:function(t){var e=Xe(t,"x","sigmoid");return Pt.runKernelFunc((function(t,n){var r=t.sigmoid(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(pn(1).sub(n)))}}}),"Sigmoid")}}),Cs=an({sign_:function(t){var e=Xe(t,"x","sign");return Pt.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Es=an({isNaN_:function(t){var e=Xe(t,"x","isNaN");return Pt.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Ts=an({isInf_:function(t){var e=Xe(t,"x","isInf");return Pt.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Ss=an({isFinite_:function(t){var e=Xe(t,"x","isFinite");return Pt.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),ks=an({sin_:function(t){var e=Xe(t,"x","sin"),n=[e];return Pt.runKernelFunc((function(t,n){var r=t.sin(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}}),"Sin",{},n)}}),As=an({sinh_:function(t){var e=Xe(t,"x","sinh");return Pt.runKernelFunc((function(t,n){var r=t.sinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}}))}}),Is=an({softplus_:function(t){var e=Xe(t,"x","softplus");return Pt.runKernelFunc((function(t,n){var r=t.softplus(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}}))}}),Rs=an({sqrt_:function(t){var e=Xe(t,"x","sqrt");return Pt.runKernelFunc((function(t,n){var r=t.sqrt(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}}))}}),Os=an({step_:function(t,e){void 0===e&&(e=0);var n=Xe(t,"x","step");return Pt.runKernelFunc((function(t){return t.step(n,e)}),{$x:n},(function(t){return{$x:function(){return _n(t)}}}))}}),Ds=an({tan_:function(t){var e=Xe(t,"x","tan");return Pt.runKernelFunc((function(t,n){var r=t.tan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}}))}}),Ms=an({tanh_:function(t){var e=Xe(t,"x","tanh");return Pt.runKernelFunc((function(t,n){var r=t.tanh(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return pn(1).sub(n.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function Ns(t,e,n,r,o,a){var i,s,u=Xe(t,"x","batchNorm"),c=Xe(e,"mean","batchNorm"),l=Xe(n,"variance","batchNorm");return null!=o&&(i=Xe(o,"scale","batchNorm")),null!=r&&(s=Xe(r,"offset","batchNorm")),T(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),T(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),T(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=i&&T(2===i.rank||1===i.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."})),null!=s&&T(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Bs(u,c,l,s,i,a)}function Fs(t,e,n,r,o,a){var i,s,u=Xe(t,"x","batchNorm"),c=Xe(e,"mean","batchNorm"),l=Xe(n,"variance","batchNorm");return null!=o&&(i=Xe(o,"scale","batchNorm")),null!=r&&(s=Xe(r,"offset","batchNorm")),T(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),T(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),T(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=i&&T(3===i.rank||1===i.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."})),null!=s&&T(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Bs(u,c,l,s,i,a)}function Ps(t,e,n,r,o,a){var i,s,u=Xe(t,"x","batchNorm"),c=Xe(e,"mean","batchNorm"),l=Xe(n,"variance","batchNorm");return null!=o&&(i=Xe(o,"scale","batchNorm")),null!=r&&(s=Xe(r,"offset","batchNorm")),T(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),T(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),T(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=i&&T(4===i.rank||1===i.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."})),null!=s&&T(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Bs(u,c,l,s,i,a)}function Bs(t,e,n,r,o,a){null==a&&(a=.001);var i,s,u,c=Xe(t,"x","batchNorm"),l=Xe(e,"mean","batchNorm"),h=Xe(n,"variance","batchNorm");null!=o&&(i=Xe(o,"scale","batchNorm")),null!=r&&(s=Xe(r,"offset","batchNorm")),T(l.rank===h.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),T(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),T(null==i||l.rank===i.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var f=[c,l,h,i];return Pt.runKernelFunc((function(t,e){var n=t.batchNormalization(u,Ls(l),Ls(h),a,Ls(i),Ls(s));return e([c,l,h,i]),n}),{x:c,mean:l,variance:h,scale:i,offset:s},(function(t,e){var n=e,r=n[0],o=n[1],i=n[2],s=n[3],c=null==s?pn(1):s,l=Lr(o.shape,u.shape),h=[];if(1===o.rank){for(var f=0;f<u.shape.length-1;++f)h.push(u.shape[f]);h.push(1)}var d=r.sub(o),p=t.mul(c),v=ws(i.add(pn(a))),m=v.mul(v).mul(v).mul(pn(-.5));return{x:function(){return 1===o.rank?t.mul(cr(v.as4D(1,1,1,o.shape[0]),h)).mul(c).reshape(r.shape):t.mul(v).mul(c).reshape(r.shape)},mean:function(){var t=v.mul(pn(-1)).mul(p);return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)},variance:function(){var t=m.mul(d).mul(p);return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)},scale:function(){var e=d.mul(v),n=t.mul(e);return 1===o.rank&&(n=n.sum(l)),n.reshape(o.shape)},offset:function(){var e=t;return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)}}}),"BatchNormalization",{varianceEpsilon:a},f).reshape(c.shape)}function Ls(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Ws(){Ue("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Vs=an({batchNormalization2d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ws(),Ns(t,e,n,a,o,r)}}),Us=an({batchNormalization3d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ws(),Fs(t,e,n,a,o,r)}}),js=an({batchNormalization4d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ws(),Ps(t,e,n,a,o,r)}}),zs=an({batchNormalization_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ws(),Bs(t,e,n,a,o,r)}}),qs=an({batchNorm_:Bs}),Gs=an({batchNorm2d_:Ns}),Hs=an({batchNorm3d_:Fs}),Xs=an({batchNorm4d_:Ps}),Ks=an({logicalAnd_:function(t,e){var n=Xe(t,"a","logicalAnd","bool"),r=Xe(e,"b","logicalAnd","bool");return Wr(n.shape,r.shape),Pt.runKernelFunc((function(t){return t.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Ys=an({logicalNot_:function(t){var e=Xe(t,"x","logicalNot","bool");return Pt.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),$s=an({logicalOr_:function(t,e){var n=Xe(t,"a","logicalOr","bool"),r=Xe(e,"b","logicalOr","bool");return Wr(n.shape,r.shape),Pt.runKernelFunc((function(t){return t.logicalOr(n,r)}),{$a:n,$b:r})}}),Zs=an({logicalXor_:function(t,e){var n=Xe(t,"a","logicalXor","bool"),r=Xe(e,"b","logicalXor","bool");return Wr(n.shape,r.shape),$s(t,e).logicalAnd(Ks(t,e).logicalNot())}}),Qs=an({where_:function(t,e,n){var r=Xe(e,"a","where"),o=Xe(n,"b","where"),a=Xe(t,"condition","where","bool");return S(r.shape,o.shape,"Error in where: "),1===a.rank?T(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):S(a.shape,o.shape,"Error in where: "),Pt.runKernelFunc((function(t,e){var n=t.select(a,r,o);return e([a]),n}),{$condition:a,$a:r,$b:o},(function(t,e){var n=e[0];return{$condition:function(){return _n(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}}))}}),Js=function(t){return f(this,void 0,void 0,(function(){var e,n,r;return d(this,(function(o){switch(o.label){case 0:return[4,(e=Xe(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=go(e.shape,n),t!==e&&e.dispose(),[2,r]}}))}))},tu=an({add_:function(t,e){var n,r=Xe(t,"a","add"),o=Xe(e,"b","add");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t){return t.add(r,o)}),{a:r,b:o},(function(t){return{a:function(){var e=t,n=Lr(r.shape,a);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=Lr(o.shape,a);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}}),"Add")}}),eu=an({addN_:function(t){T(Array.isArray(t),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),T(t.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length}));var e=t.map((function(t,e){return Xe(t,"tensors"+e,"addN")})),n=e[0];e.forEach((function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(t){if(!R(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return Pt.runKernelFunc((function(t){return t.addN(e)}),r,(function(t){var n={};return e.forEach((function(e,r){n[r]=function(){return t.clone()}})),n}),"AddN")}}),nu=an({addStrict_:function(t,e){var n=Xe(t,"a","addStrict"),r=Xe(e,"b","addStrict");return S(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ru=an({atan2_:function(t,e){var n,r=Xe(t,"a","atan2"),o=Xe(e,"b","atan2");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t,e){var n=t.atan2(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=tu(n.square(),r.square()),o=t.mul(r.div(e)),i=Lr(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var e=tu(n.square(),r.square()),o=ys(t.mul(n.div(e))),i=Lr(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}}))}}),ou=an({div_:function(t,e){var n,r=Xe(t,"a","div"),o=Xe(e,"b","div");if(n=Rt(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return su(r,o);var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t,e){var n=t.realDivide(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=Lr(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=Lr(r.shape,a);o.length>0&&(e=e.sum(o).reshape(r.shape));var i=r.square();return e.div(i.toFloat()).neg()}}}),"Div")}}),iu=an({divNoNan_:function(t,e){var n,r=Xe(t,"a","div"),o=Xe(e,"b","div");r=(n=Rt(r,o))[0],o=n[1];var a=ou(r,o),i=_n(a),s=o.equal(i);return Qs(s,i,a)}}),au=an({divStrict_:function(t,e){var n=Xe(t,"a","div"),r=Xe(e,"b","div");return S(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),su=an({floorDiv_:function(t,e){var n,r=Xe(t,"a","floorDiv"),o=Xe(e,"b","floorDiv");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=Lr(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=Lr(r.shape,a);o.length>0&&(e=e.sum(o).reshape(r.shape));var i=r.square();return e.div(i.toFloat()).neg()}}}),"FloorDiv")}}),uu=an({maximum_:function(t,e){var n,r=Xe(t,"a","maximum"),o=Xe(e,"b","maximum");return n=Rt(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),Wr(r.shape,o.shape),Pt.runKernelFunc((function(t,e){var n=t.maximum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}}),"Maximum")}}),cu=an({maximumStrict_:function(t,e){var n=Xe(t,"a","maximumStrict"),r=Xe(e,"b","maximumStrict");return S(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),lu=an({minimum_:function(t,e){var n,r=Xe(t,"a","minimum"),o=Xe(e,"b","minimum");return n=Rt(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),Wr(r.shape,o.shape),Pt.runKernelFunc((function(t,e){var n=t.minimum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}}),"Minimum")}}),hu=an({minimumStrict_:function(t,e){var n=Xe(t,"a","minimumStrict"),r=Xe(e,"b","minimumStrict");return S(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),pu=an({mod_:function(t,e){var n,r=Xe(t,"a","mod"),o=Xe(e,"b","mod");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t,e){var n=t.mod(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Lr(n.shape,a);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=Lr(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e}}}))}}),fu=an({modStrict_:function(t,e){var n=Xe(t,"a","modStrict"),r=Xe(e,"b","modStrict");return S(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),du=an({mul_:function(t,e){var n,r=Xe(t,"a","mul"),o=Xe(e,"b","mul");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t,e){var n=t.multiply(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),o=Lr(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=Lr(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e}}}),"Mul")}}),vu=an({mulStrict_:function(t,e){var n=Xe(t,"a","mul"),r=Xe(e,"b","mul");return S(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),mu=an({pow_:function(t,e){var n,r=Xe(t,"base","pow"),o=Xe(e,"exp","pow");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape),i=[r,o];return Pt.runKernelFunc((function(t,e){var n=t.pow(r,o);return e([r,o,n]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1],o=e[2];return{a:function(){var e=r.toFloat(),o=t.mul(e.mul(n.pow(e.sub(pn(1))))),i=Lr(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var e=n.greater(0),i=n.log().where(e,_n(n)),s=t.mul(o.mul(i)),u=Lr(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},i,[!0])}}),gu=an({powStrict_:function(t,e){return S(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),yu=an({squaredDifferenceStrict_:function(t,e){var n=Xe(t,"a","squaredDifferenceStrict"),r=Xe(e,"b","squaredDifferenceStrict");return S(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),bu=an({sub_:function(t,e){var n,r=Xe(t,"a","sub"),o=Xe(e,"b","sub");n=Rt(r,o),r=n[0],o=n[1];var a=Wr(r.shape,o.shape);return Pt.runKernelFunc((function(t){return t.subtract(r,o)}),{a:r,b:o},(function(t){return{a:function(){var e=t,n=Lr(r.shape,a);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=Lr(o.shape,a);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}}),"Sub")}}),xu=an({subStrict_:function(t,e){var n=Xe(t,"a","subStrict"),r=Xe(e,"b","subStrict");return S(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),wu=an({equal_:function(t,e){var n,r=Xe(t,"a","equal"),o=Xe(e,"b","equal");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t){return t.equal(r,o)}),{$a:r,$b:o})}}),_u=an({equalStrict_:function(t,e){var n=Xe(t,"a","equalStrict"),r=Xe(e,"b","equalStrict");return S(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Cu=an({greater_:function(t,e){var n,r=Xe(t,"a","greater"),o=Xe(e,"b","greater");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t){return t.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Eu=an({greaterEqual_:function(t,e){var n,r=Xe(t,"a","greaterEqual"),o=Xe(e,"b","greaterEqual");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return _n(n)},b:function(){return _n(r)}}}),"GreaterEqual")}}),Tu=an({greaterEqualStrict_:function(t,e){var n=Xe(t,"a","greaterEqualStrict"),r=Xe(e,"b","greaterEqualStrict");return S(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Su=an({greaterStrict_:function(t,e){var n=Xe(t,"a","greaterStrict"),r=Xe(e,"b","greaterStrict");return S(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),ku=an({less_:function(t,e){var n,r=Xe(t,"a","less"),o=Xe(e,"b","less");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t){return t.less(r,o)}),{a:r,b:o},null,"Less")}}),Au=an({lessEqual_:function(t,e){var n,r=Xe(t,"a","lessEqual"),o=Xe(e,"b","lessEqual");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t,e){var n=t.lessEqual(r,o);return e([r,o]),n}),{a:r,b:o},null,"LessEqual")}}),Iu=an({lessEqualStrict_:function(t,e){var n=Xe(t,"a","lessEqualStrict"),r=Xe(e,"b","lessEqualStrict");return S(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Ru=an({lessStrict_:function(t,e){var n=Xe(t,"a","lessStrict"),r=Xe(e,"b","lessStrict");return S(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Ou=an({notEqual_:function(t,e){var n,r=Xe(t,"a","notEqual"),o=Xe(e,"b","notEqual");return n=Rt(r,o),r=n[0],o=n[1],Wr(r.shape,o.shape),Pt.runKernelFunc((function(t){return t.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),Du=an({notEqualStrict_:function(t,e){var n=Xe(t,"a","notEqualStrict"),r=Xe(e,"b","notEqualStrict");return S(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Mu(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function Nu(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Fu=an({gather_:function(t,e,n){void 0===n&&(n=0);var r=Xe(t,"x","gather"),o=Xe(e,"indices","gather","int32");n=B(n,r.shape)[0];var a=function(t,e,n){for(var r=t.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(t.shape[s]),a*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),i*=t.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return Pt.runKernelFunc((function(t,e){var a=t.gather(r,o.flatten(),n);return e([o]),a}),{x:r,indices:o},(function(t,e){var o=e[0];return{x:function(){var e=r.shape,a=o.size,i=e.slice(0,n),s=i.length,u=e.slice(n,e.length).slice(1),c=u.length,l=Mu(0,s),h=Mu(s+1,s+1+c),f=Nu([i,[a],u]),d=t.reshape(f),p=o.reshape([a]),v=Nu([[s],l,h]),m=d.transpose(v),g=Pu(m,p,r.shape[n]),y=en(v);return g.transpose(y)},indices:function(){return o}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),Pu=an({unsortedSegmentSum_:function(t,e,n){var r=Xe(t,"x","unsortedSegmentSum"),o=Xe(e,"segmentIds","unsortedSegmentSum","int32");return T(O(n),(function(){return"numSegments must be of dtype int"})),Pt.runKernelFunc((function(t,e){var a=t.unsortedSegmentSum(r,o,n);return e([o]),a}),{$x:r},(function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=uu(e,_n(e)),r=Fu(t,n),o=Eu(e,pn(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Gn(o,i+1);o=Ks(o,gn(r.shape,"bool"));var s=_n(r);return Qs(o,r,s)}(t,n)}}}))}});function Bu(t,e,n,r,o,a,i){void 0===a&&(a="NHWC"),T(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var s=t,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),T(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),T(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),T(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],h="NHWC"===a?u.shape[3]:u.shape[1];T(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),T(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),null!=i&&T(O(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var f=Zr(a),d=jr(s,n.shape,r,1,o,i,!1,f),p=Pt.runKernelFunc((function(t,e){var r=t.conv2dDerInput(u,n,d);return e([n,u]),r}),{dy4D:u,filter:n},(function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return Uu(t,n,r,o,a,1,i)},filter:function(){return zu(t,s,n.shape,r,o,a,i)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Lu(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function Wu(t,e,n,r,o){T(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var a=t,i=e,s=!1;4===e.rank&&(s=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,t[0],t[1],t[2],t[3]]);var u=a[4],c=i.shape[4];T(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),T(5===i.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank})),T(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),T(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),T(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=zr(a,n.shape,r,1,o),h=Pt.runKernelFunc((function(t){return t.conv3dDerInput(i,n,l)}),{dy5D:i});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Vu=an({conv1d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=Xe(t,"x","conv1d"),u=Xe(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),T(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),T(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=i&&T(O(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."})),T(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),T($r(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),T("NWC"===o,(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),d=Uu(f,h,[1,n],r,"NHWC",[1,a],i);return l?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Uu=an({conv2d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Xe(t,"x","conv2d"),u=Xe(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),T(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=i&&T(O(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var h="NHWC"===o?c.shape[3]:c.shape[1];T(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),T($r(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var f=Zr(o),d=jr(c.shape,u.shape,n,a,r,i,!1,f),p=[u,c],v=Pt.runKernelFunc((function(t,e){var n=t.conv2d(c,u,d);return e([u,c]),n}),{x:c,filter:u},(function(t,e){var i=e,s=i[0],u=i[1];return T(Yr(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return qu(u.shape,t,s,n,r,o)},filter:function(){return zu(u,t,s.shape,n,r,o)}}}),"Conv2D",d,p);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),ju=an({conv3d_:function(t,e,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=Xe(t,"x","conv3d"),s=Xe(e,"filter","conv3d"),u=i,c=!1;4===i.rank&&(c=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),T(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),T(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),T(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),T(function(t,e){return Lu(t)||Lu(e)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),T("NDHWC"===o,(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=zr(u.shape,s.shape,n,a,r),h=Pt.runKernelFunc((function(t,e){var n=t.conv3d(u,s,l);return e([u,s]),n}),{x:u,$filter:s},(function(t,e){T(Lu(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var o=e[0],i=e[1];return{x:function(){return Wu(o.shape,t,i,n,r)},$filter:function(){return function(t,e,n,r,o){var a=t;4===t.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var i=e;4===i.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),T(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),T(5===i.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."})),T(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),T(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),T(i.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=zr(a.shape,n,r,1,o);return Pt.runKernelFunc((function(t){return t.conv3dDerFilter(a,i,s)}),{x5D:a,dy5D:i})}(o,t,i.shape,n,r)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),zu=an({conv2dDerFilter_:function(t,e,n,r,o,a,i){void 0===a&&(a="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),T(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),T(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),T(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];T(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),T(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=i&&T(O(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var h=Zr(a),f=jr(s.shape,n,r,1,o,i,!1,h);return Pt.runKernelFunc((function(t){return t.conv2dDerFilter(s,u,f)}),{x4D:s,dy4D:u})}}),qu=an({conv2dDerInput_:Bu}),Gu=an({depthwiseConv2d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Xe(t,"x","depthwiseConv2d"),u=Xe(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),T(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),T(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),T($r(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=i&&T(O(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var h=jr(c.shape,u.shape,n,a,r,i,!0),f=[c,u],d=Pt.runKernelFunc((function(t,e){var n=t.depthwiseConv2D(c,u,h);return e([c,u]),n}),{x:c,filter:u},(function(t,e){T(Yr(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=e[0],r=e[1];return{x:function(){return Hu(n.shape,t,r,h)},filter:function(){return Xu(n,t,r.shape,h)}}}),"DepthwiseConv2dNative",h,f);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Hu=an({depthwiseConv2dDerInput_:function(t,e,n,r){var o=e,a=!1;3===e.rank&&(a=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=Pt.runKernelFunc((function(t){return t.depthwiseConv2DDerInput(o,n,r)}),{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),Xu=an({depthwiseConv2dDerFilter_:function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e;return 3===a.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Pt.runKernelFunc((function(t){return t.depthwiseConv2DDerFilter(o,a,r)}),{x4D:o,dy4D:a})}}),Ku=an({separableConv2d_:function(t,e,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=Xe(t,"x","separableConv2d"),u=Xe(e,"depthwiseFilter","separableConv2d"),c=Xe(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),T(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),T(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),T(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),T(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var f=u.shape[2],d=u.shape[3];T(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+c.shape[2]+"."}));var p=Gu(l,u,r,o,i,a),v=Uu(p,c,1,"valid",i);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Yu=an({conv2dTranspose_:function(t,e,n,r,o,a){return Bu(n,Xe(t,"x","conv2dTranspose"),Xe(e,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),$u=an({conv3dTranspose_:function(t,e,n,r,o){return Wu(n,Xe(t,"x","conv3dTranspose"),Xe(e,"filter","conv3dTranspose"),r,o)}}),Zu=an({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Xe(t,"a","matMul"),i=Xe(e,"b","matMul");o=Rt(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?i.shape[i.rank-2]:i.shape[i.rank-1],h=a.shape.slice(0,-2),f=i.shape.slice(0,-2),d=I(h),p=I(f);T(a.rank>=2&&i.rank>=2&&a.rank===i.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."})),T(R(h,f),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."})),T(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var v=a.shape.slice(0,-2).concat([c,l]),m=n?a.as3D(d,s,c):a.as3D(d,c,s),g=r?i.as3D(p,l,u):i.as3D(p,u,l),y={transposeA:n,transposeB:r};return Pt.runKernelFunc((function(t,e){var o=t.batchMatMul(m,g,n,r);return e([m,g]),o}),{a:m,b:g},(function(t,e){var o=e,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return t.matMul(i,!1,!1)},b:function(){return t.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(t,!1,!0)},b:function(){return a.matMul(t,!1,!1)}}:{a:function(){return i.matMul(t,!0,!0)},b:function(){return t.matMul(a,!0,!0)}}:{a:function(){return t.matMul(i,!1,!0)},b:function(){return a.matMul(t,!0,!1)}}}),"BatchMatMul",y).reshape(v)}}),Qu=an({dot_:function(t,e){var n=Xe(t,"t1","dot"),r=Xe(e,"t2","dot");T(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return T(o===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ju=an({outerProduct_:function(t,e){var n=Xe(t,"v1","outerProduct"),r=Xe(e,"v2","outerProduct");return T(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),ol=an({reverse_:function(t,e){var n=Xe(t,"x","reverse");if(0===n.rank)return n.clone();var r=B(e,n.shape);return Pt.runKernelFunc((function(t){return t.reverse(n,r)}),{$x:n},(function(t){return{$x:function(){return t.reverse(r)}}})).reshapeAs(n)}}),tc=an({reverse1d_:function(t){var e=Xe(t,"x","reverse");return T(1===e.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),ol(e,0)}}),ec=an({reverse2d_:function(t,e){var n=Xe(t,"x","reverse");return T(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),ol(n,e)}}),nc=an({reverse3d_:function(t,e){var n=Xe(t,"x","reverse");return T(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),ol(n,e)}}),ul=an({reverse4d_:function(t,e){var n=Xe(t,"x","reverse");return T(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),ol(n,e)}});function rc(t,e,n,r,o,a){var i=Xe(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),T(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),T($r(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&T(O(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Vr(s.shape,e,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&R(c.inShape,c.outShape))return i.clone();var l=[s],h=Pt.runKernelFunc((function(t,e){var n=t.maxPool(s,c);return e([s,n]),n}),{x:s},(function(t,a){var i=a[0],s=a[1];return{x:function(){return function(t,e,n,r,o,a,i,s){var u=Xe(t,"dy","maxPoolBackprop"),c=Xe(e,"input","maxPoolBackprop"),l=Xe(n,"output","maxPoolBackprop");T(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),T($r(o,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),T(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),T(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var h=Vr(c.shape,r,o,a,i,s);return Pt.runKernelFunc((function(t){return t.maxPoolBackprop(u,c,l,h)}),{$dy:u,$input:c})}(t,i,s,e,n,r,o)}}}),"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function oc(t,e,n,r,o,a){var i=Xe(t,"x","avgPool","float32");null==r&&(r=[1,1]),T($r(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),T(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&T(O(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Vr(s.shape,e,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&R(c.inShape,c.outShape))return i.clone();var l=Pt.runKernelFunc((function(t){return t.avgPool(s,c)}),{x:s},(function(t){return{x:function(){return function(t,e,n,r,o,a){var i=Xe(t,"dy","avgPoolBackprop"),s=Xe(e,"input","avgPoolBackprop");T(s.rank===i.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"})),null==o&&(o=[1,1]),T($r(r,o),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}));var u=s,c=i,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),T(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),T(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var h=Vr(u.shape,n,r,o,a),f=Pt.runKernelFunc((function(t){return t.avgPoolBackprop(c,u,h)}),{dy4D:c,input4D:u});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}(t,s,e,n,r,o)}}}),"AvgPool",c);return l=l.cast(i.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var ic=an({maxPool_:function(t,e,n,r,o){return rc(t,e,n,1,r,o)}}),ac=an({avgPool_:function(t,e,n,r,o){return oc(t,e,n,1,r,o)}}),dl=an({pool_:function(t,e,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=Xe(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),T($r(a,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"}));var c,l=Vr(s.shape,e,a,o,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=t.map((function(t,n){return t+(t-1)*(e[n]-1)})).map((function(t){return t-1})),r=n.map((function(t){return Math.floor(t/2)})),o=n.map((function(t,e){return t-r[e]}));return n.map((function(t,e){return[r[e],o[e]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var f=1===h[0]&&1===h[1],d=function(t,e,n){var r=n.map((function(t){return t[0]})),o=n.map((function(t){return t[1]})),a=t.concat(r,o),i=e.map((function(t,e){return(t-a[e]%t)%t})),s=o.map((function(t,e){return t+i[e]}));return[e.map((function(t,e){return[r[e],s[e]]})),e.map((function(t,e){return[0,i[e]]}))]}([l.inHeight,l.inWidth],h,c),p=d[0],v=d[1],m=f?r:"valid",g=f?s:ar(s,h,p),y=("avg"===n?function(){return oc(g,e,a,1,m)}:function(){return rc(g,e,a,1,m)})(),x=f?y:Vn(y,h,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),sc=an({maxPool3d_:function(t,e,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Xe(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),T(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),T("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),T($r(n,i),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&T(O(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Ur(u.shape,e,n,i,r,o,a),h=Pt.runKernelFunc((function(t,e){var n=t.maxPool3d(u,l);return e([u,n]),n}),{x:u},(function(t,a){var s=a[0],u=a[1];return{x:function(){return function(t,e,n,r,o,a,i,s){var u=Xe(t,"dy","maxPool3dBackprop"),c=Xe(e,"input","maxPool3dBackprop"),l=Xe(n,"output","maxPool3dBackprop"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),T(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),T(5===f.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+f.rank+"."})),T(5===d.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."})),null==a&&(a=[1,1,1]),T($r(o,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),null!=s&&T(O(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var v=Ur(f.shape,r,o,a,i,s),m=Pt.runKernelFunc((function(t){return t.maxPool3dBackprop(h,f,d,v)}),{dy5D:h,input5D:f});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(t,s,u,e,n,i,r,o)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),uc=an({avgPool3d_:function(t,e,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Xe(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),T(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),T("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),T($r(n,i),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&T(O(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Ur(u.shape,e,n,i,r,o,a),h=Pt.runKernelFunc((function(t){return t.avgPool3d(u,l)}),{x:u},(function(t){return{x:function(){return function(t,e,n,r,o,a,i){var s=Xe(t,"dy","avgPool3dBackprop"),u=Xe(e,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),T(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),T(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==o&&(o=[1,1,1]),T($r(r,o),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),null!=i&&T(O(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var f=Ur(l.shape,n,r,o,a,i),d=Pt.runKernelFunc((function(t){return t.avgPool3dBackprop(c,l,f)}),{dy5D:c,input5D:l});return h?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(t,u,e,n,i,r,o)}}}));return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),cc=an({slice_:function(t,e,n){var r,o,a=Xe(t,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach((function(t){T(-1!==t,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(t,e){return t>=0?t:(T(-1===t,(function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."})),a.shape[e]-r[e])})),Er(a,r,o);var i=a.shape,s={begin:r,size:o};return Pt.runKernelFunc((function(t){return t.slice(a,r,o)}),{x:a},(function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return t.pad(e)}}}),"Slice",s)}}),lc=an({slice1d_:function(t,e,n){var r=Xe(t,"x","slice1d");return T(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),cc(r,[e],[n])}}),hc=an({slice2d_:function(t,e,n){var r=Xe(t,"x","slice2d");return T(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),cc(r,e,n)}}),pc=an({slice3d_:function(t,e,n){var r=Xe(t,"x","slice3d");return T(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),cc(r,e,n)}}),fc=an({slice4d_:function(t,e,n){var r=Xe(t,"x","slice4d");return T(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),cc(r,e,n)}});function dc(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(Qe(e.shape,r))),t.rank<n.rank&&(t=t.reshape(Qe(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var vc=an({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","all","bool"),o=B(e,r.shape),a=o,i=tn(a,r.rank);null!=i&&(r=r.transpose(i),a=nn(a.length,r.rank));var s=Pt.runKernelFunc((function(t){return t.all(r,a)}),{$x:r});if(n){var u=Qe(s.shape,o);return s.reshape(u)}return s}}),mc=an({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","any","bool"),o=B(e,r.shape),a=o,i=tn(a,r.rank);null!=i&&(r=r.transpose(i),a=nn(a.length,r.rank));var s=Pt.runKernelFunc((function(t){return t.any(r,a)}),{$x:r});if(n){var u=Qe(s.shape,o);return s.reshape(u)}return s}}),gc=an({argMax_:function(t,e){void 0===e&&(e=0);var n=Xe(t,"x","argMax");null==e&&(e=0);var r=B(e,n.shape),o=tn(r,n.rank);null!=o&&(n=n.transpose(o),r=nn(r.length,n.rank));var a={axis:r[0]},i=[n];return Pt.runKernelFunc((function(t,e){var o=t.argMax(n,r[0]);return e([n]),o}),{x:n},(function(t,e){var n=e[0];return{x:function(){return _n(n)}}}),"ArgMax",a,i)}}),yc=an({argMin_:function(t,e){void 0===e&&(e=0);var n=Xe(t,"x","argMin");null==e&&(e=0);var r=B(e,n.shape),o=tn(r,n.rank);return null!=o&&(n=n.transpose(o),r=nn(r.length,n.rank)),Pt.runKernelFunc((function(t,e){var o=t.argMin(n,r[0]);return e([n]),o}),{$x:n},(function(t,e){var n=e[0];return{$x:function(){return _n(n)}}}))}}),bc=an({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","logSumExp"),o=B(e,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=Qe(s.shape,o);return s.reshape(u)}return s}}),xc=an({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","max"),o=r,a=B(e,r.shape),i=a,s=tn(i,r.rank);null!=s&&(r=r.transpose(s),i=nn(i.length,r.rank));var u=[r],c=Pt.runKernelFunc((function(t,e){var n=t.max(r,i);return e([o,n]),n}),{x:r},(function(t,e){return dc(t,e[1],e[0],a,s)}),"Max",{axes:i},u,[!0]);if(n){var l=Qe(c.shape,a);c=c.reshape(l)}return c}}),wc=an({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","mean"),o=B(e,r.shape),a=I(Ze(r.shape,o)[1]);return Or((function(t){var r=pn(a);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(gn(t.shape,"float32")).div(a)}}}))(r)}}),_c=an({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","min"),o=r,a=B(e,r.shape),i=a,s=tn(i,r.rank);null!=s&&(r=r.transpose(s),i=nn(i.length,r.rank));var u=[r],c=Pt.runKernelFunc((function(t,e){var n=t.min(r,i);return e([o,n]),n}),{x:r},(function(t,e){return dc(t,e[1],e[0],a,s)}),"Min",{axes:i},u,[!0]);if(n){var l=Qe(c.shape,a);c=c.reshape(l)}return c}}),Cc=an({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=B(e,(t=Xe(t,"x","moments")).shape),o=t.mean(r,n),a=o.shape;n||(a=Qe(o.shape,r));var i=t.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),Ec=an({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=B(e,r.shape);return Or((function(t){var e=tn(o,t.rank),r=o,a=t;null!=e&&(a=t.transpose(e),r=nn(r.length,t.rank));var i=function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(gn(t.shape,"float32"))},s={axes:r},u=Pt.runKernelFunc((function(t){return t.sum(a,r)}),{x:a},(function(t){return{x:function(){return i(t)}}}),"Sum",s);if(n){var c=Qe(u.shape,o);u=u.reshape(c)}return{value:u,gradFunc:i}}))(r)}}),Tc=an({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Xe(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=B(e,r.shape),a=tn(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=nn(i.length,r.rank));var u=Pt.runKernelFunc((function(t){return t.prod(s,i)}),{permutedX:s});if(n){var c=Qe(u.shape,o);u=u.reshape(c)}return u}}),Sc=an({elu_:function(t){var e=Xe(t,"x","elu");return Pt.runKernelFunc((function(t,n){var r=t.elu(e);return n([r]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return Pt.runKernelFunc((function(e){return e.eluDer(t,n)}),{dy:t,y:n})}}}))}}),kc=an({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=Xe(t,"x","leakyRelu");return uu(pn(e).mul(n),n)}}),Ac=an({prelu_:function(t,e){var n=Xe(t,"x","prelu"),r=Xe(e,"alpha","prelu");return Pt.runKernelFunc((function(t,e){var o=t.prelu(n,r);return e([n,r]),o}),{x:n,alpha:r},(function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{x:function(){return Qs(o,t,t.mul(r))},alpha:function(){var e=Qs(o,_n(t),t.mul(n)),a=Lr(r.shape,t.shape);return a.length>0&&(e=e.sum(a)),e.reshape(r.shape)}}}),"Prelu")}}),Ic=an({relu_:function(t){var e=Xe(t,"x","relu");return"bool"===e.dtype?e.toInt():Pt.runKernelFunc((function(t,n){var r=t.relu(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}}),"Relu")}}),Rc=an({relu6_:function(t){var e=Xe(t,"x","relu6");return"bool"===e.dtype?e.toInt():Pt.runKernelFunc((function(t,n){var r=t.relu6(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}}),"Relu6")}}),Oc=an({selu_:function(t){var e=Xe(t,"x","selu");return Pt.runKernelFunc((function(t,n){var r=t.selu(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){var e=n.greater(pn(0)),r=pn(Ia),o=pn(Ra),a=t.mul(o),i=t.mul(r).mul(n.toFloat().exp());return Qs(e,a,i)}}}))}}),Dc=an({transpose_:function(t,e){var n=Xe(t,"x","transpose");if(null==e&&(e=n.shape.map((function(t,e){return e})).reverse()),T(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."})),e.forEach((function(t){T(t>=0&&t<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e}))})),n.rank<=1)return n.clone();var r={perm:e};return Pt.runKernelFunc((function(t){return t.transpose(n,e)}),{x:n},(function(t){var n=en(e);return{x:function(){return t.transpose(n)}}}),"Transpose",r)}}),Mc=an({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=Xe(t,"x","localResponseNormalization");T(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),T(O(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Pt.runKernelFunc((function(t,a){var s=t.localResponseNormalization4D(i,e,n,r,o);return a([i,s]),s}),{x4D:i},(function(t,a){var i=a[0],s=a[1];return{x4D:function(){return Pt.runKernelFunc((function(a){return a.LRNGrad(t,i,s,e,n,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Nc=an({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(pn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=Xe(t,"x","norm"),e,n),a=o.shape;if(r){var i=B(n,t.shape);a=Qe(o.shape,i)}return o.reshape(a)}}),Fc=an({basicLSTMCell_:function(t,e,n,r,o,a){var i=Xe(t,"forgetBias","basicLSTMCell"),s=Xe(e,"lstmKernel","basicLSTMCell"),u=Xe(n,"lstmBias","basicLSTMCell"),c=Xe(r,"data","basicLSTMCell"),l=Xe(o,"c","basicLSTMCell"),h=Xe(a,"h","basicLSTMCell"),f=c.concat(h,1).matMul(s).add(u),d=f.shape[0],p=f.shape[1]/4,v=[d,p],m=f.slice([0,0],v),g=f.slice([0,p],v),y=f.slice([0,2*p],v),x=f.slice([0,3*p],v),b=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(i.add(y).sigmoid())),w=b.tanh().mulStrict(x.sigmoid());return[b,w]}}),Pc=an({multiRNNCell_:function(t,e,n,r){for(var o=Xe(e,"data","multiRNNCell"),a=Ke(n,"c","multiRNNCell"),i=Ke(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,a[c],i[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],f=[];for(c=0;c<u.length;c+=2)h.push(u[c]),f.push(u[c+1]);return[h,f]}}),Bc=an({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var a=Xe(t,"v","movingAverage"),i=Xe(e,"x","movingAverage"),s=Xe(n,"decay","movingAverage");Ot(a,i),T(R(a.shape,i.shape),(function(){return"Shape mismatch in v and x"}));var u=pn(1),c=u.sub(s),l=i.sub(a).mul(c);if(o){T(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Xe(r,"step","movingAverage");l=l.div(u.sub(mu(s,h)))}return a.add(l)}}),Lc=an({stridedSlice_:function(t,e,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var c=Xe(t,"x","stridedSlice"),l=Tr(s),h=c.shape.slice();l.forEach((function(t){e[t]=0,n[t]=1,h.splice(t,0,1)})),c=c.reshape(h);for(var f=0;f<c.rank;f++)e[f]=kr(o,e,r,c.shape,f),n[f]=Ar(a,n,r,c.shape,f),r[f]=r[f]||1;var d=Tr(u);d.forEach((function(t){n[t]=e[t]+1,r[t]=1}));var p=Sr(e,n,r),v=p.filter((function(t,e){return-1===d.indexOf(e)}));return r.every((function(t){return 1===t}))?cc(c,e,p).reshape(v):Pt.runKernelFunc((function(t){return t.stridedSlice(c,e,n,r)}),{$x:c}).reshape(v)}}),Wc=an({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=Xe(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var a=Pt.runKernelFunc((function(t){return t.topk(r,e,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Vc=an({scatterND_:function(t,e,n){var r=Xe(t,"indices","scatterND","int32"),o=Xe(e,"updates","scatterND");return _r(o,r,n),Pt.runKernelFunc((function(t){return t.scatterND(r,o,n)}),{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Uc=an({fft_:function(t){T("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return Pt.runKernelFunc((function(t){return t.fft(r)}),{input:t}).reshape(t.shape)}}),jc=an({ifft_:function(t){T("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return Pt.runKernelFunc((function(t){return t.ifft(r)}),{input:t}).reshape(t.shape)}}),zc=an({rfft_:function(t,e){T("float32"===t.dtype,(function(){return"The dtype for rfft() must be real value but got "+t.dtype}));var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var a=t.shape.map((function(t){return 0})),i=t.shape.map((function(t){return t}));i[t.shape.length-1]=e,n=t.slice(a,i),r=e}else if(null!=e&&e>r){var s=t.shape.map((function(t){return t}));s[t.shape.length-1]=e-r,n=t.concat(yn(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=sn(n,u).as2D(o,r),l=Uc(c),h=Math.floor(r/2)+1,f=un(l),d=cn(l),p=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,sn(p[0],v[0]).reshape(m)}}),qc=an({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=jc(r);return un(o)}var a=[n,2*(e-1)],i=un(t).as2D(n,e),s=cn(t).as2D(n,e),u=i.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(pn(-1)),l=i.concat(u,1),h=s.concat(c,1);return r=sn(l,h).as2D(a[0],a[1]),o=jc(r),un(o)}}),Gc=Object.freeze({fft:Uc,ifft:jc,rfft:zc,irfft:qc}),Hc=an({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=Xe(t,"sparseIndices","sparseToDense","int32"),a=Xe(e,"sparseValues","sparseToDense"),i=Xe(r,"defaultValue","sparseToDense",a.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,a=t.rank>1?t.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=e.size;if(0!==e.rank&&(1!==e.rank||i!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),Pt.runKernelFunc((function(t){return t.sparseToDense(o,a,n,i)}),{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),th=an({gatherND_:function(t,e){var n=Xe(e,"indices","gatherND","int32"),r=Xe(t,"x","gatherND");return Pt.runKernelFunc((function(t){return t.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Xc=an({diag_:function(t){var e=Xe(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return Pt.runKernelFunc((function(t){return t.diag(e)}),{$x:e}).reshape(n)}}),Kc=an({dropout_:function(t,e,n,r){var o=Xe(t,"x","dropout");if(T("float32"===o.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),T(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),0===e)return t instanceof xt?o.clone():o;var a=function(t,e){if(null==e)return t.shape.slice();if(R(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(o,n),i=1-e,s=or(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function Yc(t,e,n){for(var r=1-t%2,o=new Float32Array(t),a=0;a<t;++a){var i=2*Math.PI*a/(t+r-1);o[a]=e-n*Math.cos(i)}return fn(o,"float32")}var $c,Zc=an({hannWindow_:function(t){return Yc(t,.5,.5)}}),Qc=an({hammingWindow_:function(t){return Yc(t,.54,.46)}}),Jc=an({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+e<=t.size;)i.push(cc(t,a,e)),a+=n;if(r)for(;a<t.size;){var s=a+e-t.size,u=Cn([cc(t,a,e-s),bn([s],o)]);i.push(u),a+=n}return 0===i.length?dn([],[0,e]):Cn(i).as2D(i.length,e)}}),tl=an({stft_:function(t,e,n,r,o){var a;void 0===o&&(o=Zc),null==r&&(a=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=Jc(t,e,n),s=du(i,o(e)),u=[],c=0;c<i.shape[0];c++)u.push(zc(s.slice([c,0],[1,e]),r));return Cn(u)}}),el=Object.freeze({hannWindow:Zc,hammingWindow:Qc,frame:Jc,stft:tl});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}($c||($c={}));var nl=an({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=$c.SUM_BY_NONZERO_WEIGHTS);var o=Xe(t,"labels","absoluteDifference"),a=Xe(e,"predictions","absoluteDifference"),i=null;null!=n&&(i=Xe(n,"weights","absoluteDifference")),S(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return rl(s,i,r)}}),rl=an({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=$c.SUM_BY_NONZERO_WEIGHTS);var r=Xe(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=Xe(e,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===$c.NONE)return a;if(n===$c.SUM)return a.sum();if(n===$c.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(pn(i)):s}if(n===$c.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(pn(r.size));var u=o.mul(gn(r.shape)).notEqual(pn(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),il=an({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=$c.SUM_BY_NONZERO_WEIGHTS);var a=Xe(t,"labels","cosineDistance"),i=Xe(e,"predictions","cosineDistance"),s=null;null!=r&&(s=Xe(r,"weights","cosineDistance")),S(a.shape,i.shape,"Error in cosineDistance: ");var u=pn(1).sub(a.mul(i).sum(n,!0));return rl(u,s,o)}}),al=an({hingeLoss_:function(t,e,n,r){void 0===r&&(r=$c.SUM_BY_NONZERO_WEIGHTS);var o=Xe(t,"labels","hingeLoss"),a=Xe(e,"predictions","hingeLoss"),i=null;null!=n&&(i=Xe(n,"weights","hingeLoss")),S(o.shape,a.shape,"Error in hingeLoss: ");var s=pn(1);o=pn(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return rl(u,i,r)}}),sl=an({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=$c.SUM_BY_NONZERO_WEIGHTS);var a=Xe(t,"labels","huberLoss"),i=Xe(e,"predictions","huberLoss"),s=null;null!=n&&(s=Xe(n,"weights","huberLoss")),S(a.shape,i.shape,"Error in huberLoss: ");var u=pn(r),c=i.sub(a).abs(),l=lu(c,u),h=c.sub(l),f=pn(.5).mul(l.square()).add(u.mul(h));return rl(f,s,o)}}),cl=an({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=$c.SUM_BY_NONZERO_WEIGHTS);var a=Xe(t,"labels","logLoss"),i=Xe(e,"predictions","logLoss"),s=null;null!=n&&(s=Xe(n,"weights","logLoss")),S(a.shape,i.shape,"Error in logLoss: ");var u=pn(1),c=pn(r),l=a.mul(i.add(c).log()).neg().sub(u.sub(a).mul(u.sub(i).add(c).log()));return rl(l,s,o)}}),ll=an({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=$c.SUM_BY_NONZERO_WEIGHTS);var o=Xe(t,"labels","meanSquaredError"),a=Xe(e,"predictions","meanSquaredError"),i=null;null!=n&&(i=Xe(n,"weights","meanSquaredError")),S(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return rl(s,i,r)}}),hl=an({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=$c.SUM_BY_NONZERO_WEIGHTS);var a=Xe(t,"multiClassLabels","sigmoidCrossEntropy"),i=Xe(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Xe(n,"weights","sigmoidCrossEntropy")),S(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=pn(r),c=pn(1),l=pn(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var h=function(t,e){var n=Xe(t,"labels","sigmoidCrossEntropyWithLogits"),r=Xe(e,"logits","sigmoidCrossEntropyWithLogits");S(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return rl(h,s,o)}}),pl=an({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=$c.SUM_BY_NONZERO_WEIGHTS);var a=Xe(t,"onehotLabels","softmaxCrossEntropy"),i=Xe(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Xe(n,"weights","softmaxCrossEntropy")),S(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=pn(r),c=pn(1),l=pn(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var h=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return Or((function(t,e,r){var o=e.logSumExp([n],!0),a=e.toFloat().sub(o);return r([t,a]),{value:a.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],a=Qe(t.shape,[n]);return[t.reshape(a).mul(r.toFloat().sub(o.exp())),t.reshape(a).mul(o.exp().sub(r.toFloat()))]}}}))(t,e)}(a,i);return rl(h,s,o)}}),fl=Object.freeze({get Reduction(){return $c},absoluteDifference:nl,computeWeightedLoss:rl,cosineDistance:il,hingeLoss:al,huberLoss:sl,logLoss:cl,meanSquaredError:ll,sigmoidCrossEntropy:hl,softmaxCrossEntropy:pl});function vl(t,e){return void 0===e&&(e=!1),Pt.tidy((function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=Hn(n),a=t.clone(),i=dn([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,c=function(t){var e,u=a,c=s,l=o;e=Pt.tidy((function(){var e=a.slice([t,t],[n-t,1]),u=e.norm(),c=a.slice([t,t],[1,1]),l=dn([[-1]]).where(c.greater(0),dn([[1]])),h=c.sub(l.mul(u)),f=e.div(h);s=1===f.shape[0]?i.clone():i.concat(f.slice([1,0],[f.shape[0]-1,f.shape[1]]),0);var d=l.matMul(h).div(u).neg(),p=a.slice([t,0],[n-t,r]),v=d.mul(s);if(0===t)a=p.sub(v.matMul(s.transpose().matMul(p)));else{var m=p.sub(v.matMul(s.transpose().matMul(p)));a=a.slice([0,0],[t,r]).concat(m,0)}var g=o.slice([0,t],[n,o.shape[1]-t]);if(0===t)o=g.sub(g.matMul(s).matMul(v.transpose()));else{var y=g.sub(g.matMul(s).matMul(v.transpose()));o=o.slice([0,0],[n,t]).concat(y,1)}return[s,a,o]})),s=e[0],a=e[1],o=e[2],ze([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]}))}var ml=an({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=Xe(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(e<=i))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=i),n<0&&(n=s);var u=xn(0,i,1,"int32").reshape([-1,1]),c=xn(0,s,1,"int32"),l=bu(u,c),h=Ks(l.lessEqual(pn(+e,"int32")),l.greaterEqual(pn(-n,"int32"))),f=yn([i,s],r.dtype);return ur(pr(r.reshape([-1,i,s])).map((function(t){return Qs(h,t,f)}))).reshape(o)}}),gl=an({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,T(null!=t&&t.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=t[0].shape[0],r=function(e){T(t[e].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"}))},o=1;o<t.length;++o)r(o)}else e=!0,t=tr(t,t.shape[0],0).map((function(t){return sr(t,[0])}));T(t.length<=t[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."}));var a=[],i=t,s=function(t){a.push(Pt.tidy((function(){var e=i[t];if(t>0)for(var n=0;n<t;++n){var r=Ec(a[n].mulStrict(e)).mul(a[n]);e=e.sub(r)}return e.div(Nc(e,"euclidean"))})))};for(o=0;o<t.length;++o)s(o);return e?ur(a,0):a}}),yl=an({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return vl(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce((function(t,e){return t*e})),r=pr(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],a=[];return r.forEach((function(t){var n=vl(t,e),r=n[0],i=n[1];o.push(r),a.push(i)})),[ur(o,0).reshape(t.shape),ur(a,0).reshape(t.shape)]}}),bl=Object.freeze({bandPart:ml,gramSchmidt:gl,qr:yl});function xl(t,e,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=t.shape[0];return n=Math.min(n,i),T(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),T(2===t.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"})),T(4===t.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]})),T(1===e.rank,(function(){return"scores must be a 1D tensor"})),T(e.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]})),T(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var wl=an({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=Xe(t,"images","resizeBilinear");T(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(2===e.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],s=e[1],u=Pt.runKernelFunc((function(t,e){return e([o]),t.resizeBilinear(o,i,s,n)}),{x:o},(function(t,e){return{x:function(){return Pt.runKernelFunc((function(r){return r.resizeBilinearBackprop(t,e[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),_l=an({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=Xe(t,"images","resizeNearestNeighbor");T(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(2===e.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),T("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],s=e[1],u=Pt.runKernelFunc((function(t,e){return e([o]),t.resizeNearestNeighbor(o,i,s,n)}),{batchImages:o},(function(t,e){return{batchImages:function(){return Pt.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Cl=an({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=Xe(t,"boxes","nonMaxSuppression"),i=Xe(e,"scores","nonMaxSuppression"),s=xl(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return Pt.runKernelFunc((function(t){return t.nonMaxSuppression(a,i,n,r,o)}),{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),El=an({nonMaxSuppressionWithScore_:function(t,e,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=Xe(t,"boxes","nonMaxSuppression"),s=Xe(e,"scores","nonMaxSuppression"),u=xl(i,s,n,r,o,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=Pt.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Tl=an({cropAndResize_:function(t,e,n,r,o,a){var i=Xe(t,"image","cropAndResize"),s=Xe(e,"boxes","cropAndResize","float32"),u=Xe(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var c=s.shape[0];return T(4===i.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."})),T(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),T(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),T(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),T(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),T("bilinear"===o||"nearest"===o,(function(){return"method must be bilinear or nearest, but was "+o})),Pt.runKernelFunc((function(t,e){return t.cropAndResize(i,s,u,r,o,a)}),{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),Sl=Object.freeze({resizeBilinear:wl,resizeNearestNeighbor:_l,nonMaxSuppression:Cl,nonMaxSuppressionAsync:function(t,e,n,a,i){return void 0===a&&(a=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),f(this,void 0,void 0,(function(){var r,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:return r=Xe(t,"boxes","nonMaxSuppressionAsync"),s=Xe(e,"scores","nonMaxSuppressionAsync"),u=xl(r,s,n,a,i),n=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([r.data(),s.data()])];case 1:return o=f.sent(),c=o[0],l=o[1],h=so(c,l,n,a,i),r!==t&&r.dispose(),s!==e&&s.dispose(),[2,h]}}))}))},nonMaxSuppressionWithScore:El,nonMaxSuppressionWithScoreAsync:function(t,e,n,a,i,s){return void 0===a&&(a=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===s&&(s=0),f(this,void 0,void 0,(function(){var r,u,o,c,l,h,f;return d(this,(function(d){switch(d.label){case 0:return r=Xe(t,"boxes","nonMaxSuppressionAsync"),u=Xe(e,"scores","nonMaxSuppressionAsync"),o=xl(r,u,n,a,i,s),n=o.maxOutputSize,a=o.iouThreshold,i=o.scoreThreshold,s=o.softNmsSigma,[4,Promise.all([r.data(),u.data()])];case 1:return c=d.sent(),l=c[0],h=c[1],f=uo(l,h,n,a,i,s),r!==t&&r.dispose(),u!==e&&u.dispose(),[2,f]}}))}))},cropAndResize:Tl}),kl=function(t,e){return!(t>0)||"linear"===e},Al=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Il=function(t,e){var n=e,r=Lr(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},Rl=function(t,e,n){if("linear"===e)return t;if("relu"===e)return Ic(t);if("elu"===e)return Sc(t);if("relu6"===e)return Rc(t);if("prelu"===e)return Ac(t,n);throw new Error("Unknown fused activation "+e+".")},Ol=an({fusedMatMul_:function(t){var e,n=t.a,r=t.b,o=t.transposeA,a=void 0!==o&&o,i=t.transposeB,s=void 0!==i&&i,u=t.bias,c=t.activation,l=void 0===c?"linear":c,h=t.preluActivationWeights;if(!1===kl(Pt.state.gradientDepth,l)){var f=Zu(n,r,a,s);return null!=u&&(f=tu(f,u)),Rl(f,l,h)}var d=Xe(n,"a","fused matMul"),p=Xe(r,"b","fused matMul");e=Rt(d,p),d=e[0],p=e[1];var v=a?d.shape[d.rank-2]:d.shape[d.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?d.shape[d.rank-1]:d.shape[d.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=d.shape.slice(0,-2),b=p.shape.slice(0,-2),w=I(x),_=I(b);T(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."})),T(R(x,b),(function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."})),T(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var C,E,S=d.shape.slice(0,-2).concat([g,y]),k=a?d.as3D(w,v,g):d.as3D(w,g,v),A=s?p.as3D(_,y,m):p.as3D(_,m,y);null!=u&&Wr(S,(C=Rt(C=Xe(u,"bias","fused matMul"),d)[0]).shape),null!=h&&(E=Xe(h,"prelu weights","fused matMul"));var O={a:k,b:A};null!=u&&(O.bias=C),null!=h&&(O.preluActivationWeights=E);var D=[k,A];return Pt.runKernelFunc((function(t,e){var n=t.fusedBatchMatMul({a:k,b:A,transposeA:a,transposeB:s,bias:C,activation:l,preluActivationWeights:E});return e([k,A,n]),n}),O,(function(t,e){var n=e[0],r=e[1],o=e[2],i=Al(t,o,l),c={};return null!=u&&(c={bias:function(){return Il(C,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},c):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},c):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},D,[!0]).reshape(S)}}),Dl=an({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,f=void 0===h?"linear":h,d=t.preluActivationWeights;if(f=f||"linear",!1===kl(Pt.state.gradientDepth,f)){var p=Uu(e,n,r,o,i,u,c);return null!=l&&(p=tu(p,l)),Rl(p,f,d)}var v=Xe(e,"x","conv2d"),m=Xe(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),T(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=c&&T(O(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),T(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),T($r(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),T("NHWC"===i,(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var x,b,w=jr(g.shape,m.shape,r,u,o,c);null!=l&&(x=Rt(x=Xe(l,"bias","fused conv2d"),v)[0],Wr(w.outShape,x.shape)),null!=d&&(b=Xe(d,"prelu weights","fused conv2d"));var _={x:g,filter:m};null!=l&&(_.bias=x),null!=d&&(_.preluActivationWeights=b);var C=[m,g],E=Pt.runKernelFunc((function(t,e){var n=t.fusedConv2d({input:g,filter:m,convInfo:w,bias:x,activation:f,preluActivationWeights:b});return e([m,g,n]),n}),_,(function(t,e){var n=e,a=n[0],i=n[1],s=n[2],c=Al(t,s,f);T(Yr(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var h={};return null!=l&&(h={bias:function(){return Il(x,c)}}),Object.assign({x:function(){return qu(i.shape,c,a,r,o)},filter:function(){return zu(i,c,a.shape,r,o)}},h)}),"FusedConv2D",{convInfo:w,activation:f},C,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Ml=an({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,f=void 0===h?"linear":h,d=t.preluActivationWeights;if(!1===kl(Pt.state.gradientDepth,f)){var p=Gu(e,n,r,o,i,u,c);return null!=l&&(p=tu(p,l)),Rl(p,f,d)}var v=Xe(e,"x","depthwiseConv2d"),m=Xe(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),T(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),T(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==u&&(u=[1,1]),T($r(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&T(O(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var x,b,w=jr(g.shape,m.shape,r,u,o,c,!0);null!=l&&(x=Rt(x=Xe(l,"bias","fused conv2d"),v)[0],Wr(w.outShape,x.shape)),null!=d&&(b=Xe(d,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:m};null!=l&&(_.bias=x),null!=d&&(_.preluActivationWeights=b);var C=[m,g],E=Pt.runKernelFunc((function(t,e){var n=t.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:x,activation:f,preluActivationWeights:b});return e([m,g,n]),n}),_,(function(t,e){T(Yr(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=e[0],r=e[1],o=e[2],a=Al(t,o,f),i={};return null!=l&&(i={bias:function(){return Il(x,a)}}),Object.assign({x:function(){return Hu(r.shape,a,n,w)},filter:function(){return Xu(r,a,n.shape,w)}},i)}),"FusedDepthwiseConv2D",{convInfo:w,activation:f},C,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Nl=Object.freeze({matMul:Ol,conv2d:Dl,depthwiseConv2d:Ml}),Fl=Object.freeze({image:Sl,linalg:bl,losses:fl,spectral:Gc,fused:Nl,signal:el,square:Za,squaredDifference:Ja,conv1d:Vu,conv2d:Uu,conv3d:ju,depthwiseConv2d:Gu,separableConv2d:Ku,conv2dTranspose:Yu,conv3dTranspose:$u,op:an,batchNormalization2d:Vs,batchNormalization3d:Us,batchNormalization4d:js,batchNormalization:zs,batchNorm:qs,batchNorm2d:Gs,batchNorm3d:Hs,batchNorm4d:Xs,booleanMaskAsync:function(t,e,n){return f(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h,f,p,v,m;return d(this,(function(d){switch(d.label){case 0:for(r=Xe(t,"tensor","boolMask"),a=Xe(e,"mask","boolMask","bool"),i=null==n?0:n,s=a.rank,u=r.shape,T(s>0,(function(){return"mask cannot be scalar"})),S(u.slice(i,i+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),o=1,c=i;c<i+s;c++)o*=u[c];return l=u.slice(0,i).concat([o],u.slice(i+s)),h=r.reshape(l),f=a.reshape([-1]),[4,Js(f)];case 1:return p=d.sent(),v=p.squeeze([1]),m=Fu(h,v,i),t!==r&&r.dispose(),e!==a&&a.dispose(),v.dispose(),h.dispose(),f.dispose(),p.dispose(),[2,m]}}))}))},complex:sn,real:un,imag:cn,concat:Cn,concat1d:En,concat2d:Tn,concat3d:Sn,concat4d:kn,split:tr,matMul:Zu,dot:Qu,outerProduct:Ju,reverse:ol,reverse1d:tc,reverse2d:ec,reverse3d:nc,reverse4d:ul,maxPool:ic,avgPool:ac,pool:dl,maxPool3d:sc,avgPool3d:uc,slice:cc,slice1d:lc,slice2d:hc,slice3d:pc,slice4d:fc,abs:ts,acos:es,acosh:ns,asin:rs,asinh:os,atan:is,atanh:as,ceil:ss,clipByValue:us,cos:cs,cosh:ls,erf:hs,exp:ps,expm1:fs,floor:ds,log:vs,log1p:ms,logSigmoid:gs,neg:ys,reciprocal:bs,round:xs,rsqrt:ws,sigmoid:_s,sign:Cs,isNaN:Es,isInf:Ts,isFinite:Ss,sin:ks,sinh:As,softplus:Is,sqrt:Rs,step:Os,tan:Ds,tanh:Ms,all:vc,any:mc,argMax:gc,argMin:yc,logSumExp:bc,max:xc,mean:wc,min:_c,moments:Cc,sum:Ec,prod:Tc,equal:wu,equalStrict:_u,greater:Cu,greaterEqual:Eu,greaterEqualStrict:Tu,greaterStrict:Su,less:ku,lessEqual:Au,lessEqualStrict:Iu,lessStrict:Ru,notEqual:Ou,notEqualStrict:Du,add:tu,addN:eu,addStrict:nu,atan2:ru,div:ou,divNoNan:iu,divStrict:au,floorDiv:su,maximum:uu,maximumStrict:cu,minimum:lu,minimumStrict:hu,mod:pu,modStrict:fu,mul:du,mulStrict:vu,pow:mu,powStrict:gu,squaredDifferenceStrict:yu,sub:bu,subStrict:xu,elu:Sc,leakyRelu:kc,prelu:Ac,relu:Ic,relu6:Rc,selu:Oc,logicalAnd:Ks,logicalNot:Ys,logicalOr:$s,logicalXor:Zs,where:Qs,whereAsync:Js,buffer:Wn,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:Vn,broadcastTo:Un,cast:jn,clone:zn,cumsum:qn,depthToSpace:br,expandDims:Gn,eye:Hn,multinomial:Xn,oneHot:Kn,pad:Yn,pad1d:$n,pad2d:Zn,pad3d:Qn,pad4d:Jn,rand:er,randomNormal:nr,randomGamma:rr,randomUniform:or,reshape:ir,spaceToBatchND:ar,squeeze:sr,stack:ur,tile:cr,truncatedNormal:lr,unstack:pr,setdiff1dAsync:function(t,e){return f(this,void 0,void 0,(function(){var n,r,a,i,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:return n=Xe(t,"x","setdiff1d"),r=Xe(e,"y","setdiff1d"),T(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),T(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),T(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return a=f.sent(),[4,r.data()];case 2:for(i=f.sent(),s=new Set(i),u=0,l=0;l<a.length;l++)s.has(a[l])||u++;for(o=new mt([u],n.dtype),c=new mt([u],"int32"),l=0,h=0;l<a.length;l++)s.has(a[l])||(o.values[h]=a[l],c.values[h]=l,h++);return[2,[o.toTensor(),c.toTensor()]]}}))}))},fill:bn,linspace:function(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return Pt.runKernelFunc((function(r){return r.linspace(t,e,n)}),{})},ones:gn,range:xn,scalar:pn,tensor:ln,tensor1d:fn,tensor2d:dn,tensor3d:vn,tensor4d:mn,tensor5d:function(t,e,n){if(k(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ge(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return hn(t,e,r,n)},tensor6d:function(t,e,n){if(k(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ge(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return hn(t,e=e||r,r,n)},variable:function(t,e,n,r){return void 0===e&&(e=!0),Pt.makeVariable(t,e,n,r)},zeros:yn,onesLike:wn,zerosLike:_n,transpose:Dc,softmax:Dr,logSoftmax:Mr,localResponseNormalization:Mc,norm:Nc,gather:Fu,unsortedSegmentSum:Pu,basicLSTMCell:Fc,multiRNNCell:Pc,movingAverage:Bc,stridedSlice:Lc,topk:Wc,scatterND:Vc,fft:Uc,ifft:jc,rfft:zc,irfft:qc,sparseToDense:Hc,gatherND:th,diag:Xc,dropout:Kc,hannWindow:Zc,hammingWindow:Qc,frame:Jc,stft:tl,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),f(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h,f,p,v,m,g;return d(this,(function(d){switch(d.label){case 0:return r=Xe(t,"predictions","inTopK"),a=Xe(e,"targets","inTopK"),T(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),T(r.rank-1===a.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank})),S(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],T(n>0&&n<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n})),[4,r.data()];case 1:return s=d.sent(),[4,a.data()];case 2:for(u=d.sent(),o=[s.length/i,i],l=o[1],h=W("bool",c=o[0]),f=0;f<c;f++){for(p=f*l,v=s.subarray(p,p+l),m=[],g=0;g<v.length;g++)m.push({value:v[g],index:g});for(m.sort((function(t,e){return e.value-t.value})),h[f]=0,g=0;g<n;g++)if(m[g].index===u[f]){h[f]=1;break}}return t!==r&&r.dispose(),e!==a&&a.dispose(),[2,ln(h,a.shape,"bool")]}}))}))}});function Pl(t,e){Array.isArray(t)||(t=[t]),t.forEach((function(t){null!=t&&T("complex64"!==t.dtype,(function(){return e+" does not support complex64 tensors."}))}))}function Bl(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Ll=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Nr(e,Pt),e}return h(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,i().get("IS_NODE")&&qe("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;return"complex64"===n?eo(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map((function(t){return st(t)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Wn(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return Pt.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){return e=it(),t(),[2,{kernelMs:it()-e}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Pt.keep(t.clone()),imag:Pt.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(Pl(t,"slice"),Ir(t.shape,e,n)){var r=Rr(e,t.strides),o=I(n);return ln(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var a=Wn(n,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(t,n){return t+e[n]}));a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){Pl(t,"stridedSlice");var o=Sr(e,n,r);if(o.some((function(t){return 0===t})))return ln([],o);for(var a=Wn(o,t.dtype),i=this.bufferSync(t),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+e[l];a.set.apply(a,[i.get.apply(i,c)].concat(u))}return a.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=Wn([t.size,t.size],t.dtype),r=n.values,o=0;o<e.length;o++)r[o*t.size+o]=e[o];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(r[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(r);return u},e.prototype.reverse=function(t,e){Pl(t,"reverse");for(var n=Wn(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var a=n.indexToLoc(o),i=a.slice();e.forEach((function(e){return i[e]=t.shape[e]-1-i[e]})),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map((function(t){return un(t)})),o=t.map((function(t){return cn(t)}));return sn(this.concat(r,e),this.concat(o,e))}var a=t.map((function(t){var n=I(t.shape.slice(e));return t.as2D(-1,n)})),i=on(a.map((function(t){return t.shape})),1),s=Wn(i,t[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(t){s.set(n.readSync(t.dataId),u),u+=t.size}))}else{var c=0;a.forEach((function(t){for(var e=n.readSync(t.dataId),r=0,o=0;o<t.shape[0];++o)for(var a=o*i[1]+c,u=0;u<t.shape[1];++u)s[a+u]=e[r++];c+=t.shape[1]}))}var l=on(t.map((function(t){return t.shape})),e);return ln(s,l,t[0].dtype)},e.prototype.neg=function(t){return Pl(t,"neg"),this.multiply(pn(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t+n,imag:e+r}})):this.broadcastedBinaryOp(t,e,At(t.dtype,e.dtype),(function(t,e){return t+e}))},e.prototype.addN=function(t){var e=this;Pl(t,"addN");for(var n=t.map((function(t){return e.readSync(t.dataId)})),r=Wn(t[0].shape,t[0].dtype),o=r.values,a=0;a<t.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},e.prototype.softmax=function(t,e){var n=B([e],t.shape),r=this.max(t,n),o=Qe(r.shape,n),a=this.subtract(t,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t-n,imag:e-r}})):this.broadcastedBinaryOp(t,e,At(t.dtype,e.dtype),(function(t,e){return t-e}))},e.prototype.pow=function(t,e){return Pl([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.pow(t,e)}))},e.prototype.batchMatMul=function(t,e,n,r){Pl([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],a=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],f=l[1],d=l[2],p=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],v=p[0],m=p[1],g=p[2],y=a*i,x=Wn([s,a,i],t.dtype),b=x.values,w=this.blockSize,_=0;_<s;_++)for(var C=0;C<a;C+=w)for(var E=0;E<i;E+=w)for(var T=0;T<o;T+=w)for(var S=Math.min(C+w,a),k=Math.min(E+w,i),A=Math.min(T+w,o),I=C;I<S;I++)for(var R=E;R<k;R++){for(var O=0,D=T;D<A;D++)O+=u[_*h+I*f+D*d]*c[D*v+R*m+_*g];b[_*y+(I*i+R)]+=O}return x.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=this.batchMatMul(e,n,r,o);return a&&(u=this.add(u,a)),i&&(u=Bl(this,u,i,s)),u},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}})):this.broadcastedBinaryOp(t,e,At(t.dtype,e.dtype),(function(t,e){return t*e}))},e.prototype.realDivide=function(t,e){return Pl([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",(function(t,e){return t/e}))},e.prototype.floorDiv=function(t,e){return Pl([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",(function(t,e){return Math.floor(t/e)}))},e.prototype.sum=function(t,e){Pl(t,"sum"),Je("sum",e,t.rank);for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,At(t.dtype,"int32")),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=0,f=0;f<i;++f)h+=u[l+f];s[c]=h}return a},e.prototype.prod=function(t,e){Pl(t,"sum");for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,At(t.dtype,"int32")),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=1,f=0;f<i;++f)h*=u[l+f];s[c]=h}return a},e.prototype.unsortedSegmentSum=function(t,e,n){Pl(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,a=0;a<o;++a)e=e.expandDims(a+1);for(a=0;a<n;++a){var i=pn(a,"int32"),s=wu(i,e).asType("float32").mul(t).sum(0);r.push(s)}return ur(r)},e.prototype.argMin=function(t,e){Pl(t,"argMin");var n=[e];Je("argMin",n,t.rank);for(var r=Ze(t.shape,n),o=r[0],a=r[1],i=yn(o,"int32"),s=I(a),u=this.readSync(i.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0,p=0;p<s;++p){var v=c[h+p];v<f&&(f=v,d=p)}u[l]=d}return i},e.prototype.argMax=function(t,e){Pl(t,"argMax");var n=[e];Je("argMax",n,t.rank);for(var r=Ze(t.shape,n),o=r[0],a=r[1],i=yn(o,"int32"),s=I(a),u=this.readSync(i.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0,p=0;p<s;++p){var v=c[h+p];v>f&&(f=v,d=p)}u[l]=d}return i},e.prototype.cumsum=function(t,e,n,r){if(Pl(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=At(t.dtype,"int32"),a=yn(t.shape,o),i=this.readSync(a.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var f=c(l,h);if(0===h)i[f]=n?0:s[f];else{var d=c(l,h-1);i[f]=n?s[d]+i[d]:s[f]+i[d]}}return a},e.prototype.equal=function(t,e){return Pl([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t===e?1:0}))},e.prototype.notEqual=function(t,e){return Pl([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t!==e?1:0}))},e.prototype.less=function(t,e){return Pl([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<e?1:0}))},e.prototype.lessEqual=function(t,e){return Pl([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<=e?1:0}))},e.prototype.greater=function(t,e){return Pl([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>e?1:0}))},e.prototype.greaterEqual=function(t,e){return Pl([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>=e?1:0}))},e.prototype.logicalNot=function(t){Pl(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return Pl([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t&&e}))},e.prototype.logicalOr=function(t,e){return Pl([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t||e}))},e.prototype.select=function(t,e,n){Pl([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=this.readSync(n.dataId),i=yn(e.shape,At(e.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:I(e.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)1===r[l]?s[u++]=o[l]:s[u++]=a[l];return i},e.prototype.where=function(t){Pl([t],"where");var e=this.readSync(t.dataId);return go(t.shape,e)},e.prototype.topk=function(t,e,n){return Pl(t,"topk"),mo(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){Pl(t,"min"),Je("min",e,t.rank);for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,t.dtype),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],f=0;f<i;++f){var d=u[l+f];d<h&&(h=d)}s[c]=h}return a},e.prototype.minimum=function(t,e){return Pl([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.min(t,e)}))},e.prototype.mod=function(t,e){return Pl([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}))},e.prototype.max=function(t,e){Pl(t,"max"),Je("max",e,t.rank);for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,t.dtype),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],f=0;f<i;++f){var d=u[l+f];d>h&&(h=d)}s[c]=h}return a},e.prototype.maximum=function(t,e){return Pl([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.max(t,e)}))},e.prototype.all=function(t,e){Pl(t,"all"),Je("all",e,t.rank);for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,t.dtype),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],f=0;f<i;++f){var d=u[l+f];h=h&&d}s[c]=h}return a},e.prototype.any=function(t,e){Pl(t,"any"),Je("any",e,t.rank);for(var n=Ze(t.shape,e),r=n[0],o=n[1],a=yn(r,t.dtype),i=I(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],f=0;f<i;++f){var d=u[l+f];h=h||d}s[c]=h}return a},e.prototype.squaredDifference=function(t,e){return Pl([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t-e;return n*n}))},e.prototype.ceil=function(t){Pl(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){Pl(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){Pl(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){Pl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){Pl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){Pl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){Pl(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);e[r]-o<.5?n[r]=Math.floor(e[r]):e[r]-o>.5?n[r]=Math.ceil(e[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){Pl(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){Pl(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){Pl(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){Pl(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log1p(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){Pl(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){Pl(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){Pl(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Pl(t,"relu");for(var e=yn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},e.prototype.relu6=function(t){Pl(t,"relu");for(var e=yn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return e},e.prototype.prelu=function(t,e){return Pl([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return t<0?e*t:t}))},e.prototype.elu=function(t){Pl(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){Pl([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){Pl(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),a=0;a<n.length;++a){var i=n[a];e[a]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(e,t.shape,"float32")},e.prototype.clip=function(t,e,n){Pl(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<e?e:i}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r){var o=n[2*r],a=n[2*r+1];e[r]=Math.hypot(o,a)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){Pl(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){Pl(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){Pl(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var u,a=r[o]>-e,i=r[o]<e,s=Math.exp(r[o]);u=i?s:a?r[o]:Math.log(1+s),n[o]=u}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){Pl(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){Pl(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){Pl(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){Pl(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){Pl(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){Pl(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return Pl([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.atan2(t,e)}))},e.prototype.sinh=function(t){Pl(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){Pl(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){Pl(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=D(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){Pl(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){Pl(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){Pl(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){Pl(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);e[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),Pl(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.conv2d(e,n,r);return o&&(s=this.add(s,o)),a&&(s=Bl(this,s,a,i)),s},e.prototype.conv2d=function(t,e,n){Pl([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Wn(n.outShape,t.dtype),h=t.strides[0],f=c?t.strides[1]:t.strides[2],d=c?t.strides[2]:1,p=c?1:t.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],x=this.readSync(t.dataId),b=this.readSync(e.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var C=_*h,E=_*v,T=0;T<n.outHeight;++T)for(var S=E+T*m,k=T*n.strideHeight-u,A=0;A<r;A++){var I=k+A*a;if(!(I<0||I>=n.inHeight))for(var R=A*e.strides[0],O=C+I*f,D=0;D<n.outWidth;++D)for(var M=S+D*g,N=D*n.strideWidth-s,F=0;F<o;F++){var P=N+F*i;if(!(P<0||P>=n.inWidth))for(var B=O+P*d,L=R+F*e.strides[1],W=0;W<n.inChannels;++W){for(var V=x[B+W*p],U=0;U<n.outChannels;++U)w[M+U*y]+=V*b[L+U];L+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,f=Wn(n.outShape,t.dtype),d=this.readSync(t.dataId),p=this.readSync(e.dataId),v=f.values,m=0;m<n.batchSize;++m)for(var g=m*t.strides[0],y=m*f.strides[0],x=0;x<n.outDepth;++x)for(var b=y+x*f.strides[1],w=x*n.strideDepth-c,_=0;_<r;_++){var C=w+_*i;if(!(C<0||C>=n.inDepth))for(var E=_*e.strides[0],T=g+C*t.strides[1],S=0;S<n.outHeight;++S)for(var k=b+S*f.strides[2],A=S*n.strideHeight-h,I=0;I<o;I++){var R=A+I*s;if(!(R<0||R>=n.inHeight))for(var O=E+I*e.strides[1],D=T+R*t.strides[2],M=0;M<n.outWidth;++M)for(var N=k+M*n.outChannels,F=M*n.strideWidth-l,P=0;P<a;P++){var B=F+P*u;if(!(B<0||B>=n.inWidth))for(var L=O+P*e.strides[2],W=D+B*n.inChannels,V=L,U=0;U<n.inChannels;++U){for(var j=d[W+U],z=0;z<n.outChannels;++z)v[N+z]+=j*p[V+z];V+=n.outChannels}}}}return f.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){Pl([t,e],"conv2dDerInput");for(var r=Wn(n.inShape,"float32"),o=r.values,a=this.readSync(t.dataId),i=this.readSync(e.dataId),s=e.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,f=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,x=n.outWidth,b=n.strideHeight,w=n.strideWidth,_=n.dataFormat,C=f-1-n.padInfo.top,E=d-1-n.padInfo.left,T="channelsLast"===_,S=r.strides[0],k=T?r.strides[1]:r.strides[2],A=T?r.strides[2]:1,I=T?1:r.strides[1],R=t.strides[0],O=T?t.strides[1]:t.strides[2],D=T?t.strides[2]:1,M=T?1:t.strides[1],N=0;N<h;++N)for(var F=0;F<p;++F)for(var P=0;P<v;++P)for(var B=P-C,L=Math.max(0,Math.ceil(B/b)),W=Math.min(y,(f+B)/b),V=0;V<m;++V){for(var U=V-E,j=Math.max(0,Math.ceil(U/w)),z=Math.min(x,(d+U)/w),G=0,q=L;q<W;++q)for(var H=q*b-B,X=j;X<z;++X)for(var K=R*N+O*q+D*X,Y=u*(f-1-H)+c*(d-1-(X*w-U))+l*F,$=0;$<g;++$)G+=a[K+M*$]*i[Y+$];o[S*N+k*P+A*V+I*F]=G}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=Wn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(t.dataId),h=t.strides,f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],x=g[1],b=g[2],w=g[3],_=n.batchSize,C=n.filterDepth,E=n.filterHeight,T=n.filterWidth,S=n.inChannels,k=n.inDepth,A=n.inHeight,I=n.inWidth,R=n.outChannels,O=n.outDepth,D=n.outHeight,M=n.outWidth,N=n.strideDepth,F=n.strideHeight,P=n.strideWidth,B=C-1-n.padInfo.front,L=E-1-n.padInfo.top,W=T-1-n.padInfo.left,V=0;V<_;++V)for(var U=0;U<S;++U)for(var j=0;j<k;++j)for(var z=j-B,G=Math.max(0,Math.ceil(z/N)),q=Math.min(O,(C+z)/N),H=0;H<A;++H)for(var X=H-L,K=Math.max(0,Math.ceil(X/F)),Y=Math.min(D,(E+X)/F),$=0;$<I;++$){for(var Z=$-W,Q=Math.max(0,Math.ceil(Z/P)),J=Math.min(M,(T+Z)/P),tt=0,et=G;et<q;++et)for(var nt=et*N-z,rt=K;rt<Y;++rt)for(var ot=rt*F-X,it=Q;it<J;++it)for(var at=f*V+d*et+p*rt+v*it,st=y*(C-1-nt)+x*(E-1-ot)+b*(T-1-(it*P-Z))+w*U,ut=0;ut<R;++ut)tt+=l[at+ut]*m[st+ut];o[i*V+s*j+u*H+c*$+U]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){Pl([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=Wn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(t),f=this.bufferSync(e),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((c-m)/o)),y=Math.min(n.outWidth,(n.inWidth+c-m)/o),x=0;x<n.inChannels;++x)for(var b=0;b<n.outChannels;++b){for(var w=0,_=0;_<n.batchSize;++_)for(var C=p;C<v;++C)for(var E=d+C*r-l,T=g;T<y;++T){var S=m+T*o-c;w+=s?h.get(_,E,S,x)*f.get(_,C,T,b):h.get(_,x,E,S)*f.get(_,b,C,T)}u.set(w,d,m,x,b)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Wn(n.filterShape,"float32"),l=c.values,h=c.strides,f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],x=g[1],b=g[2],w=g[3],_=this.readSync(t.dataId),C=t.strides,E=C[0],T=C[1],S=C[2],k=C[3],A=n.padInfo.front,I=n.padInfo.left,R=n.padInfo.top,O=0;O<i;++O)for(var D=Math.max(0,Math.ceil((A-O)/r)),M=Math.min(n.outDepth,(n.inDepth+A-O)/r),N=O*f,F=0;F<s;++F)for(var P=Math.max(0,Math.ceil((R-F)/o)),B=Math.min(n.outHeight,(n.inHeight+R-F)/o),L=F*d+N,W=0;W<u;++W)for(var V=Math.max(0,Math.ceil((I-W)/a)),U=Math.min(n.outWidth,(n.inWidth+I-W)/a),j=W*p+L,z=0;z<n.inChannels;++z)for(var G=z*v+j,q=0;q<n.outChannels;++q){for(var H=0,X=0;X<n.batchSize;++X)for(var K=X*E,Y=X*y,$=D;$<M;++$)for(var Z=(O+$*r-A)*T+K,Q=$*x+Y,J=P;J<B;++J)for(var tt=(F+J*o-R)*S+Z,et=J*b+Q,nt=V;nt<U;++nt){var rt=nt*w+et;H+=_[(W+nt*a-I)*k+tt+z]*m[rt+q]}l[G+q]=H}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.depthwiseConv2D(e,n,r);return o&&(s=this.add(s,o)),a&&(s=Bl(this,s,a,i)),s},e.prototype.depthwiseConv2D=function(t,e,n){Pl([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Wn(n.outShape,t.dtype),h=this.readSync(t.dataId),f=this.readSync(e.dataId),d=l.values,p=0;p<n.batchSize;++p)for(var v=p*t.strides[0],m=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],x=g*n.strideHeight-s,b=0;b<r;++b){var w=x+b*a;if(!(w<0||w>=n.inHeight))for(var _=b*e.strides[0],C=v+w*t.strides[1],E=0;E<n.outWidth;++E)for(var T=y+E*l.strides[2],S=E*n.strideWidth-u,k=0;k<o;++k){var A=S+k*i;if(!(A<0||A>=n.inWidth))for(var I=_+k*e.strides[1],R=C+A*n.inChannels,O=T,D=I,M=0;M<n.inChannels;++M){for(var N=h[R+M],F=0;F<c;++F)d[O+F]+=N*f[D+F];O+=c,D+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){Pl([t,e],"depthwiseConv2DDerInput");for(var r=Wn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=this.readSync(t.dataId),l=t.strides,h=l[0],f=l[1],d=l[2],p=this.readSync(e.dataId),v=e.strides,m=v[0],g=v[1],y=v[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,_=n.inChannels,C=n.inHeight,E=n.inWidth,T=n.outChannels,S=n.outHeight,k=n.outWidth,A=n.strideHeight,I=n.strideWidth,R=b-1-n.padInfo.top,O=w-1-n.padInfo.left,D=T/_,M=0;M<x;++M)for(var N=0;N<_;++N)for(var F=0;F<C;++F)for(var P=F-R,B=Math.max(0,Math.ceil(P/A)),L=Math.min(S,(b+P)/A),W=0;W<E;++W){for(var V=W-O,U=Math.max(0,Math.ceil(V/I)),j=Math.min(k,(w+V)/I),z=0,G=B;G<L;++G)for(var q=G*A-P,H=U;H<j;++H)for(var X=h*M+f*G+d*H,K=m*(b-1-q)+g*(w-1-(H*I-V))+y*N,Y=0;Y<D;++Y)z+=c[X+(N*D+Y)]*p[K+Y];o[i*M+s*F+u*W+N]=z}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){Pl([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Wn(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(t),f=this.bufferSync(e),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),x=0;x<n.outChannels;++x){for(var b=Math.trunc(x/l),w=x%l,_=0,C=0;C<n.batchSize;++C)for(var E=p;E<v;++E)for(var T=d+E*r-c,S=g;S<y;++S){var k=m+S*o-u;_+=h.get(C,T,k,b)*f.get(C,E,S,x)}s.set(_,d,m,b,w)}return s.toTensor()},e.prototype.tile=function(t,e){return Pl(t,"tile"),vo(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){Pl(t,"pad");var r=e.map((function(e,n){return e[0]+t.shape[n]+e[1]})),o=e.map((function(t){return t[0]})),a=this.bufferSync(t),i=Wn(r,t.dtype);0!==n&&i.values.fill(n);for(var s=0;s<t.size;s++){var u=a.indexToLoc(s),c=u.map((function(t,e){return t+o[e]}));i.set.apply(i,[a.get.apply(a,u)].concat(c))}return i.toTensor()},e.prototype.transpose=function(t,e){Pl(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=this.readSync(t.dataId),a=Wn(n,t.dtype),i=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];var l=a.locToIndex(u);a.values[l]=o[r]}return a.toTensor()},e.prototype.gather=function(t,e,n){Pl([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var a=Wn(r,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=i.locToIndex(c);a.values[s]=i.values[l]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){Pl([t],"batchToSpaceND");var r=e.reduce((function(t,e){return t*e})),o=fr(t.shape,e,r),a=dr(o.length,e.length),i=vr(t.shape,e,r),s=mr(n,e.length),u=gr(i,n,e.length);return t.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){Pl([t],"spaceToBatchND");var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=fr(i.shape,e,r,!1),u=dr(s.length,e.length,!1),c=vr(i.shape,e,r,!1);return i.reshape(s).transpose(u).reshape(c)},e.prototype.pool=function(t,e,n){Pl(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=this.readSync(t.dataId),d=Wn(e.outShape,t.dtype),p=d.values,v=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var x=y*v,b=y*t.strides[0],w=0;w<e.inChannels;++w)for(var _=0;_<e.outHeight;++_)for(var C=_*r-c,E=Math.max(0,C),T=Math.min(e.inHeight,s+C),S=x+_*m,k=0;k<e.outWidth;++k){for(var A=k*o-l,I=Math.max(0,A),R=Math.min(e.inWidth,u+A),O=h,D=0,M=0,N=E;N<T;N+=a){for(var F=b+N*t.strides[1],P=I;P<R;P+=i){var B=f[F+P*t.strides[2]+w];"max"===n&&B>O?O=B:"avg"===n&&(D+=B,M++)}if(isNaN(O))break}p[S+k*g+w]="avg"===n?D/M:O}return d.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var n=Wn(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h=this.bufferSync(t),f=0;f<e.batchSize;++f)for(var d=0;d<e.inChannels;++d)for(var p=0;p<e.outHeight;++p){for(var v=p*r-c,m=v;m<0;)m+=a;for(var g=Math.min(e.inHeight,s+v),y=0;y<e.outWidth;++y){for(var x=y*o-l,b=x;b<0;)b+=i;for(var w=Math.min(e.inWidth,u+x),_=Number.NEGATIVE_INFINITY,C=-1,E=m;E<g;E+=a)for(var T=E-v,S=b;S<w;S+=i){var k=S-x,A=h.get(f,E,S,d);A>_&&(_=A,C=T*u+k)}n.set(C,f,p,y,d)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){Pl([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,f=c-1-r.padInfo.top,d=Wn(e.shape,"float32"),p=this.bufferSync(o),v=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var x=0;x<r.inWidth;++x){for(var b=y-f,w=x-h,_=0,C=0;C<c;C+=s){var E=(b+C)/a;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var T=0;T<l;T+=u){var S=(w+T)/i;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var k=c*l-1-p.get(m,E,S,g)===C*l+T?1:0;0!==k&&(_+=v.get(m,E,S,g)*k)}}}d.set(_,m,y,x,g)}return d.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){Pl([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,f=c-1-n.padInfo.top,d=Wn(e.shape,"float32"),p=1/(a*i),v=this.bufferSync(t),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var x=0;x<n.inWidth;++x){for(var b=y-f,w=x-h,_=0,C=0;C<c;C+=s){var E=(b+C)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var T=0;T<l;T+=u){var S=(w+T)/o;S<0||S>=n.outWidth||Math.floor(S)!==S||(_+=v.get(m,E,S,g))}}d.set(_*p,m,y,x,g)}return d.toTensor()},e.prototype.pool3d=function(t,e,n){Pl(t,"pool3d");for(var r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),g=Wn(e.outShape,t.dtype),y=g.values,x=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],b=e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[3]*e.outShape[4],_=e.outShape[4],C=0;C<e.batchSize;++C)for(var E=C*x,T=C*t.strides[0],S=0;S<e.inChannels;++S)for(var k=0;k<e.outDepth;++k){for(var A=k*r-f,I=A;I<0;)I+=i;for(var R=Math.min(e.inDepth,c+A),O=E+k*b,D=0;D<e.outHeight;++D){for(var M=D*o-d,N=M;N<0;)N+=s;for(var F=Math.min(e.inHeight,l+M),P=O+D*w,B=0;B<e.outWidth;++B){for(var L=B*a-p,W=L;W<0;)W+=u;for(var V=Math.min(e.inWidth,h+L),U=P+B*_,j=v,z=0,G=0,q=I;q<R;q+=i){for(var H=T+q*t.strides[1],X=N;X<F;X+=s){for(var K=H+X*t.strides[2],Y=W;Y<V;Y+=u){var $=m[K+Y*t.strides[3]+S];if("max"===n&&$>j?j=$:"avg"===n&&(z+=$,G++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}y[U+S]="avg"===n?z/G:j}}}return g.toTensor()},e.prototype.avgPool3d=function(t,e){return Pl(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){Pl([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=f-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Wn(e.shape,"float32"),x=1/(i*s*u),b=this.bufferSync(t),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var C=0;C<n.inDepth;++C)for(var E=0;E<n.inHeight;++E)for(var T=0;T<n.inWidth;++T){for(var S=C-v,k=E-g,A=T-m,I=0,R=0;R<f;R+=c){var O=(S+R)/r;if(!(O<0||O>=n.outDepth||Math.floor(O)!==O))for(var D=0;D<d;D+=l){var M=(k+D)/o;if(!(M<0||M>=n.outHeight||Math.floor(M)!==M))for(var N=0;N<p;N+=h){var F=(A+N)/a;F<0||F>=n.outWidth||Math.floor(F)!==F||(I+=b.get(w,O,M,F,_))}}}y.set(I*x,w,C,E,T,_)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return Pl(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=Wn(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v=this.bufferSync(t),m=0;m<e.batchSize;++m)for(var g=0;g<e.inChannels;++g)for(var y=0;y<e.outDepth;++y){for(var x=y*r-f,b=x;b<0;)b+=i;for(var w=Math.min(e.inDepth,c+x),_=0;_<e.outHeight;++_){for(var C=_*o-d,E=C;E<0;)E+=s;for(var T=Math.min(e.inHeight,l+C),S=0;S<e.outWidth;++S){for(var k=S*a-p,A=k;A<0;)A+=u;for(var I=Math.min(e.inWidth,h+k),R=Number.NEGATIVE_INFINITY,O=-1,D=b;D<w;D+=i)for(var M=D-x,N=E;N<T;N+=s)for(var F=N-C,P=A;P<I;P+=u){var B=P-k,L=v.get(m,D,N,P,g);L>=R&&(R=L,O=M*l*h+F*l+B)}n.set(O,m,y,_,S,g)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){Pl([e,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=h-1-r.padInfo.front,v=d-1-r.padInfo.left,m=f-1-r.padInfo.top,g=Wn(e.shape,"float32"),y=this.bufferSync(o),x=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var C=0;C<r.inHeight;++C)for(var E=0;E<r.inWidth;++E){for(var T=_-p,S=C-m,k=E-v,A=0,I=0;I<h;I+=u){var R=(T+I)/a;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var O=0;O<f;O+=c){var D=(S+O)/i;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var M=0;M<d;M+=l){var N=(k+M)/s;if(!(N<0||N>=r.outWidth||Math.floor(N)!==N)){var F=h*f*d-1-y.get(b,R,D,N,w)===I*f*d+O*d+M?1:0;0!==F&&(A+=x.get(b,R,D,N,w)*F)}}}}g.set(A,b,_,C,E,w)}return g.toTensor()},e.prototype.cast=function(t,e){return Qr(t,e,this)},e.prototype.reshape=function(t,e){return Jr(t,e)},e.prototype.avgPool=function(t,e){return Pl(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){Pl(t,"resizeBilinear");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(I([a,e,n,u])),h=[r&&e>1?i-1:i,r&&n>1?s-1:s],f=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=0,p=h[0]/f[0],v=h[1]/f[1],m=0;m<a;m++)for(var g=0;g<e;g++)for(var y=p*g,x=Math.floor(y),b=y-x,w=Math.min(i-1,Math.ceil(y)),_=m*t.strides[0]+x*t.strides[1],C=m*t.strides[0]+w*t.strides[1],E=0;E<n;E++)for(var T=v*E,S=Math.floor(T),k=T-S,A=Math.min(s-1,Math.ceil(T)),R=_+S*t.strides[2],O=C+S*t.strides[2],D=_+A*t.strides[2],M=C+A*t.strides[2],N=0;N<u;N++){var F=c[R+N],P=c[O+N],B=F+(c[D+N]-F)*k,L=B+(P+(c[M+N]-P)*k-B)*b;l[d++]=L}return ln(l,[a,e,n,u])},e.prototype.resizeBilinearBackprop=function(t,e,n){Pl([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*a*i*s),f=[n&&c>1?a-1:a,n&&l>1?i-1:i],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=f[0]/d[0],v=f[1]/d[1],m=this.readSync(t.dataId),g=0,y=0;y<o;y++)for(var x=y*e.strides[0],b=0;b<c;b++)for(var w=b*p,_=Math.floor(w),C=Math.min(Math.ceil(w),a-1),E=x+_*e.strides[1],T=x+C*e.strides[1],S=w-_,k=1-S,A=0;A<l;A++)for(var I=A*v,R=Math.floor(I),O=Math.min(Math.ceil(I),i-1),D=I-R,M=1-D,N=E+R*e.strides[2],F=E+O*e.strides[2],P=T+R*e.strides[2],B=T+O*e.strides[2],L=k*M,W=k*D,V=S*M,U=S*D,j=0;j<s;j++){var z=m[g++];h[N+j]+=z*L,h[F+j]+=z*W,h[P+j]+=z*V,h[B+j]+=z*U}return mn(h,[o,i,a,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){Pl(t,"resizeNearestNeighbor");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(a*e*n*u),h=[r&&e>1?i-1:i,r&&n>1?s-1:s],f=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=h[0]/f[0],p=h[1]/f[1],v=0,m=0;m<a;m++)for(var g=m*t.strides[0],y=0;y<e;y++)for(var x=d*y,b=g+Math.min(i-1,r?Math.round(x):Math.floor(x))*t.strides[1],w=0;w<n;w++)for(var _=p*w,C=b+Math.min(s-1,r?Math.round(_):Math.floor(_))*t.strides[2],E=0;E<u;E++){var T=c[C+E];l[v++]=T}return ln(l,[a,e,n,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){Pl([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*a*i*s),f=this.readSync(t.dataId),d=[n&&c>1?a-1:a,n&&l>1?i-1:i],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,w=0;w<o;w++)for(var _=w*e.strides[0],C=0;C<a;C++)for(var E=_+C*e.strides[1],T=Math.floor(C*g),S=Math.floor(T-x/2),k=0;k<i;k++)for(var A=E+k*e.strides[2],I=Math.floor(k*y),R=Math.floor(I-b/2),O=0;O<s;O++){for(var D=0,M=0;M<x;M++){var N=M+S;if(!(N<0||N>=c)){var F=_+N*t.strides[1],P=N*v;if(C===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var B=0;B<b;B++){var L=B+R;if(!(L<0||L>=l)){var W=F+L*t.strides[2],V=L*m;k===Math.min(i-1,n?Math.round(V):Math.floor(V))&&(D+=f[W+O])}}}}h[A+O]=D}return mn(h,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,a){Pl([t,e,n,o,a],"batchNorm");for(var i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(i.length),f=l.length,d=c.length,p=u.length,v=s.length,m=0,g=0,y=0,x=0,b=0;b<i.length;++b)h[b]=l[m++]+(i[b]-s[g++])*c[y++]/Math.sqrt(u[x++]+r),m>=f&&(m=0),g>=v&&(g=0),y>=d&&(y=0),x>=p&&(x=0);return mn(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){Pl(t,"localResponseNormalization4D");var a=t.shape[3],i=a-1,s=this.readSync(t.dataId),u=t.size,c=new Float32Array(u);function l(t){for(var n=t%a,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,i),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var f=l(h),d=s[h]*Math.pow(n+r*f,-o);c[h]=d}return mn(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,o,a,i){Pl(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),h=new Float32Array(t.size),f=t.size,d=0;d<f;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=a*g+o,y=v;y<m;y++){var x=-2*a*i*c[y]*l[d]/g;d===y&&(x+=Math.pow(g,-i)),x*=u[d],h[y]+=x}}return mn(h,t.shape)},e.prototype.multinomial=function(t,e,n,r){Pl(t,"multinomial");for(var o=e?t:Dr(t),a=o.shape[0],i=o.shape[1],s=yn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<a;++l){var h=l*i,f=new Float32Array(i-1);f[0]=c[h];for(var d=1;d<f.length;++d)f[d]=f[d-1]+c[h+d];for(var p=Pn(r.toString()),v=l*n,m=0;m<n;++m){var g=p();u[v+m]=f.length;for(var y=0;y<f.length;y++)if(g<f[y]){u[v+m]=y;break}}}return s},e.prototype.oneHot=function(t,e,n,r){Pl(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var a=this.readSync(t.dataId),i=0;i<t.size;++i)a[i]>=0&&a[i]<e&&(o[i*e+a[i]]=n);return dn(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return Pl(t,"nonMaxSuppression"),so(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=Wn(t.shape,"float32"),a=Wn(t.shape,"float32"),i=un(t).as2D(n,r),s=cn(t).as2D(n,r),u=0;u<n;u++)for(var c=i.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=sn(c,l),f=this.readSync(this.fftImpl(h,e).dataId),d=0;d<r;d++){var p=no(f,d);o.values[u*r+d]=p.real,a.values[u*r+d]=p.imag}return sn(o.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=sn(un(o).div(pn(r)),cn(o).div(pn(r)))),o}var a=this.readSync(t.dataId),i=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(a,r,e));return sn(i.real,i.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,a=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),i=sn(a.real,a.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=sn(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var a=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(e,n),l=sn(c.real,c.imag).mul(u),h=i.add(l),f=i.sub(l),d=un(h).concat(un(f)),p=cn(h).concat(cn(f));return sn(d,p).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var a=0,i=0,s=0;s<e;s++){var u=oo(o*s,e,n),c=no(t,s);a+=c.real*u.real-c.imag*u.imag,i+=c.real*u.imag+c.imag*u.real}n&&(a/=e,i/=e),ro(r,a,i,o)}return r},e.prototype.depthToSpace=function(t,e,n){T("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),T(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));for(var r=t.shape[0],o=t.shape[1],a=t.shape[2],i=t.shape[3],s=o*e,u=a*e,c=i/(e*e),l=this.readSync(t.dataId),h=new Float32Array(r*s*u*c),f=0,d=0;d<r;++d)for(var p=0;p<s;++p)for(var v=Math.floor(p/e),m=p%e,g=0;g<u;++g)for(var y=Math.floor(g/e),x=(m*e+g%e)*c,b=0;b<c;++b){var w=b+x+i*(y+a*(v+o*d));h[f++]=l[w]}return mn(h,[r,s,u,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=Wr(t.shape,e.shape),a=Wn(o,n),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=Br(t.shape,o),c=Br(e.shape,o),l=a.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(i[h%i.length],s[h%s.length]);else{var f=this.bufferSync(t),d=this.bufferSync(e),p=function(n){var o=a.indexToLoc(n),h=o.slice(-t.rank);u.forEach((function(t){return h[t]=0}));var p=f.locToIndex(h),v=o.slice(-e.rank);c.forEach((function(t){return v[t]=0}));var m=d.locToIndex(v);l[n]=r(i[p],s[m])};for(h=0;h<l.length;++h)p(h)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Wr(t.shape,e.shape),o=Wn(r,"float32"),a=Wn(r,"float32"),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=Br(t.shape,r),c=Br(e.shape,r),l=o.values,h=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;f++){var d=f%i.length,p=f%s.length,v=n(i[2*d],i[2*d+1],s[2*p],s[2*p+1]);l[f]=v.real,h[f]=v.imag}else{var m=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),f=a.slice(-t.rank);u.forEach((function(t){return f[t]=0}));var d=m.locToIndex(f),p=a.slice(-e.rank);c.forEach((function(t){return p[t]=0}));var v=g.locToIndex(p),y=n(i[2*d],i[2*d+1],s[2*v],s[2*v+1]);l[r]=y.real,h[r]=y.imag};for(f=0;f<l.length;f++)y(f)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(t,e,n){return fo(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,o,a){for(var i=t.shape,s=i[0],u=i[1],c=i[2],l=i[3],h=e.shape[0],f=r[0],d=r[1],p=Wn([h,f,d,l],"float32"),v=this.readSync(e.dataId),m=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,x=p.strides,b=0;b<h;b++){var w=4*b,_=v[w],C=v[w+1],E=v[w+2],T=v[w+3],S=m[b];if(!(S>=s))for(var k=f>1?(E-_)*(u-1)/(f-1):0,A=d>1?(T-C)*(c-1)/(d-1):0,I=0;I<f;I++){var R=f>1?_*(u-1)+I*k:.5*(_+E)*(u-1);if(R<0||R>u-1)for(var O=0;O<d;O++)for(var D=0;D<l;D++){var M=D+O*x[2]+I*x[1]+b*x[0];p.values[M]=a}else if("bilinear"===o){var N=Math.floor(R),F=Math.ceil(R),P=R-N;for(O=0;O<d;O++)if((q=d>1?C*(c-1)+O*A:.5*(C+T)*(c-1))<0||q>c-1)for(D=0;D<l;D++)M=D+O*x[2]+I*x[1]+b*x[0],p.values[M]=a;else{var B=Math.floor(q),L=Math.ceil(q),W=q-B;for(D=0;D<l;D++){var V=g[M=D+B*y[2]+N*y[1]+S*y[0]],U=g[M=D+L*y[2]+N*y[1]+S*y[0]],j=g[M=D+B*y[2]+F*y[1]+S*y[0]],z=V+(U-V)*W,G=j+(g[M=D+L*y[2]+F*y[1]+S*y[0]]-j)*W;M=D+O*x[2]+I*x[1]+b*x[0],p.values[M]=z+(G-z)*P}}}else for(O=0;O<d;++O){var q;if((q=d>1?C*(c-1)+O*A:.5*(C+T)*(c-1))<0||q>c-1)for(D=0;D<l;D++)M=D+O*x[2]+I*x[1]+b*x[0],p.values[M]=a;else{var H=Math.round(q),X=Math.round(R);for(D=0;D<l;D++){var K=D+H*y[2]+X*y[1]+S*y[0],Y=D+O*x[2]+I*x[1]+b*x[0];p.values[Y]=g[K]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var o=Cr(0,t,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize;return this.scatter(t,e,n,c,s,i,a,u,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=yr(t,e),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return ln([],a,t.dtype);for(var c=new mt([i,s],t.dtype),l=this.readSync(e.dataId),h=this.readSync(t.dataId),f=0;f<i;f++){for(var d=[],p=0,v=0;v<r;v++){var m=l[f*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=t.size/s)throw new Error("Invalid indices: "+d+" does not index into "+t.shape);for(var g=0;g<s;g++)c.values[f*s+g]=h[p*s+g]}return c.toTensor().reshape(a)},e.prototype.scatterND=function(t,e,n){var r=Cr(0,t,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=pn(0);return this.scatter(t,e,n,u,i,a,o,s,c,!0)},e.prototype.fill=function(t,e,n){var r=V(n=n||$(e),I(t));return r.fill(e),Pt.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=V(t.dtype,I(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return to(t,e,n)},e.prototype.scatter=function(t,e,n,r,o,a,i,s,u,c){var l=[r/o,o],h=this.readSync(t.dataId),f=this.readSync(e.dataId);if(0===r)return ln([],n,e.dtype);var d=new mt(l,e.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var v=[],m=0,g=0;g<i;g++){var y=h[p*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var x=0;x<o;x++)c?d.values[m*o+x]+=f[p*o+x]:d.values[m*o+x]=0===e.rank?f[0]:f[p*o+x]}return d.toTensor().reshape(n)},e}(Fr);Pt.registerBackend("cpu",(function(){return new Ll}),1);for(var Wl=0,Vl=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,f=n;Pl(a,"NonMaxSuppressionWithScore");var d=uo(f.data.get(a.dataId).values,f.data.get(i.dataId).values,u,c,l,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n;Pl(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Qa,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,o=r.a,a=r.b,i=n;Pl([o,a],Qa);var s=i.data.get(o.dataId).values,u=i.data.get(a.dataId).values,c=function(t,e,n,r,o,a){var i=Wr(t,e),s=i.length,u=J(i),c=W(o,I(i)),l=t.length,h=e.length,f=J(t),d=J(e),p=Br(t,i),v=Br(e,i);if(p.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=a(n[m%n.length],r[m%r.length]);else{var g=function(t){var e=ct(t,s,u),o=e.slice(-l);p.forEach((function(t){return o[t]=0}));var i=ut(o,l,f),m=e.slice(-h);v.forEach((function(t){return m[t]=0}));var g=ut(m,h,d);c[t]=a(n[i],r[g])};for(m=0;m<c.length;++m)g(m)}return[c,i]}(o.shape,a.shape,s,u,o.dtype,(function(t,e){var n=t-e;return n*n})),l=c[0],h=c[1];return{dataId:i.write(l,h,o.dtype),shape:h,dtype:o.dtype}}}];Wl<Vl.length;Wl++)w(Vl[Wl]);for(var Ul,jl=function(t){this.variableNames=["A"];var e=Co(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},zl=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Co(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},ql=0,Gl=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e.pixels,a=r.numChannels,s="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,c=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=c[0],h=c[1],f=[h,l],d=[h,l,a];(u||s)&&(null==Ul&&(Ul=document.createElement("canvas").getContext("2d")),Ul.canvas.width=l,Ul.canvas.height=h,Ul.drawImage(o,0,0,l,h),o=Ul.canvas);var p=n.makeTensorInfo(f,"int32");n.texData.get(p.dataId).usage=Vt.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);var v=i().getBool("WEBGL_PACK")?new zl(d):new jl(d),m=n.runWebGLProgram(v,[p],"int32");return n.disposeData(p.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;qe("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,f=n,d=uo(f.readSync(a.dataId),f.readSync(i.dataId),u,c,l,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n,a=new Oa(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Qa,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,o=r.a,a=r.b,s=n,u=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yo("return (a - b) * (a - b);",o.shape,a.shape):new Xo("return (a - b) * (a - b);",o.shape,a.shape);return s.compileAndRun(u,[o,a])}}];ql<Gl.length;ql++)w(Gl[ql]);for(var Hl=0,Xl=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Qa,gradFunc:function(t,e){var n=e[0],r=e[1],o=pn(2);return{a:function(){return du(t,du(o,bu(n,r)))},b:function(){return du(t,du(o,bu(r,n)))}}}}];Hl<Xl.length;Hl++)p(Xl[Hl]);var Kl=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();i().get("IS_BROWSER")&&i().setPlatform("browser",new Kl);var Yl,$l=function(){function t(){this.util=n(224),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=i().global.fetch?i().global.fetch(t,e):(null==Yl&&(Yl=n(223)),Yl(t,e))},t.prototype.now=function(){var t=r.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();i().get("IS_NODE")&&i().setPlatform("node",new $l);var Zl={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Ql(t,e){for(var n={},r=0,o=function(e){var o=e.name,a=e.dtype,i=e.shape,s=I(i),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Zl[c.dtype],h=t.slice(r,r+s*l),f="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===a)u=Float32Array.from(f,(function(t){return t*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(f,(function(t){return Math.round(t*c.scale+c.min)}))}r+=s*l}else if("string"===a){var d=I(e.shape);u=[];for(var p=0;p<d;p++){var v=new Uint32Array(t.slice(r,r+4))[0];r+=4;var m=new Uint8Array(t.slice(r,r+v));u.push(m),r+=v}}else{var g=Zl[a];if(h=t.slice(r,r+s*g),"float32"===a)u=new Float32Array(h);else if("int32"===a)u=new Int32Array(h);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(h)}r+=s*g}n[o]=ln(u,i,a)},a=0,i=e;a<i.length;a++)o(i[a]);return n}function Jl(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach((function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)}));var r=new Uint8Array(e),o=0;return n.forEach((function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength})),r.buffer}var eh=void 0!==o&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function nh(t){return eh?o.byteLength(t):new Blob([t]).size}function rh(t){var e=0;t.forEach((function(t){e+=t.byteLength}));var n=new Uint8Array(e),r=0;return t.forEach((function(t){n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function oh(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function ih(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:nh(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:nh(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var ah=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach((function(t){var n=t(e,r);null!==n&&o.push(n)})),o},t}(),sh="://",uh=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){T(null!=e,(function(){return"scheme must not be undefined or null."})),e.endsWith(sh)&&(e=e.slice(0,e.indexOf(sh))),T(e.length>0,(function(){return"scheme must not be an empty string."}));var r=t.getInstance();T(null==r.managers[e],(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function ch(t){if(-1===t.indexOf(sh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+uh.getSchemes().join(","));return{scheme:t.split(sh)[0],path:t.split(sh)[1]}}function lh(t,e,n){return void 0===n&&(n=!1),f(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:return T(t!==e,(function(){return"Old path and new path are the same: '"+t+"'"})),T((r=ah.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+t+"."})),T(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."})),a=r[0],T((i=ah.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),T(i.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),s=i[0],u=ch(t).scheme,o=ch(t).path,c=u===ch(t).scheme,[4,a.load()];case 1:return l=f.sent(),n&&c?[4,uh.getManager(u).removeModel(o)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,s.save(l)];case 4:return h=f.sent(),!n||c?[3,6]:[4,uh.getManager(u).removeModel(o)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var hh="models_store",ph="model_info_store";function fh(){if(!i().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function dh(t){var e=t.result;e.createObjectStore(hh,{keyPath:"modelPath"}),e.createObjectStore(ph,{keyPath:"modelPath"})}var vh=function(){function t(t){if(this.indexedDB=fh(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]}))}))},t.prototype.load=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this.databaseAction(this.modelPath)]}))}))},t.prototype.databaseAction=function(t,e){var n=this;return new Promise((function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return dh(o)},o.onsuccess=function(){var a=o.result;if(null==e){var i=a.transaction(hh,"readonly"),s=i.objectStore(hh).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,c=ih(e),l=a.transaction(ph,"readwrite"),h=l.objectStore(ph),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var o=(u=a.transaction(hh,"readwrite")).objectStore(hh).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});o.onsuccess=function(){return t({modelArtifactsInfo:c})},o.onerror=function(t){var e=(h=l.objectStore(ph)).delete(n.modelPath);e.onsuccess=function(){return a.close(),r(o.error)},e.onerror=function(t){return a.close(),r(o.error)}}},f.onerror=function(t){return a.close(),r(f.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(t){return r(o.error)}}))},t.URL_SCHEME="indexeddb://",t}(),mh=function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(vh.URL_SCHEME)?(e=t.slice(vh.URL_SCHEME.length),new vh(e)):null;var e};ah.registerSaveRouter(mh),ah.registerLoadRouter(mh);var gh=function(){function t(){this.indexedDB=fh()}return t.prototype.listModels=function(){return f(this,void 0,void 0,(function(){var t=this;return d(this,(function(e){return[2,new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return dh(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(ph,"readonly"),a=o.objectStore(ph).getAll();a.onsuccess=function(){for(var t={},n=0,r=a.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},a.onerror=function(e){return t.close(),n(a.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}}))]}))}))},t.prototype.removeModel=function(t){return f(this,void 0,void 0,(function(){var e=this;return d(this,(function(n){var r;return t=(r=t).startsWith(vh.URL_SCHEME)?r.slice(vh.URL_SCHEME.length):r,[2,new Promise((function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return dh(o)},o.onsuccess=function(){var e,a=o.result,i=a.transaction(ph,"readwrite"),s=i.objectStore(ph),u=s.get(t);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),i=function(){var o=(e=a.transaction(hh,"readwrite")).objectStore(hh).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=i,o.onerror=function(t){return i(),a.close(),r(u.error)}},u.onerror=function(t){return a.close(),r(u.error)},i.oncomplete=function(){null==e?a.close():e.oncomplete=function(){return a.close()}}},o.onerror=function(t){return r(o.error)}}))]}))}))},t}();if(i().getBool("IS_BROWSER"))try{uh.registerManager(vh.URL_SCHEME,new gh)}catch(l){}var yh="/",bh="tensorflowjs_models",xh="info",wh="model_topology",_h="weight_specs",Ch="weight_data",Eh="model_metadata";function Th(t){return{info:[bh,t,xh].join(yh),topology:[bh,t,wh].join(yh),weightSpecs:[bh,t,_h].join(yh),weightData:[bh,t,Ch].join(yh),modelMetadata:[bh,t,Eh].join(yh)}}function Sh(t){var e=t.split(yh);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(yh)}var kh=function(){function t(t){if(!i().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Th(this.modelPath)}return t.prototype.save=function(t){return f(this,void 0,void 0,(function(){var e,n,r;return d(this,(function(c){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=ih(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(eh)return o.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,c=e.length;r<c;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},t.prototype.load=function(){return f(this,void 0,void 0,(function(){var t,e,n,r,a,i,s;return d(this,(function(c){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(eh){var e=o.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),c=0;c<n.length;++c)r.set([n.charCodeAt(c)],c);return r.buffer}(s),[2,e]}))}))},t.URL_SCHEME="localstorage://",t}(),Ah=function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(kh.URL_SCHEME)?(e=t.slice(kh.URL_SCHEME.length),new kh(e)):null;var e};ah.registerSaveRouter(Ah),ah.registerLoadRouter(Ah);var Ih=function(){function t(){T(i().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),T("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return t.prototype.listModels=function(){return f(this,void 0,void 0,(function(){var t,e,n,r,a,i;return d(this,(function(o){for(t={},e=bh+yh,n=yh+xh,r=0;r<this.LS.length;++r)(a=this.LS.key(r)).startsWith(e)&&a.endsWith(n)&&(i=Sh(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]}))}))},t.prototype.removeModel=function(t){return f(this,void 0,void 0,(function(){var e,n;return d(this,(function(r){var o;if(t=(o=t).startsWith(kh.URL_SCHEME)?o.slice(kh.URL_SCHEME.length):o,e=Th(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]}))}))},t}();if(i().getBool("IS_BROWSER"))try{uh.registerManager(kh.URL_SCHEME,new Ih)}catch(l){}function Rh(t){return new Promise((function(t){return setTimeout(t)})).then(t)}var Oh=function(){function t(e){if(!i().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return f(this,void 0,void 0,(function(){var e,n,r,a,i,s;return d(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,Rh((function(){return i.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==t.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,Rh((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:ih(t)}]}}))}))},t.URL_SCHEME="downloads://",t}(),Dh=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return f(this,void 0,void 0,(function(){var t,e,n=this;return d(this,(function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise((function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var l=[],h=[],f=[];u.forEach((function(t){t.paths.forEach((function(t){h.push(t),f.push(null)})),l.push.apply(l,t.weights)})),u.forEach((function(t){t.paths.forEach((function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=h.indexOf(t);f[o]=n,-1===f.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:rh(f),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])}))}))}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},a.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(t)}))]}))}))},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map((function(t){return oh(t.name)})),o={},a=0,i=t;a<i.length;a++)i[a].paths.forEach((function(t){var a=oh(t);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[t]=e[r.indexOf(a)]}));if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function Mh(t,e,n,r){!function(t){T(null!=t&&Array.isArray(t)&&t.length>0,(function(){return"promises must be a none empty array"}))}(t),function(t,e){T(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t})),T(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e})),T(e>=t,(function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e}))}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map((function(a){return a.then((function(a){var i=n+ ++o/t.length*(r-n);return e(i),a})),a})))}function Nh(t,e){return f(this,void 0,void 0,(function(){var n,r,a,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?i().platform.fetch:e.fetchFunc,r=t.map((function(t){return n(t,e.requestInit,{isBinary:!0})})),a=0,s=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return u=f.sent(),[3,4];case 2:return[4,Mh(r,e.onProgress,a,s)];case 3:u=f.sent(),f.label=4;case 4:return o=u.map((function(t){return t.arrayBuffer()})),c=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(o)];case 5:return h=f.sent(),[3,8];case 6:return[4,Mh(o,e.onProgress,c,l)];case 7:h=f.sent(),f.label=8;case 8:return[2,h]}}))}))}function Fh(t){var e=this;return function(n,a,i){return void 0===a&&(a=""),f(e,void 0,void 0,(function(){var e,r,s,u,o,c,l,h,f,p;return d(this,(function(d){switch(d.label){case 0:if(e=n.map((function(){return!1})),r={},s=null!=i?i.map((function(){return!1})):[],u=[],n.forEach((function(t,n){var o=0;t.weights.forEach((function(t){var a="quantization"in t?t.quantization.dtype:t.dtype,c=Zl[a]*I(t.shape),l=function(){e[n]=!0,null==r[n]&&(r[n]=[]),r[n].push({manifestEntry:t,groupOffset:o,sizeBytes:c})};null!=i?i.forEach((function(e,n){e===t.name&&(l(),s[n]=!0)})):l(),u.push(t.name),o+=c}))})),!s.every((function(t){return t})))throw o=i.filter((function(t,e){return!s[e]})),new Error("Could not find weights in manifest with names: "+o.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return c=e.reduce((function(t,e,n){return e&&t.push(n),t}),[]),l=[],c.forEach((function(t){n[t].paths.forEach((function(t){var e=a+(a.endsWith("/")?"":"/")+t;l.push(e)}))})),[4,t(l)];case 1:return h=d.sent(),f={},p=0,c.forEach((function(t){for(var e=n[t].paths.length,o=0,a=0;a<e;a++)o+=h[p+a].byteLength;for(var i=new ArrayBuffer(o),s=new Uint8Array(i),u=0,c=0;c<e;c++){var l=new Uint8Array(h[p+c]);s.set(l,u),u+=l.byteLength}r[t].forEach((function(t){var e=Ql(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)f[n]=e[n]})),p+=e})),[2,f]}}))}))}}ah.registerSaveRouter((function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Oh.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new Oh(t)}(t.slice(Oh.URL_SCHEME.length)):null}));var Ph=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(T("function"==typeof e.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=e.fetchFunc):this.fetch=i().platform.fetch,T(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&T(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."})),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return f(this,void 0,void 0,(function(){var e,n,r,a;return d(this,(function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:ih(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}}))}))},t.prototype.load=function(){return f(this,void 0,void 0,(function(){var t,e,n,r,a,i,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,t.json()];case 3:return e=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,a=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,u=e.format,o=e.userDefinedMetadata,null==r&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:h=f.sent(),c=h[0],l=h[1],f.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:o,generatedBy:i,convertedBy:s,format:u}]}}))}))},t.prototype.loadWeights=function(t){return f(this,void 0,void 0,(function(){var e,n,r,a,i,s,u,o,c,l,h;return d(this,(function(f){switch(f.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],a=n[1],i=this.weightPathPrefix||r,s=[],u=0,o=t;u<o.length;u++)c=o[u],s.push.apply(s,c.weights);return l=[],t.forEach((function(t){t.paths.forEach((function(t){l.push(i+t+a)}))})),[4,Nh(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=f.sent(),[2,[s,rh(h)]]}}))}))},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function Bh(t){return null!=t.match(Ph.URL_SCHEME_REGEX)}var Lh=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every((function(t){return Bh(t)})):Bh(t))?Wh(t,{onProgress:e}):null};function Wh(t,e){return new Ph(t,e)}ah.registerSaveRouter(Lh),ah.registerLoadRouter(Lh);var Vh,Uh=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this.modelArtifacts]}))}))},t}(),td=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this.saveHandler(t)]}))}))},t}(),jh=Object.freeze({browserFiles:function(t){return new Dh(t)},browserHTTPRequest:function(t,e){return Wh(t,e)},concatenateArrayBuffers:rh,decodeWeights:Ql,encodeWeights:function(t,e){return f(this,void 0,void 0,(function(){var n,a,i,s,u,r=this;return d(this,(function(o){switch(o.label){case 0:for(n=[],a=[],i=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t),s=function(s){var u=i[s],o=Array.isArray(t)?t[s].tensor:t[u];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype)throw new Error("Unsupported dtype in weight '"+u+"': "+o.dtype);var c={name:u,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){var l=new Promise((function(t){return f(r,void 0,void 0,(function(){var e,n,r,a,i,s,u;return d(this,(function(c){switch(c.label){case 0:return[4,o.bytes()];case 1:for(e=c.sent(),n=e.reduce((function(t,e){return t+e.length}),0)+4*e.length,r=new Uint8Array(n),a=0,i=0;i<e.length;i++)s=e[i],u=new Uint8Array(new Uint32Array([s.length]).buffer),r.set(u,a),a+=4,r.set(s,a),a+=s.length;return t(r),[2]}}))}))}));a.push(l)}else a.push(o.data());null!=e&&(c.group=e),n.push(c)},u=0;u<i.length;++u)s(u);return[4,Promise.all(a)];case 1:return[2,{data:Jl(o.sent()),specs:n}]}}))}))},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new Uh(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Uh({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Uh({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return ah.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:ih,getSaveHandlers:function(t){return ah.getSaveHandlers(t)},http:Wh,isHTTPScheme:Bh,loadWeights:function(t,e,n,a){return void 0===e&&(e=""),f(this,void 0,void 0,(function(){return d(this,(function(r){return[2,Fh((function(t){return Nh(t,{requestInit:a})}))(t,e,n)]}))}))},registerLoadRouter:function(t){return ah.registerLoadRouter(t)},registerSaveRouter:function(t){return ah.registerSaveRouter(t)},weightsLoaderFactory:Fh,withSaveHandler:function(t){return new td(t)},copyModel:function(t,e){return f(this,void 0,void 0,(function(){return d(this,(function(n){return[2,lh(t,e,!1)]}))}))},listModels:function(){return f(this,void 0,void 0,(function(){var t,e,n,r,a,i,s;return d(this,(function(o){switch(o.label){case 0:t=uh.getSchemes(),e={},n=0,r=t,o.label=1;case 1:return n<r.length?(a=r[n],[4,uh.getManager(a).listModels()]):[3,4];case 2:for(s in i=o.sent())e[a+sh+s]=i[s];o.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(t,e){return f(this,void 0,void 0,(function(){return d(this,(function(n){return[2,lh(t,e,!0)]}))}))},removeModel:function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){return e=ch(t),[2,uh.getManager(e.scheme).removeModel(e.path)]}))}))}}),zh=an({confusionMatrix_:function(t,e,n){var r=Xe(t,"labels","confusionMatrix"),o=Xe(e,"predictions","confusionMatrix");T(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),T(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),T(1===o.rank,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),T(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),T(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=Kn(r.asType("int32"),n),i=Kn(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),qh=(Object.freeze({confusionMatrix:zh}),an({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)a=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);i=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=y("FromPixels",Pt.backendName))return Pt.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],h=c[1];if(i?s=t.getContext("2d").getImageData(0,0,l,h).data:r||n?s=t.data:(a||o)&&(null==Vh&&(Vh=document.createElement("canvas").getContext("2d")),Vh.canvas.width=l,Vh.canvas.height=h,Vh.drawImage(t,0,0,l,h),s=Vh.getImageData(0,0,l,h).data),4===e)u=new Int32Array(s);else{var f=l*h;u=new Int32Array(f*e);for(var p=0;p<f;p++)for(var d=0;d<e;++d)u[p*e+d]=s[4*p+d]}return vn(u,[h,l,e],"int32")}})),Gh=Object.freeze({toPixels:function(t,e){return f(this,void 0,void 0,(function(){var n,r,a,i,s,u,o,c,l,h,f,p,v,m,g,y,x,b,w,_,C,E,T;return d(this,(function(d){switch(d.label){case 0:if(n=Xe(t,"img","toPixels"),t instanceof xt||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],i=r[1],(s=2===n.rank?1:n.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return u=d.sent(),o=n.min(),c=n.max(),[4,Promise.all([o.data(),c.data()])];case 2:if(l=d.sent(),h=l[0],f=l[1],p=h[0],v=f[0],o.dispose(),c.dispose(),"float32"===n.dtype){if(p<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+v+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+v+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(i*a*4),y=0;y<a*i;++y)x=void 0,b=void 0,w=void 0,_=void 0,1===s?(x=u[y]*m,b=u[y]*m,w=u[y]*m,_=255):3===s?(x=u[3*y]*m,b=u[3*y+1]*m,w=u[3*y+2]*m,_=255):4===s&&(x=u[4*y]*m,b=u[4*y+1]*m,w=u[4*y+2]*m,_=u[4*y+3]*m),g[0+(C=4*y)]=Math.round(x),g[C+1]=Math.round(b),g[C+2]=Math.round(w),g[C+3]=Math.round(_);return null!=e&&(e.width=i,e.height=a,E=e.getContext("2d"),T=new ImageData(g,i,a),E.putImageData(T,0,0)),n!==t&&n.dispose(),[2,g]}}))}))},fromPixels:qh}),Hh=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),Xh=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function Kh(t){T(null!=t.className,(function(){return"Class being registered does not have the static className property defined."})),T("string"==typeof t.className,(function(){return"className is required to be a string, but got type "+typeof t.className})),T(t.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Xh.register(t)}Object.freeze({Serializable:Hh,SerializationMap:Xh,registerClass:Kh});function dd(){return 32===Pt.backend.floatPrecision()?.001:.1}function Yh(t,e,n){var r=!0;if((G(t)||G(e))&&(r=!1),G(t)&&G(e)&&(r=!0),r){var o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(t)&&Array.isArray(e)){var i=Ge(t),s=Ge(e);if(!R(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=G(t)?t:A(t),c=G(e)?e:A(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var h=u[l],f=c[l];if(!n(h,f))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function $h(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=dd()),Yh(t,e,(function(t,e){return $h(t,e,n)}))},testEpsilon:dd,expectPromiseToFail:function(t,e){t().then((function(){return e.fail()}),(function(){return e()}))},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return K(t)||K(t[0])||K(e)||K(e[0])?Yh(t,n,(function(t,e){return t==e})):Yh(t,e,(function(t,e){return $h(t,e,0)}))},expectNumbersClose:function(t,e,n){if(null==n&&(n=dd()),!$h(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:qi,webgl_util:We,forceHalfFloat:function(){i().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:$a,setWebGLContext:qt,GPGPUContext:Gi});var Zh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,a=r.grads;if(null!=n){var i=n.map((function(t){return{name:t.name,tensor:a[t.name]}}));this.applyGradients(i)}else this.applyGradients(a);return ze(a),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){T(Z(t),(function(){return"The f passed in variableGrads(f) must be a function"})),T(null==e||Array.isArray(e)&&e.every((function(t){return t instanceof St})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=e;if(!n)for(var r in e=[],Pt.registeredVariables)e.push(Pt.registeredVariables[r]);var o=n?e.filter((function(t){return!t.trainable})):null,a=e.length;T((e=e.filter((function(t){return t.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var i=Pt.gradients(t,e,null,!0),s=i.value,u=i.grads;T(u.some((function(t){return null!=t})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),T(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return e.forEach((function(t,e){null!=u[e]&&(c[t.name]=u[e])})),null!=o&&o.forEach((function(t){return c[t.name]=null})),{value:s,grads:c}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&ze(this.iterations_)},e.prototype.saveIterations=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:pn(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}}))}))},e}(Hh);Object.defineProperty(Zh,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var Qh=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=Pt.backend.epsilon()),o}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Pt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:je((function(){return _n(o).variable(!1)}))}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:je((function(){return _n(o).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;je((function(){var t=i.mul(e.rho).add(a.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(i.add(e.epsilon).sqrt()).mul(a),r=s.mul(e.rho).add(n.square().mul(1-e.rho));i.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(ze(this.accumulatedGrads.map((function(t){return t.variable}))),ze(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(Zh);Kh(Qh);var Jh=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Pt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:je((function(){return bn(o.shape,e.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedGrads[r].variable;je((function(){var t=i.add(a.square());i.assign(t);var n=a.div(t.add(Pt.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&ze(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(Zh);Kh(Jh);var tp=function(t){function e(e,n,r,o){void 0===o&&(o=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],je((function(){a.accBeta1=pn(n).variable(),a.accBeta2=pn(r).variable()})),null==o&&(a.epsilon=Pt.backend.epsilon()),a}return h(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);je((function(){var r=bu(1,e.accBeta1),o=bu(1,e.accBeta2);n.forEach((function(n,a){var i=Pt.registeredVariables[n];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:n+"/m",variable:je((function(){return _n(i).variable(!1)}))}),null==e.accumulatedSecondMoment[a]&&(e.accumulatedSecondMoment[a]={originalName:n+"/v",variable:je((function(){return _n(i).variable(!1)}))});var s=Array.isArray(t)?t[a].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,c=e.accumulatedSecondMoment[a].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2).add(s.square().mul(1-e.beta2)),f=l.div(r),d=h.div(o);u.assign(l),c.assign(h);var p=f.div(d.sqrt().add(e.epsilon)).mul(-e.learningRate).add(i);i.assign(p)}})),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ze(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedSecondMoment&&ze(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){var e,n=this;return d(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),je((function(){n.accBeta1.assign(mu(n.beta1,n.iterations_+1)),n.accBeta2.assign(mu(n.beta2,n.iterations_+1))})),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(Zh);Kh(tp);var ep=function(t){function e(e,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],je((function(){i.iteration=pn(0).variable(),i.accBeta1=pn(n).variable()})),null==o&&(i.epsilon=Pt.backend.epsilon()),i}return h(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);je((function(){var r=bu(1,e.accBeta1),o=ou(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach((function(n,a){var i=Pt.registeredVariables[n];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:n+"/m",variable:_n(i).variable(!1)}),null==e.accumulatedWeightedInfNorm[a]&&(e.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:_n(i).variable(!1)});var s=Array.isArray(t)?t[a].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,c=e.accumulatedWeightedInfNorm[a].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2),f=s.abs(),d=h.maximum(f);u.assign(l),c.assign(d);var p=o.div(r).mul(l.div(d.add(e.epsilon))).add(i);i.assign(p)}})),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ze(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedWeightedInfNorm&&ze(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(t){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(Zh);Kh(ep);var np=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=Pt.registeredVariables[n];je((function(){var t=e.c.mul(o).add(a);a.assign(t)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(t){return Pt.keep(t)}(pn(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(Zh);Kh(np);var op=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=pn(o.momentum),o}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Pt.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:je((function(){return _n(o).variable(!1)}))});var a=e.accumulations[r].variable,i=Array.isArray(t)?t[r].tensor:t[n];null!=i&&je((function(){var t,n=e.m.mul(a).add(i);t=e.useNesterov?e.c.mul(i.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),a.assign(n),o.assign(t)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&ze(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(np);Kh(op);var ip=function(t){function e(e,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=t.call(this)||this;if(i.learningRate=e,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=Pt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Pt.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:je((function(){return _n(o).variable(!1)}))}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:je((function(){return _n(o).variable(!1)}))}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:je((function(){return _n(o).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;je((function(){var t=i.mul(e.decay).add(a.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(a.mul(1-e.decay)),c=s.mul(e.momentum).add(a.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));i.assign(t),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var h=i.mul(e.decay).add(a.square().mul(1-e.decay));c=s.mul(e.momentum).add(a.mul(e.learningRate).div(h.add(e.epsilon).sqrt())),i.assign(h),s.assign(c),l=o.sub(c),o.assign(l)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&ze(this.accumulatedMeanSquares.map((function(t){return t.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&ze(this.accumulatedMeanGrads.map((function(t){return t.variable}))),null!=this.accumulatedMoments&&ze(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return f(this,void 0,void 0,(function(){var t;return d(this,(function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return f(this,void 0,void 0,(function(){var e;return d(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(Zh);Kh(ip);var ap=function(){function t(){}return t.sgd=function(t){return new np(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new op(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new ip(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new tp(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new Qh(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new ep(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new Jh(t,e)},t}();ap.sgd,ap.momentum,ap.adadelta,ap.adagrad,ap.rmsprop,ap.adamax,ap.adam,"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame;xt.prototype.squaredDifference=function(t){return Ja(this,t)},yt=Fl}).call(this,n(20),n(81),n(218).Buffer,n(121).setImmediate)},189:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return h})),n.d(e,"e",(function(){return f}));var r=function(t,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var p in b)b.hasOwnProperty(p)&&(t[p]=b[p])})(t,b)};function o(t,b){function e(){this.constructor=t}r(t,b),t.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}var c=function(){return(c=Object.assign||function(t){for(var s,i=1,e=arguments.length;i<e;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function l(t,e,n,r){return new(n||(n=Promise))((function(o,c){function l(t){try{f(r.next(t))}catch(t){c(t)}}function h(t){try{f(r.throw(t))}catch(t){c(t)}}function f(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,h)}f((r=r.apply(t,e||[])).next())}))}function h(t,body){var e,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(t,o)}catch(t){c=[6,t],n=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function f(){for(var s=0,i=0,t=arguments.length;i<t;i++)s+=arguments[i].length;var e=Array(s),n=0;for(i=0;i<t;i++)for(var a=arguments[i],r=0,o=a.length;r<o;r++,n++)e[n]=a[r];return e}},193:function(t,e,n){!function(t,e,n,r){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var c=o(e),l=o(n),h=o(r),f=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},d=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},v=function(t,e){return{startTime:e,type:"setValue",value:t}},m=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},y=function(time,t,e){var n=e.startTime,r=e.target,o=e.timeConstant;return r+(t-r)*Math.exp((n-time)/o)},x=function(t){return"exponentialRampToValue"===t.type},w=function(t){return"linearRampToValue"===t.type},_=function(t){return x(t)||w(t)},C=function(t){return"setValue"===t.type},E=function(t){return"setValueCurve"===t.type},T=function t(e,n,time,r){var o=e[n];return void 0===o?r:_(o)||C(o)?o.value:E(o)?o.values[o.values.length-1]:y(time,t(e,n-1,o.startTime,r),o)},S=function(t,e,n,r,o){return void 0===n?[r.insertTime,o]:_(n)?[n.endTime,n.value]:C(n)?[n.startTime,n.value]:E(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,T(t,e-1,n.startTime,o)]},k=function(t){return"cancelAndHold"===t.type},A=function(t){return"cancelScheduledValues"===t.type},I=function(t){return k(t)||A(t)?t.cancelTime:x(t)||w(t)?t.endTime:t.startTime},R=function(time,t,e,n){var r=n.endTime,o=n.value;return e===o?o:0<e&&0<o||e<0&&o<0?e*Math.pow(o/e,(time-t)/(r-t)):0},O=function(time,t,e,n){return e+(time-t)/(n.endTime-t)*(n.value-e)},D=function(time,t){var e=t.duration,n=t.startTime,r=t.values;return function(t,e){var n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]}(r,(time-n)/e*(r.length-1))},M=function(t){return"setTarget"===t.type},N=function(){function t(e){l.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return h.default(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=I(t);if(k(t)||A(t)){var n=this._automationEvents.findIndex((function(n){return A(t)&&E(n)?n.startTime+n.duration>=e:I(n)>=e})),r=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),k(t)){var o=this._automationEvents[this._automationEvents.length-1];if(void 0!==r&&_(r)){if(M(o))throw new Error("The internal list is malformed.");var c=E(o)?o.startTime+o.duration:I(o),l=E(o)?o.values[o.values.length-1]:o.value,h=x(r)?R(e,c,l,r):O(e,c,l,r),y=x(r)?f(h,e,this._currenTime):d(h,e,this._currenTime);this._automationEvents.push(y)}void 0!==o&&M(o)&&this._automationEvents.push(v(this.getValue(e),e)),void 0!==o&&E(o)&&o.startTime+o.duration>e&&(this._automationEvents[this._automationEvents.length-1]=m(new Float32Array([6,7]),o.startTime,e-o.startTime))}}else{var C=this._automationEvents.findIndex((function(t){return I(t)>e})),T=-1===C?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[C-1];if(void 0!==T&&E(T)&&I(T)+T.duration>e)return!1;var S=x(t)?f(t.value,t.endTime,this._currenTime):w(t)?d(t.value,e,this._currenTime):t;if(-1===C)this._automationEvents.push(S);else{if(E(t)&&e+t.duration>I(this._automationEvents[C]))return!1;this._automationEvents.splice(C,0,S)}}return!0}},{key:"flush",value:function(time){var t=this._automationEvents.findIndex((function(t){return I(t)>time}));if(t>1){var e=this._automationEvents.slice(t-1),n=e[0];M(n)&&e.unshift(v(T(this._automationEvents,t-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=e}}},{key:"getValue",value:function(time){if(0===this._automationEvents.length)return this._defaultValue;var t=this._automationEvents[this._automationEvents.length-1],e=this._automationEvents.findIndex((function(t){return I(t)>time})),n=this._automationEvents[e],r=I(t)<=time?t:this._automationEvents[e-1];if(void 0!==r&&M(r)&&(void 0===n||!_(n)||n.insertTime>time))return y(time,T(this._automationEvents,e-2,r.startTime,this._defaultValue),r);if(void 0!==r&&C(r)&&(void 0===n||!_(n)))return r.value;if(void 0!==r&&E(r)&&(void 0===n||!_(n)||r.startTime+r.duration>time))return time<r.startTime+r.duration?D(time,r):r.values[r.values.length-1];if(void 0!==r&&_(r)&&(void 0===n||!_(n)))return r.value;if(void 0!==n&&x(n)){var o=S(this._automationEvents,e-1,r,n,this._defaultValue),l=c.default(o,2),h=l[0],f=l[1];return R(time,h,f,n)}if(void 0!==n&&w(n)){var d=S(this._automationEvents,e-1,r,n,this._defaultValue),v=c.default(d,2),m=v[0],k=v[1];return O(time,m,k,n)}return this._defaultValue}}]),t}();t.AutomationEventList=N,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},t.createSetValueAutomationEvent=v,t.createSetValueCurveAutomationEvent=m,Object.defineProperty(t,"__esModule",{value:!0})}(e,n(205),n(211),n(212))},196:function(t,e,n){"use strict";function r(t){var e="";if(!t)try{t=n(!function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){e=t.toString()}return{readFile:t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){return t?r(t):n(e)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}n.d(e,"a",(function(){return r}))},200:function(t,e,n){"use strict";n.d(e,"c",(function(){return Ni})),n.d(e,"b",(function(){return ca})),n.d(e,"a",(function(){return _a})),n.d(e,"d",(function(){return Aa}));var r=n(193);const o=new WeakSet,c=new WeakMap,l=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakMap,m=new WeakMap,y=new WeakMap,x=new WeakMap,w={construct:()=>w},_=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,C=(source,t)=>{const e=[];let n=source.replace(/^[\s]+/,""),r=n.match(_);for(;null!==r;){const o=r[1].slice(1,-1),c=r[0].replace(/([\s]+)?;?$/,"").replace(o,new URL(o,t).toString());e.push(c),n=n.slice(r[0].length).replace(/^[\s]+/,""),r=n.match(_)}return[e.join(";"),n]},E=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},T=t=>{if(!(t=>{try{new new Proxy(t,w)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},S=(map,t)=>{const e=map.get(t);if(void 0===e)throw new Error("A value with the given key could not be found.");return e},k=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[r]=n;return t.delete(r),r},A=(t,source,output,input)=>{const e=S(t,source),n=k(e,t=>t[0]===output&&t[1]===input);return 0===e.size&&t.delete(source),n},I=t=>S(v,t),R=t=>{if(o.has(t))throw new Error("The AudioNode is already stored.");o.add(t),I(t).forEach(t=>t(!0))},O=t=>"port"in t,D=t=>{if(!o.has(t))throw new Error("The AudioNode is not stored.");o.delete(t),I(t).forEach(t=>t(!1))},M=(t,e)=>{!O(t)&&e.every(t=>0===t.size)&&D(t)},N={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},F=(t,e)=>t.context===e,P=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},B=()=>new DOMException("","IndexSizeError"),L=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw B();throw t}})},W={numberOfChannels:1},V=-34028234663852886e22,U=-V,j=t=>o.has(t),z={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},G=t=>S(c,t),H=t=>S(h,t),X=(t,e)=>{const{activeInputs:n}=G(t);n.forEach(n=>n.forEach(([source])=>{e.includes(t)||X(source,[...e,t])}));const r=(t=>"playbackRate"in t)(t)?[t.playbackRate]:O(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of r){const n=H(t);void 0!==n&&n.activeInputs.forEach(([source])=>X(source,e))}j(t)&&D(t)},K=t=>{X(t.destination,[])},Y=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t),$=t=>"context"in t,Z=t=>$(t[0]),Q=(t,element,e,n)=>{for(const r of t)if(e(r)){if(n)return!1;throw Error("The set contains at least one similar element.")}return t.add(element),!0},J=(t,source,[output,e],n)=>{Q(t,[source,output,e],t=>t[0]===source&&t[1]===output,n)},tt=(t,[source,output,e],n)=>{const r=t.get(source);void 0===r?t.set(source,new Set([[output,e]])):Q(r,[output,e],t=>t[0]===output,n)},et=t=>"inputs"in t,nt=(t,e,output,input)=>{if(et(e)){const n=e.inputs[input];return t.connect(n,output,0),[n,output,0]}return t.connect(e,output,input),[e,output,input]},ot=(t,source,output)=>{for(const e of t)if(e[0]===source&&e[1]===output)return t.delete(e),e;return null},it=(t,e)=>{if(!I(t).delete(e))throw new Error("Missing the expected event listener.")},at=(t,source,output)=>{const e=S(t,source),n=k(e,t=>t[0]===output);return 0===e.size&&t.delete(source),n},st=(t,e,output,input)=>{et(e)?t.disconnect(e.inputs[input],output,0):t.disconnect(e,output,input)},ut=t=>S(l,t),ct=t=>S(f,t),lt=t=>m.has(t),ht=t=>!o.has(t),pt=t=>new Promise(e=>{const n=t.createScriptProcessor(256,1,1),r=t.createGain(),o=t.createBuffer(1,2,44100),c=o.getChannelData(0);c[0]=1,c[1]=1;const source=t.createBufferSource();source.buffer=o,source.loop=!0,source.connect(n).connect(t.destination),source.connect(r),source.disconnect(r),n.onaudioprocess=r=>{const o=r.inputBuffer.getChannelData(0);Array.prototype.some.call(o,t=>1===t)?e(!0):e(!1),source.stop(),n.onaudioprocess=null,source.disconnect(n),n.disconnect(t.destination)},source.start()}),ft=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach((t,n)=>e(n,t))},vt=t=>"context"in t,mt=(source,t,output,e)=>{const{activeInputs:n,passiveInputs:r}=H(t),{outputs:o}=G(source),c=I(source),l=o=>{const c=ut(source),l=ct(t);if(o){const t=at(r,source,output);J(n,source,t,!1),e||lt(source)||c.connect(l,output)}else{const t=((t,source,output)=>k(t,t=>t[0]===source&&t[1]===output))(n,source,output);tt(r,t,!1),e||lt(source)||c.disconnect(l,output)}};return!!Q(o,[t,output],e=>e[0]===t&&e[1]===output,!0)&&(c.add(l),j(source)?J(n,source,[output,l],!0):tt(r,[source,output,l],!0),!0)},gt=(source,t,e,output,input)=>{const[n,r]=((source,t,output,input)=>{const{activeInputs:e,passiveInputs:n}=G(t),r=ot(e[input],source,output);if(null===r){return[A(n,source,output,input)[2],!1]}return[r[2],!0]})(source,e,output,input);if(null!==n&&(it(source,n),!r||t||lt(source)||st(ut(source),ut(e),output,input)),j(e)){const{activeInputs:t}=G(e);M(e,t)}},yt=(source,t,e,output)=>{const[n,r]=((source,t,output)=>{const{activeInputs:e,passiveInputs:n}=H(t),r=ot(e,source,output);if(null===r){return[at(n,source,output)[1],!1]}return[r[2],!0]})(source,e,output);null!==n&&(it(source,n),!r||t||lt(source)||ut(source).disconnect(ct(e),output))};class bt{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((n,r)=>t.call(e,n,r,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const xt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function wt(t,e,n,r,o){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,o);else{const c=t.getChannelData(r);if(0===e[n].byteLength)e[n]=c.slice(o,o+128);else{const t=new Float32Array(c.buffer,o*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const _t=(t,e,n,r,o)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],r,o):0!==e[n].byteLength&&t.getChannelData(r).set(e[n],o)},Ct=(t,e)=>{const n=[];for(let i=0;i<t;i+=1){const t=[],r="number"==typeof e?e:e[i];for(let e=0;e<r;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Et=async(t,e,n,r,o,c,l)=>{const h=null===e?128*Math.ceil(t.context.length/128):e.length,f=r.channelCount*r.numberOfInputs,d=o.reduce((t,e)=>t+e,0),v=0===d?null:n.createBuffer(d,h,n.sampleRate);if(void 0===c)throw new Error("Missing the processor constructor.");const m=G(t),y=await((t,e)=>{const n=S(x,t),r=ut(e);return S(n,r)})(n,t),w=Ct(r.numberOfInputs,r.channelCount),_=Ct(r.numberOfOutputs,o),C=Array.from(t.parameters.keys()).reduce((t,e)=>({...t,[e]:new Float32Array(128)}),{});for(let i=0;i<h;i+=128){if(r.numberOfInputs>0&&null!==e)for(let t=0;t<r.numberOfInputs;t+=1)for(let n=0;n<r.channelCount;n+=1)wt(e,w[t],n,n,i);void 0!==c.parameterDescriptors&&null!==e&&c.parameterDescriptors.forEach(({name:t},n)=>{wt(e,C,t,f+n,i)});for(let t=0;t<r.numberOfInputs;t+=1)for(let e=0;e<o[t];e+=1)0===_[t][e].byteLength&&(_[t][e]=new Float32Array(128));try{const t=w.map((input,t)=>0===m.activeInputs[t].size?[]:input),e=l(i/n.sampleRate,n.sampleRate,()=>y.process(t,_,C));if(null!==v)for(let t=0,e=0;t<r.numberOfOutputs;t+=1){for(let n=0;n<o[t];n+=1)_t(v,_[t],n,e+n,i);e+=o[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return v},Tt={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},St={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},kt={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},At={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},It={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Rt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Ot=(t,e,output)=>{const n=e[output];if(void 0===n)throw t();return n},Dt={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Mt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Nt=()=>new DOMException("","InvalidStateError"),Ft=()=>new DOMException("","InvalidAccessError"),Pt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Bt=(t,e,n,r,o,c,l,h,f,input,output)=>{const d=input.length;let i=h;for(let h=0;h<d;h+=1){let d=n[0]*input[h];for(let e=1;e<o;e+=1){const r=i-e&f-1;d+=n[e]*c[r],d-=t[e]*l[r]}for(let t=o;t<r;t+=1)d+=n[t]*c[i-t&f-1];for(let n=o;n<e;n+=1)d-=t[n]*l[i-n&f-1];c[i]=input[h],l[i]=d,i=i+1&f-1,output[h]=d}return i},Lt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Wt=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return void 0!==n&&(n.catch(()=>{}),!0)}catch{}return!1},Vt={numberOfChannels:1},Ut=(t,e,option)=>{const n=e[option];void 0!==n&&n!==t[option]&&(t[option]=n)},jt=(t,e)=>{Ut(t,e,"channelCount"),Ut(t,e,"channelCountMode"),Ut(t,e,"channelInterpretation")},zt=t=>"function"==typeof t.getFloatTimeDomainData,qt=(t,e,n)=>{const r=e[n];void 0!==r&&r!==t[n].value&&(t[n].value=r)},Gt=t=>{var e;t.start=(e=t.start,(n=0,r=0,o)=>{if("number"==typeof o&&o<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,o)})},Ht=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},Xt=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Kt=async(t,e)=>new t(await(t=>new Promise((e,n)=>{const{port1:r,port2:o}=new MessageChannel;r.onmessage=({data:data})=>{r.close(),o.close(),e(data)},r.onmessageerror=({data:data})=>{r.close(),o.close(),n(data)},o.postMessage(t)}))(e)),Yt=(t,e)=>{const n=t.createBiquadFilter();return jt(n,e),qt(n,e,"Q"),qt(n,e,"detune"),qt(n,e,"frequency"),qt(n,e,"gain"),Ut(n,e,"type"),n},$t=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return jt(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Nt()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw Nt()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw Nt()}})})(n),n},Zt=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Qt=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return jt(n,e),qt(n,e,"delayTime"),n},Jt=(t,e)=>{const n=t.createGain();return jt(n,e),qt(n,e,"gain"),n};function te(a,b){const t=b[0]*b[0]+b[1]*b[1];return[(a[0]*b[0]+a[1]*b[1])/t,(a[1]*b[0]-a[0]*b[1])/t]}function ee(t,e){let n=[0,0];for(let i=t.length-1;i>=0;i-=1)b=e,n=[(a=n)[0]*b[0]-a[1]*b[1],a[0]*b[1]+a[1]*b[0]],n[0]+=t[i];var a,b;return n}const ne=(t,e,n,r)=>t.createScriptProcessor(e,n,r),re=()=>new DOMException("","NotSupportedError"),oe={numberOfChannels:1},ie={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ae={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},se={disableNormalization:!1},ue={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},ce=()=>new DOMException("","UnknownError"),le={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},he=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},pe=(object,t,e,n)=>{let r=Object.getPrototypeOf(object);for(;!r.hasOwnProperty(t);)r=Object.getPrototypeOf(r);const{get:o,set:c}=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(object,t,{get:e(o),set:n(c)})},fe=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},de=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},ve=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},me=(t,e)=>{const n=e.createGain();t.connect(n);const r=(o=t.disconnect,()=>{o.call(t,n),t.removeEventListener("ended",r)});var o;t.addEventListener("ended",r),Zt(t,n),t.stop=(e=>{let r=!1;return(o=0)=>{if(r)try{e.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else e.call(t,o),r=!0}})(t.stop)},ge=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},ye=(be=Q,(t,source,[output,input,e],n)=>{be(t[input],[source,output,e],t=>t[0]===source&&t[1]===output,n)});var be;const xe=(t=>(e,input,[source,output,n],r)=>{const o=e.get(source);void 0===o?e.set(source,new Set([[output,input,n]])):t(o,[output,input,n],t=>t[0]===output&&t[1]===input,r)})(Q),we=(t=>(e,source,output,input)=>t(e[input],t=>t[0]===source&&t[1]===output))(k),_e=new WeakMap,Ce=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(_e),Ee=(Te=new Map,Se=new WeakMap,(t,e)=>{const n=Se.get(t);if(void 0!==n)return n;const r=Te.get(t);if(void 0!==r)return r;try{const n=e();return n instanceof Promise?(Te.set(t,n),n.catch(()=>!1).then(e=>(Te.delete(t),Se.set(t,e),e))):(Se.set(t,n),n)}catch{return Se.set(t,!1),!1}});var Te,Se;const ke="undefined"==typeof window?null:window,Ae=(Ie=Ee,Re=B,(t,e)=>{const n=t.createAnalyser();if(jt(n,e),!(e.maxDecibels>e.minDecibels))throw Re();return Ut(n,e,"fftSize"),Ut(n,e,"maxDecibels"),Ut(n,e,"minDecibels"),Ut(n,e,"smoothingTimeConstant"),Ie(zt,()=>zt(n))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=.0078125*(n[i]-128);return e}})(n),n});var Ie,Re;const Oe=(De=G,t=>{const e=De(t);if(null===e.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var De;const Me=((t,e,n)=>async(r,o,c,l)=>{const h=t(r),f=[...l,r];await Promise.all(h.activeInputs.map((t,input)=>Array.from(t).filter(([source])=>!f.includes(source)).map(async([source,output])=>{const t=e(source),l=await t.render(source,o,f),h=r.context.destination;n(source)||r===h&&n(r)||l.connect(c,output,input)})).reduce((t,e)=>[...t,...e],[]))})(G,Oe,lt),Ne=(Fe=Ae,Pe=ut,Be=Me,()=>{const t=new WeakMap;return{render(e,n,r){const o=t.get(n);return void 0!==o?Promise.resolve(o):(async(e,n,r)=>{let o=Pe(e);if(!F(o,n)){const t={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=Fe(n,t)}return t.set(n,o),await Be(e,n,o,r),o})(e,n,r)}}});var Fe,Pe,Be;const Le=(We=d,t=>{const e=We.get(t);if(void 0===e)throw Nt();return e});var We;const Ve=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ke),Ue=(je=Ve,t=>null!==je&&t instanceof je);var je;const ze=new WeakMap,qe=(Ge=ge,class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,e,n){if(null!==e){let r=this._listeners.get(e);void 0===r&&(r=Ge(this,e),"function"==typeof e&&this._listeners.set(e,r)),this._nativeEventTarget.addEventListener(t,r,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const r=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===r?null:r,n)}});var Ge;const He=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ke),Xe=(Ke=He,t=>null!==Ke&&t instanceof Ke);var Ke;const Ye=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ke),$e=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ke),Ze=((t,e,n,r,o,c,h,f,d,m,y,x,w,_,C)=>class extends m{constructor(e,r,o,c){super(o),this._context=e,this._nativeAudioNode=o;const h=y(e);x(h)&&!0!==n(pt,()=>pt(h))&&(t=>{const e=new Map;var n,r;t.connect=(n=t.connect.bind(t),(t,output=0,input=0)=>{const r=vt(t)?n(t,output,input):n(t,output),o=e.get(t);return void 0===o?e.set(t,[{input:input,output:output}]):o.every(t=>t.input!==input||t.output!==output)&&o.push({input:input,output:output}),r}),t.disconnect=(r=t.disconnect,(n,output,input)=>{if(r.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,r]of e){const o=r.filter(t=>t.output!==n);0===o.length?e.delete(t):e.set(t,o)}else if(e.has(n))if(void 0===output)e.delete(n);else{const t=e.get(n);if(void 0!==t){const r=t.filter(t=>t.output!==output&&(t.input!==input||void 0===input));0===r.length?e.delete(n):e.set(n,r)}}for(const[n,r]of e)r.forEach(e=>{vt(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)})})})(o),l.set(this,o),v.set(this,new Set),"closed"!==e.state&&r&&R(this),t(this,c,o)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,output=0,input=0){if(output<0||output>=this._nativeAudioNode.numberOfOutputs)throw o();const n=y(this._context),l=C(n);if(w(t)||_(t))throw c();if($(t)){const n=ut(t);try{const e=nt(this._nativeAudioNode,n,output,input),r=ht(this);(l||r)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!r&&ht(t)&&R(t)}catch(t){if(12===t.code)throw c();throw t}if(e(this,t,output,input,l)){const e=d([this],t);ft(e,r(l))}return t}const f=ct(t);if("playbackRate"===f.name)throw h();try{this._nativeAudioNode.connect(f,output),(l||ht(this))&&this._nativeAudioNode.disconnect(f,output)}catch(t){if(12===t.code)throw c();throw t}if(mt(this,t,output,l)){const e=d([this],t);ft(e,r(l))}}disconnect(t,output,input){let e;const n=y(this._context),r=C(n);if(void 0===t)e=((source,t)=>{const e=G(source),n=[];for(const r of e.outputs)Z(r)?gt(source,t,...r):yt(source,t,...r),n.push(r[0]);return e.outputs.clear(),n})(this,r);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw o();e=((source,t,output)=>{const e=G(source),n=[];for(const r of e.outputs)r[1]===output&&(Z(r)?gt(source,t,...r):yt(source,t,...r),n.push(r[0]),e.outputs.delete(r));return n})(this,r,t)}else{if(void 0!==output&&(output<0||output>=this.numberOfOutputs))throw o();if($(t)&&void 0!==input&&(input<0||input>=t.numberOfInputs))throw o();if(e=((source,t,e,output,input)=>{const n=G(source);return Array.from(n.outputs).filter(t=>!(t[0]!==e||void 0!==output&&t[1]!==output||void 0!==input&&t[2]!==input)).map(e=>(Z(e)?gt(source,t,...e):yt(source,t,...e),n.outputs.delete(e),e[0]))})(this,r,t,output,input),0===e.length)throw c()}for(const t of e){const e=d([this],t);ft(e,f)}}})((Qe=c,(t,e,n)=>{const r=[];for(let i=0;i<n.numberOfInputs;i+=1)r.push(new Set);Qe.set(t,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,r,o,c,l,h,f,d,v,m,y)=>(source,x,output,input,w)=>{const{activeInputs:_,passiveInputs:C}=c(x),{outputs:E}=c(source),T=h(source),S=c=>{const h=f(x),d=f(source);if(c){const e=A(C,source,output,input);t(_,source,e,!1),w||m(source)||n(d,h,output,input),y(x)&&R(x)}else{const t=r(_,source,output,input);e(C,input,t,!1),w||m(source)||o(d,h,output,input);const n=l(x);0===n?v(x)&&M(x,_):setTimeout(()=>{v(x)&&M(x,_)},1e3*n)}};return!!d(E,[x,output,input],t=>t[0]===x&&t[1]===output&&t[2]===input,!0)&&(T.add(S),v(source)?t(_,source,[output,input,S],!0):e(C,input,[source,output,S],!0),!0)})(ye,xe,nt,we,st,G,Ce,I,ut,Q,j,lt,ht),Ee,((t,e,n,r,o,c)=>l=>(h,f)=>{const d=t.get(h);if(void 0===d){if(!l&&c(h)){const t=r(h),{outputs:c}=n(h);for(const output of c)if(Z(output)){const n=r(output[0]);e(t,n,output[1],output[2])}else{const e=o(output[0]);t.disconnect(e,output[1])}}t.set(h,f)}else t.set(h,d+f)})(m,st,G,ut,ct,j),B,Ft,re,((t,e,n,r,o,c,l,h)=>(f,d)=>{const v=e.get(f);if(void 0===v)throw new Error("Missing the expected cycle count.");const m=c(f.context),y=h(m);if(v===d){if(e.delete(f),!y&&l(f)){const e=r(f),{outputs:c}=n(f);for(const output of c)if(Z(output)){const n=r(output[0]);t(e,n,output[1],output[2])}else{const t=o(output[0]);e.connect(t,output[1])}}}else e.set(f,v-d)})(nt,m,G,ut,ct,Le,j,Ue),((t,e,n)=>function r(o,c){const l=$(c)?c:n(t,c);if((t=>"delayTime"in t)(l))return[];if(o[0]===l)return[o];if(o.includes(l))return[];const{outputs:h}=e(l);return Array.from(h).map(t=>r([...o,l],t[0])).reduce((t,e)=>t.concat(e),[])})(ze,G,S),qe,Le,Xe,Ye,$e,Ue);var Qe;const Je=((t,e,n,r,o,c)=>class extends t{constructor(t,n){const l=o(t),h={...N,...n},f=r(l,h);super(t,!1,f,c(l)?e():null),this._nativeAnalyserNode=f}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ze,Ne,B,Ae,Le,Ue),tn=new WeakSet,en=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ke),nn=(rn=new Uint32Array(1),t=>(rn[0]=t,rn[0]));var rn;const on=((t,e)=>n=>{n.copyFromChannel=(r,o,c=0)=>{const l=t(c),h=t(o);if(h>=n.numberOfChannels)throw e();const f=n.length,d=n.getChannelData(h),v=r.length;for(let i=l<0?-l:0;i+l<f&&i<v;i+=1)r[i]=d[i+l]},n.copyToChannel=(source,r,o=0)=>{const c=t(o),l=t(r);if(l>=n.numberOfChannels)throw e();const h=n.length,f=n.getChannelData(l),d=source.length;for(let i=c<0?-c:0;i+c<h&&i<d;i+=1)f[i+c]=source[i]}})(nn,B),an=(t=>e=>{e.copyFromChannel=(n=>(r,o,c=0)=>{const l=t(c),h=t(o);if(l<e.length)return n.call(e,r,h,l)})(e.copyFromChannel),e.copyToChannel=(n=>(source,r,o=0)=>{const c=t(o),l=t(r);if(c<e.length)return n.call(e,source,l,c)})(e.copyToChannel)})(nn),sn=((t,e,n,r,o,c,l,h)=>{let f=null;return class d{constructor(d){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:v,numberOfChannels:m,sampleRate:y}={...W,...d};null===f&&(f=new o(1,1,44100));const x=null!==r&&e(c,c)?new r({length:v,numberOfChannels:m,sampleRate:y}):f.createBuffer(m,v,y);if(0===x.numberOfChannels)throw n();return"function"!=typeof x.copyFromChannel?(l(x),L(x)):e(P,()=>P(x))||h(x),t.add(x),x}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===d.prototype||t.has(e)}}})(tn,Ee,re,en,Ve,(un=en,()=>{if(null===un)return!1;try{new un({length:1,sampleRate:44100})}catch{return!1}return!0}),on,an);var un;const cn=(ln=Jt,(t,e)=>{const n=ln(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);const r=()=>{e.removeEventListener("ended",r),e.disconnect(n),n.disconnect()};e.addEventListener("ended",r)});var ln;const hn=((t,e,n)=>async(r,o,c,l)=>{const h=e(r);await Promise.all(Array.from(h.activeInputs).map(async([source,output])=>{const e=t(source),r=await e.render(source,o,l);n(source)||r.connect(c,output)}))})(Oe,H,lt),pn=(t=>(e,n,r,o)=>t(n,e,r,o))(hn),fn=((t,e,n,r,o,c,l,h,f,d,v)=>(m,y)=>{const x=m.createBufferSource();return jt(x,y),qt(x,y,"playbackRate"),Ut(x,y,"buffer"),Ut(x,y,"loop"),Ut(x,y,"loopEnd"),Ut(x,y,"loopStart"),e(n,()=>n(m))||(t=>{t.start=(e=>{let n=!1;return(r=0,o=0,c)=>{if(n)throw Nt();e.call(t,r,o,c),n=!0}})(t.start)})(x),e(r,()=>r(m))||f(x),e(o,()=>o(m))||d(x,m),e(c,()=>c(m))||Gt(x),e(l,()=>l(m))||v(x,m),e(h,()=>h(m))||Ht(x),t(m,x),x})(cn,Ee,t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},fe,de,ve,t=>{var e;t.start=(e=t.start,(n=0,r=0,o)=>{const c=t.buffer,l=null===c?r:Math.min(c.duration,r);null!==c&&l>c.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,l,o)})},(dn=pe,(t,e)=>{const n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),dn(t,"buffer",e=>()=>{const r=e.call(t);return r===n?null:r},e=>r=>e.call(t,null===r?n:r))}),me);var dn;const vn=((t,e)=>(n,r,o,c)=>(t(r).replay(o),e(r,n,o,c)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(H),hn),mn=((t,e,n,r,o)=>()=>{const c=new WeakMap;let l=null,h=null;return{set start(t){l=t},set stop(t){h=t},render(f,d,v){const m=c.get(d);return void 0!==m?Promise.resolve(m):(async(f,d,v)=>{let m=n(f);const y=F(m,d);if(!y){const t={buffer:m.buffer,channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,loop:m.loop,loopEnd:m.loopEnd,loopStart:m.loopStart,playbackRate:m.playbackRate.value};m=e(d,t),null!==l&&m.start(...l),null!==h&&m.stop(h)}return c.set(d,m),y?await t(d,f.playbackRate,m.playbackRate,v):await r(d,f.playbackRate,m.playbackRate,v),await o(f,d,m,v),m})(f,d,v)}}})(pn,fn,ut,vn,Me),gn=((t,e,n,o,c,l,h,f,d,v,m,y)=>(x,w,_,C=null,E=null)=>{const T=new r.AutomationEventList(_.defaultValue),S=w?o(T):null,k={get defaultValue(){return _.defaultValue},get maxValue(){return null===C?_.maxValue:C},get minValue(){return null===E?_.minValue:E},get value(){return _.value},set value(t){_.value=t,k.setValueAtTime(t,x.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof _.cancelAndHoldAtTime)null===S&&T.flush(x.context.currentTime),T.add(c(t)),_.cancelAndHoldAtTime(t);else{const e=Array.from(T).pop();null===S&&T.flush(x.context.currentTime),T.add(c(t));const n=Array.from(T).pop();_.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?_.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?_.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?_.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&_.setValueCurveAtTime(n.values,n.startTime,n.duration))}return k},cancelScheduledValues:t=>(null===S&&T.flush(x.context.currentTime),T.add(l(t)),_.cancelScheduledValues(t),k),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===S&&T.flush(x.context.currentTime),T.add(h(t,e)),_.exponentialRampToValueAtTime(t,e),k},linearRampToValueAtTime:(t,e)=>(null===S&&T.flush(x.context.currentTime),T.add(f(t,e)),_.linearRampToValueAtTime(t,e),k),setTargetAtTime:(t,e,n)=>(null===S&&T.flush(x.context.currentTime),T.add(d(t,e,n)),_.setTargetAtTime(t,e,n),k),setValueAtTime:(t,e)=>(null===S&&T.flush(x.context.currentTime),T.add(v(t,e)),_.setValueAtTime(t,e),k),setValueCurveAtTime(t,e,n){const r=t instanceof Float32Array?t:new Float32Array(t);if(null!==y&&"webkitAudioContext"===y.name){const t=e+n,o=x.context.sampleRate,c=Math.ceil(e*o),l=Math.floor(t*o),h=l-c,f=new Float32Array(h);for(let i=0;i<h;i+=1){const t=(r.length-1)/n*((c+i)/o-e),l=Math.floor(t),h=Math.ceil(t);f[i]=l===h?r[l]:(1-(t-l))*r[l]+(1-(h-t))*r[h]}null===S&&T.flush(x.context.currentTime),T.add(m(f,e,n)),_.setValueCurveAtTime(f,e,n);const d=l/o;d<t&&k.setValueAtTime(f[f.length-1],d),k.setValueAtTime(r[r.length-1],t)}else null===S&&T.flush(x.context.currentTime),T.add(m(r,e,n)),_.setValueCurveAtTime(r,e,n);return k}};return n.set(k,_),e.set(k,x),t(k,S),k})((yn=h,(t,e)=>{yn.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),ze,f,t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:r}=n;e.exponentialRampToValueAtTime(r,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:r}=n;e.linearRampToValueAtTime(r,t)}else if("setTarget"===n.type){const{startTime:t,target:r,timeConstant:o}=n;e.setTargetAtTime(r,t,o)}else if("setValue"===n.type){const{startTime:t,value:r}=n;e.setValueAtTime(r,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:r,values:o}=n;e.setValueCurveAtTime(o,r,t)}}}}),r.createCancelAndHoldAutomationEvent,r.createCancelScheduledValuesAutomationEvent,r.createExponentialRampToValueAutomationEvent,r.createLinearRampToValueAutomationEvent,r.createSetTargetAutomationEvent,r.createSetValueAutomationEvent,r.createSetValueCurveAutomationEvent,He);var yn;const bn=((t,e,n,r,o,c,l,h)=>class extends t{constructor(t,r){const h=c(t),f={...z,...r},d=o(h,f),v=l(h),m=v?e():null;super(t,!1,d,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=null!==f.buffer,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=n(this,v,d.playbackRate,U,V)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?h(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){R(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),j(this)&&D(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ze,mn,gn,Nt,fn,Le,Ue,ge),xn=((t,e,n,r,o,c,l,h)=>class extends t{constructor(t,n){const r=c(t),f=l(r),d=o(r,n,f);super(t,!1,d,f?e(h):null),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ze,t=>{let e=null;return{render:(n,r,o)=>(null===e&&(e=(async(e,n,r)=>{const o=n.destination;return await t(e,n,o,r),o})(n,r,o)),e)}},B,Nt,((t,e)=>(n,r,o)=>{const c=n.destination;if(c.channelCount!==r)try{c.channelCount=r}catch{}o&&"explicit"!==c.channelCountMode&&(c.channelCountMode="explicit"),0===c.maxChannelCount&&Object.defineProperty(c,"maxChannelCount",{value:r});const l=t(n,{channelCount:r,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:1});return e(l,"channelCount",t=>()=>t.call(l),t=>e=>{t.call(l,e);try{c.channelCount=e}catch(t){if(e>c.maxChannelCount)throw t}}),e(l,"channelCountMode",t=>()=>t.call(l),t=>e=>{t.call(l,e),c.channelCountMode=e}),e(l,"channelInterpretation",t=>()=>t.call(l),t=>e=>{t.call(l,e),c.channelInterpretation=e}),Object.defineProperty(l,"maxChannelCount",{get:()=>c.maxChannelCount}),l.connect(c),l})(Jt,pe),Le,Ue,Me),wn=((t,e,n,r,o)=>()=>{const c=new WeakMap;return{render(l,h,f){const d=c.get(h);return void 0!==d?Promise.resolve(d):(async(l,h,f)=>{let d=n(l);const v=F(d,h);if(!v){const t={Q:d.Q.value,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,gain:d.gain.value,type:d.type};d=e(h,t)}return c.set(h,d),v?(await t(h,l.Q,d.Q,f),await t(h,l.detune,d.detune,f),await t(h,l.frequency,d.frequency,f),await t(h,l.gain,d.gain,f)):(await r(h,l.Q,d.Q,f),await r(h,l.detune,d.detune,f),await r(h,l.frequency,d.frequency,f),await r(h,l.gain,d.gain,f)),await o(l,h,d,f),d})(l,h,f)}}})(pn,Yt,ut,vn,Me),_n=(t=>(e,n)=>t.set(e,n))(_e),Cn=(En=Ze,Tn=gn,Sn=wn,kn=Ft,An=Yt,In=Le,Rn=Ue,On=_n,class extends En{constructor(t,e){const n=In(t),r={...Tt,...e},o=An(n,r),c=Rn(n);super(t,!1,o,c?Sn():null),this._Q=Tn(this,c,o.Q,U,V),this._detune=Tn(this,c,o.detune,1200*Math.log2(U),-1200*Math.log2(U)),this._frequency=Tn(this,c,o.frequency,t.sampleRate/2,0),this._gain=Tn(this,c,o.gain,40*Math.log10(U),V),this._nativeBiquadFilterNode=o,On(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){if(this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n),t.length!==e.length||e.length!==n.length)throw kn()}});var En,Tn,Sn,kn,An,In,Rn,On;const Dn=((t,e)=>(n,r,o)=>{const c=new Set;var l,h;return n.connect=(l=n.connect,(o,output=0,input=0)=>{const h=0===c.size;if(e(o))return l.call(n,o,output,input),t(c,[o,output,input],t=>t[0]===o&&t[1]===output&&t[2]===input,!0),h&&r(),o;l.call(n,o,output),t(c,[o,output],t=>t[0]===o&&t[1]===output,!0),h&&r()}),n.disconnect=(h=n.disconnect,(t,output,input)=>{const r=c.size>0;if(void 0===t)h.apply(n),c.clear();else if("number"==typeof t){h.call(n,t);for(const e of c)e[1]===t&&c.delete(e)}else{e(t)?h.call(n,t,output,input):h.call(n,t,output);for(const e of c)e[0]!==t||void 0!==output&&e[1]!==output||void 0!==input&&e[2]!==input||c.delete(e)}const l=0===c.size;r&&l&&o()}),n})(Q,Ye),Mn=(Nn=Nt,Fn=Dn,(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw Nn()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw Nn()}});const n=t.createBufferSource();Fn(e,()=>{const t=e.numberOfInputs;for(let i=0;i<t;i+=1)n.connect(e,0,i)},()=>n.disconnect(e))});var Nn,Fn;const Pn=((t,e)=>(n,r)=>{const o=n.createChannelMerger(r.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,o),jt(o,r),o})(He,Mn),Bn=((t,e,n,r,o)=>class extends t{constructor(t,c){const l=r(t),h={...St,...c};super(t,!1,n(l,h),o(l)?e():null)}})(Ze,((t,e,n)=>()=>{const r=new WeakMap;return{render(o,c,l){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(o,c,l)=>{let h=e(o);if(!F(h,c)){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,numberOfInputs:h.numberOfInputs};h=t(c,e)}return r.set(c,h),await n(o,c,h,l),h})(o,c,l)}}})(Pn,ut,Me),Pn,Le,Ue),Ln=((t,e,n,r,o,c)=>class extends t{constructor(t,l){const h=r(t),f=c({...kt,...l});super(t,!1,n(h,f),o(h)?e():null)}})(Ze,((t,e,n)=>()=>{const r=new WeakMap;return{render(o,c,l){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(o,c,l)=>{let h=e(o);if(!F(h,c)){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,numberOfOutputs:h.numberOfOutputs};h=t(c,e)}return r.set(c,h),await n(o,c,h,l),h})(o,c,l)}}})($t,ut,Me),$t,Le,Ue,t=>({...t,channelCount:t.numberOfOutputs})),Wn=((t,e,n,r)=>(o,{offset:c,...l})=>{const h=o.createBuffer(1,2,44100),f=e(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),d=n(o,{...l,gain:c}),v=h.getChannelData(0);v[0]=1,v[1]=1,f.buffer=h,f.loop=!0;const m={get bufferSize(){},get channelCount(){return d.channelCount},set channelCount(t){d.channelCount=t},get channelCountMode(){return d.channelCountMode},set channelCountMode(t){d.channelCountMode=t},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(t){d.channelInterpretation=t},get context(){return d.context},get inputs(){return[]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get offset(){return d.gain},get onended(){return f.onended},set onended(t){f.onended=t},addEventListener:(...t)=>f.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>f.dispatchEvent(t[0]),removeEventListener:(...t)=>f.removeEventListener(t[0],t[1],t[2]),start(t=0){f.start.call(f,t)},stop(t=0){f.stop.call(f,t)}};return t(o,f),r(Zt(m,d),()=>f.connect(d),()=>f.disconnect(d))})(cn,fn,Jt,Dn),Vn=((t,e,n,r,o)=>(c,l)=>{if(void 0===c.createConstantSource)return n(c,l);const h=c.createConstantSource();return jt(h,l),qt(h,l,"offset"),e(r,()=>r(c))||Gt(h),e(o,()=>o(c))||Ht(h),t(c,h),h})(cn,Ee,Wn,fe,ve),Un=((t,e,n,r,o,c,l)=>class extends t{constructor(t,l){const h=o(t),f={...At,...l},d=r(h,f),v=c(h),m=v?n():null;super(t,!1,d,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=d,this._offset=e(this,v,d.offset,U,V),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?l(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){R(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),j(this)&&D(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ze,gn,((t,e,n,r,o)=>()=>{const c=new WeakMap;let l=null,h=null;return{set start(t){l=t},set stop(t){h=t},render(f,d,v){const m=c.get(d);return void 0!==m?Promise.resolve(m):(async(f,d,v)=>{let m=n(f);const y=F(m,d);if(!y){const t={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,offset:m.offset.value};m=e(d,t),null!==l&&m.start(l),null!==h&&m.stop(h)}return c.set(d,m),y?await t(d,f.offset,m.offset,v):await r(d,f.offset,m.offset,v),await o(f,d,m,v),m})(f,d,v)}}})(pn,Vn,ut,vn,Me),Vn,Le,Ue,ge),jn=((t,e)=>(n,r)=>{const o=n.createConvolver();if(jt(o,r),r.disableNormalization===o.normalize&&(o.normalize=!r.disableNormalization),Ut(o,r,"buffer"),r.channelCount>2)throw t();if(e(o,"channelCount",t=>()=>t.call(o),e=>n=>{if(n>2)throw t();return e.call(o,n)}),"max"===r.channelCountMode)throw t();return e(o,"channelCountMode",t=>()=>t.call(o),e=>n=>{if("max"===n)throw t();return e.call(o,n)}),o})(re,pe),zn=((t,e,n,r,o,c)=>class extends t{constructor(t,l){const h=r(t),f={...It,...l},d=n(h,f);super(t,!1,d,o(h)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=d,null!==f.buffer&&c(this,f.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,c(this,0)}else this._isBufferNullified=!1,c(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ze,((t,e,n)=>()=>{const r=new WeakMap;return{render(o,c,l){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(o,c,l)=>{let h=e(o);if(!F(h,c)){const e={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,disableNormalization:!h.normalize};h=t(c,e)}return r.set(c,h),et(h)?await n(o,c,h.inputs[0],l):await n(o,c,h,l),h})(o,c,l)}}})(jn,ut,Me),jn,Le,Ue,_n),qn=((t,e,n,r,o,c,l)=>class extends t{constructor(t,h){const f=o(t),d={...Rt,...h},v=r(f,d),m=c(f);super(t,!1,v,m?n(d.maxDelayTime):null),this._delayTime=e(this,m,v.delayTime),l(this,d.maxDelayTime)}get delayTime(){return this._delayTime}})(Ze,gn,((t,e,n,r,o)=>c=>{const l=new WeakMap;return{render(h,f,d){const v=l.get(f);return void 0!==v?Promise.resolve(v):(async(h,f,d)=>{let v=n(h);const m=F(v,f);if(!m){const t={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,delayTime:v.delayTime.value,maxDelayTime:c};v=e(f,t)}return l.set(f,v),m?await t(f,h.delayTime,v.delayTime,d):await r(f,h.delayTime,v.delayTime,d),await o(h,f,v,d),v})(h,f,d)}}})(pn,Qt,ut,vn,Me),Qt,Le,Ue,_n),Gn=(Hn=re,(t,e)=>{const n=t.createDynamicsCompressor();if(jt(n,e),e.channelCount>2)throw Hn();if("max"===e.channelCountMode)throw Hn();return qt(n,e,"attack"),qt(n,e,"knee"),qt(n,e,"ratio"),qt(n,e,"release"),qt(n,e,"threshold"),n});var Hn;const Xn=((t,e,n,r,o,c,l,h)=>class extends t{constructor(t,o){const f=c(t),d={...Dt,...o},v=r(f,d),m=l(f);super(t,!1,v,m?n():null),this._attack=e(this,m,v.attack),this._knee=e(this,m,v.knee),this._nativeDynamicsCompressorNode=v,this._ratio=e(this,m,v.ratio),this._release=e(this,m,v.release),this._threshold=e(this,m,v.threshold),h(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,o()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,o()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ze,gn,((t,e,n,r,o)=>()=>{const c=new WeakMap;return{render(l,h,f){const d=c.get(h);return void 0!==d?Promise.resolve(d):(async(l,h,f)=>{let d=n(l);const v=F(d,h);if(!v){const t={attack:d.attack.value,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,knee:d.knee.value,ratio:d.ratio.value,release:d.release.value,threshold:d.threshold.value};d=e(h,t)}return c.set(h,d),v?(await t(h,l.attack,d.attack,f),await t(h,l.knee,d.knee,f),await t(h,l.ratio,d.ratio,f),await t(h,l.release,d.release,f),await t(h,l.threshold,d.threshold,f)):(await r(h,l.attack,d.attack,f),await r(h,l.knee,d.knee,f),await r(h,l.ratio,d.ratio,f),await r(h,l.release,d.release,f),await r(h,l.threshold,d.threshold,f)),await o(l,h,d,f),d})(l,h,f)}}})(pn,Gn,ut,vn,Me),Gn,re,Le,Ue,_n),Kn=((t,e,n,r,o,c)=>class extends t{constructor(t,l){const h=o(t),f={...Mt,...l},d=r(h,f),v=c(h);super(t,!1,d,v?n():null),this._gain=e(this,v,d.gain,U,V)}get gain(){return this._gain}})(Ze,gn,((t,e,n,r,o)=>()=>{const c=new WeakMap;return{render(l,h,f){const d=c.get(h);return void 0!==d?Promise.resolve(d):(async(l,h,f)=>{let d=n(l);const v=F(d,h);if(!v){const t={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,gain:d.gain.value};d=e(h,t)}return c.set(h,d),v?await t(h,l.gain,d.gain,f):await r(h,l.gain,d.gain,f),await o(l,h,d,f),d})(l,h,f)}}})(pn,Jt,ut,vn,Me),Jt,Le,Ue),Yn=((t,e,n,r)=>(o,c,{channelCount:l,channelCountMode:h,channelInterpretation:f,feedback:d,feedforward:v})=>{const m=Xt(c,o.sampleRate),y=d instanceof Float64Array?d:new Float64Array(d),x=v instanceof Float64Array?v:new Float64Array(v),w=y.length,_=x.length,C=Math.min(w,_);if(0===w||w>20)throw r();if(0===y[0])throw e();if(0===_||_>20)throw r();if(0===x[0])throw e();if(1!==y[0]){for(let i=0;i<_;i+=1)x[i]/=y[0];for(let i=1;i<w;i+=1)y[i]/=y[0]}const E=n(o,m,l,l);E.channelCount=l,E.channelCountMode=h,E.channelInterpretation=f;const T=[],S=[],k=[];for(let i=0;i<l;i+=1){T.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),S.push(t),k.push(e)}E.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,r=e.numberOfChannels;for(let i=0;i<r;i+=1){const input=e.getChannelData(i),output=n.getChannelData(i);T[i]=Bt(y,w,x,_,C,S[i],k[i],T[i],32,input,output)}};const A=o.sampleRate/2;return Zt({get bufferSize(){return m},get channelCount(){return E.channelCount},set channelCount(t){E.channelCount=t},get channelCountMode(){return E.channelCountMode},set channelCountMode(t){E.channelCountMode=t},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(t){E.channelInterpretation=t},get context(){return E.context},get inputs(){return[E]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},addEventListener:(...t)=>E.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>E.dispatchEvent(t[0]),getFrequencyResponse(e,n,r){if(e.length!==n.length||n.length!==r.length)throw t();const o=e.length;for(let i=0;i<o;i+=1){const t=-Math.PI*(e[i]/A),o=[Math.cos(t),Math.sin(t)],c=te(ee(x,o),ee(y,o));n[i]=Math.sqrt(c[0]*c[0]+c[1]*c[1]),r[i]=Math.atan2(c[1],c[0])}},removeEventListener:(...t)=>E.removeEventListener(t[0],t[1],t[2])},E)})(Ft,Nt,ne,re),$n=((t,e,n,r)=>o=>t(Wt,()=>Wt(o))?Promise.resolve(t(r,r)).then(t=>{if(!t){const t=n(o,512,0,1);o.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>o.currentTime,t.connect(o.destination)}return o.startRendering()}):new Promise(t=>{const n=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(o.destination),o.startRendering()}))(Ee,Jt,ne,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(t=>{n.oncomplete=()=>{r.disconnect(),t(0!==n.currentTime)},n.startRendering()})})(Jt,Ve)),Zn=((t,e,n,r,o)=>(c,l)=>{const h=new WeakMap;let f=null;const d=async(d,v,m)=>{let y=null,x=e(d);const w=F(x,v);if(void 0===v.createIIRFilter?y=t(v,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):w||(x=v.createIIRFilter(l,c)),h.set(v,null===y?x:y),null!==y){if(null===f){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(d.context.destination.channelCount,d.context.length,v.sampleRate);f=(async()=>{await r(d,t,t.destination,m);return((t,e,n,r)=>{const o=n instanceof Float64Array?n:new Float64Array(n),c=r instanceof Float64Array?r:new Float64Array(r),l=o.length,h=c.length,f=Math.min(l,h);if(1!==o[0]){for(let i=0;i<l;i+=1)c[i]/=o[0];for(let i=1;i<h;i+=1)o[i]/=o[0]}const d=new Float32Array(32),v=new Float32Array(32),m=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),y=t.numberOfChannels;for(let i=0;i<y;i+=1){const input=t.getChannelData(i),output=m.getChannelData(i);d.fill(0),v.fill(0),Bt(o,l,c,h,f,d,v,0,32,input,output)}return m})(await o(t),v,c,l)})()}const t=await f;return y.buffer=t,y.start(0),y}return await r(d,v,x,m),x};return{render(t,e,n){const r=h.get(e);return void 0!==r?Promise.resolve(r):d(t,e,n)}}})(fn,ut,Ve,Me,$n);var Qn;const Jn=((t,e,n,r,o,c)=>class extends t{constructor(t,l){const h=r(t),f=o(h),d={...Pt,...l},v=e(h,f?null:t.baseLatency,d);super(t,!1,v,f?n(d.feedback,d.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,r,o)=>{if(n.length!==r.length||r.length!==o.length)throw Ft();return e.call(t,n,r,o)})})(v),this._nativeIIRFilterNode=v,c(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Ze,(Qn=Yn,(t,e,n)=>{if(void 0===t.createIIRFilter)return Qn(t,e,n);const r=t.createIIRFilter(n.feedforward,n.feedback);return jt(r,n),r}),Zn,Le,Ue,_n),er=((t,e,n,r,o)=>(c,l)=>{const h=l.listener,{forwardX:f,forwardY:d,forwardZ:v,positionX:m,positionY:y,positionZ:x,upX:w,upY:_,upZ:C}=void 0===h.forwardX?(()=>{const f=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(l),v=r(l,256,9,0),m=(input,e)=>{const r=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e});return r.connect(f,0,input),r.start(),Object.defineProperty(r.offset,"defaultValue",{get:()=>e}),t({context:c},d,r.offset,U,V)};let y=[0,0,-1,0,1,0],x=[0,0,0];return v.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some((t,e)=>t!==y[e])&&(h.setOrientation(...e),y=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some((t,e)=>t!==x[e])&&(h.setPosition(...n),x=n)},f.connect(v),{forwardX:m(0,0),forwardY:m(1,0),forwardZ:m(2,-1),positionX:m(6,0),positionY:m(7,0),positionZ:m(8,0),upX:m(3,0),upY:m(4,1),upZ:m(5,0)}})():h;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return v},get positionX(){return m},get positionY(){return y},get positionZ(){return x},get upX(){return w},get upY(){return _},get upZ(){return C}}})(gn,Pn,Vn,ne,Ue),nr=new WeakMap,rr=((t,e,n,r,o,c)=>class extends n{constructor(n,c){super(n),this._nativeContext=n,d.set(this,n),r(n)&&o.set(n,new Set),this._destination=new t(this,c),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?c(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(xn,er,qe,Ue,nr,ge),or=((t,e,n,r,o,c)=>(l,h)=>{const f=l.createOscillator();return jt(f,h),qt(f,h,"detune"),qt(f,h,"frequency"),void 0!==h.periodicWave?f.setPeriodicWave(h.periodicWave):Ut(f,h,"type"),e(n,()=>n(l))||Gt(f),e(r,()=>r(l))||c(f,l),e(o,()=>o(l))||Ht(f),t(l,f),f})(cn,Ee,fe,de,ve,me),ir=((t,e,n,r,o,c,l)=>class extends t{constructor(t,l){const h=o(t),f={...ie,...l},d=n(h,f),v=c(h),m=v?r():null,y=t.sampleRate/2;super(t,!1,d,m),this._detune=e(this,v,d.detune,153600,-153600),this._frequency=e(this,v,d.frequency,y,-y),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=m,null!==this._oscillatorNodeRenderer&&void 0!==f.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=f.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?l(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){R(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),j(this)&&D(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ze,gn,or,((t,e,n,r,o)=>()=>{const c=new WeakMap;let l=null,h=null,f=null;return{set periodicWave(t){l=t},set start(t){h=t},set stop(t){f=t},render(d,v,m){const y=c.get(v);return void 0!==y?Promise.resolve(y):(async(d,v,m)=>{let y=n(d);const x=F(y,v);if(!x){const t={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,detune:y.detune.value,frequency:y.frequency.value,periodicWave:null===l?void 0:l,type:y.type};y=e(v,t),null!==h&&y.start(h),null!==f&&y.stop(f)}return c.set(v,y),x?(await t(v,d.detune,y.detune,m),await t(v,d.frequency,y.frequency,m)):(await r(v,d.detune,y.detune,m),await r(v,d.frequency,y.frequency,m)),await o(d,v,y,m),y})(d,v,m)}}})(pn,or,ut,vn,Me),Le,Ue,ge),ar=(sr=fn,(t,e)=>{const n=sr(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=t.createBuffer(1,2,44100);return n.buffer=r,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}});var sr;const ur=((t,e,n,r,o)=>(c,{curve:l,oversample:h,...f})=>{const d=c.createWaveShaper(),v=c.createWaveShaper();jt(d,f),jt(v,f);const m=n(c,{...f,gain:1}),y=n(c,{...f,gain:-1}),x=n(c,{...f,gain:1}),w=n(c,{...f,gain:-1});let _=null,C=!1,E=null;const T={get bufferSize(){},get channelCount(){return d.channelCount},set channelCount(t){m.channelCount=t,y.channelCount=t,d.channelCount=t,x.channelCount=t,v.channelCount=t,w.channelCount=t},get channelCountMode(){return d.channelCountMode},set channelCountMode(t){m.channelCountMode=t,y.channelCountMode=t,d.channelCountMode=t,x.channelCountMode=t,v.channelCountMode=t,w.channelCountMode=t},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(t){m.channelInterpretation=t,y.channelInterpretation=t,d.channelInterpretation=t,x.channelInterpretation=t,v.channelInterpretation=t,w.channelInterpretation=t},get context(){return d.context},get curve(){return E},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)d.curve=n,v.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),r=new Float32Array(t+2-t%2);e[0]=n[0],r[0]=-n[t-1];const o=Math.ceil((t+1)/2),c=(t+1)/2-1;for(let i=1;i<o;i+=1){const l=i/o*c,h=Math.floor(l),f=Math.ceil(l);e[i]=h===f?n[h]:(1-(l-h))*n[h]+(1-(f-l))*n[f],r[i]=h===f?-n[t-1-h]:-(1-(l-h))*n[t-1-h]-(1-(f-l))*n[t-1-f]}e[o]=t%2==1?n[o-1]:(n[o-2]+n[o-1])/2,d.curve=e,v.curve=r}E=n,C&&(r(E)&&null===_?_=t(c,m):null!==_&&(_(),_=null))},get inputs(){return[m]},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get oversample(){return d.oversample},set oversample(t){d.oversample=t,v.oversample=t},addEventListener:(...t)=>m.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>m.dispatchEvent(t[0]),removeEventListener:(...t)=>m.removeEventListener(t[0],t[1],t[2])};null!==l&&(T.curve=l instanceof Float32Array?l:new Float32Array(l)),h!==T.oversample&&(T.oversample=h);return o(Zt(T,x),()=>{m.connect(d).connect(x),m.connect(y).connect(v).connect(w).connect(x),C=!0,r(E)&&(_=t(c,m))},()=>{m.disconnect(d),d.disconnect(x),m.disconnect(y),y.disconnect(v),v.disconnect(w),w.disconnect(x),C=!1,null!==_&&(_(),_=null)})})(ar,Nt,Jt,he,Dn),cr=((t,e,n,r,o,c,l)=>(h,f)=>{const d=h.createWaveShaper();if(null!==c&&"webkitAudioContext"===c.name)return n(h,f);jt(d,f);const v=null===f.curve||f.curve instanceof Float32Array?f.curve:new Float32Array(f.curve);if(null!==v&&v.length<2)throw e();Ut(d,{curve:v},"curve"),Ut(d,f,"oversample");let m=null,y=!1;l(d,"curve",t=>()=>t.call(d),e=>n=>(e.call(d,n),y&&(r(n)&&null===m?m=t(h,d):r(n)||null===m||(m(),m=null)),n));return o(d,()=>{y=!0,r(d.curve)&&(m=t(h,d))},()=>{y=!1,null!==m&&(m(),m=null)})})(ar,Nt,ur,he,Dn,He,pe),lr=((t,e,n,r,o,c,l,h,f)=>(d,{coneInnerAngle:v,coneOuterAngle:m,coneOuterGain:y,distanceModel:x,maxDistance:w,orientationX:_,orientationY:C,orientationZ:E,panningModel:T,positionX:S,positionY:k,positionZ:A,refDistance:I,rolloffFactor:R,...O})=>{const D=d.createPanner();if(O.channelCount>2)throw l();if("max"===O.channelCountMode)throw l();jt(D,O);const M={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},N=n(d,{...M,channelInterpretation:"speakers",numberOfInputs:6}),F=r(d,{...O,gain:1}),P=r(d,{...M,gain:1}),B=r(d,{...M,gain:0}),L=r(d,{...M,gain:0}),W=r(d,{...M,gain:0}),V=r(d,{...M,gain:0}),U=r(d,{...M,gain:0}),j=o(d,256,6,1),z=c(d,{...M,curve:new Float32Array([1,1]),oversample:"none"});let G=[_,C,E],H=[S,k,A];j.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some((t,e)=>t!==G[e])&&(D.setOrientation(...e),G=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some((t,e)=>t!==H[e])&&(D.setPosition(...n),H=n)},Object.defineProperty(B.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(U.gain,"defaultValue",{get:()=>0});const X={get bufferSize(){},get channelCount(){return D.channelCount},set channelCount(t){if(t>2)throw l();F.channelCount=t,D.channelCount=t},get channelCountMode(){return D.channelCountMode},set channelCountMode(t){if("max"===t)throw l();F.channelCountMode=t,D.channelCountMode=t},get channelInterpretation(){return D.channelInterpretation},set channelInterpretation(t){F.channelInterpretation=t,D.channelInterpretation=t},get coneInnerAngle(){return D.coneInnerAngle},set coneInnerAngle(t){D.coneInnerAngle=t},get coneOuterAngle(){return D.coneOuterAngle},set coneOuterAngle(t){D.coneOuterAngle=t},get coneOuterGain(){return D.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();D.coneOuterGain=t},get context(){return D.context},get distanceModel(){return D.distanceModel},set distanceModel(t){D.distanceModel=t},get inputs(){return[F]},get maxDistance(){return D.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;D.maxDistance=t},get numberOfInputs(){return D.numberOfInputs},get numberOfOutputs(){return D.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return B.gain},get orientationZ(){return L.gain},get panningModel(){return D.panningModel},set panningModel(t){D.panningModel=t},get positionX(){return W.gain},get positionY(){return V.gain},get positionZ(){return U.gain},get refDistance(){return D.refDistance},set refDistance(t){if(t<0)throw new RangeError;D.refDistance=t},get rolloffFactor(){return D.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;D.rolloffFactor=t},addEventListener:(...t)=>F.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>F.dispatchEvent(t[0]),removeEventListener:(...t)=>F.removeEventListener(t[0],t[1],t[2])};v!==X.coneInnerAngle&&(X.coneInnerAngle=v),m!==X.coneOuterAngle&&(X.coneOuterAngle=m),y!==X.coneOuterGain&&(X.coneOuterGain=y),x!==X.distanceModel&&(X.distanceModel=x),w!==X.maxDistance&&(X.maxDistance=w),_!==X.orientationX.value&&(X.orientationX.value=_),C!==X.orientationY.value&&(X.orientationY.value=C),E!==X.orientationZ.value&&(X.orientationZ.value=E),T!==X.panningModel&&(X.panningModel=T),S!==X.positionX.value&&(X.positionX.value=S),k!==X.positionY.value&&(X.positionY.value=k),A!==X.positionZ.value&&(X.positionZ.value=A),I!==X.refDistance&&(X.refDistance=I),R!==X.rolloffFactor&&(X.rolloffFactor=R),1===G[0]&&0===G[1]&&0===G[2]||D.setOrientation(...G),0===H[0]&&0===H[1]&&0===H[2]||D.setPosition(...H);return f(Zt(X,D),()=>{F.connect(D),t(F,z,0,0),z.connect(P).connect(N,0,0),z.connect(B).connect(N,0,1),z.connect(L).connect(N,0,2),z.connect(W).connect(N,0,3),z.connect(V).connect(N,0,4),z.connect(U).connect(N,0,5),N.connect(j).connect(d.destination)},()=>{F.disconnect(D),h(F,z,0,0),z.disconnect(P),P.disconnect(N),z.disconnect(B),B.disconnect(N),z.disconnect(L),L.disconnect(N),z.disconnect(W),W.disconnect(N),z.disconnect(V),V.disconnect(N),z.disconnect(U),U.disconnect(N),N.disconnect(j),j.disconnect(d.destination)})})(nt,Nt,Pn,Jt,ne,cr,re,st,Dn),pr=(fr=lr,(t,e)=>{const n=t.createPanner();return void 0===n.orientationX?fr(t,e):(jt(n,e),qt(n,e,"orientationX"),qt(n,e,"orientationY"),qt(n,e,"orientationZ"),qt(n,e,"positionX"),qt(n,e,"positionY"),qt(n,e,"positionZ"),Ut(n,e,"coneInnerAngle"),Ut(n,e,"coneOuterAngle"),Ut(n,e,"coneOuterGain"),Ut(n,e,"distanceModel"),Ut(n,e,"maxDistance"),Ut(n,e,"panningModel"),Ut(n,e,"refDistance"),Ut(n,e,"rolloffFactor"),n)});var fr;const dr=((t,e,n,r,o,c,l)=>class extends t{constructor(t,h){const f=o(t),d={...ae,...h},v=n(f,d),m=c(f);super(t,!1,v,m?r():null),this._nativePannerNode=v,this._orientationX=e(this,m,v.orientationX,U,V),this._orientationY=e(this,m,v.orientationY,U,V),this._orientationZ=e(this,m,v.orientationZ,U,V),this._positionX=e(this,m,v.positionX,U,V),this._positionY=e(this,m,v.positionY,U,V),this._positionZ=e(this,m,v.positionZ,U,V),l(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ze,gn,pr,((t,e,n,r,o,c,l,h,f,d)=>()=>{const v=new WeakMap;let m=null;return{render(y,x,w){const _=v.get(x);return void 0!==_?Promise.resolve(_):(async(y,x,w)=>{let _=null,C=c(y);const E={channelCount:C.channelCount,channelCountMode:C.channelCountMode,channelInterpretation:C.channelInterpretation},T={...E,coneInnerAngle:C.coneInnerAngle,coneOuterAngle:C.coneOuterAngle,coneOuterGain:C.coneOuterGain,distanceModel:C.distanceModel,maxDistance:C.maxDistance,panningModel:C.panningModel,refDistance:C.refDistance,rolloffFactor:C.rolloffFactor},S=F(C,x);if("bufferSize"in C)_=r(x,{...E,gain:1});else if(!S){const t={...T,orientationX:C.orientationX.value,orientationY:C.orientationY.value,orientationZ:C.orientationZ.value,positionX:C.positionX.value,positionY:C.positionY.value,positionZ:C.positionZ.value};C=o(x,t)}if(v.set(x,null===_?C:_),null!==_){if(null===m){if(null===l)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new l(6,y.context.length,x.sampleRate),r=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});r.connect(t.destination),m=(async()=>{const e=await Promise.all([y.orientationX,y.orientationY,y.orientationZ,y.positionX,y.positionY,y.positionZ].map(async(e,r)=>{const o=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0});return await h(t,e,o.offset,w),o}));for(let i=0;i<6;i+=1)e[i].connect(r,0,i),e[i].start(0);return d(t)})()}const t=await m,c=r(x,{...E,gain:1});await f(y,x,c,w);const v=[];for(let i=0;i<t.numberOfChannels;i+=1)v.push(t.getChannelData(i));let C=[v[0][0],v[1][0],v[2][0]],S=[v[3][0],v[4][0],v[5][0]],k=r(x,{...E,gain:1}),A=o(x,{...T,orientationX:C[0],orientationY:C[1],orientationZ:C[2],positionX:S[0],positionY:S[1],positionZ:S[2]});c.connect(k).connect(A.inputs[0]),A.connect(_);for(let i=128;i<t.length;i+=128){const t=[v[0][i],v[1][i],v[2][i]],e=[v[3][i],v[4][i],v[5][i]];if(t.some((t,e)=>t!==C[e])||e.some((t,e)=>t!==S[e])){C=t,S=e;const n=i/x.sampleRate;k.gain.setValueAtTime(0,n),k=r(x,{...E,gain:0}),A=o(x,{...T,orientationX:C[0],orientationY:C[1],orientationZ:C[2],positionX:S[0],positionY:S[1],positionZ:S[2]}),k.gain.setValueAtTime(1,n),c.connect(k).connect(A.inputs[0]),A.connect(_)}}return _}return S?(await t(x,y.orientationX,C.orientationX,w),await t(x,y.orientationY,C.orientationY,w),await t(x,y.orientationZ,C.orientationZ,w),await t(x,y.positionX,C.positionX,w),await t(x,y.positionY,C.positionY,w),await t(x,y.positionZ,C.positionZ,w)):(await h(x,y.orientationX,C.orientationX,w),await h(x,y.orientationY,C.orientationY,w),await h(x,y.orientationZ,C.orientationZ,w),await h(x,y.positionX,C.positionX,w),await h(x,y.positionY,C.positionY,w),await h(x,y.positionZ,C.positionZ,w)),et(C)?await f(y,x,C.inputs[0],w):await f(y,x,C,w),C})(y,x,w)}}})(pn,Pn,Vn,Jt,pr,ut,Ve,vn,Me,$n),Le,Ue,_n),vr=((t,e,n,r)=>class o{constructor(o,c){const l=e(o),h=r({...se,...c}),f=t(l,h);return n.add(f),f}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===o.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:r,real:o})=>{const c=r instanceof Float32Array?r:new Float32Array(r),l=o instanceof Float32Array?o:new Float32Array(o),h=e.createPeriodicWave(l,c,{disableNormalization:n});if(Array.from(r).length<2)throw t();return h})(B),Le,new WeakSet,t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}}),mr=((t,e)=>(n,r)=>{const o=r.channelCountMode;if("clamped-max"===o)throw e();if(void 0===n.createStereoPanner)return t(n,r);const c=n.createStereoPanner();return jt(c,r),qt(c,r,"pan"),Object.defineProperty(c,"channelCountMode",{get:()=>o,set:t=>{if(t!==o)throw e()}}),c})(((t,e,n,r,o,c)=>{const l=new Float32Array([1,1]),h=Math.PI/2,f={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...f,oversample:"none"},v=(t,c,v,m,y)=>{if(1===c)return((t,e,o,c)=>{const v=new Float32Array(16385),m=new Float32Array(16385);for(let i=0;i<16385;i+=1){const t=i/16384*h;v[i]=Math.cos(t),m[i]=Math.sin(t)}const y=n(t,{...f,gain:0}),x=r(t,{...d,curve:v}),w=r(t,{...d,curve:l}),_=n(t,{...f,gain:0}),C=r(t,{...d,curve:m});return{connectGraph(){e.connect(y),e.connect(w.inputs[0]),e.connect(_),w.connect(o),o.connect(x.inputs[0]),o.connect(C.inputs[0]),x.connect(y.gain),C.connect(_.gain),y.connect(c,0,0),_.connect(c,0,1)},disconnectGraph(){e.disconnect(y),e.disconnect(w.inputs[0]),e.disconnect(_),w.disconnect(o),o.disconnect(x.inputs[0]),o.disconnect(C.inputs[0]),x.disconnect(y.gain),C.disconnect(_.gain),y.disconnect(c,0,0),_.disconnect(c,0,1)}}})(t,v,m,y);if(2===c)return((t,o,c,v)=>{const m=new Float32Array(16385),y=new Float32Array(16385),x=new Float32Array(16385),w=new Float32Array(16385),_=Math.floor(8192.5);for(let i=0;i<16385;i+=1)if(i>_){const t=(i-_)/(16384-_)*h;m[i]=Math.cos(t),y[i]=Math.sin(t),x[i]=0,w[i]=1}else{const t=i/(16384-_)*h;m[i]=1,y[i]=0,x[i]=Math.cos(t),w[i]=Math.sin(t)}const C=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),E=n(t,{...f,gain:0}),T=r(t,{...d,curve:m}),S=n(t,{...f,gain:0}),k=r(t,{...d,curve:y}),A=r(t,{...d,curve:l}),I=n(t,{...f,gain:0}),R=r(t,{...d,curve:x}),O=n(t,{...f,gain:0}),D=r(t,{...d,curve:w});return{connectGraph(){o.connect(C),o.connect(A.inputs[0]),C.connect(E,0),C.connect(S,0),C.connect(I,1),C.connect(O,1),A.connect(c),c.connect(T.inputs[0]),c.connect(k.inputs[0]),c.connect(R.inputs[0]),c.connect(D.inputs[0]),T.connect(E.gain),k.connect(S.gain),R.connect(I.gain),D.connect(O.gain),E.connect(v,0,0),I.connect(v,0,0),S.connect(v,0,1),O.connect(v,0,1)},disconnectGraph(){o.disconnect(C),o.disconnect(A.inputs[0]),C.disconnect(E,0),C.disconnect(S,0),C.disconnect(I,1),C.disconnect(O,1),A.disconnect(c),c.disconnect(T.inputs[0]),c.disconnect(k.inputs[0]),c.disconnect(R.inputs[0]),c.disconnect(D.inputs[0]),T.disconnect(E.gain),k.disconnect(S.gain),R.disconnect(I.gain),D.disconnect(O.gain),E.disconnect(v,0,0),I.disconnect(v,0,0),S.disconnect(v,0,1),O.disconnect(v,0,1)}}})(t,v,m,y);throw o()};return(e,{channelCount:r,channelCountMode:l,pan:h,...f})=>{if("max"===l)throw o();const d=t(e,{...f,channelCount:1,channelCountMode:l,numberOfInputs:2}),m=n(e,{...f,channelCount:r,channelCountMode:l,gain:1}),y=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:h});let{connectGraph:x,disconnectGraph:w}=v(e,r,m,y,d);Object.defineProperty(y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(y.gain,"minValue",{get:()=>-1});const _={get bufferSize(){},get channelCount(){return m.channelCount},set channelCount(t){m.channelCount!==t&&(C&&w(),({connectGraph:x,disconnectGraph:w}=v(e,t,m,y,d)),C&&x()),m.channelCount=t},get channelCountMode(){return m.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw o();m.channelCountMode=t},get channelInterpretation(){return m.channelInterpretation},set channelInterpretation(t){m.channelInterpretation=t},get context(){return m.context},get inputs(){return[m]},get numberOfInputs(){return m.numberOfInputs},get numberOfOutputs(){return m.numberOfOutputs},get pan(){return y.gain},addEventListener:(...t)=>m.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>m.dispatchEvent(t[0]),removeEventListener:(...t)=>m.removeEventListener(t[0],t[1],t[2])};let C=!1;return c(Zt(_,d),()=>{x(),C=!0},()=>{w(),C=!1})}})(Pn,$t,Jt,cr,re,Dn),re),gr=((t,e,n,r,o,c)=>class extends t{constructor(t,l){const h=o(t),f={...ue,...l},d=n(h,f),v=c(h);super(t,!1,d,v?r():null),this._pan=e(this,v,d.pan)}get pan(){return this._pan}})(Ze,gn,mr,((t,e,n,r,o)=>()=>{const c=new WeakMap;return{render(l,h,f){const d=c.get(h);return void 0!==d?Promise.resolve(d):(async(l,h,f)=>{let d=n(l);const v=F(d,h);if(!v){const t={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,pan:d.pan.value};d=e(h,t)}return c.set(h,d),v?await t(h,l.pan,d.pan,f):await r(h,l.pan,d.pan,f),et(d)?await o(l,h,d.inputs[0],f):await o(l,h,d,f),d})(l,h,f)}}})(pn,mr,ut,vn,Me),Le,Ue),yr=((t,e,n)=>()=>{const r=new WeakMap;return{render(o,c,l){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(o,c,l)=>{let h=e(o);if(!F(h,c)){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,curve:h.curve,oversample:h.oversample};h=t(c,e)}return r.set(c,h),et(h)?await n(o,c,h.inputs[0],l):await n(o,c,h,l),h})(o,c,l)}}})(cr,ut,Me),xr=((t,e,n,r,o,c,l)=>class extends t{constructor(t,e){const h=o(t),f={...le,...e},d=n(h,f);super(t,!0,d,c(h)?r():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,l(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ze,Nt,cr,yr,Le,Ue,_n),wr=(t=>null!==t&&t.isSecureContext)(ke),_r=(t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return r()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ke),Cr=new WeakMap,Er=((t,e)=>n=>{let r=t.get(n);if(void 0!==r)return r;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,8e3),t.set(n,r),r})(Cr,Ve),Tr=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ke),Sr=wr?((t,e,n,r,o,c,l,h,f,d,v,m)=>(x,w,_={credentials:"omit"})=>{const S=c(x),k=new URL(w,m.location.href).toString();if(void 0!==S.audioWorklet)return Promise.all([o(w),Promise.resolve(t(v,v))]).then(([source,t])=>{const[e,n]=C(source,k),r=t?n:n.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),o=new Blob([`${e};(registerProcessor=>{${r}\n})((n,p)=>registerProcessor(n,class extends p{${t?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${t?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),c=URL.createObjectURL(o);return S.audioWorklet.addModule(c,_).then(()=>{if(h(S))return;return l(S).audioWorklet.addModule(c,_)}).finally(()=>URL.revokeObjectURL(c))});const A=d.get(x);if(void 0!==A&&A.has(w))return Promise.resolve();const I=f.get(x);if(void 0!==I){const t=I.get(w);if(void 0!==t)return t}const R=o(w).then(source=>{const[t,e]=C(source,k);return n(`${t};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${e}\n})})(window,'_AWGS')`)}).then(()=>{const t=m._AWGS.pop();if(void 0===t)throw new SyntaxError;r(S.currentTime,S.sampleRate,()=>t(class{},void 0,(t,n)=>{if(""===t.trim())throw e();const r=y.get(S);if(void 0!==r){if(r.has(t))throw e();T(n),E(n.parameterDescriptors),r.set(t,n)}else T(n),E(n.parameterDescriptors),y.set(S,new Map([[t,n]]))},S.sampleRate,void 0,void 0))});return void 0===I?f.set(x,new Map([[w,R]])):I.set(w,R),R.then(()=>{const t=d.get(x);void 0===t?d.set(x,new Set([w])):t.add(w)}).finally(()=>{const t=f.get(x);void 0!==t&&t.delete(w)}),R})(Ee,re,(t=>source=>new Promise((e,n)=>{if(null===t)return void n(new SyntaxError);const head=t.document.head;if(null===head)n(new SyntaxError);else{const script=t.document.createElement("script"),r=new Blob([source],{type:"application/javascript"}),o=URL.createObjectURL(r),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(o)};t.onerror=(e,r,h,f,d)=>r===o||r===t.location.href&&1===h&&1===f?(l(),n(d),!1):null!==c?c(e,r,h,f,d):void 0,script.onerror=()=>{l(),n(new SyntaxError)},script.onload=()=>{l(),e()},script.src=o,script.type="module",head.appendChild(script)}}))(ke),_r,(t=>async e=>{try{const t=await fetch(e);if(t.ok)return t.text()}catch{}throw t()})(()=>new DOMException("","AbortError")),Le,Er,Ue,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,8e3),o=URL.createObjectURL(n);let c=!1,l=!1;try{await r.audioWorklet.addModule(o);const e=new t(r,"a",{numberOfOutputs:0}),n=r.createOscillator();e.port.onmessage=()=>c=!0,e.onprocessorerror=()=>l=!0,n.connect(e),await r.startRendering()}catch{}finally{URL.revokeObjectURL(o)}return c&&!l})(Tr,Ve),ke):void 0,kr=((t,e)=>n=>t(n)||e(n))(Xe,Ue),Ar=((t,e,n,r,o,c,l,h,f,d,v,m,y,x,w,_,C,E,T,S)=>class extends w{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new o(this)}createBuffer(t,e,r){return new n({length:e,numberOfChannels:t,sampleRate:r})}createBufferSource(){return new r(this)}createChannelMerger(t=6){return new c(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new l(this,{numberOfOutputs:t})}createConstantSource(){return new h(this)}createConvolver(){return new f(this)}createDelay(t=1){return new v(this,{maxDelayTime:t})}createDynamicsCompressor(){return new m(this)}createGain(){return new y(this)}createIIRFilter(t,e){return new x(this,{feedback:e,feedforward:t})}createOscillator(){return new _(this)}createPanner(){return new C(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new E(this,{...n,imag:e,real:t})}createStereoPanner(){return new T(this)}createWaveShaper(){return new S(this)}decodeAudioData(t,e,n){return d(this._nativeContext,t).then(t=>("function"==typeof e&&e(t),t)).catch(t=>{throw"function"==typeof n&&n(t),t})}})(Sr,Je,sn,bn,Cn,Bn,Ln,Un,zn,((t,e,n,r,o,c,l,h,f,d,v)=>(m,y)=>{const x=l(m)?m:c(m);if(o.has(y)){const t=n();return Promise.reject(t)}try{o.add(y)}catch{}return e(f,()=>f(x))?x.decodeAudioData(y).then(n=>(e(h,()=>h(n))||v(n),t.add(n),n)):new Promise((e,n)=>{const o=()=>{try{(t=>{const{port1:e}=new MessageChannel;e.postMessage(t,[t])})(y)}catch{}},c=t=>{n(t),o()};try{x.decodeAudioData(y,n=>{"function"!=typeof n.copyFromChannel&&(d(n),L(n)),t.add(n),o(),e(n)},t=>{c(null===t?r():t)})}catch(t){c(t)}})})(tn,Ee,()=>new DOMException("","DataCloneError"),()=>new DOMException("","EncodingError"),new WeakSet,Le,kr,P,Wt,on,an),qn,Xn,Kn,Jn,rr,ir,dr,vr,gr,xr),Ir=((t,e,n,r)=>class extends t{constructor(t,o){const c=n(t),l=e(c,o);if(r(c))throw TypeError();super(t,!0,l,null),this._nativeMediaElementAudioSourceNode=l}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ze,(t,e)=>t.createMediaElementSource(e.mediaElement),Le,Ue),Rr=((t,e,n,r)=>class extends t{constructor(t,o){const c=n(t);if(r(c))throw new TypeError;const l={...Lt,...o},h=e(c,l);super(t,!1,h,null),this._nativeMediaStreamAudioDestinationNode=h}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ze,(t,e)=>{const n=t.createMediaStreamDestination();return jt(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},Le,Ue),Or=((t,e,n,r)=>class extends t{constructor(t,o){const c=n(t),l=e(c,o);if(r(c))throw new TypeError;super(t,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ze,(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((a,b)=>a.id<b.id?-1:a.id>b.id?1:0);const r=n.slice(0,1),o=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(o,"mediaStream",{value:e}),o},Le,Ue),Dr=((t,e,n)=>class extends t{constructor(t,r){const o=n(t);super(t,!0,e(o,r),null)}})(Ze,((t,e)=>(n,{mediaStreamTrack:r})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(r);const o=new MediaStream([r]),c=n.createMediaStreamSource(o);if("audio"!==r.kind)throw t();if(e(n))throw new TypeError;return c})(Nt,Ue),Le),Mr=((t,e,n,r,o,c,l,h,f)=>class extends t{constructor(t={}){if(null===f)throw new Error("Missing the native AudioContext constructor.");const e=new f(t);if(null===e)throw r();if(!Y(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:o}=t,{sampleRate:c}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===o?512/c:"interactive"===o||void 0===o?256/c:"playback"===o?1024/c:128*Math.max(2,Math.min(128,Math.round(o*c/128)))/c,this._nativeAudioContext=e,"webkitAudioContext"===f.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw e()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),K(this)}))}createMediaElementSource(t){return new o(this,{mediaElement:t})}createMediaStreamDestination(){return new c(this)}createMediaStreamSource(t){return new l(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new h(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(t=>{if(void 0===t||15===t.code)throw e();throw t})}suspend(){return this._nativeAudioContext.suspend().catch(t=>{if(void 0===t)throw e();throw t})}})(Ar,Nt,re,ce,Ir,Rr,Or,Dr,He),Nr=(Fr=nr,t=>{const e=Fr.get(t);if(void 0===e)throw new Error("The context has no set of AudioWorkletNodes.");return e});var Fr;const Pr=(Br=Nr,(t,e)=>{Br(t).add(e)});var Br;const Lr=(t=>(e,n,output=0,input=0)=>{const r=e[output];if(void 0===r)throw t();return vt(n)?r.connect(n,0,input):r.connect(n,0)})(B),Wr=(t=>(e,n)=>{t(e).delete(n)})(Nr),Vr=(t=>(e,n,output,input=0)=>void 0===n?e.forEach(t=>t.disconnect()):"number"==typeof n?Ot(t,e,n).disconnect():vt(n)?void 0===output?e.forEach(t=>t.disconnect(n)):void 0===input?Ot(t,e,output).disconnect(n,0):Ot(t,e,output).disconnect(n,0,input):void 0===output?e.forEach(t=>t.disconnect(n)):Ot(t,e,output).disconnect(n,0))(B),Ur=new WeakMap,jr=((t,e)=>n=>e(t,n))(Ur,S),zr=((t,e,n,r,o,c,l,h,f,d,v,m,y)=>(w,_,C,E)=>{if(0===E.numberOfInputs&&0===E.numberOfOutputs)throw f();const T=Array.isArray(E.outputChannelCount)?E.outputChannelCount:Array.from(E.outputChannelCount);if(T.some(t=>t<1))throw f();if(T.length!==E.numberOfOutputs)throw e();if("explicit"!==E.channelCountMode)throw f();const S=E.channelCount*E.numberOfInputs,k=T.reduce((t,e)=>t+e,0),A=void 0===C.parameterDescriptors?0:C.parameterDescriptors.length;if(S+A>6||k>6)throw f();const I=new MessageChannel,R=[],O=[];for(let i=0;i<E.numberOfInputs;i+=1)R.push(l(w,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1})),O.push(o(w,{channelCount:E.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:E.channelCount}));const D=[];if(void 0!==C.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:r}of C.parameterDescriptors){const o=c(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==E.parameterData[r]?E.parameterData[r]:void 0===t?0:t});Object.defineProperties(o.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?U:e},minValue:{get:()=>void 0===n?V:n}}),D.push(o)}const M=r(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+A)}),N=Xt(_,w.sampleRate),F=h(w,N,S+A,Math.max(1,k)),P=o(w,{channelCount:Math.max(1,k),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,k)}),B=[];for(let i=0;i<E.numberOfOutputs;i+=1)B.push(r(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:T[i]}));for(let i=0;i<E.numberOfInputs;i+=1){R[i].connect(O[i]);for(let t=0;t<E.channelCount;t+=1)O[i].connect(M,t,i*E.channelCount+t)}const L=new bt(void 0===C.parameterDescriptors?[]:C.parameterDescriptors.map(({name:t},e)=>{const n=D[e];return n.connect(M,0,S+e),n.start(0),[t,n.offset]}));M.connect(F);let W=E.channelInterpretation,j=null;const z=0===E.numberOfOutputs?[F]:B,G={get bufferSize(){return N},get channelCount(){return E.channelCount},set channelCount(t){throw n()},get channelCountMode(){return E.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return W},set channelInterpretation(t){for(const e of R)e.channelInterpretation=t;W=t},get context(){return F.context},get inputs(){return R},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get onprocessorerror(){return j},set onprocessorerror(t){"function"==typeof j&&G.removeEventListener("processorerror",j),j="function"==typeof t?t:null,"function"==typeof j&&G.addEventListener("processorerror",j)},get parameters(){return L},get port(){return I.port2},addEventListener:(...t)=>F.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,z),disconnect:d.bind(null,z),dispatchEvent:(...t)=>F.dispatchEvent(t[0]),removeEventListener:(...t)=>F.removeEventListener(t[0],t[1],t[2])},H=new Map;var X,K;I.port1.addEventListener=(X=I.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=H.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{v(w.currentTime,w.sampleRate,()=>e(t))},H.set(e,t[1]))}}return X.call(I.port1,t[0],t[1],t[2])}),I.port1.removeEventListener=(K=I.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=H.get(t[1]);void 0!==e&&(H.delete(t[1]),t[1]=e)}return K.call(I.port1,t[0],t[1],t[2])});let Y=null;Object.defineProperty(I.port1,"onmessage",{get:()=>Y,set:t=>{"function"==typeof Y&&I.port1.removeEventListener("message",Y),Y="function"==typeof t?t:null,"function"==typeof Y&&(I.port1.addEventListener("message",Y),I.port1.start())}}),C.prototype.port=I.port1;let $=null;((t,e,n,r)=>{let o=x.get(t);void 0===o&&(o=new WeakMap,x.set(t,o));const c=Kt(n,r);return o.set(e,c),c})(w,G,C,E).then(t=>$=t);const Z=Ct(E.numberOfInputs,E.channelCount),Q=Ct(E.numberOfOutputs,T),J=void 0===C.parameterDescriptors?[]:C.parameterDescriptors.reduce((t,{name:e})=>({...t,[e]:new Float32Array(128)}),{});let tt=!0;const et=()=>{E.numberOfOutputs>0&&F.disconnect(P);for(let i=0,t=0;i<E.numberOfOutputs;i+=1){const e=B[i];for(let n=0;n<T[i];n+=1)P.disconnect(e,t+n,n);t+=T[i]}},nt=new Map;F.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==$){const n=m(G);for(let i=0;i<N;i+=128){for(let e=0;e<E.numberOfInputs;e+=1)for(let n=0;n<E.channelCount;n+=1)wt(t,Z[e],n,n,i);void 0!==C.parameterDescriptors&&C.parameterDescriptors.forEach(({name:e},n)=>{wt(t,J,e,S+n,i)});for(let t=0;t<E.numberOfInputs;t+=1)for(let e=0;e<T[t];e+=1)0===Q[t][e].byteLength&&(Q[t][e]=new Float32Array(128));try{const t=Z.map((input,t)=>{if(n[t].size>0)return nt.set(t,N/128),input;const e=nt.get(t);return void 0===e?[]:(input.every(t=>t.every(t=>0===t))&&(1===e?nt.delete(t):nt.set(t,e-1)),input)}),r=v(w.currentTime+i/w.sampleRate,w.sampleRate,()=>$.process(t,Q,J));tt=r;for(let t=0,n=0;t<E.numberOfOutputs;t+=1){for(let r=0;r<T[t];r+=1)_t(e,Q[t],r,n+r,i);n+=T[t]}}catch(t){tt=!1,G.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!tt){for(let t=0;t<E.numberOfInputs;t+=1){R[t].disconnect(O[t]);for(let e=0;e<E.channelCount;e+=1)O[i].disconnect(M,e,t*E.channelCount+e)}if(void 0!==C.parameterDescriptors){const t=C.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=D[e];t.disconnect(M,0,S+e),t.stop()}}M.disconnect(F),F.onaudioprocess=null,ot?et():st();break}}}};let ot=!1;const it=l(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),at=()=>F.connect(it).connect(w.destination),st=()=>{F.disconnect(it),it.disconnect()};return at(),y(G,()=>{if(tt){st(),E.numberOfOutputs>0&&F.connect(P);for(let i=0,t=0;i<E.numberOfOutputs;i+=1){const e=B[i];for(let n=0;n<T[i];n+=1)P.connect(e,t+n,n);t+=T[i]}}ot=!0},()=>{tt&&(at(),et()),ot=!1})})(Lr,B,Nt,Pn,$t,Vn,Jt,ne,re,Vr,_r,jr,Dn),qr=((t,e,n,r,o)=>(c,l,h,f,d,v)=>{if(null!==h)try{const e=new h(c,f,v),r=new Map;let l=null;if(Object.defineProperties(e,{channelCount:{get:()=>v.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>l,set:t=>{"function"==typeof l&&e.removeEventListener("processorerror",l),l="function"==typeof t?t:null,"function"==typeof l&&e.addEventListener("processorerror",l)}}}),e.addEventListener=(y=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=r.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},r.set(e,t[1]))}}return y.call(e,"error",t[1],t[2]),y.call(e,...t)}),e.removeEventListener=(m=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=r.get(t[1]);void 0!==e&&(r.delete(t[1]),t[1]=e)}return m.call(e,"error",t[1],t[2]),m.call(e,t[0],t[1],t[2])}),0!==v.numberOfOutputs){const t=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(c.destination);return o(e,()=>t.disconnect(),()=>t.connect(c.destination))}return e}catch(t){if(11===t.code)throw r();throw t}var m,y;if(void 0===d)throw r();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(v),e(c,l,d,v)})(Nt,zr,Jt,re,Dn),Gr=((t,e,n,r,o,c,l,h,f,d,v,m,y,x,w,_)=>(C,E,T)=>{const S=new WeakMap;let k=null;return{render(A,I,R){h(I,A);const O=S.get(I);return void 0!==O?Promise.resolve(O):(async(h,A,I)=>{let R=v(h),O=null;const D=F(R,A),M=Array.isArray(E.outputChannelCount)?E.outputChannelCount:Array.from(E.outputChannelCount);if(null===m){const t=M.reduce((t,e)=>t+e,0),n=o(A,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),c=[];for(let i=0;i<h.numberOfOutputs;i+=1)c.push(r(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:M[i]}));const d=l(A,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1});d.connect=e.bind(null,c),d.disconnect=f.bind(null,c),O=[n,c,d]}else D||(R=new m(A,C));if(S.set(A,null===O?R:O[2]),null!==O){if(null===k){if(void 0===T)throw new Error("Missing the processor constructor.");if(null===y)throw new Error("Missing the native OfflineAudioContext constructor.");const t=h.channelCount*h.numberOfInputs,e=void 0===T.parameterDescriptors?0:T.parameterDescriptors.length,n=t+e,f=async()=>{const f=new y(n,128*Math.ceil(h.context.length/128),A.sampleRate),d=[],v=[];for(let i=0;i<E.numberOfInputs;i+=1)d.push(l(f,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1})),v.push(o(f,{channelCount:E.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:E.channelCount}));const m=await Promise.all(Array.from(h.parameters.values()).map(async t=>{const e=c(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await x(f,t,e.offset,I),e})),C=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let i=0;i<E.numberOfInputs;i+=1){d[i].connect(v[i]);for(let t=0;t<E.channelCount;t+=1)v[i].connect(C,t,i*E.channelCount+t)}for(const[e,n]of m.entries())n.connect(C,0,t+e),n.start(0);return C.connect(f.destination),await Promise.all(d.map(t=>w(h,f,t,I))),_(f)};k=Et(h,0===n?null:await f(),A,E,M,T,d)}const t=await k,e=n(A,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[f,v,m]=O;null!==t&&(e.buffer=t,e.start(0)),e.connect(f);for(let i=0,t=0;i<h.numberOfOutputs;i+=1){const e=v[i];for(let n=0;n<M[i];n+=1)f.connect(e,t+n,n);t+=M[i]}return m}if(D)for(const[e,n]of h.parameters.entries())await t(A,n,R.parameters.get(e),I);else for(const[t,e]of h.parameters.entries())await x(A,e,R.parameters.get(t),I);return await w(h,A,R,I),R})(A,I,R)}}})(pn,Lr,fn,Pn,$t,Vn,Jt,Wr,Vr,_r,ut,Tr,Ve,vn,Me,$n),Hr=(t=>e=>t.get(e))(Cr),Xr=(t=>(e,n)=>{t.set(e,n)})(Ur),Kr=wr?((t,e,n,r,o,c,l,h,f,d,v,m,x)=>class extends e{constructor(e,x,w){var _;const C=h(e),E=f(C),T=v({...xt,...w}),S=y.get(C),k=null==S?void 0:S.get(x),A=E||"closed"!==C.state?C:null!==(_=l(C))&&void 0!==_?_:C,I=o(A,E?null:e.baseLatency,d,x,k,T);super(e,!0,I,E?r(x,T,k):null);const R=[];I.parameters.forEach((t,e)=>{const r=n(this,E,t);R.push([e,r])}),this._nativeAudioWorkletNode=I,this._onprocessorerror=null,this._parameters=new bt(R),E&&t(C,this);const{activeInputs:O}=c(this);m(I,O)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?x(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Pr,Ze,gn,Gr,qr,G,Hr,Le,Ue,Tr,t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),Xr,ge):void 0,Yr=(((t,e,n,r,o)=>{})(Nt,re,ce,rr,He),((t,e)=>(n,r,o)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,o)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(re,Ve)),$r=((t,e,n,r,o,c,l,h)=>{const f=[];return(d,v)=>n(d).render(d,v,f).then(()=>Promise.all(Array.from(r(v)).map(t=>n(t).render(t,v,f)))).then(()=>o(v)).then(n=>("function"!=typeof n.copyFromChannel?(l(n),L(n)):e(c,()=>c(n))||h(n),t.add(n),n))})(tn,Ee,Oe,Nr,$n,P,on,an),Zr=(((t,e,n,r,o)=>{})(Ee,Nt,Yr,rr,$r),((t,e,n,r,o)=>class extends t{constructor(a,b,t){let n;if("number"==typeof a&&void 0!==b&&void 0!==t)n={length:b,numberOfChannels:a,sampleRate:t};else{if("object"!=typeof a)throw new Error("The given parameters are not valid.");n=a}const{length:o,numberOfChannels:c,sampleRate:l}={...oe,...n},h=r(c,o,l);e(Wt,()=>Wt(h))||h.addEventListener("statechange",(()=>{let i=0;const t=e=>{"running"===this._state&&(i>0?(h.removeEventListener("statechange",t),e.stopImmediatePropagation(),this._waitForThePromiseToSettle(e)):i+=1)};return t})()),super(h,c),this._length=o,this._nativeOfflineAudioContext=h,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,K(this)}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}})(Ar,Ee,Nt,Yr,$r)),Qr=((t,e)=>n=>{const r=t.get(n);return e(r)||e(n)})(d,Xe),Jr=(to=l,eo=Ye,t=>to.has(t)||eo(t));var to,eo;const no=(ro=f,oo=$e,t=>ro.has(t)||oo(t));var ro,oo;const io=((t,e)=>n=>{const r=t.get(n);return e(r)||e(n)})(d,Ue);function ao(t,e){if(!t)throw new Error(e)}function so(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function uo(t){t.isOffline||"running"===t.state||lo('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let co=console;function lo(...t){co.warn(...t)}function ho(t){return void 0===t}function po(t){return!ho(t)}function fo(t){return"number"==typeof t}function vo(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function mo(t){return"boolean"==typeof t}function go(t){return Array.isArray(t)}function yo(t){return"string"==typeof t}function bo(t){return yo(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const xo="object"==typeof self?self:null,wo=xo&&(xo.hasOwnProperty("AudioContext")||xo.hasOwnProperty("webkitAudioContext"));function _o(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c}function Co(t,e,n,r){return new(n||(n=Promise))((function(o,c){function l(t){try{f(r.next(t))}catch(t){c(t)}}function h(t){try{f(r.throw(t))}catch(t){c(t)}}function f(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,h)}f((r=r.apply(t,e||[])).next())}))}Object.create;Object.create;class Eo{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function To(t){return no(t)}function So(t){return Jr(t)}function ko(t){return io(t)}function Ao(t){return Qr(t)}function Io(t){return t instanceof AudioBuffer}function Ro(t,e){return"value"===t||To(e)||So(e)||Io(e)}function Oo(t,...e){if(!e.length)return t;const source=e.shift();if(vo(t)&&vo(source))for(const e in source)Ro(e,source[e])?t[e]=source[e]:vo(source[e])?(t[e]||Object.assign(t,{[e]:{}}),Oo(t[e],source[e])):Object.assign(t,{[e]:source[e]});return Oo(t,...e)}function Do(t,e,n=[],r){const o={},c=Array.from(e);if(vo(c[0])&&r&&!Reflect.has(c[0],r)){Object.keys(c[0]).some(e=>Reflect.has(t,e))||(Oo(o,{[r]:c[0]}),n.splice(n.indexOf(r),1),c.shift())}if(1===c.length&&vo(c[0]))Oo(o,c[0]);else for(let i=0;i<n.length;i++)po(c[i])&&(o[n[i]]=c[i]);return Oo(t,o)}function Mo(t,e){return ho(t)?e:t}function No(t,e){return e.forEach(e=>{Reflect.has(t,e)&&delete t[e]}),t}class Fo{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||xo&&this.toString()===xo.TONE_DEBUG_CLASS)&&function(...t){co.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Fo.version="14.7.58";function Po(a,b){return a>b+1e-6}function Bo(a,b){return Po(a,b)||Wo(a,b)}function Lo(a,b){return a+1e-6<b}function Wo(a,b){return Math.abs(a-b)<1e-6}function Vo(t,e,n){return Math.max(Math.min(t,n),e)}class Uo extends Fo{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Do(Uo.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(ao(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];ao(Bo(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(time,param="time"){const t=this._search(time,param);return-1!==t?this._timeline[t]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(time,param="time"){const t=this._search(time,param);return t+1<this._timeline.length?this._timeline[t+1]:null}getBefore(time){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<time)return this._timeline[t-1];const e=this._search(time);return e-1>=0?this._timeline[e-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Wo(this._timeline[e].time,t)){for(let i=e;i>=0&&Wo(this._timeline[i].time,t);i--)e=i;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&Bo(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(time){const t=this._search(time);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(time,param="time"){if(0===this._timeline.length)return-1;let t=0;const e=this._timeline.length;let n=e;if(e>0&&this._timeline[e-1][param]<=time)return e-1;for(;t<n;){let e=Math.floor(t+(n-t)/2);const r=this._timeline[e],o=this._timeline[e+1];if(Wo(r[param],time)){for(let i=e;i<this._timeline.length;i++){if(!Wo(this._timeline[i][param],time))break;e=i}return e}if(Lo(r[param],time)&&Po(o[param],time))return e;Po(r[param],time)?n=e:t=e+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(time,t){const e=this._search(time);return-1!==e&&this._iterate(t,0,e),this}forEachAfter(time,t){const e=this._search(time);return this._iterate(t,e+1),this}forEachBetween(t,e,n){let r=this._search(t),o=this._search(e);return-1!==r&&-1!==o?(this._timeline[r].time!==t&&(r+=1),this._timeline[o].time===e&&(o-=1),this._iterate(n,r,o)):-1===r&&this._iterate(n,0,o),this}forEachFrom(time,t){let e=this._search(time);for(;e>=0&&this._timeline[e].time>=time;)e--;return this._iterate(t,e+1),this}forEachAtTime(time,t){const e=this._search(time);if(-1!==e&&Wo(this._timeline[e].time,time)){let n=e;for(let i=e;i>=0&&Wo(this._timeline[i].time,time);i--)n=i;this._iterate(e=>{t(e)},n,e)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const jo=[];function zo(t){jo.push(t)}const qo=[];function Go(t){qo.push(t)}class Ho extends Fo{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(t=>{ho(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}),this}once(t,e){const n=(...r)=>{e(...r),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach(n=>{if(ho(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(ho(e))this._events[t]=[];else{const n=this._events[t];for(let i=n.length-1;i>=0;i--)n[i]===e&&n.splice(i,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let i=0,t=n.length;i<t;i++)n[i].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const n=Object.getOwnPropertyDescriptor(Ho.prototype,e);Object.defineProperty(t.prototype,e,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class Xo extends Ho{constructor(){super(...arguments),this.isOffline=!1}}class Ko extends Xo{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Uo,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=Do(Ko.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new Mr(t)}({latencyHint:t.latencyHint}),this._ticker=new Eo(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,jo.forEach(e=>e(t)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){ao(Ao(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaStreamDestination(){ao(Ao(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){ao(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){ao(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){ao(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){ao(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return ao(po(Kr),"This node only works in a secure context (https or localhost)"),new Kr(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return Co(this,void 0,void 0,(function*(){ao(po(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return Co(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach(e=>t.push(e)),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,yo(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return"suspended"===this._context.state&&Ao(this._context)?this._context.resume():Promise.resolve()}close(){return Co(this,void 0,void 0,(function*(){var t;Ao(this._context)&&(yield this._context.close()),this._initialized&&(t=this,qo.forEach(e=>e(t)))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=t;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=e,r.loop=!0,r.start(0),this._constants.set(t,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,r=()=>{const o=this.now();this._timeouts.add({callback:()=>{t(),r()},id:n,time:o+e})};return r(),n}}function Yo(t,e){go(e)?e.forEach(e=>Yo(t,e)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function $o(t,e){go(e)?e.forEach(e=>$o(t,e)):Object.defineProperty(t,e,{writable:!0})}const Zo=()=>{};class Qo extends Fo{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Zo;const t=Do(Qo.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Io(t.url)||t.url instanceof Qo?this.set(t.url):yo(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:Zo,onload:Zo,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:ni().sampleRate}set(t){return t instanceof Qo?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Co(this,void 0,void 0,(function*(){const e=Qo.load(t).then(t=>{this.set(t),this.onload(this)});Qo.downloads.push(e);try{yield e}finally{const t=Qo.downloads.indexOf(e);Qo.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=go(t)&&t[0].length>0,n=e?t.length:1,r=e?t[0].length:t.length,o=ni(),c=o.createBuffer(n,r,o.sampleRate),l=e||1!==n?t:[t];for(let t=0;t<n;t++)c.copyToChannel(l[t],t);return this._buffer=c,this}toMono(t){if(fo(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let i=0;i<e.length;i++)t[i]+=e[i]}t=t.map(t=>t/e),this.fromArray(t)}return this}toArray(t){if(fo(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),r=Math.floor(e*this.sampleRate);ao(n<r,"The start time must be less than the end time");const o=r-n,c=ni().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)c.copyToChannel(this.getChannelData(t).subarray(n,r),t);return new Qo(c)}_reverse(){if(this.loaded)for(let i=0;i<this.numberOfChannels;i++)this.getChannelData(i).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Qo).fromArray(t)}static fromUrl(t){return Co(this,void 0,void 0,(function*(){const e=new Qo;return yield e.load(t)}))}static load(t){return Co(this,void 0,void 0,(function*(){const e=t.match(/\[(.+\|?)+\]$/);if(e){const n=e[1].split("|");let r=n[0];for(const t of n)if(Qo.supportsType(t)){r=t;break}t=t.replace(e[0],r)}const n=""===Qo.baseUrl||Qo.baseUrl.endsWith("/")?Qo.baseUrl:Qo.baseUrl+"/",r=yield fetch(n+t);if(!r.ok)throw new Error("could not load url: "+t);const o=yield r.arrayBuffer();return yield ni().decodeAudioData(o)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Co(this,void 0,void 0,(function*(){for(yield Promise.resolve();Qo.downloads.length;)yield Qo.downloads[0]}))}}Qo.baseUrl="",Qo.downloads=[];class Jo extends Ko{constructor(){var t,e,n;super({clockSource:"offline",context:ko(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new Zr(t,e,n)),lookAhead:0,updateInterval:ko(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ko(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Co(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise(t=>setTimeout(t,1)))}}))}render(t=!0){return Co(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Qo(e)}))}close(){return Promise.resolve()}}const ti=new class extends Xo{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return Co(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let ei=ti;function ni(){return ei===ti&&wo&&ri(new Ko),ei}function ri(t){ei=Ao(t)?new Ko(t):ko(t)?new Jo(t):t}if(xo&&!xo.TONE_SILENCE_LOGGING){let t="v";0;const e=` * Tone.js ${t}14.7.58 * `;console.log("%c"+e,"background: #000; color: #fff")}function oi(t){return Math.pow(10,t/20)}function ii(t){return Math.log(t)/Math.LN10*20}function ai(t){return Math.pow(2,t/12)}let si=440;function ui(t){return Math.round(ci(t))}function ci(t){return 69+12*Math.log2(t/si)}function hi(t){return si*Math.pow(2,(t-69)/12)}class pi extends Fo{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),r="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/n)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,q,s)=>{let e=0;return t&&"0"!==t&&(e+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),q&&"0"!==q&&(e+=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(e+=this._beatsToUnits(parseFloat(s)/4)),e},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof pi&&this.fromType(this._val),ho(this._val))return this._noArg();if(yo(this._val)&&ho(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(vo(this._val)){let t=0;for(const e in this._val)if(po(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(po(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return yo(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class fi extends pi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new fi(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),r=this.valueOf();return r+(Math.round(r/n)*n-r)*e}toNotation(){const time=this.toSeconds(),t=["1m"];for(let e=1;e<9;e++){const n=Math.pow(2,e);t.push(n+"n."),t.push(n+"n"),t.push(n+"t")}t.push("0");let e=t[0],n=new fi(this.context,t[0]).toSeconds();return t.forEach(t=>{const r=new fi(this.context,t).toSeconds();Math.abs(r-time)<Math.abs(n-time)&&(e=t,n=r)}),e}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let r=e%1*4;e=Math.floor(e)%this._getTimeSignature();const o=r.toString();o.length>3&&(r=parseFloat(parseFloat(o).toFixed(3)));return[n,e,r].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ui(this.toFrequency())}_now(){return this.context.now()}}class di extends fi{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return si}static set A4(t){!function(t){si=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:di.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=vi[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:di.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,q,s){let e=1;return t&&"0"!==t&&(e*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),q&&"0"!==q&&(e*=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(e*=this._beatsToUnits(parseFloat(s)/4)),e}}})}transpose(t){return new di(this.context,this.valueOf()*ai(t))}harmonize(t){return t.map(t=>this.transpose(t))}toMidi(){return ui(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/di.A4);let n=Math.round(12*e)+57;const r=Math.floor(n/12);r<0&&(n+=-12*r);return mi[n%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return hi(t)}static ftom(t){return ui(t)}}const vi={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},mi=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class gi extends fi{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class yi extends Fo{constructor(){super();const t=Do(yi.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:ni()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(time){return new fi(this.context,time).toSeconds()}toFrequency(t){return new di(this.context,t).toFrequency()}toTicks(time){return new gi(this.context,time).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(n=>{ho(t[n])&&delete e[n]}),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const n=this[e];po(n)&&po(n.value)&&po(n.setValueAtTime)?t[e]=n.value:n instanceof yi?t[e]=n._getPartialProperties(t[e]):go(n)||fo(n)||yo(n)||mo(n)?t[e]=n:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&po(this[e])&&(this[e]&&po(this[e].value)&&po(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof yi?this[e].set(t[e]):this[e]=t[e])}),this}}class bi extends Uo{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(time){const t=this.get(time);return null!==t?t.state:this._initial}setStateAtTime(t,time,e){return so(time,0),this.add(Object.assign({},e,{state:t,time:time})),this}getLastState(t,time){for(let i=this._search(time);i>=0;i--){const e=this._timeline[i];if(e.state===t)return e}}getNextState(t,time){const e=this._search(time);if(-1!==e)for(let i=e;i<this._timeline.length;i++){const e=this._timeline[i];if(e.state===t)return e}}}class xi extends yi{constructor(){super(Do(xi.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=Do(xi.getDefaults(),arguments,["param","units","convert"]);for(ao(po(t.param)&&(To(t.param)||t.param instanceof xi),"param must be an AudioParam");!To(t.param);)t.param=t.param._param;this._swappable=!!po(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Uo(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,po(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(yi.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return po(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return po(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return po(this.maxValue)&&po(this.minValue)&&so(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?oi(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?ii(t):t}setValueAtTime(t,time){const e=this.toSeconds(time),n=this._fromType(t);return ao(isFinite(n)&&isFinite(e),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(time)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",t,e),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}getValueAtTime(time){const t=Math.max(this.toSeconds(time),0),e=this._events.getAfter(t),n=this._events.get(t);let r=this._initialValue;if(null===n)r=this._initialValue;else if("setTargetAtTime"!==n.type||null!==e&&"setValueAtTime"!==e.type)if(null===e)r=n.value;else if("linearRampToValueAtTime"===e.type||"exponentialRampToValueAtTime"===e.type){let o=n.value;if("setTargetAtTime"===n.type){const t=this._events.getBefore(n.time);o=null===t?this._initialValue:t.value}r="linearRampToValueAtTime"===e.type?this._linearInterpolate(n.time,o,e.time,e.value,t):this._exponentialInterpolate(n.time,o,e.time,e.value,t)}else r=n.value;else{const e=this._events.getBefore(n.time);let o;o=null===e?this._initialValue:e.value,"setTargetAtTime"===n.type&&(r=this._exponentialApproach(n.time,o,n.value,n.constant,t))}return this._toType(r)}setRampPoint(time){time=this.toSeconds(time);let t=this.getValueAtTime(time);return this.cancelAndHoldAtTime(time),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,time),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),r=this.toSeconds(e);return ao(isFinite(n)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,r),this._param.linearRampToValueAtTime(n,r),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=Math.max(this._minOutput,n),this._assertRange(n);const r=this.toSeconds(e);return ao(isFinite(n)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,r),this._param.exponentialRampToValueAtTime(n,r),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,time,e){time=this.toSeconds(time),e=this.toSeconds(e);const n=Math.log(e+1)/Math.log(200);return this.setTargetAtTime(t,time,n),this.cancelAndHoldAtTime(time+.9*e),this.linearRampToValueAtTime(t,time+e),this}setTargetAtTime(t,e,n){const r=this._fromType(t);ao(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const o=this.toSeconds(e);return this._assertRange(r),ao(isFinite(r)&&isFinite(o),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:o,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",t,o,n),this._param.setTargetAtTime(r,o,n),this}setValueCurveAtTime(t,e,n,r=1){n=this.toSeconds(n),e=this.toSeconds(e);const o=this._fromType(t[0])*r;this.setValueAtTime(this._toType(o),e);const c=n/(t.length-1);for(let i=1;i<t.length;i++){const n=this._fromType(t[i])*r;this.linearRampToValueAtTime(this._toType(n),e+i*c)}return this}cancelScheduledValues(time){const t=this.toSeconds(time);return ao(isFinite(t),"Invalid argument to cancelScheduledValues: "+JSON.stringify(time)),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(time){const t=this.toSeconds(time),e=this._fromType(this.getValueAtTime(t));ao(isFinite(t),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(time)),this.log(this.units,"cancelAndHoldAtTime",t,"value="+e);const n=this._events.get(t),r=this._events.getAfter(t);return n&&Wo(n.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),"linearRampToValueAtTime"===r.type?this.linearRampToValueAtTime(this._toType(e),t):"exponentialRampToValueAtTime"===r.type&&this.exponentialRampToValueAtTime(this._toType(e),t)),this._events.add({time:t,type:"setValueAtTime",value:e}),this._param.setValueAtTime(e,t),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(param){const t=this.context.currentTime;param.setValueAtTime(this.getValueAtTime(t),t);const e=this._events.get(t);if(e&&"setTargetAtTime"===e.type){const n=this._events.getAfter(e.time),r=n?n.time:t+2,o=(r-t)/10;for(let i=t;i<r;i+=o)param.linearRampToValueAtTime(this.getValueAtTime(i),i)}return this._events.forEachAfter(this.context.currentTime,t=>{"cancelScheduledValues"===t.type?param.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?param.setTargetAtTime(t.value,t.time,t.constant):param[t.type](t.value,t.time)}),this}setParam(param){ao(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const input=this.input;return input.disconnect(this._param),this.apply(param),this._param=param,input.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,r,o){return n+(e-n)*Math.exp(-(o-t)/r)}_linearInterpolate(t,e,n,r,o){return e+(o-t)/(n-t)*(r-e)}_exponentialInterpolate(t,e,n,r,o){return e*Math.pow(r/e,(o-t)/(n-t))}}class wi extends yi{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return po(this.input)?To(this.input)||this.input instanceof xi?1:this.input.numberOfInputs:0}get numberOfOutputs(){return po(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return po(t)&&(t instanceof wi||So(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();ao(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Ci(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return lo("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return Ei(this,t,e,n),this}chain(...t){return _i(this,...t),this}fan(...t){return t.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),po(this.input)&&(this.input instanceof wi?this.input.dispose():So(this.input)&&this.input.disconnect()),po(this.output)&&(this.output instanceof wi?this.output.dispose():So(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function _i(...t){const e=t.shift();t.reduce((t,e)=>(t instanceof wi?t.connect(e):So(t)&&Ci(t,e),e),e)}function Ci(t,e,n=0,r=0){for(ao(po(t),"Cannot connect from undefined node"),ao(po(e),"Cannot connect to undefined node"),(e instanceof wi||So(e))&&ao(e.numberOfInputs>0,"Cannot connect to node with no inputs"),ao(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof wi||e instanceof xi;)po(e.input)&&(e=e.input);for(;t instanceof wi;)po(t.output)&&(t=t.output);To(e)?t.connect(e,n):t.connect(e,n,r)}function Ei(t,e,n=0,r=0){if(po(e))for(;e instanceof wi;)e=e.input;for(;!So(t);)po(t.output)&&(t=t.output);To(e)?t.disconnect(e,n):So(e)?t.disconnect(e,n,r):t.disconnect()}class Ti extends wi{constructor(){super(Do(Ti.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=Do(Ti.getDefaults(),arguments,["gain","units"]);this.gain=new xi({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Yo(this,"gain")}static getDefaults(){return Object.assign(wi.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Si extends wi{constructor(t){super(t),this.onended=Zo,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Ti({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(time){const t=this.toSeconds(time);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(wi.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Zo})}_startGain(time,t=1){ao(-1===this._startTime,"Source cannot be started more than once");const e=this.toSeconds(this._fadeIn);return this._startTime=time+e,this._startTime=Math.max(this._startTime,this.context.currentTime),e>0?(this._gainNode.gain.setValueAtTime(0,time),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,time+e):this._gainNode.gain.exponentialApproachValueAtTime(t,time,e)):this._gainNode.gain.setValueAtTime(t,time),this}stop(time){return this.log("stop",time),this._stopGain(this.toSeconds(time)),this}_stopGain(time){ao(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(time)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,time):this._gainNode.gain.targetRampTo(0,t,time):(this._gainNode.gain.cancelAndHoldAtTime(time),this._gainNode.gain.setValueAtTime(0,time)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Zo&&(this.onended(this),this.onended=Zo,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),ao(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ki extends Si{constructor(){super(Do(ki.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=Do(ki.getDefaults(),arguments,["offset"]);Ci(this._source,this._gainNode),this.offset=new xi({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Si.getDefaults(),{convert:!0,offset:1,units:"number"})}start(time){const t=this.toSeconds(time);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(time){this._source.stop(time)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Ai extends wi{constructor(){super(Do(Ai.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=Do(Ai.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ki({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(wi.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Ii(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,time){return this._param.setValueAtTime(t,time),this}getValueAtTime(time){return this._param.getValueAtTime(time)}setRampPoint(time){return this._param.setRampPoint(time),this}linearRampToValueAtTime(t,time){return this._param.linearRampToValueAtTime(t,time),this}exponentialRampToValueAtTime(t,time){return this._param.exponentialRampToValueAtTime(t,time),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,time,e){return this._param.exponentialApproachValueAtTime(t,time,e),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,r){return this._param.setValueCurveAtTime(t,e,n,r),this}cancelScheduledValues(time){return this._param.cancelScheduledValues(time),this}cancelAndHoldAtTime(time){return this._param.cancelAndHoldAtTime(time),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(param){return this._param.apply(param),this}}function Ii(t,e,n,r){(e instanceof xi||To(e)||e instanceof Ai&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Ai&&(e.overridden=!0)),Ci(t,e,n,r)}class Ri extends xi{constructor(){super(Do(Ri.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Uo(1/0),this._multiplier=1;const t=Do(Ri.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(xi.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,time,e){time=this.toSeconds(time),this.setRampPoint(time);const n=this._fromType(t),r=this._events.get(time),o=Math.round(Math.max(1/e,1));for(let i=0;i<=o;i++){const t=e*i+time,o=this._exponentialApproach(r.time,r.value,n,e,t);this.linearRampToValueAtTime(this._toType(o),t)}return this}setValueAtTime(t,time){const e=this.toSeconds(time);super.setValueAtTime(t,time);const n=this._events.get(e),r=this._events.previousEvent(n),o=this._getTicksUntilEvent(r,e);return n.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,time){const e=this.toSeconds(time);super.linearRampToValueAtTime(t,time);const n=this._events.get(e),r=this._events.previousEvent(n),o=this._getTicksUntilEvent(r,e);return n.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,time){time=this.toSeconds(time);const e=this._fromType(t),n=this._events.get(time),r=Math.round(Math.max(10*(time-n.time),1)),o=(time-n.time)/r;for(let i=0;i<=r;i++){const t=o*i+n.time,r=this._exponentialInterpolate(n.time,n.value,time,e,t);this.linearRampToValueAtTime(this._toType(r),t)}return this}_getTicksUntilEvent(t,time){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(ho(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const e=this._fromType(this.getValueAtTime(t.time));let n=this._fromType(this.getValueAtTime(time));const r=this._events.get(time);return r&&r.time===time&&"setValueAtTime"===r.type&&(n=this._fromType(this.getValueAtTime(time-this.sampleTime))),.5*(time-t.time)*(e+n)+t.ticks}getTicksAtTime(time){const t=this.toSeconds(time),e=this._events.get(t);return Math.max(this._getTicksUntilEvent(e,t),0)}getDurationOfTicks(t,time){const e=this.toSeconds(time),n=this.getTicksAtTime(time);return this.getTimeOfTick(n+t)-e}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const r=this._fromType(this.getValueAtTime(e.time)),o=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-e.time),c=Math.sqrt(Math.pow(r,2)-2*o*(e.ticks-t)),l=(-r+c)/o,h=(-r-c)/o;return(l>0?l:h)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),r=this.toSeconds(t),o=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-o}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Oi extends Ai{constructor(){super(Do(Oi.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=Do(Oi.getDefaults(),arguments,["value"]);this.input=this._param=new Ri({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Ai.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,time){return this._param.getDurationOfTicks(t,time)}getTicksAtTime(time){return this._param.getTicksAtTime(time)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Di extends yi{constructor(){super(Do(Di.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new bi,this._tickOffset=new Uo;const t=Do(Di.getDefaults(),arguments,["frequency"]);this.frequency=new Oi({context:this.context,units:t.units,value:t.frequency}),Yo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},yi.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(time,t){const e=this.toSeconds(time);return"started"!==this._state.getValueAtTime(e)&&(this._state.setStateAtTime("started",e),po(t)&&this.setTicksAtTime(t,e)),this}stop(time){const t=this.toSeconds(time);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(time){const t=this.toSeconds(time);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(time){return time=this.toSeconds(time),this._state.cancel(time),this._tickOffset.cancel(time),this}getTicksAtTime(time){const t=this.toSeconds(time),e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let r=e,o=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=r.time;const n=this._tickOffset.get(t.time);n&&n.time>=r.time&&(o=n.ticks,e=n.time),"started"===r.state&&"started"!==t.state&&(o+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),r=t}),this._state.remove(n),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(s){const t=this.now(),e=this.frequency.timeToTicks(s,t);this.setTicksAtTime(e,t)}getSecondsAtTime(time){time=this.toSeconds(time);const t=this._state.getLastState("stopped",time),e={state:"paused",time:time};this._state.add(e);let n=t,r=0;return this._state.forEachBetween(t.time,time+this.sampleTime,t=>{let e=n.time;const o=this._tickOffset.get(t.time);o&&o.time>=n.time&&(r=o.seconds,e=o.time),"started"===n.state&&"started"!==t.state&&(r+=t.time-e),n=t}),this._state.remove(e),r}setTicksAtTime(t,time){return time=this.toSeconds(time),this._tickOffset.cancel(time),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,time),ticks:t,time:time}),this}getStateAtTime(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),r=this._state.get(e),o=Math.max(n.time,r.time),c=this.frequency.getTicksAtTime(o)+t-n.ticks;return this.frequency.getTimeOfTick(c)}forEachTickBetween(t,e,n){let r=this._state.get(t);this._state.forEachBetween(t,e,e=>{r&&"started"===r.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(r.time,t),e.time-this.sampleTime,n),r=e});let o=null;if(r&&"started"===r.state){const c=Math.max(r.time,t),l=this.frequency.getTicksAtTime(c),h=l-this.frequency.getTicksAtTime(r.time);let f=Math.ceil(h)-h;f=Wo(f,1)?0:f;let d=this.frequency.getTimeOfTick(l+f);for(;d<e;){try{n(d,Math.round(this.getTicksAtTime(d)))}catch(t){o=t;break}d+=this.frequency.getDurationOfTicks(1,d)}}if(o)throw o;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Mi extends yi{constructor(){super(Do(Mi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Zo,this._lastUpdate=0,this._state=new bi("stopped"),this._boundLoop=this._loop.bind(this);const t=Do(Mi.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Di({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Yo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(yi.getDefaults(),{callback:Zo,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(time,t){uo(this.context);const e=this.toSeconds(time);return this.log("start",e),"started"!==this._state.getValueAtTime(e)&&(this._state.setStateAtTime("started",e),this._tickSource.start(e,t),e<this._lastUpdate&&this.emit("start",e,t)),this}stop(time){const t=this.toSeconds(time);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(time){const t=this.toSeconds(time);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(s){this._tickSource.seconds=s}getSecondsAtTime(time){return this._tickSource.getSecondsAtTime(time)}setTicksAtTime(t,time){return this._tickSource.setTicksAtTime(t,time),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(time){return this._tickSource.getTicksAtTime(time)}nextTickTime(t,e){const n=this.toSeconds(e),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}}),this._tickSource.forEachTickBetween(t,e,(time,t)=>{this.callback(time,t)}))}getStateAtTime(time){const t=this.toSeconds(time);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ho.mixin(Mi);class Ni extends Fo{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Do(Ni.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Zo,onload:Zo,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return ao(this.has(t),"ToneAudioBuffers has no buffer named: "+t),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,n=Zo,r=Zo){return yo(e)?this._buffers.set(t.toString(),new Qo(this.baseUrl+e,n,r)):this._buffers.set(t.toString(),new Qo(e,n,r)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class Fi extends gi{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Pi extends yi{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Uo,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,time){return this._events.add({callback:t,time:this.toSeconds(time)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}zo(t=>{t.draw=new Pi({context:t})}),Go(t=>{t.draw.dispose()});class Bi extends Fo{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){ao(po(t.time),"Events must have a time property"),ao(po(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Li(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,t=>this.remove(t)),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),r=t.right;r&&(t.right=r.left,r.left=t),null!==e?n?e.left=r:e.right=r:this._setRoot(r)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),r=t.left;r&&(t.left=r.right,r.right=t),null!==e?n?e.left=r:e.right=r:this._setRoot(r)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(time){if(null!==this._root){const t=[];if(this._root.search(time,t),t.length>0){let e=t[0];for(let i=1;i<t.length;i++)t[i].low>e.low&&(e=t[i]);return e.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse(t=>e.push(t)),e.forEach(e=>{e.event&&t(e.event)})}return this}forEachAtTime(time,t){if(null!==this._root){const e=[];this._root.search(time,e),e.forEach(e=>{e.event&&t(e.event)})}return this}forEachFrom(time,t){if(null!==this._root){const e=[];this._root.searchAfter(time,e),e.forEach(e=>{e.event&&t(e.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class Li{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Wi extends wi{constructor(){super(Do(Wi.getDefaults(),arguments,["volume"])),this.name="Volume";const t=Do(Wi.getDefaults(),arguments,["volume"]);this.input=this.output=new Ti({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Yo(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(wi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Vi extends wi{constructor(){super(Do(Vi.getDefaults(),arguments)),this.name="Destination",this.input=new Wi({context:this.context}),this.output=new Ti({context:this.context}),this.volume=this.input.volume;const t=Do(Vi.getDefaults(),arguments);_i(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(wi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),_i(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}zo(t=>{t.destination=new Vi({context:t})}),Go(t=>{t.destination.dispose()});class Ui extends Fo{constructor(t){super(),this.name="TimelineValue",this._timeline=new Uo({memory:10}),this._initialValue=t}set(t,time){return this._timeline.add({value:t,time:time}),this}get(time){const t=this._timeline.get(time);return t?t.value:this._initialValue}}class ji{constructor(t,e){this.id=ji._eventId++;const n=Object.assign(ji.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:Zo,once:!1,time:0}}invoke(time){this.callback&&(this.callback(time),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}ji._eventId=0;class zi extends ji{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(zi.getDefaults(),e);this.duration=new Fi(t.context,n.duration).valueOf(),this._interval=new Fi(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ji.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(time){this._createEvents(time),super.invoke(time)}_createEvents(time){const t=this.transport.getTicksAtTime(time);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Fi(this.context,this._nextTick).toSeconds()))}_restart(time){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(time);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Fi(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Fi(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class qi extends yi{constructor(){super(Do(qi.getDefaults(),arguments)),this.name="Transport",this._loop=new Ui(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Uo,this._repeatedEvents=new Bi,this._syncedSignals=[],this._swingAmount=0;const t=Do(qi.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Mi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Yo(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(yi.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const progress=e%(2*this._swingTicks)/(2*this._swingTicks),n=Math.sin(progress*Math.PI)*this._swingAmount;t+=new Fi(this.context,2*this._swingTicks/3).toSeconds()*n}this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._timeline.forEachAtTime(e,e=>e.invoke(t))}schedule(t,time){const e=new ji(this,{callback:t,time:new gi(this.context,time).toTicks()});return this._addEvent(e,this._timeline)}scheduleRepeat(t,e,n,r=1/0){const o=new zi(this,{callback:t,duration:new fi(this.context,r).toTicks(),interval:new fi(this.context,e).toTicks(),time:new gi(this.context,n).toTicks()});return this._addEvent(o,this._repeatedEvents)}scheduleOnce(t,time){const e=new ji(this,{callback:t,once:!0,time:new gi(this.context,time).toTicks()});return this._addEvent(e,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,t=>this.clear(t.id)),this._repeatedEvents.forEachFrom(e,t=>this.clear(t.id)),this}_bindClockEvents(){this._clock.on("start",(time,t)=>{t=new Fi(this.context,t).toSeconds(),this.emit("start",time,t)}),this._clock.on("stop",time=>{this.emit("stop",time)}),this._clock.on("pause",time=>{this.emit("pause",time)})}get state(){return this._clock.getStateAtTime(this.now())}start(time,t){let e;return po(t)&&(e=this.toTicks(t)),this._clock.start(time,e),this}stop(time){return this._clock.stop(time),this}pause(time){return this._clock.pause(time),this}toggle(time){return time=this.toSeconds(time),"started"!==this._clock.getStateAtTime(time)?this.start(time):this.stop(time),this}get timeSignature(){return this._timeSignature}set timeSignature(t){go(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new fi(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new fi(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Fi(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Fi(this.context,e).toBarsBeatsSixteenths()}set position(progress){const t=this.toTicks(progress);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(s){const t=this.now(),e=this._clock.frequency.timeToTicks(s,t);this.ticks=e}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),time=this._clock.getTimeOfTick(Math.ceil(n));this.emit("stop",time),this._clock.setTicksAtTime(t,time),this.emit("start",time,this._clock.getSecondsAtTime(time))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(time){return Math.round(this._clock.getTicksAtTime(time))}getSecondsAtTime(time){return this._clock.getSecondsAtTime(time)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const r=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/r}else e=0}const n=new Ti(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let i=this._syncedSignals.length-1;i>=0;i--){const e=this._syncedSignals[i];e.signal===t&&(e.ratio.dispose(),e.signal.value=e.initial,this._syncedSignals.splice(i,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),$o(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ho.mixin(qi),zo(t=>{t.transport=new qi({context:t})}),Go(t=>{t.transport.dispose()});class Gi extends wi{constructor(t){super(t),this.input=void 0,this._state=new bi("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Zo,this._syncedStop=Zo,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Wi({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Yo(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(wi.getDefaults(),{mute:!1,onstop:Zo,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(time){return this._synced?time:Math.max(time,this.context.currentTime)}start(time,t,e){let n=ho(time)&&this._synced?this.context.transport.seconds:this.toSeconds(time);if(n=this._clampToCurrentTime(n),this._synced||"started"!==this._state.getValueAtTime(n))if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const r=this._state.get(n);r&&(r.offset=this.toSeconds(Mo(t,0)),r.duration=e?this.toSeconds(e):void 0);const o=this.context.transport.schedule(n=>{this._start(n,t,e)},n);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else uo(this.context),this._start(n,t,e);else ao(Po(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,t,e);return this}stop(time){let t=ho(time)&&this._synced?this.context.transport.seconds:this.toSeconds(time);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||po(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(time,t,e){return time=this.toSeconds(time),"started"===this._state.getValueAtTime(time)&&(this._state.cancel(time),this._restart(time,t,e)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(time,t)=>{if(t>0){const e=this._state.get(t);if(e&&"started"===e.state&&e.time!==t){const n=t-this.toSeconds(e.time);let r;e.duration&&(r=this.toSeconds(e.duration)-n),this._start(time,this.toSeconds(e.offset)+n,r)}}},this._syncedStop=time=>{const t=this.context.transport.getSecondsAtTime(Math.max(time-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(time)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Zo,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Hi extends Si{constructor(){super(Do(Hi.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=Do(Hi.getDefaults(),arguments,["url","onload"]);Ci(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new xi({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Qo(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Si.getDefaults(),{url:new Qo,loop:!1,loopEnd:0,loopStart:0,onload:Zo,onerror:Zo,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(time,t,e,n=1){ao(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(time);this._startGain(r,n),t=this.loop?Mo(t,this.loopStart):Mo(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;Bo(o,t)&&(o=(o-e)%n+e),Wo(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Lo(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),po(e)){let t=this.toSeconds(e);t=Math.max(t,0),this.stop(r+t)}return this}_stopSource(time){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(time)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function Xi(t,e){return Co(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,r=new Jo(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0);return(yield r.render()).getChannelData(0)}))}class Ki extends Si{constructor(){super(Do(Ki.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=Do(Ki.getDefaults(),arguments,["frequency","type"]);Ci(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new xi({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new xi({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Yo(this,["frequency","detune"])}static getDefaults(){return Object.assign(Si.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(time){const t=this.toSeconds(time);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(time){this._oscillator.stop(time)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Yi extends Gi{constructor(){super(Do(Yi.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=Do(Yi.getDefaults(),arguments,["frequency","type"]);this.frequency=new Ai({context:this.context,units:"frequency",value:t.frequency}),Yo(this,"frequency"),this.detune=new Ai({context:this.context,units:"cents",value:t.detune}),Yo(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Gi.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(time){const t=this.toSeconds(time),e=new Ki({context:this.context,onended:()=>this.onstop(this)});this._oscillator=e,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(time){const t=this.toSeconds(time);this._oscillator&&this._oscillator.stop(t)}_restart(time){const t=this.toSeconds(time);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return Yi._periodicWaveCache.find(t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every((element,t)=>n[t]===element));var e,n})}{const t=Yi._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(po(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),r=this.context.createPeriodicWave(e,n);this._wave=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Yi._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),Yi._periodicWaveCache.length>100&&Yi._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(p){so(p,0);let t=this._type;const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(e&&(t=e[1]),"custom"!==this._type)this.type=0===p?t:t+p.toString();else{const t=new Float32Array(p);this._partials.forEach((e,i)=>t[i]=e),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const r=new Float32Array(n),o=new Float32Array(n);let c=1;if("custom"===t){if(c=this._partials.length+1,this._partialCount=this._partials.length,n=c,0===this._partials.length)return[r,o]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(c=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],c=Math.max(c,2),n=c):this._partialCount=0,this._partials=[]}for(let l=1;l<n;++l){const n=2/(l*Math.PI);let b;switch(t){case"sine":b=l<=c?1:0,this._partials[l-1]=b;break;case"square":b=1&l?2*n:0,this._partials[l-1]=b;break;case"sawtooth":b=n*(1&l?1:-1),this._partials[l-1]=b;break;case"triangle":b=1&l?n*n*2*(l-1>>1&1?-1:1):0,this._partials[l-1]=b;break;case"custom":b=this._partials[l-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==b?(r[l]=-b*Math.sin(e*l),o[l]=b*Math.cos(e*l)):(r[l]=0,o[l]=0)}return[r,o]}_inverseFFT(t,e,n){let r=0;const o=t.length;for(let i=0;i<o;i++)r+=t[i]*Math.cos(i*n)+e[i]*Math.sin(i*n);return r}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const r=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*r),n);return Vo(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Yi._periodicWaveCache=[];class $i extends wi{constructor(){super(Object.assign(Do($i.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Ii(this,t,e,n),this}}class Zi extends $i{constructor(){super(Object.assign(Do(Zi.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=Do(Zi.getDefaults(),arguments,["mapping","length"]);go(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Ai.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let i=0,r=e;i<r;i++){const e=i/(r-1)*2-1;n[i]=t(e,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){ao(["none","2x","4x"].some(e=>e.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Qi extends $i{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Zi({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ji extends Ai{constructor(){super(Object.assign(Do(Ji.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=Do(Ji.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Ti({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ai.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class ta extends Gi{constructor(){super(Do(ta.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Qi({context:this.context}),this._modulationNode=new Ti({context:this.context});const t=Do(ta.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Yi({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Yi({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ji({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Yo(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Yi.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(time){this._modulator.start(time),this._carrier.start(time)}_stop(time){this._modulator.stop(time),this._carrier.stop(time)}_restart(time){this._modulator.restart(time),this._carrier.restart(time)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class ea extends Gi{constructor(){super(Do(ea.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Ti({context:this.context,gain:0});const t=Do(ea.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Yi({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Ai({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Yi({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ji({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Ji({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Yo(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Yi.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(time){this._modulator.start(time),this._carrier.start(time)}_stop(time){this._modulator.stop(time),this._carrier.stop(time)}_restart(time){return this._modulator.restart(time),this._carrier.restart(time),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class na extends Gi{constructor(){super(Do(na.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Ti({context:this.context,gain:0}),this._thresh=new Zi({context:this.context,mapping:t=>t<=0?-1:1});const t=Do(na.getDefaults(),arguments,["frequency","width"]);this.width=new Ai({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Yi({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Yo(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Gi.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(time){time=this.toSeconds(time),this._triangle.start(time),this._widthGate.gain.setValueAtTime(1,time)}_stop(time){time=this.toSeconds(time),this._triangle.stop(time),this._widthGate.gain.cancelScheduledValues(time),this._widthGate.gain.setValueAtTime(0,time)}_restart(time){this._triangle.restart(time),this._widthGate.gain.cancelScheduledValues(time),this._widthGate.gain.setValueAtTime(1,time)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ra extends Gi{constructor(){super(Do(ra.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=Do(ra.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Ai({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Ai({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Yo(this,["frequency","detune"])}static getDefaults(){return Object.assign(Yi.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(time){time=this.toSeconds(time),this._forEach(t=>t.start(time))}_stop(time){time=this.toSeconds(time),this._forEach(t=>t.stop(time))}_restart(time){this._forEach(t=>t.restart(time))}_forEach(t){for(let i=0;i<this._oscillators.length;i++)t(this._oscillators[i],i)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach((t,i)=>t.detune.value=e+n*i)}}get count(){return this._oscillators.length}set count(t){if(so(t,1),this._oscillators.length!==t){this._forEach(t=>t.dispose()),this._oscillators=[];for(let i=0;i<t;i++){const e=new Yi({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+i/t*360,partialCount:this._partialCount,onstop:0===i?()=>this.onstop(this):Zo});"custom"===this.type&&(e.partials=this._partials),this.frequency.connect(e.frequency),this.detune.connect(e.detune),e.detune.overridden=!1,e.connect(this.output),this._oscillators[i]=e}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((t,i)=>t.phase=this._phase+i/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class oa extends Gi{constructor(){super(Do(oa.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ji({context:this.context,value:2});const t=Do(oa.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new na({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Yi({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Yo(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Gi.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(time){time=this.toSeconds(time),this._modulator.start(time),this._pulse.start(time)}_stop(time){time=this.toSeconds(time),this._modulator.stop(time),this._pulse.stop(time)}_restart(time){this._modulator.restart(time),this._pulse.restart(time)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const ia={am:ta,fat:ra,fm:ea,oscillator:Yi,pulse:na,pwm:oa};class aa extends Gi{constructor(){super(Do(aa.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=Do(aa.getDefaults(),arguments,["frequency","type"]);this.frequency=new Ai({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Ai({context:this.context,units:"cents",value:t.detune}),Yo(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Yi.getDefaults(),ea.getDefaults(),ta.getDefaults(),ra.getDefaults(),na.getDefaults(),oa.getDefaults())}_start(time){this._oscillator.start(time)}_stop(time){this._oscillator.stop(time)}_restart(time){return this._oscillator.restart(time),this}get type(){let t="";return["am","fm","fat"].some(p=>this._sourceType===p)&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=ia[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout(()=>t.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof ia[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&fo(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&fo(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&yo(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Co(this,void 0,void 0,(function*(){return Xi(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function sa(t,e=1/0){const n=new WeakMap;return function(r,o){Reflect.defineProperty(r,o,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){so(r,t,e),n.set(this,r)}})}}function ua(t,e=1/0){const n=new WeakMap;return function(r,o){Reflect.defineProperty(r,o,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){so(this.toSeconds(r),t,e),n.set(this,r)}})}}class ca extends Gi{constructor(){super(Do(ca.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=Do(ca.getDefaults(),arguments,["url","onload"]);this._buffer=new Qo({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Gi.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Zo,onerror:Zo,playbackRate:1,reverse:!1})}load(t){return Co(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=Zo){t(),this.autostart&&this.start()}_onSourceEnd(source){this.onstop(this),this._activeSources.delete(source),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(time,t,e){return super.start(time,t,e),this}_start(t,e,n){e=this._loop?Mo(e,this._loopStart):Mo(e,0);let r=this.toSeconds(e);this._synced&&(r*=this._playbackRate);const o=n;n=Mo(n,Math.max(this._buffer.duration-r,0));let c=this.toSeconds(n);c/=this._playbackRate,t=this.toSeconds(t);const source=new Hi({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+c),this._state.setStateAtTime("stopped",t+c,{implicitEnd:!0})),this._activeSources.add(source),this._loop&&ho(o)?source.start(t,r):source.start(t,r,c-this.toSeconds(this.fadeOut))}_stop(time){const t=this.toSeconds(time);this._activeSources.forEach(source=>source.stop(t))}restart(time,t,e){return super.restart(time,t,e),this}_restart(time,t,e){this._stop(time),this._start(time,t,e)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&so(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(source=>{source.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&so(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(source=>{source.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(source=>{source.loop=t}),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(source=>source.cancelStop())),this._activeSources.forEach(source=>{source.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(source=>source.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}_o([ua(0)],ca.prototype,"fadeIn",void 0),_o([ua(0)],ca.prototype,"fadeOut",void 0);class la extends $i{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Zi({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ha extends wi{constructor(){super(Do(ha.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Ai({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=Do(ha.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(wi.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(yo(t))return t;{let n;for(n in pa)if(pa[n][e]===t)return n;return t}}_setCurve(t,e,n){if(yo(n)&&Reflect.has(pa,n)){const r=pa[n];vo(r)?"_decayCurve"!==t&&(this[t]=r[e]):this[t]=r}else{if(!go(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){ao(["linear","exponential"].some(e=>e===t),"Invalid envelope curve: "+t),this._decayCurve=t}triggerAttack(time,t=1){this.log("triggerAttack",time,t),time=this.toSeconds(time);let e=this.toSeconds(this.attack);const n=this.toSeconds(this.decay),r=this.getValueAtTime(time);if(r>0){e=(1-r)/(1/e)}if(e<this.sampleTime)this._sig.cancelScheduledValues(time),this._sig.setValueAtTime(t,time);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,e,time);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,e,time);else{this._sig.cancelAndHoldAtTime(time);let n=this._attackCurve;for(let i=1;i<n.length;i++)if(n[i-1]<=r&&r<=n[i]){n=this._attackCurve.slice(i),n[0]=r;break}this._sig.setValueCurveAtTime(n,time,e,t)}if(n&&this.sustain<1){const r=t*this.sustain,o=time+e;this.log("decay",o),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(r,n+o):this._sig.exponentialApproachValueAtTime(r,o,n)}return this}triggerRelease(time){this.log("triggerRelease",time),time=this.toSeconds(time);const t=this.getValueAtTime(time);if(t>0){const e=this.toSeconds(this.release);e<this.sampleTime?this._sig.setValueAtTime(0,time):"linear"===this._releaseCurve?this._sig.linearRampTo(0,e,time):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,e,time):(ao(go(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(time),this._sig.setValueCurveAtTime(this._releaseCurve,time,e,t))}return this}getValueAtTime(time){return this._sig.getValueAtTime(time)}triggerAttackRelease(t,time,e=1){return time=this.toSeconds(time),this.triggerAttack(time,e),this.triggerRelease(time+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Ii(this,t,e,n),this}asArray(t=1024){return Co(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new Jo(1,e,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),o=r+this.toSeconds(this.release),c=.1*o,l=o+c,h=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/l,decay:e*this.toSeconds(this.decay)/l,release:e*this.toSeconds(this.release)/l,context:n}));h._sig.toDestination(),h.triggerAttackRelease(e*(r+c)/l,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}_o([ua(0)],ha.prototype,"attack",void 0),_o([ua(0)],ha.prototype,"decay",void 0),_o([sa(0,1)],ha.prototype,"sustain",void 0),_o([ua(0)],ha.prototype,"release",void 0);const pa=(()=>{let i,t;const e=[];for(i=0;i<128;i++)e[i]=Math.sin(i/127*(Math.PI/2));const n=[];for(i=0;i<127;i++){t=i/127;const e=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;n[i]=e/10+.83*t}n[127]=1;const r=[];for(i=0;i<128;i++)r[i]=Math.ceil(i/127*5)/5;const o=[];for(i=0;i<128;i++)t=i/127,o[i]=.5*(1-Math.cos(Math.PI*t));const c=[];for(i=0;i<128;i++){t=i/127;const e=4*Math.pow(t,3)+.2,n=Math.cos(e*Math.PI*2*t);c[i]=Math.abs(n*(1-t))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:l(c),Out:c},cosine:{In:e,Out:(h=e,h.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:n,Out:l(n)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var h})();class fa extends wi{constructor(){super(Do(fa.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=Do(fa.getDefaults(),arguments);this._volume=this.output=new Wi({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Yo(this,"volume")}static getDefaults(){return Object.assign(wi.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const time=t[e],r=this.context.transport.schedule(r=>{t[e]=r,n.apply(this,t)},time);this._scheduledEvents.push(r)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,time,n){const r=this.toSeconds(time),o=this.toSeconds(e);return this.triggerAttack(t,r,n),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class da extends fa{constructor(){super(Do(da.getDefaults(),arguments));const t=Do(da.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(fa.getDefaults(),{detune:0,onsilence:Zo,portamento:0})}triggerAttack(t,time,e=1){this.log("triggerAttack",t,time,e);const n=this.toSeconds(time);return this._triggerEnvelopeAttack(n,e),this.setNote(t,n),this}triggerRelease(time){this.log("triggerRelease",time);const t=this.toSeconds(time);return this._triggerEnvelopeRelease(t),this}setNote(t,time){const e=this.toSeconds(time),n=t instanceof di?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(e)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,t,e)}else this.frequency.setValueAtTime(n,e);return this}}_o([ua(0)],da.prototype,"portamento",void 0);class va extends ha{constructor(){super(Do(va.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Ti({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class ma extends da{constructor(){super(Do(ma.getDefaults(),arguments)),this.name="Synth";const t=Do(ma.getDefaults(),arguments);this.oscillator=new aa(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new va(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Yo(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(da.getDefaults(),{envelope:Object.assign(No(ha.getDefaults(),Object.keys(wi.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(No(aa.getDefaults(),[...Object.keys(Gi.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(time,t){if(this.envelope.triggerAttack(time,t),this.oscillator.start(time),0===this.envelope.sustain){const t=this.toSeconds(this.envelope.attack),e=this.toSeconds(this.envelope.decay);this.oscillator.stop(time+t+e)}}_triggerEnvelopeRelease(time){this.envelope.triggerRelease(time),this.oscillator.stop(time+this.toSeconds(this.envelope.release))}getLevelAtTime(time){return time=this.toSeconds(time),this.envelope.getValueAtTime(time)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class ga extends ma{constructor(){super(Do(ga.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=Do(ga.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Yo(this,["oscillator","envelope"])}static getDefaults(){return Oo(da.getDefaults(),ma.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,time){const e=this.toSeconds(time),n=this.toFrequency(t instanceof di?t.toFrequency():t),r=n*this.octaves;return this.oscillator.frequency.setValueAtTime(r,e),this.oscillator.frequency.exponentialRampToValueAtTime(n,e+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}_o([sa(0)],ga.prototype,"octaves",void 0),_o([ua(0)],ga.prototype,"pitchDecay",void 0);const ya=new Set;function ba(t){ya.add(t)}function xa(t,e){const n=`registerProcessor("${t}", ${e})`;ya.add(n)}ba('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');ba("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");ba("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");xa("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class wa extends fa{constructor(){super(Do(wa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=Do(wa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach(n=>{const r=parseInt(n,10);if(ao(bo(n)||fo(r)&&isFinite(r),"url key is neither a note or midi pitch: "+n),bo(n)){const r=new di(this.context,n).toMidi();e[r]=t.urls[n]}else fo(r)&&isFinite(r)&&(e[r]=t.urls[r])}),this._buffers=new Ni({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(fa.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Zo,onerror:Zo,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error("No available buffers for note: "+t)}triggerAttack(t,time,e=1){return this.log("triggerAttack",t,time,e),Array.isArray(t)||(t=[t]),t.forEach(t=>{const n=ci(new di(this.context,t).toFrequency()),r=Math.round(n),o=n-r,c=this._findClosest(r),l=r-c,h=this._buffers.get(l),f=ai(c+o),source=new Hi({url:h,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:f}).connect(this.output);source.start(time,0,h.duration/f,e),go(this._activeSources.get(r))||this._activeSources.set(r,[]),this._activeSources.get(r).push(source),source.onended=()=>{if(this._activeSources&&this._activeSources.has(r)){const t=this._activeSources.get(r),e=t.indexOf(source);-1!==e&&t.splice(e,1)}}}),this}triggerRelease(t,time){return this.log("triggerRelease",t,time),Array.isArray(t)||(t=[t]),t.forEach(t=>{const e=new di(this.context,t).toMidi();if(this._activeSources.has(e)&&this._activeSources.get(e).length){const t=this._activeSources.get(e);time=this.toSeconds(time),t.forEach(source=>{source.stop(time)}),this._activeSources.set(e,[])}}),this}releaseAll(time){const t=this.toSeconds(time);return this._activeSources.forEach(e=>{for(;e.length;){e.shift().stop(t)}}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,time,n=1){const r=this.toSeconds(time);return this.triggerAttack(t,r,n),go(e)?(ao(go(t),"notes must be an array when duration is array"),t.forEach((t,n)=>{const o=e[Math.min(n,e.length-1)];this.triggerRelease(t,r+this.toSeconds(o))})):this.triggerRelease(t,r+this.toSeconds(e)),this}add(t,e,n){if(ao(bo(t)||isFinite(t),"note must be a pitch or midi: "+t),bo(t)){const r=new di(this.context,t).toMidi();this._buffers.add(r,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(source=>source.dispose())}),this._activeSources.clear(),this}}_o([ua(0)],wa.prototype,"attack",void 0),_o([ua(0)],wa.prototype,"release",void 0);class _a extends wi{constructor(){super(Object.assign(Do(_a.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new la({context:this.context}),this.a=new Ti({context:this.context,gain:0}),this.b=new Ti({context:this.context,gain:0}),this.output=new Ti({context:this.context}),this._internalChannels=[this.a,this.b];const t=Do(_a.getDefaults(),arguments,["fade"]);this.fade=new Ai({context:this.context,units:"normalRange",value:t.fade}),Yo(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Ci(this._split,this.a.gain,0),Ci(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(wi.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Ca extends wi{constructor(){super(Object.assign(Do(Ca.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=Do(Ca.getDefaults(),arguments,["pan"]);this.pan=new xi({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",Yo(this,"pan")}static getDefaults(){return Object.assign(wi.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}xa("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Ea extends wi{constructor(){super(Do(Ea.getDefaults(),arguments,["solo"])),this.name="Solo";const t=Do(Ea.getDefaults(),arguments,["solo"]);this.input=this.output=new Ti({context:this.context}),Ea._allSolos.has(this.context)||Ea._allSolos.set(this.context,new Set),Ea._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(wi.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),Ea._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){Ea._soloed.has(this.context)||Ea._soloed.set(this.context,new Set),Ea._soloed.get(this.context).add(this)}_removeSolo(){Ea._soloed.has(this.context)&&Ea._soloed.get(this.context).delete(this)}_isSoloed(){return Ea._soloed.has(this.context)&&Ea._soloed.get(this.context).has(this)}_noSolos(){return!Ea._soloed.has(this.context)||Ea._soloed.has(this.context)&&0===Ea._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Ea._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Ea._allSolos=new Map,Ea._soloed=new Map;class Ta extends wi{constructor(){super(Do(Ta.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=Do(Ta.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Ca({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Wi({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,Yo(this,["pan","volume"])}static getDefaults(){return Object.assign(wi.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Sa extends wi{constructor(){super(Do(Sa.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=Do(Sa.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Ea({solo:t.solo,context:this.context}),this._panVol=this.output=new Ta({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Yo(this,["pan","volume"])}static getDefaults(){return Object.assign(wi.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Sa.buses.has(t)||Sa.buses.set(t,new Ti({context:this.context})),Sa.buses.get(t)}send(t,e=0){const n=this._getBus(t),r=new Ti({context:this.context,units:"decibels",gain:e});return this.connect(r),r.connect(n),r}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Sa.buses=new Map;class ka extends wi{constructor(){super(...arguments),this.name="Listener",this.positionX=new xi({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new xi({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new xi({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new xi({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new xi({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new xi({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new xi({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new xi({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new xi({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(wi.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}zo(t=>{t.listener=new ka({context:t})}),Go(t=>{t.listener.dispose()});ni().transport;ni().destination,ni().destination;ni().listener;ni().draw;const Aa=ni()},205:function(t,e,n){var r=n(206),o=n(207),c=n(208),l=n(210);t.exports=function(t,i){return r(t)||o(t,i)||c(t,i)||l()}},206:function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},207:function(t,e){t.exports=function(t,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,o=void 0;try{for(var c,l=t[Symbol.iterator]();!(n=(c=l.next()).done)&&(e.push(c.value),!i||e.length!==i);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return e}}},208:function(t,e,n){var r=n(209);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},209:function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}},210:function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},211:function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},212:function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},218:function(t,e,n){"use strict";(function(t){var r=n(219),o=n(220),c=n(221);function l(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(t,e){if(l()<e)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=f.prototype:(null===t&&(t=new f(e)),t.length=e),t}function f(t,e,n){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return m(this,t)}return d(this,t,e,n)}function d(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);f.TYPED_ARRAY_SUPPORT?(t=e).__proto__=f.prototype:t=y(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!f.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|w(e,n),o=(t=h(t,r)).write(e,n);o!==r&&(t=t.slice(0,o));return t}(t,e,n):function(t,e){if(f.isBuffer(e)){var n=0|x(e.length);return 0===(t=h(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?h(t,0):y(t,e);if("Buffer"===e.type&&c(e.data))return y(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function v(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function m(t,e){if(v(e),t=h(t,e<0?0:0|x(e)),!f.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function y(t,e){var n=e.length<0?0:0|x(e.length);t=h(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function x(t){if(t>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|t}function w(t,e){if(f.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return K(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(t).length;default:if(r)return K(t).length;e=(""+e).toLowerCase(),r=!0}}function _(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,n);case"utf8":case"utf-8":return M(this,e,n);case"ascii":return N(this,e,n);case"latin1":case"binary":return F(this,e,n);case"base64":return D(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function C(b,t,e){var i=b[t];b[t]=b[e],b[e]=i}function E(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=f.from(e,r)),f.isBuffer(e))return 0===e.length?-1:T(t,e,n,r,o);if("number"==typeof e)return e&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):T(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function T(t,e,n,r,o){var i,c=1,l=t.length,h=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;c=2,l/=2,h/=2,n/=2}function f(t,i){return 1===c?t[i]:t.readUInt16BE(i*c)}if(o){var d=-1;for(i=n;i<l;i++)if(f(t,i)===f(e,-1===d?0:i-d)){if(-1===d&&(d=i),i-d+1===h)return d*c}else-1!==d&&(i-=i-d),d=-1}else for(n+h>l&&(n=l-h),i=n;i>=0;i--){for(var v=!0,m=0;m<h;m++)if(f(t,i+m)!==f(e,m)){v=!1;break}if(v)return i}return-1}function S(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var c=e.length;if(c%2!=0)throw new TypeError("Invalid hex string");r>c/2&&(r=c/2);for(var i=0;i<r;++i){var l=parseInt(e.substr(2*i,2),16);if(isNaN(l))return i;t[n+i]=l}return i}function k(t,e,n,r){return $(K(e,t.length-n),t,n,r)}function A(t,e,n,r){return $(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,n,r)}function I(t,e,n,r){return A(t,e,n,r)}function R(t,e,n,r){return $(Y(e),t,n,r)}function O(t,e,n,r){return $(function(t,e){for(var n,r,o,c=[],i=0;i<t.length&&!((e-=2)<0);++i)n=t.charCodeAt(i),r=n>>8,o=n%256,c.push(o),c.push(r);return c}(e,t.length-n),t,n,r)}function D(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function M(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,c,l,h,f=t[i],d=null,v=f>239?4:f>223?3:f>191?2:1;if(i+v<=n)switch(v){case 1:f<128&&(d=f);break;case 2:128==(192&(o=t[i+1]))&&(h=(31&f)<<6|63&o)>127&&(d=h);break;case 3:o=t[i+1],c=t[i+2],128==(192&o)&&128==(192&c)&&(h=(15&f)<<12|(63&o)<<6|63&c)>2047&&(h<55296||h>57343)&&(d=h);break;case 4:o=t[i+1],c=t[i+2],l=t[i+3],128==(192&o)&&128==(192&c)&&128==(192&l)&&(h=(15&f)<<18|(63&o)<<12|(63&c)<<6|63&l)>65535&&h<1114112&&(d=h)}null===d?(d=65533,v=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),i+=v}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return n}(r)}e.Buffer=f,e.SlowBuffer=function(t){+t!=t&&(t=0);return f.alloc(+t)},e.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=l(),f.poolSize=8192,f._augment=function(t){return t.__proto__=f.prototype,t},f.from=function(t,e,n){return d(null,t,e,n)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(t,e,n){return function(t,e,n,r){return v(e),e<=0?h(t,e):void 0!==n?"string"==typeof r?h(t,e).fill(n,r):h(t,e).fill(n):h(t,e)}(null,t,e,n)},f.allocUnsafe=function(t){return m(null,t)},f.allocUnsafeSlow=function(t){return m(null,t)},f.isBuffer=function(b){return!(null==b||!b._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var t=a.length,e=b.length,i=0,n=Math.min(t,e);i<n;++i)if(a[i]!==b[i]){t=a[i],e=b[i];break}return t<e?-1:e<t?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,e){if(!c(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return f.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=f.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!f.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},f.byteLength=w,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<t;i+=2)C(this,i,i+1);return this},f.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<t;i+=4)C(this,i,i+3),C(this,i+1,i+2);return this},f.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<t;i+=8)C(this,i,i+7),C(this,i+1,i+6),C(this,i+2,i+5),C(this,i+3,i+4);return this},f.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?M(this,0,t):_.apply(this,arguments)},f.prototype.equals=function(b){if(!f.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===f.compare(this,b)},f.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},f.prototype.compare=function(t,e,n,r,o){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var c=(o>>>=0)-(r>>>=0),l=(n>>>=0)-(e>>>=0),h=Math.min(c,l),d=this.slice(r,o),v=t.slice(e,n),i=0;i<h;++i)if(d[i]!==v[i]){c=d[i],l=v[i];break}return c<l?-1:l<c?1:0},f.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},f.prototype.indexOf=function(t,e,n){return E(this,t,e,n,!0)},f.prototype.lastIndexOf=function(t,e,n){return E(this,t,e,n,!1)},f.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var c=!1;;)switch(r){case"hex":return S(this,t,e,n);case"utf8":case"utf-8":return k(this,t,e,n);case"ascii":return A(this,t,e,n);case"latin1":case"binary":return I(this,t,e,n);case"base64":return R(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,e,n);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function F(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function P(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=X(t[i]);return o}function B(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function L(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function W(t,e,n,r,o,c){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<c)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function V(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function j(t,e,n,r,o,c){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function z(t,e,n,r,c){return c||j(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function G(t,e,n,r,c){return c||j(t,0,n,8),o.write(t,e,n,r,52,8),n+8}f.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),f.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=f.prototype;else{var o=e-t;n=new f(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},f.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||L(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},f.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||L(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},f.prototype.readUInt8=function(t,e){return e||L(t,1,this.length),this[t]},f.prototype.readUInt16LE=function(t,e){return e||L(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUInt16BE=function(t,e){return e||L(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUInt32LE=function(t,e){return e||L(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},f.prototype.readUInt32BE=function(t,e){return e||L(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||L(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},f.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||L(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},f.prototype.readInt8=function(t,e){return e||L(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},f.prototype.readInt16LE=function(t,e){e||L(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},f.prototype.readInt16BE=function(t,e){e||L(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},f.prototype.readInt32LE=function(t,e){return e||L(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,e){return e||L(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readFloatLE=function(t,e){return e||L(t,4,this.length),o.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,e){return e||L(t,4,this.length),o.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,e){return e||L(t,8,this.length),o.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,e){return e||L(t,8,this.length),o.read(this,t,!1,52,8)},f.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||W(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},f.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||W(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},f.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,1,255,0),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},f.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V(this,t,e,!0),e+2},f.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V(this,t,e,!1),e+2},f.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):U(this,t,e,!0),e+4},f.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},f.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);W(this,t,e,n,o-1,-o)}var i=0,c=1,sub=0;for(this[e]=255&t;++i<n&&(c*=256);)t<0&&0===sub&&0!==this[e+i-1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},f.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);W(this,t,e,n,o-1,-o)}var i=n-1,c=1,sub=0;for(this[e+i]=255&t;--i>=0&&(c*=256);)t<0&&0===sub&&0!==this[e+i+1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},f.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,1,127,-128),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},f.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V(this,t,e,!0),e+2},f.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V(this,t,e,!1),e+2},f.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):U(this,t,e,!0),e+4},f.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||W(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),f.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},f.prototype.writeFloatLE=function(t,e,n){return z(this,t,e,!0,n)},f.prototype.writeFloatBE=function(t,e,n){return z(this,t,e,!1,n)},f.prototype.writeDoubleLE=function(t,e,n){return G(this,t,e,!0,n)},f.prototype.writeDoubleBE=function(t,e,n){return G(this,t,e,!1,n)},f.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},f.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var code=t.charCodeAt(0);code<256&&(t=code)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!f.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var o=f.isBuffer(t)?t:K(new f(t,r).toString()),c=o.length;for(i=0;i<n-e;++i)this[i+e]=o[i%c]}return this};var H=/[^+\/0-9A-Za-z-_]/g;function X(t){return t<16?"0"+t.toString(16):t.toString(16)}function K(t,e){var n;e=e||1/0;for(var r=t.length,o=null,c=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&c.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&c.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&c.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&c.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;c.push(n)}else if(n<2048){if((e-=2)<0)break;c.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;c.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;c.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return c}function Y(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(H,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function $(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(20))},219:function(t,e,n){"use strict";e.byteLength=function(t){var e=h(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,i,n=h(t),r=n[0],l=n[1],f=new c(function(t,e,n){return 3*(e+n)/4-n}(0,r,l)),d=0,v=l>0?r-4:r;for(i=0;i<v;i+=4)e=o[t.charCodeAt(i)]<<18|o[t.charCodeAt(i+1)]<<12|o[t.charCodeAt(i+2)]<<6|o[t.charCodeAt(i+3)],f[d++]=e>>16&255,f[d++]=e>>8&255,f[d++]=255&e;2===l&&(e=o[t.charCodeAt(i)]<<2|o[t.charCodeAt(i+1)]>>4,f[d++]=255&e);1===l&&(e=o[t.charCodeAt(i)]<<10|o[t.charCodeAt(i+1)]<<4|o[t.charCodeAt(i+2)]>>2,f[d++]=e>>8&255,f[d++]=255&e);return f},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,c=[],i=0,l=n-o;i<l;i+=16383)c.push(f(t,i,i+16383>l?l:i+16383));1===o?(e=t[n-1],c.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],c.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return c.join("")};for(var r=[],o=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,l=code.length;i<l;++i)r[i]=code[i],o[code.charCodeAt(i)]=i;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function f(t,e,n){for(var o,c,output=[],i=e;i<n;i+=3)o=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),output.push(r[(c=o)>>18&63]+r[c>>12&63]+r[c>>6&63]+r[63&c]);return output.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},220:function(t,e){e.read=function(t,e,n,r,o){var c,l,h=8*o-r-1,f=(1<<h)-1,d=f>>1,v=-7,i=n?o-1:0,m=n?-1:1,s=t[e+i];for(i+=m,c=s&(1<<-v)-1,s>>=-v,v+=h;v>0;c=256*c+t[e+i],i+=m,v-=8);for(l=c&(1<<-v)-1,c>>=-v,v+=r;v>0;l=256*l+t[e+i],i+=m,v-=8);if(0===c)c=1-d;else{if(c===f)return l?NaN:1/0*(s?-1:1);l+=Math.pow(2,r),c-=d}return(s?-1:1)*l*Math.pow(2,c-r)},e.write=function(t,e,n,r,o,c){var l,h,f,d=8*c-o-1,v=(1<<d)-1,m=v>>1,rt=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,i=r?0:c-1,y=r?1:-1,s=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,l=v):(l=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-l))<1&&(l--,f*=2),(e+=l+m>=1?rt/f:rt*Math.pow(2,1-m))*f>=2&&(l++,f/=2),l+m>=v?(h=0,l=v):l+m>=1?(h=(e*f-1)*Math.pow(2,o),l+=m):(h=e*Math.pow(2,m-1)*Math.pow(2,o),l=0));o>=8;t[n+i]=255&h,i+=y,h/=256,o-=8);for(l=l<<o|h,d+=o;d>0;t[n+i]=255&l,i+=y,l/=256,d-=8);t[n+i-y]|=128*s}},221:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},225:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return c}));var r=n(189),o=n(196);function c(){var e=t.Canvas||t.HTMLCanvasElement,n=t.Image||t.HTMLImageElement,c=t.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},l=Object(o.a)();return Object(r.a)({Canvas:e||function(){},CanvasRenderingContext2D:t.CanvasRenderingContext2D||function(){},Image:n||function(){},ImageData:t.ImageData||function(){},Video:t.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:c},l)}}).call(this,n(20))},226:function(t,e,n){"use strict";(function(r,o){function c(){return"object"==typeof r&&void 0!==t&&void 0!==o&&!!o.version}n.d(e,"a",(function(){return c}))}).call(this,n(20),n(81))},233:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return ht})),n.d(e,"e",(function(){return Ct})),n.d(e,"c",(function(){return Dn})),n.d(e,"f",(function(){return pn})),n.d(e,"a",(function(){return He})),n.d(e,"g",(function(){return Mn}));var r={};n.r(r),n.d(r,"drawContour",(function(){return c})),n.d(r,"drawDetections",(function(){return st})),n.d(r,"drawFaceExpressions",(function(){return Kt})),n.d(r,"DrawBoxOptions",(function(){return it})),n.d(r,"DrawBox",(function(){return at})),n.d(r,"DrawFaceLandmarksOptions",(function(){return Zt})),n.d(r,"DrawFaceLandmarks",(function(){return Qt})),n.d(r,"drawFaceLandmarks",(function(){return Jt})),n.d(r,"AnchorPosition",(function(){return Q})),n.d(r,"DrawTextFieldOptions",(function(){return nt})),n.d(r,"DrawTextField",(function(){return ot}));var o=n(188);function c(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach((function(n,r){var o=n.x,c=n.y,l=e[r];t.moveTo(l.x,l.y),t.lineTo(o,c)})),n){var r=e[e.length-1],o=e[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var l=n(189),h=function(){function t(t,e){if(!C(t)||!C(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function f(t,e){return t instanceof o.a&&t.shape.length===e}function d(t){return f(t,3)}function v(t){return f(t,4)}function m(t){return t%2==0}function y(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function x(t){return t&&t.width&&t.height}function w(t){return t.reduce((function(t,e){return t.add(e)}),new T(0,0)).div(new T(t.length,t.length))}function _(t,e,n){return Array(t).fill(0).map((function(t,i){return e+i*n}))}function C(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function E(t){return C(t)&&0<=t&&t<=1}var T=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),S=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(C),c=[r.x,r.y,r.width,r.height].every(C);if(!c&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var l=c?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],h=l[0],f=l[1],d=l[2],v=l[3];t.assertIsValidBox({x:h,y:f,width:d,height:v},"Box.constructor",n),this._x=h,this._y=f,this._width=d,this._height=v}return t.isRect=function(rect){return!!rect&&[rect.x,rect.y,rect.width,rect.height].every(C)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new T(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new T(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new T(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new T(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.round(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.floor(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,n=this.y,r=this.width,o=this.height,c=Math.abs(r-o);return r<o&&(e-=c/2,r+=c),o<r&&(n-=c/2,o+=c),new t({x:e,y:n,width:r,height:o})},t.prototype.rescale=function(s){var e=x(s)?s.width:s,n=x(s)?s.height:s;return new t({x:this.x*e,y:this.y*n,width:this.width*e,height:this.height*n})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this.x,o=this.y,c=this.right,l=this.bottom,h=Math.max(r,0),f=Math.max(o,0),d=c-h,v=l-f;return new t({x:h,y:f,width:Math.min(d,e-h),height:Math.min(v,n-f)}).floor()},t.prototype.shift=function(e,n){var r=this.width,o=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:o})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,c=r,l=this.left,h=this.top,f=this.right,d=this.bottom;return f>e&&(o=-f+e+n,f=e),d>t&&(c=-d+t+r,d=t),l<1&&(c=2-l,l=1),h<1&&(c=2-h,h=1),{dy:1,edy:c,dx:1,edx:o,y:h,ey:d,x:l,ex:f,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),k=function(t){function e(e,n,r,o,c){return void 0===c&&(c=!1),t.call(this,{left:e,top:n,right:r,bottom:o},c)||this}return Object(l.c)(e,t),e}(S),A=function(){function t(t,e,n,r,o){this._imageDims=new h(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new S(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new S(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),I=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return Object(l.c)(e,t),e.prototype.forSize=function(n,r){var o=t.prototype.forSize.call(this,n,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(A);function R(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function O(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map((function(t,e){return{score:t,boxIndex:e}})).sort((function(t,e){return t.score-e.score})).map((function(t){return t.boxIndex})),c=[],l=function(){var e=o.pop();c.push(e);for(var l=o,h=[],i=0;i<l.length;i++){var f=l[i],d=t[e],v=t[f];h.push(R(d,v,r))}o=o.filter((function(t,e){return h[e]<=n}))};o.length>0;)l();return c}function D(t,e){return o.L((function(){var n=e[0],g=e[1],b=e[2],r=o.n(Object(l.e)(t.shape.slice(0,3),[1]),n),c=o.n(Object(l.e)(t.shape.slice(0,3),[1]),g),h=o.n(Object(l.e)(t.shape.slice(0,3),[1]),b),f=o.h([r,c,h],3);return o.F(t,f)}))}function M(t){return 1/(1+Math.exp(-t))}var N=function(t){function e(e,n,r,o,c){return void 0===c&&(c=!1),t.call(this,{x:e,y:n,width:r,height:o},c)||this}return Object(l.c)(e,t),e}(S),F=function(){function t(t,e,n){void 0===n&&(n=new T(0,0));var r=e.width,o=e.height;this._imgDims=new h(r,o),this._shift=n,this._positions=t.map((function(t){return t.mul(new T(r,o)).add(n)}))}return Object.defineProperty(t.prototype,"shift",{get:function(){return new T(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map((function(e){return e.sub(t._shift).div(new T(t.imageWidth,t.imageHeight))}))},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new T(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof I?t.box.floor():new S(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=r.useDlibAlignment,c=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(c)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],o=function(t){return r.sub(t).magnitude()},c=(o(e)+o(n))/2,l=Math.floor(c/.45),h=w(t),f=Math.floor(Math.max(0,h.x-.5*l)),d=Math.floor(Math.max(0,h.y-.43*l));return new N(f,d,Math.min(l,this.imageWidth+f),Math.min(l,this.imageHeight+d))},t.prototype.alignMinBbox=function(t){var e,n,r,o,c,l,h,f=(e=this.positions,n=e.map((function(t){return t.x})),r=e.map((function(t){return t.y})),o=n.reduce((function(t,e){return e<t?e:t}),1/0),c=r.reduce((function(t,e){return e<t?e:t}),1/0),l=n.reduce((function(t,e){return t<e?e:t}),0),h=r.reduce((function(t,e){return t<e?e:t}),0),new k(o,c,l,h));return f.pad(f.width*t,f.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],w([t[3],t[4]])]},e}(F),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(w)},e}(F),L=function(){function t(label,t){this._label=label,this._distance=t}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+y(this.distance)+")":"")},t}(),W=function(t){function e(e,label){var n=t.call(this,e)||this;return n._label=label,n}return Object(l.c)(e,t),e.assertIsValidLabeledBox=function(t,e){if(S.assertIsValidBox(t,e),!C(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(S),V=function(){function t(label,t){if("string"!=typeof label)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(desc){return!(desc instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=label,this._descriptors=t}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(t){return Array.from(t)}))}},t.fromJSON=function(e){var n=e.descriptors.map((function(t){return new Float32Array(t)}));return new t(e.label,n)},t}();!function(t){function e(e,label,n,r){var o=t.call(this,e,label)||this;return o._score=n,o._classScore=r,o}Object(l.c)(e,t),e.assertIsValidPredictedBox=function(t,e){if(W.assertIsValidLabeledBox(t,e),!E(t.score)||!E(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(W);function U(t){return t.detection instanceof I}function j(t,e){var n={detection:e};return Object.assign({},t,n)}function z(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var G=n(196),H=n(225);function X(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}var K,Y=n(226);function $(t){K=t}function Z(){X()&&$(z()),Object(Y.a)()&&$(Object(H.a)())}var Q,J={getEnv:function(){if(!K)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return K},setEnv:$,initialize:Z,createBrowserEnv:z,createFileSystem:G.a,createNodejsEnv:H.a,monkeyPatch:function(t){if(K||Z(),!K)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?K.Canvas:e,r=t.Image,o=void 0===r?K.Image:r;K.Canvas=n,K.Image=o,K.createCanvasElement=t.createCanvasElement||function(){return new n},K.createImageElement=t.createImageElement||function(){return new o},K.ImageData=t.ImageData||K.ImageData,K.Video=t.Video||K.Video,K.fetch=t.fetch||K.fetch,K.readFile=t.readFile||K.readFile},isBrowser:X,isNodejs:Y.a};function tt(t){return J.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function et(t){var e=J.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var canvas=tt(t);if(!(canvas instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var r=canvas.getContext("2d");if(!r)throw new Error("resolveContext2d - canvas 2d context is null");return r}Z(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Q||(Q={}));var nt=function(t){void 0===t&&(t={});var e=t.anchorPosition,n=t.backgroundColor,r=t.fontColor,o=t.fontSize,c=t.fontStyle,l=t.padding;this.anchorPosition=e||Q.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=c||"Georgia",this.padding=l||4},ot=function(){function t(text,e,n){void 0===n&&(n={}),this.text="string"==typeof text?[text]:text instanceof t?text.text:text,this.anchor=e,this.options=new nt(n)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map((function(e){return t.measureText(e).width})).reduce((function(t,e){return t<e?e:t}),0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===Q.BOTTOM_RIGHT||n===Q.TOP_RIGHT,o=n===Q.BOTTOM_LEFT||n===Q.BOTTOM_RIGHT,c=this.measureWidth(t),l=this.measureHeight(),h=r?this.anchor.x-c:this.anchor.x,f=o?this.anchor.y-l:this.anchor.y;if(e){var d=e.width,v=e.height;return{x:Math.max(Math.min(h,d-c),0),y:Math.max(Math.min(f,v-l),0)}}return{x:h,y:f}},t.prototype.draw=function(t){var canvas=tt(t),e=et(canvas),n=this.options,r=n.backgroundColor,o=n.fontColor,c=n.fontSize,l=n.fontStyle,h=n.padding;e.font=c+"px "+l;var f=this.measureWidth(e),d=this.measureHeight();e.fillStyle=r;var v=this.getUpperLeft(e,canvas);e.fillRect(v.x,v.y,f,d),e.fillStyle=o,this.text.forEach((function(t,i){var n=h+v.x,r=h+v.y+(i+1)*c;e.fillText(t,n,r)}))},t}(),it=function(t){void 0===t&&(t={});var e=t.boxColor,n=t.lineWidth,label=t.label,r=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=label;var o={anchorPosition:Q.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new nt(Object.assign({},o,r))},at=function(){function t(t,e){void 0===e&&(e={}),this.box=new S(t),this.options=new it(e)}return t.prototype.draw=function(t){var e=et(t),n=this.options,r=n.boxColor,o=n.lineWidth,c=this.box,l=c.x,h=c.y,f=c.width,d=c.height;e.strokeStyle=r,e.lineWidth=o,e.strokeRect(l,h,f,d);var label=this.options.label;label&&new ot([label],{x:l-o/2,y:h},this.options.drawLabelOptions).draw(t)},t}();function st(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof I?e.score:U(e)?e.detection.score:void 0,r=e instanceof I?e.box:U(e)?e.detection.box:new S(e),label=n?""+y(n):void 0;new at(r,{label:label}).draw(t)}))}function ut(t){var e=J.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function ct(input){var t=J.getEnv(),e=t.Image,n=t.Video;return input instanceof e?new h(input.naturalWidth,input.naturalHeight):input instanceof n?new h(input.videoWidth,input.videoHeight):new h(input.width,input.height)}function lt(t){var e=t.width,n=t.height,canvas=(0,J.getEnv().createCanvasElement)();return canvas.width=e,canvas.height=n,canvas}function ht(t,e){var n=J.getEnv().ImageData;if(!(t instanceof n||ut(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||ct(t),o=r.width,c=r.height,canvas=lt({width:o,height:c});return t instanceof n?et(canvas).putImageData(t,0,0):et(canvas).drawImage(t,0,0,o,c),canvas}function pt(t,canvas){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,c,h,f;return Object(l.d)(this,(function(l){switch(l.label){case 0:return e=canvas||J.getEnv().createCanvasElement(),n=t.shape.slice(v(t)?1:0),r=n[0],c=n[1],h=n[2],f=o.L((function(){return t.as3D(r,c,h).toInt()})),[4,o.f.toPixels(f,e)];case 1:return l.sent(),f.dispose(),[2,e]}}))}))}function ft(input){var t=J.getEnv(),e=t.Image,n=t.Canvas,r=t.Video;return input instanceof e||input instanceof n||input instanceof r}var vt=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach((function(input,t){if(d(input))return n._imageTensors[t]=input,void(n._inputDimensions[t]=input.shape);if(v(input)){var e=input.shape[0];if(1!==e)throw new Error("NetInput - tf.Tensor4D with batchSize "+e+" passed, but not supported in input array");return n._imageTensors[t]=input,void(n._inputDimensions[t]=input.shape.slice(1))}var canvas=input instanceof J.getEnv().Canvas?input:ht(input);n._canvases[t]=canvas,n._inputDimensions[t]=[canvas.height,canvas.width,3]}))}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return _(this.batchSize,0,1).map((function(e,n){return t.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,o=e/Math.max(r,n);return new h(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,o.L((function(){var r=_(n.batchSize,0,1).map((function(r){var input=n.getInput(r);if(input instanceof o.a){var c=v(input)?input:input.expandDims();return(c=function(t,e){return void 0===e&&(e=!1),o.L((function(){var n=t.shape.slice(1),r=n[0],c=n[1];if(r===c)return t;var l=Math.abs(r-c),h=Math.round(l*(e?.5:1)),f=r>c?2:1,d=function(e){var n=t.shape.slice();return n[f]=e,o.n(n,0)},v=d(h),m=l-v.shape[f],y=[e&&m?d(m):null,t,v].filter((function(t){return!!t})).map((function(t){return t.toFloat()}));return o.h(y,f)}))}(c,e)).shape[1]===t&&c.shape[2]===t||(c=o.o.resizeBilinear(c,[t,t])),c.as3D(t,t,3)}if(input instanceof J.getEnv().Canvas)return o.f.fromPixels(function(input,t,e){void 0===e&&(e=!1);var n=J.getEnv(),r=n.Image,o=n.Canvas;if(!(input instanceof r||input instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var c=ct(input),l=t/Math.max(c.height,c.width),h=l*c.width,f=l*c.height,d=lt({width:t,height:t}),v=input instanceof o?input:ht(input),m=Math.abs(h-f)/2,y=e&&h<f?m:0,x=e&&f<h?m:0;return et(d).drawImage(v,y,x,h,f),d}(input,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+input)}));return o.E(r.map((function(t){return t.toFloat()}))).as4D(n.batchSize,t,t,3)}))},t}();function mt(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r;return Object(l.d)(this,(function(o){switch(o.label){case 0:if(t instanceof vt)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(tt)).forEach((function(input,i){if(!ft(input)&&!d(input)&&!v(input)){if("string"==typeof e[i])throw new Error("toNetInput -"+n(i)+" string passed, but could not resolve HTMLElement for element id "+e[i]);throw new Error("toNetInput -"+n(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(v(input)){var t=input.shape[0];if(1!==t)throw new Error("toNetInput -"+n(i)+" tf.Tensor4D with batchSize "+t+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(input){return ft(input)&&(t=input,new Promise((function(e,n){if(t instanceof J.getEnv().Canvas||ut(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}t.addEventListener("load",r),t.addEventListener("error",o)})));var t})))];case 1:return o.sent(),[2,new vt(r,Array.isArray(t))]}}))}))}function gt(input,t){return Object(l.b)(this,void 0,void 0,(function(){var e,canvas,n,r,o,c;return Object(l.d)(this,(function(l){switch(l.label){case 0:return e=J.getEnv().Canvas,canvas=input,input instanceof e?[3,5]:[4,mt(input)];case 1:if((n=l.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(r=n.getInput(0))instanceof e?(o=r,[3,4]):[3,2];case 2:return[4,pt(r)];case 3:o=l.sent(),l.label=4;case 4:canvas=o,l.label=5;case 5:return c=et(canvas),[2,t.map((function(t){return t instanceof I?t.forSize(canvas.width,canvas.height).box.floor():t})).map((function(t){return t.clipAtImageBorders(canvas.width,canvas.height)})).map((function(t){var e=t.x,n=t.y,r=t.width,o=t.height,l=lt({width:r,height:o});return et(l).putImageData(c.getImageData(e,n,r,o),0,0),l}))]}}))}))}function yt(t,e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){if(!d(t)&&!v(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(v(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,o.L((function(){var n=t.shape.slice(v(t)?1:0),r=n[0],c=n[1],l=n[2];return e.map((function(t){return t instanceof I?t.forSize(c,r).box:t})).map((function(t){return t.clipAtImageBorders(c,r)})).map((function(e){var n=e.x,h=e.y,f=e.width,d=e.height;return o.C(t.as3D(r,c,l),[h,n,0],[d,f,l])}))}))]}))}))}function bt(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,(0,J.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function xt(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,bt(t)];case 1:return[2,e.sent().json()]}}))}))}function wt(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter((function(s){return s})),c=t.endsWith(".json")?o[o.length-1]:n,l=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:l=t.startsWith("/")?"/"+l:l,manifestUri:"/"===l?"/"+c:l+"/"+c}}function _t(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,r,c,h;return Object(l.d)(this,(function(l){switch(l.label){case 0:return n=wt(t,e),r=n.manifestUri,c=n.modelBaseUri,[4,xt(r)];case 1:return h=l.sent(),[2,o.p.loadWeights(h,c)]}}))}))}function Ct(input,t,e){void 0===e&&(e=!1);var n=e?ct(t):t,r=n.width,o=n.height;return input.width=r,input.height=o,{width:r,height:o}}var Et=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map((function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}}))},t.prototype.getTrainableParams=function(){return this.getParamList().filter((function(param){return param.tensor instanceof o.b}))},t.prototype.getFrozenParams=function(){return this.getParamList().filter((function(param){return!(param.tensor instanceof o.b)}))},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach((function(e){var path=e.path,n=e.tensor;t.reassignParamFromPath(path,n.variable())}))},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach((function(e){var path=e.path,n=e.tensor,r=o.G(n.dataSync());n.dispose(),t.reassignParamFromPath(path,r)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach((function(param){if(t&&param.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+param.path);param.tensor.dispose()})),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(t){var e=t.tensor;return Array.from(e.dataSync())})).reduce((function(t,e){return t.concat(e)})))},t.prototype.load=function(t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}}))}))},t.prototype.loadFromUri=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,_t(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}}))}))},t.prototype.loadFromDisk=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,c,h,f,d,v,m,y;return Object(l.d)(this,(function(l){switch(l.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=J.getEnv().readFile,n=wt(t,this.getDefaultModelName()),r=n.manifestUri,c=n.modelBaseUri,h=function(t){return Promise.all(t.map((function(t){return e(t).then((function(t){return t.buffer}))})))},f=o.p.weightsLoaderFactory(h),m=(v=JSON).parse,[4,e(r)];case 1:return d=m.apply(v,[l.sent().toString()]),[4,f(d,c)];case 2:return y=l.sent(),this.loadFromWeightMap(y),[2]}}))}))},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce((function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}}),{nextObj:this.params}),n=e.obj,r=e.objProp;if(!(n&&r&&n[r]instanceof o.a))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function Tt(t,e,n){return o.L((function(){var r=o.z(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=o.c(r,e.bias)}))}function St(t,e,n){return void 0===n&&(n=!1),o.L((function(){var r=o.w(n?o.c(o.i(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):Tt(t,e.conv0,[2,2])),c=Tt(r,e.conv1,[1,1]),l=Tt(o.w(o.c(r,c)),e.conv2,[1,1]);return o.w(o.c(r,o.c(c,l)))}))}function kt(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),o.L((function(){var c=o.w(n?o.c(o.i(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Tt(t,e.conv0,r?[2,2]:[1,1])),l=Tt(c,e.conv1,[1,1]),h=Tt(o.w(o.c(c,l)),e.conv2,[1,1]),f=Tt(o.w(o.c(c,o.c(l,h))),e.conv3,[1,1]);return o.w(o.c(c,o.c(l,o.c(h,f))))}))}function At(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),o.L((function(){var c=o.c(o.i(t,e.filters,[1,1],n),e.bias);return r?o.w(c):c}))}function It(t,e){Object.keys(t).forEach((function(path){e.some((function(t){return t.originalPath===path}))||t[path].dispose()}))}function Rt(t,e){return function(n,r,c,l){var h=o.K(t(n*r*c*c),[c,c,n,r]),f=o.H(t(r));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:h,bias:f}}}function Ot(t,e){return function(n,r,c){var l=o.I(t(n*r),[n,r]),h=o.H(t(r));return e.push({paramPath:c+"/weights"},{paramPath:c+"/bias"}),{weights:l,bias:h}}}var Dt=function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n};function Mt(t,e){return function(n,r,c){var l=o.K(t(9*n),[3,3,n,1]),h=o.K(t(n*r),[1,1,n,r]),f=o.H(t(r));return e.push({paramPath:c+"/depthwise_filter"},{paramPath:c+"/pointwise_filter"},{paramPath:c+"/bias"}),new Dt(l,h,f)}}function Nt(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new Dt(n,r,o)}}function Ft(t,e){return function(n,r,o){var c=t[n];if(!f(c,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+c);return e.push({originalPath:n,paramPath:o||n}),c}}function Pt(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function Bt(t,e){var n=Rt(t,e),r=Mt(t,e);function o(t,e,o,c){return void 0===c&&(c=!1),{conv0:c?n(t,e,3,o+"/conv0"):r(t,e,o+"/conv0"),conv1:r(e,e,o+"/conv1"),conv2:r(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,n,c){void 0===c&&(c=!1);var l=o(t,e,n,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(e,e,n+"/conv3")}}}}function Lt(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function Wt(t,e){var n=Ft(t,e),r=Lt(n),o=Nt(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var Vt=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return o.L((function(){var e=kt(D(input.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.y(255)),t.dense0,!0);return e=kt(e,t.dense1),e=kt(e,t.dense2),e=kt(e,t.dense3),e=o.d(e,[7,7],[2,2],"valid")}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Wt(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return It(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Pt(t),r=n.extractWeights,o=n.getRemainingWeights,c=Bt(r,e).extractDenseBlock4Params,l=c(3,32,"dense0",!0),h=c(32,64,"dense1"),f=c(64,128,"dense2"),d=c(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:l,dense1:h,dense2:f,dense3:d}}}(t)},e}(Et);function Ut(t,e){return o.L((function(){return o.c(o.q(t,e.weights),e.bias)}))}function jt(t){var e={},n={};return Object.keys(t).forEach((function(r){(r.startsWith("fc")?n:e)[r]=t[r]})),{featureExtractorMap:e,classifierMap:n}}var zt=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(input){var t=this,e=this.params;if(!e)throw new Error(this._name+" - load model before inference");return o.L((function(){var n=input instanceof vt?t.faceFeatureExtractor.forwardInput(input):input;return Ut(n.as2D(n.shape[0],-1),e.fc)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],o=Pt(t),c=o.extractWeights,l=o.getRemainingWeights,h=Ot(c,r)(e,n,"fc");if(0!==l().length)throw new Error("weights remaing after extract: "+l().length);return{paramMappings:r,params:{fc:h}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=jt(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e,n=[],r=Ft(t,n),o={fc:(e="fc",{weights:r(e+"/weights",2),bias:r(e+"/bias",1)})};return It(t,n),{params:o,paramMappings:n}}(r)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),c=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(c)},e}(Et),qt=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Gt=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);qt.forEach((function(n,r){e[n]=t[r]}))}return t.prototype.asSortedArray=function(){var t=this;return qt.map((function(e){return{expression:e,probability:t[e]}})).sort((function(t,e){return e.probability-t.probability}))},t}(),Ht=function(t){function e(e){return void 0===e&&(e=new Vt),t.call(this,"FaceExpressionNet",e)||this}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this;return o.L((function(){return o.D(t.runNet(input))}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.predictExpressions=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,c=this;return Object(l.d)(this,(function(h){switch(h.label){case 0:return[4,mt(input)];case 1:return t=h.sent(),[4,this.forwardInput(t)];case 2:return e=h.sent(),[4,Promise.all(o.O(e).map((function(t){return Object(l.b)(c,void 0,void 0,(function(){var data;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,t.data()];case 1:return data=e.sent(),t.dispose(),[2,data]}}))}))})))];case 3:return n=h.sent(),e.dispose(),r=n.map((function(t){return new Gt(t)})),[2,t.isBatchInput?r:r[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(zt);function Xt(t,e){var n={expressions:e};return Object.assign({},t,n)}function Kt(t,e,n,r){void 0===n&&(n=.1),(Array.isArray(e)?e:[e]).forEach((function(e){var o=e instanceof Gt?e:e.expressions instanceof Gt?e.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var c=o.asSortedArray().filter((function(t){return t.probability>n})),l=U(e)?e.detection.box.bottomLeft:r||new T(0,0);new ot(c.map((function(t){return t.expression+" ("+y(t.probability)+")"})),l).draw(t)}))}function Yt(t){return U(t)&&t.landmarks instanceof F&&t.unshiftedLandmarks instanceof F&&t.alignedRect instanceof I}function $t(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),rect=r.align(),o=t.detection.imageDims,c={landmarks:r,unshiftedLandmarks:e,alignedRect:new I(t.detection.score,rect.rescale(o.reverse()),o)};return Object.assign({},t,c)}var Zt=function(t){void 0===t&&(t={});var e=t.drawLines,n=void 0===e||e,r=t.drawPoints,o=void 0===r||r,c=t.lineWidth,l=t.lineColor,h=t.pointSize,f=t.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=c||1,this.pointSize=h||2,this.lineColor=l||"rgba(0, 255, 255, 1)",this.pointColor=f||"rgba(255, 0, 255, 1)"},Qt=function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new Zt(e)}return t.prototype.draw=function(t){var e=et(t),n=this.options,r=n.drawLines,o=n.drawPoints,l=n.lineWidth,h=n.lineColor,f=n.pointSize,d=n.pointColor;if(r&&this.faceLandmarks instanceof B&&(e.strokeStyle=h,e.lineWidth=l,c(e,this.faceLandmarks.getJawOutline()),c(e,this.faceLandmarks.getLeftEyeBrow()),c(e,this.faceLandmarks.getRightEyeBrow()),c(e,this.faceLandmarks.getNose()),c(e,this.faceLandmarks.getLeftEye(),!0),c(e,this.faceLandmarks.getRightEye(),!0),c(e,this.faceLandmarks.getMouth(),!0)),o){e.strokeStyle=d,e.fillStyle=d;this.faceLandmarks.positions.forEach((function(t){e.beginPath(),e.arc(t.x,t.y,f,0,2*Math.PI),e.fill()}))}},t}();function Jt(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof F?e:Yt(e)?e.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Qt(n).draw(t)}))}function te(t,e){var n=[],r=Pt(t),o=r.extractWeights,c=r.getRemainingWeights,l=function(t,e){var n=Rt(t,e),r=Mt(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,o){return{separable_conv0:r(t,e,o+"/separable_conv0"),separable_conv1:r(e,e,o+"/separable_conv1"),expansion_conv:n(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(o,n),h=l.extractConvParams,f=l.extractSeparableConvParams,d=l.extractReductionBlockParams,v=l.extractMainBlockParams,m={conv_in:h(3,32,3,"entry_flow/conv_in"),reduction_block_0:d(32,64,"entry_flow/reduction_block_0"),reduction_block_1:d(64,128,"entry_flow/reduction_block_1")},y={};_(e,0,1).forEach((function(t){y["main_block_"+t]=v(128,"middle_flow/main_block_"+t)}));var x={reduction_block:d(128,256,"exit_flow/reduction_block"),separable_conv:f(256,512,"exit_flow/separable_conv")};if(0!==c().length)throw new Error("weights remaing after extract: "+c().length);return{paramMappings:n,params:{entry_flow:m,middle_flow:y,exit_flow:x}}}function ee(t,e){var n=[],r=function(t,e){var n=Ft(t,e),r=Lt(n),o=Nt(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}}}(t,n),o=r.extractConvParams,c=r.extractSeparableConvParams,l=r.extractReductionBlockParams,h=r.extractMainBlockParams,f={conv_in:o("entry_flow/conv_in"),reduction_block_0:l("entry_flow/reduction_block_0"),reduction_block_1:l("entry_flow/reduction_block_1")},d={};_(e,0,1).forEach((function(t){d["main_block_"+t]=h("middle_flow/main_block_"+t)}));var v={reduction_block:l("exit_flow/reduction_block"),separable_conv:c("exit_flow/separable_conv")};return It(t,n),{params:{entry_flow:f,middle_flow:d,exit_flow:v},paramMappings:n}}function ne(t,e,n){return o.c(o.i(t,e.filters,n,"same"),e.bias)}function re(t,e,n){void 0===n&&(n=!0);var r=n?o.w(t):t;return r=Tt(r,e.separable_conv0,[1,1]),r=Tt(o.w(r),e.separable_conv1,[1,1]),r=o.s(r,[3,3],[2,2],"same"),r=o.c(r,ne(t,e.expansion_conv,[2,2]))}var oe,ie=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this,e=this.params;if(!e)throw new Error("TinyXception - load model before inference");return o.L((function(){var n=D(input.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.y(256)),r=o.w(ne(n,e.entry_flow.conv_in,[2,2]));return r=re(r,e.entry_flow.reduction_block_0,!1),r=re(r,e.entry_flow.reduction_block_1),_(t._numMainBlocks,0,1).forEach((function(t){r=function(t,e){var n=Tt(o.w(t),e.separable_conv0,[1,1]);return n=Tt(o.w(n),e.separable_conv1,[1,1]),n=Tt(o.w(n),e.separable_conv2,[1,1]),n=o.c(n,t)}(r,e.middle_flow["main_block_"+t])})),r=re(r,e.exit_flow.reduction_block),r=o.w(Tt(r,e.exit_flow.separable_conv,[1,1]))}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return ee(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return te(t,this._numMainBlocks)},e}(Et);!function(t){t.FEMALE="female",t.MALE="male"}(oe||(oe={}));var ae=function(t){function e(e){void 0===e&&(e=new ie(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(input){var t=this,e=this.params;if(!e)throw new Error(this._name+" - load model before inference");return o.L((function(){var n=input instanceof vt?t.faceFeatureExtractor.forwardInput(input):input,r=o.d(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1);return{age:Ut(r,e.fc.age).as1D(),gender:Ut(r,e.fc.gender)}}))},e.prototype.forwardInput=function(input){var t=this;return o.L((function(){var e=t.runNet(input),n=e.age,r=e.gender;return{age:n,gender:o.D(r)}}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.predictAgeAndGender=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,c,h,f=this;return Object(l.d)(this,(function(d){switch(d.label){case 0:return[4,mt(input)];case 1:return t=d.sent(),[4,this.forwardInput(t)];case 2:return e=d.sent(),n=o.O(e.age),r=o.O(e.gender),c=n.map((function(t,i){return{ageTensor:t,genderTensor:r[i]}})),[4,Promise.all(c.map((function(t){var e=t.ageTensor,n=t.genderTensor;return Object(l.b)(f,void 0,void 0,(function(){var t,r,o,c,h;return Object(l.d)(this,(function(l){switch(l.label){case 0:return[4,e.data()];case 1:return t=l.sent()[0],[4,n.data()];case 2:return r=l.sent()[0],c=(o=r>.5)?oe.MALE:oe.FEMALE,h=o?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:c,genderProbability:h}]}}))}))})))];case 3:return h=d.sent(),e.age.dispose(),e.gender.dispose(),[2,t.isBatchInput?h:h[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=Pt(t),r=n.extractWeights,o=n.getRemainingWeights,c=Ot(r,e),l=c(512,1,"fc/age"),h=c(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:l,gender:h}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=jt(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=Ft(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return It(t,e),{params:o,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(Et),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.postProcess=function(output,t,e){var n=e.map((function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}})),r=n.length;return o.L((function(){var e=function(t,e){return o.E([o.n([68],t),o.n([68],e)],1).as2D(1,136).as1D()},c=function(t,e){var r=n[t],o=r.width,c=r.height;return e(o,c)?Math.abs(o-c)/2:0};return output.mul(o.n([r,136],t)).sub(o.E(Array.from(Array(r),(function(t,n){return e(function(t){return c(t,(function(t,e){return t<e}))}(n),function(t){return c(t,(function(t,e){return e<t}))}(n))})))).div(o.E(Array.from(Array(r),(function(t,r){return e(n[r].width,n[r].height)}))))}))},e.prototype.forwardInput=function(input){var t=this;return o.L((function(){var e=t.runNet(input);return t.postProcess(e,input.inputSize,input.inputDimensions.map((function(t){return{height:t[0],width:t[1]}})))}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.detectLandmarks=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(l.d)(this,(function(c){switch(c.label){case 0:return[4,mt(input)];case 1:return t=c.sent(),e=o.L((function(){return o.O(r.forwardInput(t))})),[4,Promise.all(e.map((function(e,n){return Object(l.b)(r,void 0,void 0,(function(){var r,o,c,h,f;return Object(l.d)(this,(function(l){switch(l.label){case 0:return c=(o=Array).from,[4,e.data()];case 1:return r=c.apply(o,[l.sent()]),h=r.filter((function(t,i){return m(i)})),f=r.filter((function(t,i){return!m(i)})),[2,new B(Array(68).fill(0).map((function(t,i){return new T(h[i],f[i])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return n=c.sent(),e.forEach((function(t){return t.dispose()})),[2,t.isBatchInput?n:n[0]]}}))}))},e.prototype.getClassifierChannelsOut=function(){return 136},e}(zt),ue=function(t){function e(e){return void 0===e&&(e=new Vt),t.call(this,"FaceLandmark68Net",e)||this}return Object(l.c)(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(se);var ce=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return o.L((function(){var e=St(D(input.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.y(255)),t.dense0,!0);return e=St(e,t.dense1),e=St(e,t.dense2),e=o.d(e,[14,14],[2,2],"valid")}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Wt(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return It(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Pt(t),r=n.extractWeights,o=n.getRemainingWeights,c=Bt(r,e).extractDenseBlock3Params,l=c(3,32,"dense0",!0),h=c(32,64,"dense1"),f=c(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:l,dense1:h,dense2:f}}}(t)},e}(Et),le=function(t){function e(e){return void 0===e&&(e=new ce),t.call(this,"FaceLandmark68TinyNet",e)||this}return Object(l.c)(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(se);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Object(l.c)(e,t)}(ue);function he(t,e,n,r,c){void 0===c&&(c="same");var l=e.conv,h=l.filters,f=l.bias,d=o.i(t,h,n,c);return d=function(t,e){return o.c(o.t(t,e.weights),e.biases)}(d=o.c(d,f),e.scale),r?o.w(d):d}function pe(t,e){return he(t,e,[1,1],!1)}function fe(t,e){return he(t,e,[2,2],!0,"valid")}function de(t,e){function n(n,r,c,l){var h=function(e,n,r){var c=t(e),l=c.length/(n*r*r);if(l%1!=0)throw new Error("depth has to be an integer: "+l+", weights.length: "+c.length+", numFilters: "+n+", filterSize: "+r);return o.L((function(){return o.N(o.K(c,[n,l,r,r]),[2,3,1,0])}))}(n,r,c),f=o.H(t(r));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:h,bias:f}}function r(r,c,l,h){return{conv:n(r,c,l,h+"/conv"),scale:function(n,r){var c=o.H(t(n)),l=o.H(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:c,biases:l}}(c,h+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,c){return void 0===c&&(c=!1),{conv1:r((c?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}function ve(t,e){var n=Ft(t,e);function r(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}function me(t){var e=[],n=ve(t,e),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,c=r("conv32_down"),l=o("conv32_1"),h=o("conv32_2"),d=o("conv32_3"),v=o("conv64_down"),m=o("conv64_1"),y=o("conv64_2"),x=o("conv64_3"),w=o("conv128_down"),_=o("conv128_1"),C=o("conv128_2"),E=o("conv256_down"),T=o("conv256_1"),S=o("conv256_2"),k=o("conv256_down_out"),A=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!f(A,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+A);var I={conv32_down:c,conv32_1:l,conv32_2:h,conv32_3:d,conv64_down:v,conv64_1:m,conv64_2:y,conv64_3:x,conv128_down:w,conv128_1:_,conv128_2:C,conv256_down:E,conv256_1:T,conv256_2:S,conv256_down_out:k,fc:A};return It(t,e),{params:I,paramMappings:e}}function ge(t,e){var n=function(t,e){return he(t,e,[1,1],!0)}(t,e.conv1);return n=pe(n,e.conv2),n=o.c(n,t),n=o.w(n)}function ye(t,e){var n=fe(t,e.conv1);n=pe(n,e.conv2);var r=o.d(t,2,2,"valid"),c=o.P(r.shape),h=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var f=Object(l.e)(n.shape);f[1]=1;var d=o.P(f);n=o.h([n,d],1);var v=Object(l.e)(n.shape);v[2]=1;var m=o.P(v);n=o.h([n,m],2)}return r=h?o.h([r,c],3):r,n=o.c(r,n),n=o.w(n)}var be=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return o.L((function(){var e=fe(D(input.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(o.y(256)),t.conv32_down);e=ge(e=o.s(e,3,2,"valid"),t.conv32_1),e=ge(e,t.conv32_2),e=ge(e,t.conv32_3),e=ge(e=ye(e,t.conv64_down),t.conv64_1),e=ge(e,t.conv64_2),e=ge(e,t.conv64_3),e=ge(e=ye(e,t.conv128_down),t.conv128_1),e=ge(e,t.conv128_2),e=ge(e=ye(e,t.conv256_down),t.conv256_1);var n=(e=ye(e=ge(e,t.conv256_2),t.conv256_down_out)).mean([1,2]);return o.q(n,t.fc)}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.computeFaceDescriptor=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(l.d)(this,(function(c){switch(c.label){case 0:return[4,mt(input)];case 1:return t=c.sent(),e=o.L((function(){return o.O(r.forwardInput(t))})),[4,Promise.all(e.map((function(t){return t.data()})))];case 2:return n=c.sent(),e.forEach((function(t){return t.dispose()})),[2,t.isBatchInput?n:n[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return me(t)},e.prototype.extractParams=function(t){return function(t){var e=Pt(t),n=e.extractWeights,r=e.getRemainingWeights,c=[],l=de(n,c),h=l.extractConvLayerParams,f=l.extractResidualLayerParams,d=h(4704,32,7,"conv32_down"),v=f(9216,32,3,"conv32_1"),m=f(9216,32,3,"conv32_2"),y=f(9216,32,3,"conv32_3"),x=f(36864,64,3,"conv64_down",!0),w=f(36864,64,3,"conv64_1"),_=f(36864,64,3,"conv64_2"),C=f(36864,64,3,"conv64_3"),E=f(147456,128,3,"conv128_down",!0),T=f(147456,128,3,"conv128_1"),S=f(147456,128,3,"conv128_2"),k=f(589824,256,3,"conv256_down",!0),A=f(589824,256,3,"conv256_1"),I=f(589824,256,3,"conv256_2"),R=f(589824,256,3,"conv256_down_out"),O=o.L((function(){return o.N(o.I(n(32768),[128,256]),[1,0])}));if(c.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:d,conv32_1:v,conv32_2:m,conv32_3:y,conv64_down:x,conv64_1:w,conv64_2:_,conv64_3:C,conv128_down:E,conv128_1:T,conv128_2:S,conv256_down:k,conv256_1:A,conv256_2:I,conv256_down_out:R,fc:O},paramMappings:c}}(t)},e}(Et);function xe(t,e){var n={descriptor:e};return Object.assign({},t,n)}function we(t,e){var n={age:e};return Object.assign({},t,n)}function _e(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var Ce=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,c=e.scoreThresholds,l=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=c||[.6,.7,.7],this._scaleSteps=l,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(th){return"number"!=typeof th})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(th){return"number"!=typeof th}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function Ee(t,e){function n(n,r,c,l,h){var f=o.K(t(n*r*c*c),[c,c,n,r]),d=o.H(t(r));return e.push({paramPath:l+"/filters"},{paramPath:l+"/"+(h?"batch_norm_offset":"bias")}),{filters:f,bias:d}}function r(t,e,r,o){var c=n(t,e,r,o,!0);return{filters:c.filters,batch_norm_offset:c.bias}}function c(n,c,l){return{depthwise_conv:function(n,r){var c=o.K(t(9*n),[3,3,n,1]),l=o.H(t(n)),h=o.H(t(n)),f=o.H(t(n)),d=o.H(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:c,batch_norm_scale:l,batch_norm_offset:h,batch_norm_mean:f,batch_norm_variance:d}}(n,l+"/depthwise_conv"),pointwise_conv:r(n,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:c(32,64,"mobilenetv1/conv_1"),conv_2:c(64,128,"mobilenetv1/conv_2"),conv_3:c(128,128,"mobilenetv1/conv_3"),conv_4:c(128,256,"mobilenetv1/conv_4"),conv_5:c(256,256,"mobilenetv1/conv_5"),conv_6:c(256,512,"mobilenetv1/conv_6"),conv_7:c(512,512,"mobilenetv1/conv_7"),conv_8:c(512,512,"mobilenetv1/conv_8"),conv_9:c(512,512,"mobilenetv1/conv_9"),conv_10:c(512,512,"mobilenetv1/conv_10"),conv_11:c(512,512,"mobilenetv1/conv_11"),conv_12:c(512,1024,"mobilenetv1/conv_12"),conv_13:c(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Te(t){var e=[],n=function(t,e){var n=Ft(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",c=e+"/depthwise_conv",l=e+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,c+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,c+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,c+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,c+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,c+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,l)}}function c(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function l(t){return{box_encoding_predictor:c("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:c("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}}}(t,e),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,c=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!d(c))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+c);var l={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:c}};return It(t,e),{params:l,paramMappings:e}}function Se(t,e,n){return o.L((function(){var r=o.i(t,e.filters,n,"same");return r=o.c(r,e.batch_norm_offset),o.g(r,0,6)}))}function ke(t,e){return o.L((function(){var n=null,r=Se(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach((function(param,i){var t=i+1,e=function(t){return[2,4,6,12].some((function(e){return e===t}))?[2,2]:[1,1]}(t);r=Se(r=function(t,e,n){return o.L((function(){var r=o.j(t,e.filters,n,"same");return r=o.e(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),o.g(r,0,6)}))}(r,param.depthwise_conv,e),param.pointwise_conv,[1,1]),11===t&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function Ae(t,i,e){var n=t.arraySync(),r=Math.min(n[i][0],n[i][2]),o=Math.min(n[i][1],n[i][3]),c=Math.max(n[i][0],n[i][2]),l=Math.max(n[i][1],n[i][3]),h=Math.min(n[e][0],n[e][2]),f=Math.min(n[e][1],n[e][3]),d=Math.max(n[e][0],n[e][2]),v=Math.max(n[e][1],n[e][3]),m=(c-r)*(l-o),y=(d-h)*(v-f);if(m<=0||y<=0)return 0;var x=Math.max(r,h),w=Math.max(o,f),_=Math.min(c,d),C=Math.min(l,v),E=Math.max(_-x,0)*Math.max(C-w,0);return E/(m+y-E)}function Ie(t,e){var n=function(t){var e=o.O(o.N(t,[1,0])),n=[o.F(e[2],e[0]),o.F(e[3],e[1])];return{sizes:n,centers:[o.c(e[0],o.k(n[0],o.y(2))),o.c(e[1],o.k(n[1],o.y(2)))]}}(t),r=n.sizes,c=n.centers,l=o.O(o.N(e,[1,0])),h=o.k(o.t(o.l(o.k(l[2],o.y(5))),r[0]),o.y(2)),f=o.c(o.t(o.k(l[0],o.y(10)),r[0]),c[0]),d=o.k(o.t(o.l(o.k(l[3],o.y(5))),r[1]),o.y(2)),v=o.c(o.t(o.k(l[1],o.y(10)),r[1]),c[1]);return o.N(o.E([o.F(f,h),o.F(v,d),o.c(f,h),o.c(v,d)]),[1,0])}function Re(t,e){return o.L((function(){var n=t.shape[0];return{boxPredictionEncoding:o.x(At(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:o.x(At(t,e.class_predictor),[n,-1,3])}}))}var Oe=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),De=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return Object(l.c)(e,t),e.prototype.forwardInput=function(input){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return o.L((function(){var e=input.toBatchTensor(512,!1).toFloat(),n=ke(o.F(o.t(e,o.y(.007843137718737125)),o.y(1)),t.mobilenetv1),r=function(t,e,n){return o.L((function(){var r=Se(t,n.conv_0,[1,1]),c=Se(r,n.conv_1,[2,2]),l=Se(c,n.conv_2,[1,1]),h=Se(l,n.conv_3,[2,2]),f=Se(h,n.conv_4,[1,1]),d=Se(f,n.conv_5,[2,2]),v=Se(d,n.conv_6,[1,1]),m=Se(v,n.conv_7,[2,2]),y=Re(e,n.box_predictor_0),x=Re(t,n.box_predictor_1),w=Re(c,n.box_predictor_2),_=Re(h,n.box_predictor_3),C=Re(d,n.box_predictor_4),E=Re(m,n.box_predictor_5);return{boxPredictions:o.h([y.boxPredictionEncoding,x.boxPredictionEncoding,w.boxPredictionEncoding,_.boxPredictionEncoding,C.boxPredictionEncoding,E.boxPredictionEncoding],1),classPredictions:o.h([y.classPrediction,x.classPrediction,w.classPrediction,_.classPrediction,C.classPrediction,E.classPrediction],1)}}))}(n.out,n.conv11,t.prediction_layer);return function(t,e,n){return o.L((function(){var r=t.shape[0],c=Ie(o.x(o.M(n.extra_dim,[r,1,1]),[-1,4]),o.x(t,[-1,4]));c=o.x(c,[r,c.shape[0]/r,4]);var l=o.A(o.B(e,[0,0,1],[-1,-1,-1])),h=o.B(l,[0,0,0],[-1,-1,1]);return h=o.x(h,[r,h.shape[1]]),{boxes:o.O(c),scores:o.O(h)}}))}(r.boxPredictions,r.classPredictions,t.output_layer)}))},e.prototype.forward=function(input){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return t=this.forwardInput,[4,mt(input)];case 1:return[2,t.apply(this,[e.sent()])]}}))}))},e.prototype.locateFaces=function(input,t){return void 0===t&&(t={}),Object(l.b)(this,void 0,void 0,(function(){var e,n,r,o,c,h,f,d,v,i,m,y,x,w,_,C,E,T,S,k;return Object(l.d)(this,(function(l){switch(l.label){case 0:return e=new Oe(t),n=e.maxResults,r=e.minConfidence,[4,mt(input)];case 1:for(o=l.sent(),c=this.forwardInput(o),h=c.boxes,f=c.scores,d=h[0],v=f[0],i=1;i<h.length;i++)h[i].dispose(),f[i].dispose();return x=(y=Array).from,[4,v.data()];case 2:return m=x.apply(y,[l.sent()]),.5,w=function(t,e,n,r,o){var c=t.shape[0],l=Math.min(n,c),h=e.map((function(t,e){return{score:t,boxIndex:e}})).filter((function(t){return t.score>o})).sort((function(t,e){return e.score-t.score})),f=[];return h.forEach((function(e){if(!(f.length>=l)){for(var n=e.score,c=f.length-1;c>=0;--c){var h=Ae(t,e.boxIndex,f[c]);if(0!==h&&(e.score*=h<=r?1:0,e.score<=o))break}n===e.score&&f.push(e.boxIndex)}})),f}(d,m,n,.5,r),_=o.getReshapedInputDimensions(0),C=o.inputSize,E=C/_.width,T=C/_.height,S=d.arraySync(),k=w.map((function(t){var e=[Math.max(0,S[t][0]),Math.min(1,S[t][2])].map((function(t){return t*T})),n=e[0],r=e[1],c=[Math.max(0,S[t][1]),Math.min(1,S[t][3])].map((function(t){return t*E})),l=c[0],h=c[1];return new I(m[t],new N(l,n,h-l,r-n),{height:o.getInputHeight(0),width:o.getInputWidth(0)})})),d.dispose(),v.dispose(),[2,k]}}))}))},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Te(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Pt(t),r=n.extractWeights,c=n.getRemainingWeights,l=Ee(r,e),h=l.extractMobilenetV1Params,f=l.extractPredictionLayerParams,d=h(),v=f(),m={extra_dim:o.J(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==c().length)throw new Error("weights remaing after extract: "+c().length);return{params:{mobilenetv1:d,prediction_layer:v,output_layer:m},paramMappings:e}}(t)},e}(Et);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Object(l.c)(e,t)}(De);var Me,Ne=[new T(.738768,.874946),new T(2.42204,2.65704),new T(4.30971,7.04493),new T(10.246,4.59428),new T(12.6868,11.8741)],Fe=[new T(1.603231,2.094468),new T(6.041143,7.080126),new T(2.882459,3.518061),new T(4.266906,5.178857),new T(9.041765,10.66308)],Pe=[117.001,114.697,97.404],Be=function(t){return"number"==typeof t};function Le(t){return o.L((function(){var e=o.t(t,o.y(.10000000149011612));return o.c(o.w(o.F(t,e)),e)}))}function We(t,e){return o.L((function(){var n=o.v(t,[[0,0],[1,1],[1,1],[0,0]]);return n=o.i(n,e.conv.filters,[1,1],"valid"),n=o.F(n,e.bn.sub),n=o.t(n,e.bn.truediv),Le(n=o.c(n,e.conv.bias))}))}function Ve(t,e){return o.L((function(){var n=o.v(t,[[0,0],[1,1],[1,1],[0,0]]);return n=o.z(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),Le(n=o.c(n,e.bias))}))}function Ue(t,e){var n=Rt(t,e);var r=Mt(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,c,l){return{conv:n(r,c,3,l+"/conv"),bn:function(n,r){var sub=o.H(t(n)),c=o.H(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:sub,truediv:c}}(c,l+"/bn")}},extractSeparableConvParams:r}}function je(t,e){var n=Ft(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){return{conv:r(t+"/conv"),bn:function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn")}},extractSeparableConvParams:Nt(n)}}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(Me||(Me={}));var ze=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),qe=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return function(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!Be(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every((function(t){return"string"==typeof t})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map((function(a){return a||{}})).every((function(a){return Be(a.x)&&Be(a.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(Be)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=We(t,e.conv0);return n=We(n=o.s(n,[2,2],[2,2],"same"),e.conv1),n=We(n=o.s(n,[2,2],[2,2],"same"),e.conv2),n=We(n=o.s(n,[2,2],[2,2],"same"),e.conv3),n=We(n=o.s(n,[2,2],[2,2],"same"),e.conv4),n=We(n=o.s(n,[2,2],[2,2],"same"),e.conv5),n=We(n=o.s(n,[2,2],[1,1],"same"),e.conv6),At(n=We(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?Le(At(t,e.conv0,"valid",!1)):Ve(t,e.conv0);return n=Ve(n=o.s(n,[2,2],[2,2],"same"),e.conv1),n=Ve(n=o.s(n,[2,2],[2,2],"same"),e.conv2),n=Ve(n=o.s(n,[2,2],[2,2],"same"),e.conv3),n=Ve(n=o.s(n,[2,2],[2,2],"same"),e.conv4),n=Ve(n=o.s(n,[2,2],[2,2],"same"),e.conv5),n=o.s(n,[2,2],[1,1],"same"),n=e.conv6?Ve(n,e.conv6):n,At(n=e.conv7?Ve(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(input,t){var e=this,n=this.params;if(!n)throw new Error("TinyYolov2 - load model before inference");return o.L((function(){var r=input.toBatchTensor(t,!1).toFloat();return r=(r=e.config.meanRgb?D(r,e.config.meanRgb):r).div(o.y(256)),e.config.withSeparableConvs?e.runMobilenet(r,n):e.runTinyYolov2(r,n)}))},e.prototype.forward=function(input,t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,mt(input)];case 1:return[4,e.apply(this,[n.sent(),t])];case 2:return[2,n.sent()]}}))}))},e.prototype.detect=function(input,t){return void 0===t&&(t={}),Object(l.b)(this,void 0,void 0,(function(){var e,n,r,c,h,f,d,v,m,y,x,w,_,C=this;return Object(l.d)(this,(function(l){switch(l.label){case 0:return e=new ze(t),n=e.inputSize,r=e.scoreThreshold,[4,mt(input)];case 1:return c=l.sent(),[4,this.forwardInput(c,n)];case 2:return h=l.sent(),f=o.L((function(){return o.O(h)[0].expandDims()})),d={width:c.getInputWidth(0),height:c.getInputHeight(0)},[4,this.extractBoxes(f,c.getReshapedInputDimensions(0),r)];case 3:return v=l.sent(),h.dispose(),f.dispose(),m=v.map((function(t){return t.box})),y=v.map((function(t){return t.score})),x=v.map((function(t){return t.classScore})),w=v.map((function(t){return C.config.classes[t.label]})),_=O(m.map((function(t){return t.rescale(n)})),y,this.config.iouThreshold,!0),[2,_.map((function(t){return new A(y[t],x[t],w[t],m[t],d)}))]}}))}))},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=je(t,r),c=o.extractConvParams,l=o.extractConvWithBatchNormParams,h=o.extractSeparableConvParams;if(e.withSeparableConvs){var f=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?c("conv0"):h("conv0"),conv1:h("conv1"),conv2:h("conv2"),conv3:h("conv3"),conv4:h("conv4"),conv5:h("conv5"),conv6:f>7?h("conv6"):void 0,conv7:f>8?h("conv7"):void 0,conv8:c("conv8")}}else n={conv0:l("conv0"),conv1:l("conv1"),conv2:l("conv2"),conv3:l("conv3"),conv4:l("conv4"),conv5:l("conv5"),conv6:l("conv6"),conv7:l("conv7"),conv8:c("conv8")};return It(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,c=Pt(t),l=c.extractWeights,h=c.getRemainingWeights,f=[],d=Ue(l,f),v=d.extractConvParams,m=d.extractConvWithBatchNormParams,y=d.extractSeparableConvParams;if(e.withSeparableConvs){var x=r[0],w=r[1],_=r[2],C=r[3],E=r[4],T=r[5],S=r[6],k=r[7],A=r[8];o={conv0:e.isFirstLayerConv2d?v(x,w,3,"conv0"):y(x,w,"conv0"),conv1:y(w,_,"conv1"),conv2:y(_,C,"conv2"),conv3:y(C,E,"conv3"),conv4:y(E,T,"conv4"),conv5:y(T,S,"conv5"),conv6:k?y(S,k,"conv6"):void 0,conv7:A?y(k,A,"conv7"):void 0,conv8:v(A||k||S,5*n,1,"conv8")}}else{x=r[0],w=r[1],_=r[2],C=r[3],E=r[4],T=r[5],S=r[6],k=r[7],A=r[8];o={conv0:m(x,w,"conv0"),conv1:m(w,_,"conv1"),conv2:m(_,C,"conv2"),conv3:m(C,E,"conv3"),conv4:m(E,T,"conv4"),conv5:m(T,S,"conv5"),conv6:m(S,k,"conv6"),conv7:m(k,A,"conv7"),conv8:v(A,5*n,1,"conv8")}}if(0!==h().length)throw new Error("weights remaing after extract: "+h().length);return{params:o,paramMappings:f}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return Object(l.b)(this,void 0,void 0,(function(){var r,c,h,f,d,v,m,y,x,w,_,C,E,T,S,col,A,I,R,O,D,N,F,P,B,L,W,label,V,U=this;return Object(l.d)(this,(function(j){switch(j.label){case 0:return r=e.width,c=e.height,h=Math.max(r,c),f=h/r,d=h/c,v=t.shape[1],m=this.config.anchors.length,y=o.L((function(){var e=t.reshape([v,v,m,U.boxEncodingSize]);return[e.slice([0,0,0,0],[v,v,m,4]),e.slice([0,0,0,4],[v,v,m,1]),U.withClassScores?o.D(e.slice([0,0,0,5],[v,v,m,U.config.classes.length]),3):o.y(0)]})),x=y[0],w=y[1],_=y[2],C=[],[4,w.array()];case 1:return E=j.sent(),[4,x.array()];case 2:T=j.sent(),S=0,j.label=3;case 3:if(!(S<v))return[3,12];col=0,j.label=4;case 4:if(!(col<v))return[3,11];A=0,j.label=5;case 5:return A<m?(I=M(E[S][col][A][0]),!n||I>n?(R=(col+M(T[S][col][A][0]))/v*f,O=(S+M(T[S][col][A][1]))/v*d,D=Math.exp(T[S][col][A][2])*this.config.anchors[A].x/v*f,N=Math.exp(T[S][col][A][3])*this.config.anchors[A].y/v*d,F=R-D/2,P=O-N/2,B={row:S,col:col,anchor:A},this.withClassScores?[4,this.extractPredictedClass(_,B)]:[3,7]):[3,9]):[3,10];case 6:return V=j.sent(),[3,8];case 7:V={classScore:1,label:0},j.label=8;case 8:W=(L=V).classScore,label=L.label,C.push(Object(l.a)({box:new k(F,P,F+D,P+N),score:I,classScore:I*W,label:label},B)),j.label=9;case 9:return A++,[3,5];case 10:return col++,[3,4];case 11:return S++,[3,3];case 12:return x.dispose(),w.dispose(),_.dispose(),[2,C]}}))}))},e.prototype.extractPredictedClass=function(t,e){return Object(l.b)(this,void 0,void 0,(function(){var n,col,r,o;return Object(l.d)(this,(function(c){switch(c.label){case 0:return n=e.row,col=e.col,r=e.anchor,[4,t.array()];case 1:return o=c.sent(),[2,Array(this.config.classes.length).fill(0).map((function(t,i){return o[n][col][r][i]})).map((function(t,label){return{classScore:t,label:label}})).reduce((function(t,e){return t.classScore>e.classScore?t:e}))]}}))}))},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Et),Ge=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:Fe,meanRgb:Pe}:{anchors:Ne,withClassScores:!0});return t.call(this,n)||this}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(input,t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.detect(input,t)];case 1:return[2,e.sent().map((function(t){return new I(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(qe);var He=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return Object(l.c)(e,t),e}(ze),Xe=function(){function t(){}return t.prototype.then=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}}))}))},t.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(t){throw new Error("ComposableTask - run is not implemented")}))}))},t}();function Ke(t,input,e,n,r){return void 0===r&&(r=function(t){return t.alignedRect}),Object(l.b)(this,void 0,void 0,(function(){var c,h,f,d,v;return Object(l.d)(this,(function(l){switch(l.label){case 0:return c=t.map((function(t){return Yt(t)?r(t):t.detection})),(f=n)?[3,5]:input instanceof o.a?[4,yt(input,c)]:[3,2];case 1:return d=l.sent(),[3,4];case 2:return[4,gt(input,c)];case 3:d=l.sent(),l.label=4;case 4:f=d,l.label=5;case 5:return[4,e(h=f)];case 6:return v=l.sent(),h.forEach((function(t){return t instanceof o.a&&t.dispose()})),[2,v]}}))}))}function Ye(t,input,e,n,r){return Object(l.b)(this,void 0,void 0,(function(){var o=this;return Object(l.d)(this,(function(c){return[2,Ke([t],input,(function(t){return Object(l.b)(o,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return[2,e(t[0])]}))}))}),n,r)]}))}))}function $e(t){var e=Pt(t),n=e.extractWeights,r=e.getRemainingWeights,c=[],h=function(t,e){var n=Rt(t,e),r=Ot(t,e);function c(n,r){var c=o.H(t(n));return e.push({paramPath:r}),c}function h(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:c(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:c(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:c(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=h([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Object(l.a)(Object(l.a)({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=h([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=c(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return Object(l.a)(Object(l.a)({},t),{fc1:e,prelu4_alpha:n,fc2_1:o,fc2_2:f})},extractONetParams:function(){var t=h([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),o=c(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),d=c(256,"onet/prelu5_alpha"),v=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return Object(l.a)(Object(l.a)({},t),{conv4:e,prelu4_alpha:o,fc1:f,prelu5_alpha:d,fc2_1:v,fc2_2:m,fc2_3:y})}}}(n,c),f=h.extractPNetParams,d=h.extractRNetParams,v=h.extractONetParams,m=f(),y=d(),x=v();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:m,rnet:y,onet:x},paramMappings:c}}function Ze(t){var e=[],n=function(t,e){var n=Ft(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function o(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function c(t){return n(t,1)}function h(t){return{conv1:r(t+"/conv1"),prelu1_alpha:c(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:c(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:c(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=h("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Object(l.a)(Object(l.a)({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=h("rnet"),e=o("rnet/fc1"),n=c("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),f=o("rnet/fc2_2");return Object(l.a)(Object(l.a)({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:f})},extractONetParams:function(){var t=h("onet"),e=r("onet/conv4"),n=c("onet/prelu4_alpha"),f=o("onet/fc1"),d=c("onet/prelu5_alpha"),v=o("onet/fc2_1"),m=o("onet/fc2_2"),y=o("onet/fc2_3");return Object(l.a)(Object(l.a)({},t),{conv4:e,prelu4_alpha:n,fc1:f,prelu5_alpha:d,fc2_1:v,fc2_2:m,fc2_3:y})}}}(t,e),r=n.extractPNetParams,o=n.extractRNetParams,c=n.extractONetParams,h=r(),f=o(),d=c();return It(t,e),{params:{pnet:h,rnet:f,onet:d},paramMappings:e}}function Qe(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}var Je=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return Object(l.c)(e,t),e}(S);function tn(t){return o.L((function(){return o.t(o.F(t,o.y(127.5)),o.y(.0078125))}))}function en(t,e){return o.L((function(){return o.c(o.w(t),o.t(e,o.u(o.w(o.u(t)))))}))}function nn(t,e,n){return void 0===n&&(n=!1),o.L((function(){var r=At(t,e.conv1,"valid");return r=en(r,e.prelu1_alpha),r=en(r=At(r=o.s(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),r=en(r=At(r=n?r:o.s(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)}))}function rn(t,e,n,r,c){c.stage1=[];var l=e.map((function(e){return o.L((function(){var n={scale:e},c=function(t,e){return o.L((function(){var n=Qe(e,t.shape.slice(1)),r=n.height,c=n.width,l=tn(o.o.resizeBilinear(t,[r,c]));return o.N(l,[0,2,1,3])}))}(t,e),l=Date.now(),h=function(t,e){return o.L((function(){var n=nn(t,e,!0),r=At(n,e.conv4_1,"valid"),c=o.m(o.r(r,3),3);return{prob:o.D(o.F(r,c),3),regions:At(n,e.conv4_2,"valid")}}))}(c,r),f=h.prob,d=h.regions;return n.pnet=Date.now()-l,{scoresTensor:o.O(o.O(f,3)[1])[0],regionsTensor:o.O(d)[0],scale:e,statsForScale:n}}))})).map((function(t){var e=t.scoresTensor,r=t.regionsTensor,o=t.scale,l=t.statsForScale,h=function(t,e,n,r){for(var o=[],c=t.arraySync(),l=0;l<t.shape[0];l++)for(var h=0;h<t.shape[1];h++)c[l][h]>=r&&o.push(new T(h,l));return o.map((function(t){var r=new k(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),o=c[t.y][t.x],l=e.arraySync();return{cell:r,score:o,region:new Je(l[t.y][t.x][0],l[t.y][t.x][1],l[t.y][t.x][2],l[t.y][t.x][3])}}))}(e,r,o,n);if(e.dispose(),r.dispose(),!h.length)return c.stage1.push(l),[];var f=Date.now(),d=O(h.map((function(t){return t.cell})),h.map((function(t){return t.score})),.5);return l.nms=Date.now()-f,l.numBoxes=d.length,c.stage1.push(l),d.map((function(t){return h[t]}))})).reduce((function(t,e){return t.concat(e)}),[]),h=[],f=[];if(l.length>0){var d=Date.now(),v=O(l.map((function(t){return t.cell})),l.map((function(t){return t.score})),.7);c.stage1_nms=Date.now()-d,f=v.map((function(t){return l[t].score})),h=v.map((function(t){return l[t]})).map((function(t){var e=t.cell,n=t.region;return new k(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()}))}return{boxes:h,scores:f}}function on(img,t,e){var n=e.width,r=e.height;return Object(l.b)(this,void 0,void 0,(function(){var e,c,h,f=this;return Object(l.d)(this,(function(d){switch(d.label){case 0:return e=et(img),[4,Promise.all(t.map((function(t){return Object(l.b)(f,void 0,void 0,(function(){var n,r,o,c,h,f,d,v;return Object(l.d)(this,(function(l){return n=t.padAtBorders(img.height,img.width),r=n.y,o=n.ey,c=n.x,h=n.ex,f=c-1,d=r-1,v=e.getImageData(f,d,h-f,o-d),[2,J.isNodejs()?ht(v):createImageBitmap(v)]}))}))})))];case 1:return c=d.sent(),h=[],c.forEach((function(t){var e=et(lt({width:n,height:r}));e.drawImage(t,0,0,n,r);for(var data=e.getImageData(0,0,n,r).data,o=[],i=0;i<data.length;i+=4)o.push(data[i+2]),o.push(data[i+1]),o.push(data[i]);h.push(o)})),[2,h.map((function(data){return o.L((function(){return tn(o.N(o.K(data,[1,n,r,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function an(img,t,e,n,r){return Object(l.b)(this,void 0,void 0,(function(){var c,h,f,d,v,m,y,x,w,_,C,E,T,S;return Object(l.d)(this,(function(l){switch(l.label){case 0:return c=Date.now(),[4,on(img,t,{width:24,height:24})];case 1:return h=l.sent(),r.stage2_extractImagePatches=Date.now()-c,c=Date.now(),f=h.map((function(t){var e=function(t,e){return o.L((function(){var n=nn(t,e),r=en(Ut(o.x(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),c=Ut(r,e.fc2_1),l=o.m(o.r(c,1),1),h=o.D(o.F(c,l),1),f=Ut(r,e.fc2_2);return{scores:o.O(h,1)[1],regions:f}}))}(t,n);return t.dispose(),e})),r.stage2_rnet=Date.now()-c,d=f.length>1?o.h(f.map((function(t){return t.scores}))):f[0].scores,y=(m=Array).from,[4,d.data()];case 2:return v=y.apply(m,[l.sent()]),d.dispose(),x=v.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>e})).map((function(t){return t.idx})),w=x.map((function(e){return t[e]})),_=x.map((function(t){return v[t]})),C=[],E=[],w.length>0&&(c=Date.now(),T=O(w,_,.7),r.stage2_nms=Date.now()-c,S=T.map((function(t){var e=f[x[t]].regions.arraySync();return new Je(e[0][0],e[0][1],e[0][2],e[0][3])})),E=T.map((function(t){return _[t]})),C=T.map((function(t,i){return w[t].calibrate(S[i])}))),f.forEach((function(t){t.regions.dispose(),t.scores.dispose()})),[2,{boxes:C,scores:E}]}}))}))}function sn(img,t,e,n,r){return Object(l.b)(this,void 0,void 0,(function(){var c,h,f,d,v,m,y,x,w,_,C,E,S,k,A;return Object(l.d)(this,(function(l){switch(l.label){case 0:return c=Date.now(),[4,on(img,t,{width:48,height:48})];case 1:return h=l.sent(),r.stage3_extractImagePatches=Date.now()-c,c=Date.now(),f=h.map((function(t){var e=function(t,e){return o.L((function(){var n=nn(t,e);n=en(n=At(n=o.s(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var r=en(Ut(o.x(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),c=Ut(r,e.fc2_1),l=o.m(o.r(c,1),1),h=o.D(o.F(c,l),1),f=Ut(r,e.fc2_2),d=Ut(r,e.fc2_3);return{scores:o.O(h,1)[1],regions:f,points:d}}))}(t,n);return t.dispose(),e})),r.stage3_onet=Date.now()-c,d=f.length>1?o.h(f.map((function(t){return t.scores}))):f[0].scores,y=(m=Array).from,[4,d.data()];case 2:return v=y.apply(m,[l.sent()]),d.dispose(),x=v.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>e})).map((function(t){return t.idx})),w=x.map((function(t){var e=f[t].regions.arraySync();return new Je(e[0][0],e[0][1],e[0][2],e[0][3])})),_=x.map((function(e,i){return t[e].calibrate(w[i])})),C=x.map((function(t){return v[t]})),E=[],S=[],k=[],_.length>0&&(c=Date.now(),A=O(_,C,.7,!1),r.stage3_nms=Date.now()-c,E=A.map((function(t){return _[t]})),S=A.map((function(t){return C[t]})),k=A.map((function(t,i){return Array(5).fill(0).map((function(e,n){var r=f[t].points.arraySync();return new T(r[0][n]*(E[i].width+1)+E[i].left,r[0][n+5]*(E[i].height+1)+E[i].top)}))}))),f.forEach((function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()})),[2,{boxes:E,scores:S,points:k}]}}))}))}var un=function(t){function e(){return t.call(this,"Mtcnn")||this}return Object(l.c)(e,t),e.prototype.load=function(e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]}))}))},e.prototype.loadFromDisk=function(e){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]}))}))},e.prototype.forwardInput=function(input,t){return void 0===t&&(t={}),Object(l.b)(this,void 0,void 0,(function(){var e,n,r,c,h,f,d,v,m,y,x,w,_,C,E,S,k,A,R,O,D;return Object(l.d)(this,(function(l){switch(l.label){case 0:if(!(e=this.params))throw new Error("Mtcnn - load model before inference");if(!(n=input.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return r={},c=Date.now(),h=o.L((function(){return t=o.m(o.f.fromPixels(n)).toFloat(),o.L((function(){return o.E(o.O(t,3).reverse(),3)}));var t})),f=function(t){return h.dispose(),r.total=Date.now()-c,t},d=h.shape.slice(1),v=d[0],m=d[1],y=new Ce(t),x=y.minFaceSize,w=y.scaleFactor,_=y.maxNumScales,C=y.scoreThresholds,E=y.scaleSteps,S=(E||function(t,e,n){for(var r=n[0],o=n[1],c=12/t,l=[],h=Math.min(r,o)*c,f=0;h>=12;)l.push(c*Math.pow(e,f)),h*=e,f+=1;return l}(x,w,[v,m])).filter((function(t){var e=Qe(t,[v,m]);return Math.min(e.width,e.height)>12})).slice(0,_),r.scales=S,r.pyramid=S.map((function(t){return Qe(t,[v,m])})),k=Date.now(),[4,rn(h,S,C[0],e.pnet,r)];case 1:return A=l.sent(),r.total_stage1=Date.now()-k,A.boxes.length?(r.stage2_numInputBoxes=A.boxes.length,k=Date.now(),[4,an(n,A.boxes,C[1],e.rnet,r)]):[2,f({results:[],stats:r})];case 2:return R=l.sent(),r.total_stage2=Date.now()-k,R.boxes.length?(r.stage3_numInputBoxes=R.boxes.length,k=Date.now(),[4,sn(n,R.boxes,C[2],e.onet,r)]):[2,f({results:[],stats:r})];case 3:return O=l.sent(),r.total_stage3=Date.now()-k,D=O.boxes.map((function(t,e){return $t(j({},new I(O.scores[e],new N(t.left/m,t.top/v,t.width/m,t.height/v),{height:v,width:m})),new P(O.points[e].map((function(e){return e.sub(new T(t.left,t.top)).div(new T(t.width,t.height))})),{width:t.width,height:t.height}))})),[2,f({results:D,stats:r})]}}))}))},e.prototype.forward=function(input,t){return void 0===t&&(t={}),Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,mt(input)];case 1:return[4,e.apply(this,[n.sent(),t])];case 2:return[2,n.sent().results]}}))}))},e.prototype.forwardWithStats=function(input,t){return void 0===t&&(t={}),Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,mt(input)];case 1:return[2,e.apply(this,[n.sent(),t])]}}))}))},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ze(t)},e.prototype.extractParams=function(t){return $e(t)},e}(Et),cn=[new T(1.603231,2.094468),new T(6.041143,7.080126),new T(2.882459,3.518061),new T(4.266906,5.178857),new T(9.041765,10.66308)],ln=[117.001,114.697,97.404],hn=function(t){function e(){var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:cn,meanRgb:ln,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)||this}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(input,t){return Object(l.b)(this,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.detect(input,t)];case 1:return[2,e.sent().map((function(t){return new I(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(qe),pn={ssdMobilenetv1:new De,tinyFaceDetector:new hn,tinyYolov2:new Ge,mtcnn:new un,faceLandmark68Net:new ue,faceLandmark68TinyNet:new le,faceRecognitionNet:new be,faceExpressionNet:new Ht,ageGenderNet:new ae},fn=function(t){function e(e,input,n){var r=t.call(this)||this;return r.parentTask=e,r.input=input,r.extractedFaces=n,r}return Object(l.c)(e,t),e}(Xe),dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Ke(t=r.sent(),this.input,(function(t){return Object(l.b)(n,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return pn.faceExpressionNet.predictExpressions(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,i){return Xt(t,e[i])}))]}}))}))},e.prototype.withAgeAndGender=function(){return new bn(this,this.input)},e}(fn),vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Ye(t,this.input,(function(t){return pn.faceExpressionNet.predictExpressions(t)}),this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,Xt(t,e)]}}))}))},e.prototype.withAgeAndGender=function(){return new xn(this,this.input)},e}(fn),mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.withAgeAndGender=function(){return new wn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new En(this,this.input)},e}(dn),gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Tn(this,this.input)},e}(vn),yn=function(t){function e(e,input,n){var r=t.call(this)||this;return r.parentTask=e,r.input=input,r.extractedFaces=n,r}return Object(l.c)(e,t),e}(Xe),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n=this;return Object(l.d)(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Ke(t=r.sent(),this.input,(function(t){return Object(l.b)(n,void 0,void 0,(function(){return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return pn.ageGenderNet.predictAgeAndGender(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,i){var n=e[i],r=n.age;return we(_e(t,n.gender,n.genderProbability),r)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new dn(this,this.input)},e}(yn),xn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,o;return Object(l.d)(this,(function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return(t=c.sent())?[4,Ye(t,this.input,(function(t){return pn.ageGenderNet.predictAgeAndGender(t)}),this.extractedFaces)]:[2];case 2:return e=c.sent(),n=e.age,r=e.gender,o=e.genderProbability,[2,we(_e(t,r,o),n)]}}))}))},e.prototype.withFaceExpressions=function(){return new vn(this,this.input)},e}(yn),wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.withFaceExpressions=function(){return new mn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new En(this,this.input)},e}(bn),_n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.withFaceExpressions=function(){return new gn(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Tn(this,this.input)},e}(xn),Cn=function(t){function e(e,input){var n=t.call(this)||this;return n.parentTask=e,n.input=input,n}return Object(l.c)(e,t),e}(Xe),En=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,Ke(t=e.sent(),this.input,(function(t){return Promise.all(t.map((function(t){return pn.faceRecognitionNet.computeFaceDescriptor(t)})))}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,e.sent().map((function(e,i){return xe(t[i],e)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new mn(this,this.input)},e.prototype.withAgeAndGender=function(){return new wn(this,this.input)},e}(Cn),Tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Ye(t,this.input,(function(t){return pn.faceRecognitionNet.computeFaceDescriptor(t)}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return e=n.sent(),[2,xe(t,e)]}}))}))},e.prototype.withFaceExpressions=function(){return new gn(this,this.input)},e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e}(Cn),Sn=function(t){function e(e,input,n){var r=t.call(this)||this;return r.parentTask=e,r.input=input,r.useTinyLandmarkNet=n,r}return Object(l.c)(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?pn.faceLandmark68TinyNet:pn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Xe),kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,c,h=this;return Object(l.d)(this,(function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),e=t.map((function(t){return t.detection})),this.input instanceof o.a?[4,yt(this.input,e)]:[3,3];case 2:return r=l.sent(),[3,5];case 3:return[4,gt(this.input,e)];case 4:r=l.sent(),l.label=5;case 5:return n=r,[4,Promise.all(n.map((function(t){return h.landmarkNet.detectLandmarks(t)})))];case 6:return c=l.sent(),n.forEach((function(t){return t instanceof o.a&&t.dispose()})),[2,t.map((function(t,i){return $t(t,c[i])}))]}}))}))},e.prototype.withFaceExpressions=function(){return new mn(this,this.input)},e.prototype.withAgeAndGender=function(){return new wn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new En(this,this.input)},e}(Sn),An=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n,r,c;return Object(l.d)(this,(function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return(t=l.sent())?(e=t.detection,this.input instanceof o.a?[4,yt(this.input,[e])]:[3,3]):[2];case 2:return r=l.sent(),[3,5];case 3:return[4,gt(this.input,[e])];case 4:r=l.sent(),l.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return c=l.sent(),n.forEach((function(t){return t instanceof o.a&&t.dispose()})),[2,$t(t,c)]}}))}))},e.prototype.withFaceExpressions=function(){return new gn(this,this.input)},e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Tn(this,this.input)},e}(Sn),In=function(t){function e(input,e){void 0===e&&(e=new Oe);var n=t.call(this)||this;return n.input=input,n.options=e,n}return Object(l.c)(e,t),e}(Xe),Rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,input,e,n;return Object(l.d)(this,(function(r){switch(r.label){case 0:return input=(t=this).input,(e=t.options)instanceof Ce?[4,pn.mtcnn.forward(input,e)]:[3,2];case 1:return[2,r.sent().map((function(t){return t.detection}))];case 2:if(!(n=e instanceof He?function(input){return pn.tinyFaceDetector.locateFaces(input,e)}:e instanceof Oe?function(input){return pn.ssdMobilenetv1.locateFaces(input,e)}:e instanceof ze?function(input){return pn.tinyYolov2.locateFaces(input,e)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,n(input)]}}))}))},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise((function(e){return Object(l.b)(t,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map((function(t){return j({},t)})))]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new kn(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new dn(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new bn(this.runAndExtendWithFaceDetections(),this.input)},e}(In),On=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(l.c)(e,t),e.prototype.run=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,new Rn(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach((function(t){t.score>e.score&&(e=t)})),[2,e]}}))}))},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise((function(e){return Object(l.b)(t,void 0,void 0,(function(){var t;return Object(l.d)(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?j({},t):void 0)]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new An(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new vn(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new xn(this.runAndExtendWithFaceDetection(),this.input)},e}(In);function Dn(input,t){return void 0===t&&(t=new Oe),new On(input,t)}!function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map((function(desc){if(desc instanceof V)return desc;if(desc instanceof Float32Array)return new V(o(),[desc]);if(desc.descriptor&&desc.descriptor instanceof Float32Array)return new V(o(),[desc.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map((function(e){return function(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map((function(t,i){return t-r[i]})).reduce((function(t,e){return t+Math.pow(e,2)}),0))}(e,t)})).reduce((function(t,e){return t+e}),0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,label=n.label;return new L(label,e.computeMeanDistance(t,r))})).reduce((function(t,e){return t.distance<e.distance?t:e}))},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new L("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(t){return t.toJSON()}))}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map((function(t){return V.fromJSON(t)})),e.distanceThreshold)}}();function Mn(t,e){var n=new h(e.width,e.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(t))return t.map((function(t){return Mn(t,{width:r,height:o})}));if(Yt(t)){var c=t.detection.forSize(r,o),l=t.unshiftedLandmarks.forSize(c.box.width,c.box.height);return $t(j(t,c),l)}return U(t)?j(t,t.detection.forSize(r,o)):t instanceof F||t instanceof I?t.forSize(r,o):t}},238:function(t,e,n){"use strict";var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;e.a=function(t){return"string"==typeof t&&r.test(t)}},242:function(t,e,n){"use strict";var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),o=new Uint8Array(16);function c(){if(!r)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}for(var l=n(238),h=[],f=0;f<256;++f)h.push((f+256).toString(16).substr(1));var d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!Object(l.a)(n))throw TypeError("Stringified UUID is invalid");return n};e.a=function(t,e,n){var r=(t=t||{}).random||(t.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return d(r)}}}]);